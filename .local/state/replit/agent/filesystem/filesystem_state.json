{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Canada Tour 2025 Application\n\n## Overview\n\nThis is a comprehensive travel application for managing and showcasing a 17-day tour through Canada, focusing on the Okanagan Valley wine regions and Rocky Mountains. The application provides both a public-facing tour showcase and an administrative interface for content management. Built as a full-stack web application with a React frontend and Express backend, it features location management, image galleries, tour settings, and responsive design optimized for travel planning.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React with TypeScript using Vite as the build tool\n- **UI Library**: Shadcn/ui components built on Radix UI primitives for accessible, customizable components\n- **Styling**: Tailwind CSS with custom design tokens and CSS variables for theming\n- **Routing**: Wouter for lightweight client-side routing (Home, Location Detail, Admin Panel)\n- **State Management**: TanStack Query (React Query) for server state management and caching\n- **Form Handling**: React Hook Form with Zod validation for type-safe form management\n\n### Backend Architecture\n- **Framework**: Express.js with TypeScript running on Node.js\n- **API Design**: RESTful API with endpoints for locations, tour settings, and file uploads\n- **Data Storage**: In-memory storage implementation with interface for future database migration\n- **File Uploads**: Uppy integration with object storage for image management\n- **Development**: Hot module replacement via Vite integration for development workflow\n\n### Data Storage Solutions\n- **Database**: PostgreSQL with Drizzle ORM for type-safe database operations\n- **Schema**: Structured tables for locations, location images, and tour settings with JSON fields for flexible data\n- **Object Storage**: Google Cloud Storage integration with ACL policies for secure file management\n- **Migration**: Drizzle migrations for database schema versioning\n\n### Authentication and Authorization\n- **Object Access**: Custom ACL system for granular file access control\n- **Service Authentication**: Google Cloud service account authentication via Replit sidecar\n- **Admin Access**: Basic admin panel without user authentication (suitable for single-admin scenarios)\n\n### External Dependencies\n- **Google Cloud Storage**: For image and file storage with programmatic access control\n- **Neon Database**: PostgreSQL database hosting with serverless connection pooling\n- **Font Loading**: Google Fonts (Inter) for consistent typography\n- **Development Tools**: Replit-specific plugins for development environment integration\n\nThe architecture prioritizes type safety throughout the stack, responsive design for mobile and desktop use, and a clear separation between public tour showcase and administrative functionality. The modular component structure and shared schema definitions enable consistent data handling between frontend and backend.","size_bytes":3009},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\", \"Inter\", \"system-ui\", \"sans-serif\"],\n        serif: [\"var(--font-serif)\", \"Georgia\", \"serif\"],\n        mono: [\"var(--font-mono)\", \"Menlo\", \"monospace\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        fadeIn: {\n          from: { \n            opacity: \"0\", \n            transform: \"translateY(20px)\" \n          },\n          to: { \n            opacity: \"1\", \n            transform: \"translateY(0)\" \n          },\n        },\n        slideUp: {\n          from: { \n            transform: \"translateY(100%)\" \n          },\n          to: { \n            transform: \"translateY(0)\" \n          },\n        },\n        float: {\n          \"0%, 100%\": { \n            transform: \"translateY(0px)\" \n          },\n          \"50%\": { \n            transform: \"translateY(-10px)\" \n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"fade-in\": \"fadeIn 0.6s ease-in-out\",\n        \"slide-up\": \"slideUp 0.4s ease-out\",\n        \"float\": \"float 3s ease-in-out infinite\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":3573},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"attached_assets/LocationCard_1757810570712.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Wine, Mountain, Network } from \"lucide-react\";\nimport type { Location } from \"@shared/schema\";\n\ninterface LocationCardProps {\n  location: Location;\n}\n\nexport default function LocationCard({ location }: LocationCardProps) {\n  const getIcon = (category: string | null) => {\n    switch (category) {\n      case \"Wine Country\":\n        return <Wine className=\"mr-2 h-4 w-4\" />;\n      case \"Alpine Adventure\":\n        return <Mountain className=\"mr-2 h-4 w-4\" />;\n      case \"Wilderness\":\n        return <Network className=\"mr-2 h-4 w-4\" />;\n      default:\n        return <Mountain className=\"mr-2 h-4 w-4\" />;\n    }\n  };\n\n  const formatDateRange = (startDate: string, endDate: string) => {\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    const startMonth = start.toLocaleDateString('en-US', { month: 'short' });\n    const endMonth = end.toLocaleDateString('en-US', { month: 'short' });\n    \n    if (startMonth === endMonth) {\n      return `${startMonth} ${start.getDate()}-${end.getDate()}`;\n    }\n    return `${startMonth} ${start.getDate()} - ${endMonth} ${end.getDate()}`;\n  };\n\n  return (\n    <Card className=\"group cursor-pointer hover:shadow-lg transition-shadow\" data-testid={`location-card-${location.id}`}>\n      <div className=\"relative overflow-hidden\">\n        <img \n          src={location.imageUrl || \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4\"}\n          alt={location.name}\n          className=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\"\n        />\n      </div>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"text-xl font-semibold\">{location.name}</h3>\n          <span className=\"text-sm text-muted-foreground\">\n            {formatDateRange(location.startDate, location.endDate)}\n          </span>\n        </div>\n        <p className=\"text-muted-foreground text-sm mb-3\">{location.description}</p>\n        <div className=\"flex items-center text-primary text-sm\">\n          {getIcon(location.category)}\n          <span>{location.category}</span>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2245},"attached_assets/index_1757810570727.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0 0% 100%);\n  --foreground: hsl(215 25% 27%);\n  --card: hsl(0 0% 100%);\n  --card-foreground: hsl(215 25% 27%);\n  --primary: hsl(173 80% 40%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(210 40% 96%);\n  --secondary-foreground: hsl(215 25% 27%);\n  --muted: hsl(210 40% 96%);\n  --muted-foreground: hsl(215 20% 55%);\n  --accent: hsl(173 80% 40%);\n  --accent-foreground: hsl(0 0% 100%);\n  --border: hsl(220 13% 91%);\n  --input: hsl(220 13% 91%);\n  --ring: hsl(173 80% 40%);\n  --destructive: hsl(0 84% 60%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --radius: 0.75rem;\n  --font-sans: 'Inter', sans-serif;\n}\n\n.dark {\n  --background: hsl(222 84% 4%);\n  --foreground: hsl(210 40% 98%);\n  --card: hsl(222 84% 4%);\n  --card-foreground: hsl(210 40% 98%);\n  --primary: hsl(173 80% 40%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(217 32% 17%);\n  --secondary-foreground: hsl(210 40% 98%);\n  --muted: hsl(217 32% 17%);\n  --muted-foreground: hsl(215 20% 65%);\n  --accent: hsl(173 80% 40%);\n  --accent-foreground: hsl(0 0% 100%);\n  --border: hsl(217 32% 17%);\n  --input: hsl(217 32% 17%);\n  --ring: hsl(173 80% 40%);\n  --destructive: hsl(0 84% 60%);\n  --destructive-foreground: hsl(0 0% 100%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  \n  body {\n    @apply bg-background text-foreground font-sans antialiased;\n  }\n}\n\n@layer utilities {\n  .glass-effect {\n    backdrop-filter: blur(10px);\n    background: rgba(255, 255, 255, 0.95);\n  }\n  \n  .dark .glass-effect {\n    background: rgba(0, 0, 0, 0.95);\n  }\n}\n\n@keyframes fadeIn {\n  from { \n    opacity: 0; \n    transform: translateY(20px); \n  }\n  to { \n    opacity: 1; \n    transform: translateY(0); \n  }\n}\n\n@keyframes slideUp {\n  from { \n    transform: translateY(100%); \n  }\n  to { \n    transform: translateY(0); \n  }\n}\n\n@keyframes float {\n  0%, 100% { \n    transform: translateY(0px); \n  }\n  50% { \n    transform: translateY(-10px); \n  }\n}\n\n.animate-fade-in {\n  animation: fadeIn 0.6s ease-in-out;\n}\n\n.animate-slide-up {\n  animation: slideUp 0.4s ease-out;\n}\n\n.animate-float {\n  animation: float 3s ease-in-out infinite;\n}\n","size_bytes":2287},"attached_assets/tailwind.config_1757810570728.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        fadeIn: {\n          from: { \n            opacity: \"0\", \n            transform: \"translateY(20px)\" \n          },\n          to: { \n            opacity: \"1\", \n            transform: \"translateY(0)\" \n          },\n        },\n        slideUp: {\n          from: { \n            transform: \"translateY(100%)\" \n          },\n          to: { \n            transform: \"translateY(0)\" \n          },\n        },\n        float: {\n          \"0%, 100%\": { \n            transform: \"translateY(0px)\" \n          },\n          \"50%\": { \n            transform: \"translateY(-10px)\" \n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"fade-in\": \"fadeIn 0.6s ease-in-out\",\n        \"slide-up\": \"slideUp 0.4s ease-out\",\n        \"float\": \"float 3s ease-in-out infinite\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":3495},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","size_bytes":5544},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err: any) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the upload URL for a public object entity.\n  async getPublicObjectEntityUploadURL(): Promise<string> {\n    const publicObjectSearchPaths = this.getPublicObjectSearchPaths();\n    if (!publicObjectSearchPaths || publicObjectSearchPaths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var.\"\n      );\n    }\n\n    // Use the first public search path\n    const publicObjectDir = publicObjectSearchPaths[0];\n    const objectId = randomUUID();\n    const fullPath = `${publicObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets a display URL for an uploaded object entity.\n  async getObjectEntityDisplayURL(objectPath: string): Promise<string> {\n    const { bucketName, objectName } = parseObjectPath(objectPath);\n\n    // Sign URL for GET method with extended TTL for display (30 days)\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"GET\",\n      ttlSec: 2592000, // 30 days (30 * 24 * 60 * 60)\n    });\n  }\n\n  // Gets the upload URL and object path for an object entity.\n  async getObjectEntityUploadInfo(): Promise<{ uploadURL: string; objectPath: string }> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    const uploadURL = await signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n\n    return {\n      uploadURL,\n      objectPath: fullPath\n    };\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nexport function parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\n// Semaphore-based rate limiter for concurrent requests to avoid overwhelming the sidecar\nlet currentRequests = 0;\nconst MAX_CONCURRENT_REQUESTS = 3;\nconst requestQueue: Array<{ resolve: () => void; reject: (error: Error) => void }> = [];\n\nasync function acquireSlot(): Promise<void> {\n  if (currentRequests < MAX_CONCURRENT_REQUESTS) {\n    currentRequests++;\n    return Promise.resolve();\n  }\n\n  return new Promise<void>((resolve, reject) => {\n    requestQueue.push({ resolve, reject });\n  });\n}\n\nfunction releaseSlot(): void {\n  currentRequests--;\n  if (requestQueue.length > 0) {\n    const next = requestQueue.shift();\n    if (next) {\n      currentRequests++;\n      next.resolve();\n    }\n  }\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n\n  // Retry logic for failed requests\n  const maxRetries = 3;\n  let lastError: Error | undefined;\n\n  // Acquire semaphore slot before starting requests\n  await acquireSlot();\n\n  try {\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const response = await fetch(\n          `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n          {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(request),\n            // Add timeout to prevent hanging requests\n            signal: AbortSignal.timeout(10000), // 10 second timeout\n          }\n        );\n        \n        if (response.ok) {\n          const { signed_url: signedURL } = await response.json();\n          return signedURL;\n        } else {\n          // Get error details for better debugging\n          const errorText = await response.text();\n          console.error(`Sidecar error details:`, {\n            status: response.status,\n            statusText: response.statusText,\n            headers: Object.fromEntries(response.headers.entries()),\n            body: errorText,\n            requestData: request\n          });\n          \n          lastError = new Error(\n            `Failed to sign object URL, errorcode: ${response.status}, ` +\n            `error: ${errorText}, make sure you're running on Replit`\n          );\n          \n          // Don't retry immediately on auth errors (400-499)\n          if (response.status >= 400 && response.status < 500) {\n            throw lastError;\n          }\n        }\n      } catch (error: any) {\n        lastError = error;\n        \n        // Don't retry on timeout or auth errors\n        if (error.name === 'TimeoutError' || error.name === 'AbortError' ||\n            (error.message && error.message.includes('errorcode: 4'))) {\n          throw error;\n        }\n        \n        // Wait before retrying (exponential backoff)\n        if (attempt < maxRetries) {\n          await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt - 1) * 1000));\n        }\n      }\n    }\n\n    throw lastError || new Error('Failed to sign object URL after retries');\n  } finally {\n    // Always release the semaphore slot\n    releaseSlot();\n  }\n\n  throw lastError || new Error('Failed to sign object URL after retries');\n}\n","size_bytes":13073},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { ObjectStorageService, objectStorageClient, parseObjectPath } from \"./objectStorage\";\nimport { insertLocationSchema, insertLocationImageSchema, insertTripPhotoSchema, insertTourSettingsSchema, insertLocationPingSchema, insertHeroImageSchema, insertScenicContentSchema, scenicContentUpdateSchema, insertCreatorSchema, tripPhotos } from \"@shared/schema\";\nimport { syncExternalData } from \"./sync-external-data\";\nimport { z } from \"zod\";\nimport { db } from \"./db\";\nimport { sql } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\nimport multer from \"multer\";\nimport { randomUUID } from \"crypto\";\nimport crypto from \"crypto\";\n\n// Configure multer for image uploads (legacy endpoints)\nconst upload = multer({\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB max file size\n  },\n  fileFilter: (req, file, cb) => {\n    // Check file type\n    const allowedMimeTypes = [\n      'image/jpeg',\n      'image/jpg', \n      'image/png',\n      'image/webp',\n      'image/gif'\n    ];\n    \n    if (allowedMimeTypes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error('Nur Bilddateien sind erlaubt (JPG, PNG, WebP, GIF)'));\n    }\n  }\n});\n\n// Configure multer for media uploads (images and videos)\nconst mediaUpload = multer({\n  limits: {\n    fileSize: 52428800, // 50MB max file size for videos\n    fieldSize: 52428800, // 50MB max field size\n    fields: 10, // Max number of non-file fields\n    files: 10, // Max number of files\n  },\n  fileFilter: (req, file, cb) => {\n    // Check file type for both images and videos\n    const allowedImageTypes = [\n      'image/jpeg',\n      'image/jpg', \n      'image/png',\n      'image/webp',\n      'image/gif'\n    ];\n    \n    const allowedVideoTypes = [\n      'video/mp4',\n      'video/webm',\n      'video/quicktime'\n    ];\n    \n    const allAllowedTypes = [...allowedImageTypes, ...allowedVideoTypes];\n    \n    if (allAllowedTypes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error('Nur Bilder (JPG, PNG, WebP, GIF) und Videos (MP4, WebM, MOV) sind erlaubt'));\n    }\n  }\n});\n\n// Validate image URL security\nfunction validateImageUrl(imageUrl: string): { valid: boolean; error?: string } {\n  try {\n    const url = new URL(imageUrl);\n    \n    // Only allow HTTPS URLs\n    if (url.protocol !== 'https:') {\n      return { valid: false, error: \"Nur HTTPS URLs sind erlaubt\" };\n    }\n    \n    // Allow specific trusted hostnames\n    const allowedHosts = [\n      'storage.googleapis.com',\n      'images.unsplash.com',\n      'plus.unsplash.com',\n      'cdn.pixabay.com',\n      'images.pexels.com'\n    ];\n    \n    // Check for Google Cloud Storage bucket patterns (e.g., storage.googleapis.com)\n    const isGoogleStorageBucket = url.hostname === 'storage.googleapis.com' || \n                                 url.hostname.includes('storage.googleapis.com');\n    \n    // Check for object storage bucket patterns used by Replit (replit-objstore-)\n    const isReplitObjectStore = url.hostname.includes('storage.googleapis.com') && \n                               url.pathname.includes('replit-objstore-');\n    \n    const isAllowedHost = allowedHosts.some(host => \n      url.hostname === host || \n      url.hostname.endsWith('.' + host)\n    ) || isGoogleStorageBucket || isReplitObjectStore;\n    \n    if (!isAllowedHost) {\n      return { valid: false, error: \"Bild-Host ist nicht erlaubt\" };\n    }\n    \n    // Check for image file extensions or query parameters that indicate images\n    const imageExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif'];\n    const hasImageExtension = imageExtensions.some(ext => \n      url.pathname.toLowerCase().includes(ext)\n    );\n    \n    // For some services like Unsplash, check query parameters\n    const hasImageFormat = url.searchParams.get('fm') || url.pathname.includes('photo');\n    \n    // Skip file extension check for trusted Google Cloud Storage URLs (signed URLs often don't have extensions)\n    const isGoogleCloudStorageUrl = url.hostname === 'storage.googleapis.com';\n    \n    if (!hasImageExtension && !hasImageFormat && !isGoogleCloudStorageUrl) {\n      return { valid: false, error: \"Nur Bilddateien sind erlaubt (jpg, png, webp, gif)\" };\n    }\n    \n    return { valid: true };\n  } catch (error) {\n    return { valid: false, error: \"Ungültige URL\" };\n  }\n}\n\n// Simple auth validation for sensitive operations\nfunction simpleAuthMiddleware(req: any, res: any, next: any) {\n  const adminToken = req.headers['admin-token'];\n  \n  // Only allow requests with valid admin token\n  if (adminToken === process.env.ADMIN_TOKEN && process.env.ADMIN_TOKEN) {\n    return next();\n  }\n  \n  // For admin endpoints, require proper authentication\n  if (req.path.startsWith('/api/admin/')) {\n    return res.status(401).json({ error: 'Authentication required for admin operations' });\n  }\n  \n  // For other operations, allow public access (trip photo uploads, etc.)\n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Location routes\n  app.get(\"/api/locations\", async (req, res) => {\n    try {\n      const locations = await storage.getLocations();\n      // Cache-busting headers for immediate sync updates\n      res.set({\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      res.json(locations);\n    } catch (error) {\n      console.error(\"Error fetching locations:\", error);\n      res.status(500).json({ error: \"Failed to fetch locations\" });\n    }\n  });\n\n  app.get(\"/api/locations/:slug\", async (req, res) => {\n    try {\n      const location = await storage.getLocationBySlug(req.params.slug);\n      if (!location) {\n        return res.status(404).json({ error: \"Location not found\" });\n      }\n      // Cache-busting headers for immediate sync updates\n      res.set({\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      res.json(location);\n    } catch (error) {\n      console.error(\"Error fetching location:\", error);\n      res.status(500).json({ error: \"Failed to fetch location\" });\n    }\n  });\n\n  app.post(\"/api/locations\", async (req, res) => {\n    try {\n      const validation = insertLocationSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid location data\", details: validation.error });\n      }\n      \n      const location = await storage.createLocation(validation.data);\n      res.status(201).json(location);\n    } catch (error) {\n      console.error(\"Error creating location:\", error);\n      res.status(500).json({ error: \"Failed to create location\" });\n    }\n  });\n\n  app.put(\"/api/locations/:id\", async (req, res) => {\n    try {\n      const validation = insertLocationSchema.partial().safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid location data\", details: validation.error });\n      }\n\n      const location = await storage.updateLocation(req.params.id, validation.data);\n      res.json(location);\n    } catch (error) {\n      console.error(\"Error updating location:\", error);\n      res.status(500).json({ error: \"Failed to update location\" });\n    }\n  });\n\n  app.delete(\"/api/locations/:id\", async (req, res) => {\n    try {\n      await storage.deleteLocation(req.params.id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting location:\", error);\n      res.status(500).json({ error: \"Failed to delete location\" });\n    }\n  });\n\n  // Location images routes\n  app.get(\"/api/locations/:locationId/images\", async (req, res) => {\n    try {\n      const images = await storage.getLocationImages(req.params.locationId);\n      // Cache-busting headers for immediate sync updates\n      res.set({\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      res.json(images);\n    } catch (error) {\n      console.error(\"Error fetching location images:\", error);\n      res.status(500).json({ error: \"Failed to fetch images\" });\n    }\n  });\n\n  app.post(\"/api/locations/:locationId/images\", async (req, res) => {\n    try {\n      const imageData = { ...req.body, locationId: req.params.locationId };\n      const validation = insertLocationImageSchema.safeParse(imageData);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid image data\", details: validation.error });\n      }\n\n      const image = await storage.addLocationImage(validation.data);\n      res.status(201).json(image);\n    } catch (error) {\n      console.error(\"Error adding location image:\", error);\n      res.status(500).json({ error: \"Failed to add image\" });\n    }\n  });\n\n  app.delete(\"/api/locations/:locationId/images/:imageId\", async (req, res) => {\n    try {\n      await storage.deleteLocationImage(req.params.imageId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting image:\", error);\n      res.status(500).json({ error: \"Failed to delete image\" });\n    }\n  });\n\n  app.put(\"/api/locations/:locationId/images/:imageId/main\", async (req, res) => {\n    try {\n      await storage.setMainImage(req.params.locationId, req.params.imageId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error setting main image:\", error);\n      res.status(500).json({ error: \"Failed to set main image\" });\n    }\n  });\n\n  // Trip photos routes\n  app.get(\"/api/locations/:locationId/trip-photos\", async (req, res) => {\n    try {\n      const tripPhotos = await storage.getTripPhotos(req.params.locationId);\n      \n      // Filter out photos without objectPath (old broken uploads)\n      const validPhotos = tripPhotos.filter(photo => photo.objectPath);\n      \n      // Generate direct serving URLs for each photo (no signed URLs needed)\n      const photosWithUrls = validPhotos.map(photo => ({\n        ...photo,\n        imageUrl: `/api/trip-photos/${photo.id}/image`\n      }));\n      \n      res.json(photosWithUrls);\n    } catch (error) {\n      console.error(\"Error fetching trip photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch trip photos\" });\n    }\n  });\n\n  // Simplified direct file upload for trip photos\n  app.post(\"/api/locations/:locationId/trip-photos\", \n    upload.single('image'),\n    async (req, res) => {\n    try {\n      // Check if location exists\n      const location = await storage.getLocation(req.params.locationId);\n      if (!location) {\n        return res.status(404).json({ \n          error: \"Location nicht gefunden. Bitte wählen Sie eine gültige Location.\" \n        });\n      }\n\n      // Check if file was uploaded\n      if (!req.file) {\n        return res.status(400).json({ \n          error: \"Bitte wählen Sie ein Bild zum Hochladen.\" \n        });\n      }\n\n      // Validate form data\n      const { caption, uploadedBy, creatorId } = req.body;\n      \n      // Debug log to verify data received\n      console.log('Received upload data:', { caption, uploadedBy, creatorId });\n      \n      // Validate caption length\n      if (caption && caption.length > 500) {\n        return res.status(400).json({ \n          error: \"Bildunterschrift ist zu lang (maximal 500 Zeichen)\" \n        });\n      }\n\n      // Validate uploadedBy length  \n      if (uploadedBy && uploadedBy.length > 100) {\n        return res.status(400).json({ \n          error: \"Name ist zu lang (maximal 100 Zeichen)\" \n        });\n      }\n\n      // Handle file upload to object storage\n      try {\n        const objectStorageService = new ObjectStorageService();\n        const { uploadURL, objectPath } = await objectStorageService.getObjectEntityUploadInfo();\n        \n        // Upload file to object storage\n        const uploadResponse = await fetch(uploadURL, {\n          method: 'PUT',\n          body: req.file.buffer,\n          headers: {\n            'Content-Type': req.file.mimetype,\n          },\n        });\n\n        if (!uploadResponse.ok) {\n          throw new Error('Upload zu Object Storage fehlgeschlagen');\n        }\n\n        // Store objectPath for permanent access (don't store expiring displayURL)\n        // We'll generate fresh display URLs on GET requests\n\n        // Create trip photo record with objectPath\n        const tripPhotoData = {\n          locationId: req.params.locationId,\n          creatorId: creatorId || null, // Store creator ID for proper attribution\n          objectPath: objectPath, // Store permanent path\n          imageUrl: '/placeholder', // Placeholder - real URL generated on GET\n          caption: caption || null,\n          uploadedBy: uploadedBy || null,\n        };\n\n        const tripPhoto = await storage.addTripPhoto(tripPhotoData);\n        res.status(201).json(tripPhoto);\n\n      } catch (uploadError) {\n        console.error(\"File upload error:\", uploadError);\n        return res.status(500).json({ \n          error: \"Datei-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.\" \n        });\n      }\n\n    } catch (error) {\n      console.error(\"Error adding trip photo:\", error);\n      res.status(500).json({ \n        error: \"Foto konnte nicht hochgeladen werden. Bitte versuchen Sie es erneut.\" \n      });\n    }\n  });\n\n  // Direct image serving endpoint for trip photos\n  app.get(\"/api/trip-photos/:photoId/image\", async (req, res) => {\n    try {\n      const photoId = req.params.photoId;\n      const tripPhotos = await storage.getAllTripPhotos();\n      const photo = tripPhotos.find(p => p.id === photoId);\n      \n      if (!photo || !photo.objectPath) {\n        return res.status(404).json({ error: \"Photo not found\" });\n      }\n\n      // Parse the object path to get bucket and object name\n      let { bucketName, objectName } = parseObjectPath(photo.objectPath);\n      const objectStorageService = new ObjectStorageService();\n      \n      // Get the file directly from object storage\n      const bucket = objectStorageClient.bucket(bucketName);\n      let file = bucket.file(objectName);\n      \n      // Check if file exists at the stored path\n      let [exists] = await file.exists();\n      \n      // If not found and path contains 'public/uploads', try private directory\n      if (!exists && objectName.includes('public/uploads')) {\n        const privateObjectName = objectName.replace('public/uploads', '.private/uploads');\n        file = bucket.file(privateObjectName);\n        [exists] = await file.exists();\n      }\n      \n      if (!exists) {\n        return res.status(404).json({ error: \"Image file not found\" });\n      }\n      \n      // Use the existing downloadObject method to serve the file\n      await objectStorageService.downloadObject(file, res, 86400); // 24 hour cache\n      \n    } catch (error) {\n      console.error(\"Error serving trip photo image:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Failed to serve image\" });\n      }\n    }\n  });\n\n  // Centralized trip photos routes\n  app.get(\"/api/trip-photos\", async (req, res) => {\n    try {\n      const tripPhotos = await storage.getAllTripPhotos();\n      \n      // Filter out photos without objectPath (old broken uploads)\n      const validPhotos = tripPhotos.filter(photo => photo.objectPath);\n      \n      // Generate direct serving URLs for each photo (no signed URLs needed)\n      const photosWithUrls = validPhotos.map(photo => ({\n        ...photo,\n        imageUrl: `/api/trip-photos/${photo.id}/image`\n      }));\n      \n      res.json(photosWithUrls);\n    } catch (error) {\n      console.error(\"Error fetching all trip photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch trip photos\" });\n    }\n  });\n\n  app.post(\"/api/trip-photos\", \n    upload.single('image'),\n    async (req, res) => {\n    try {\n      // Check if file was uploaded\n      if (!req.file) {\n        return res.status(400).json({ \n          error: \"Bitte wählen Sie ein Bild zum Hochladen.\" \n        });\n      }\n\n      // Extract FormData fields - handle empty strings properly\n      const caption = req.body?.caption || null;\n      const uploadedBy = req.body?.uploadedBy || null;\n      const locationId = req.body?.locationId || null;\n      const creatorId = req.body?.creatorId || null;\n      \n      // Debug log to verify data received\n      console.log('===== CENTRALIZED ROUTE DEBUG =====');\n      console.log('req.body type:', typeof req.body);\n      console.log('req.body keys:', Object.keys(req.body || {}));\n      console.log('req.body full:', JSON.stringify(req.body, null, 2));\n      console.log('req.file:', req.file ? { fieldname: req.file.fieldname, originalname: req.file.originalname, size: req.file.size } : 'Missing');\n      console.log('Raw field checks:');\n      console.log('- req.body.caption:', typeof req.body?.caption, '=', req.body?.caption);\n      console.log('- req.body.uploadedBy:', typeof req.body?.uploadedBy, '=', req.body?.uploadedBy);\n      console.log('- req.body.locationId:', typeof req.body?.locationId, '=', req.body?.locationId);\n      console.log('- req.body.creatorId:', typeof req.body?.creatorId, '=', req.body?.creatorId);\n      console.log('Extracted values:', { caption, uploadedBy, locationId, creatorId });\n      console.log('=================================');\n      \n      // Validate caption length\n      if (caption && caption.length > 500) {\n        return res.status(400).json({ \n          error: \"Bildunterschrift ist zu lang (maximal 500 Zeichen)\" \n        });\n      }\n\n      // Validate uploadedBy length  \n      if (uploadedBy && uploadedBy.length > 100) {\n        return res.status(400).json({ \n          error: \"Name ist zu lang (maximal 100 Zeichen)\" \n        });\n      }\n\n      // Validate locationId if provided (optional location tagging)\n      if (locationId) {\n        const location = await storage.getLocation(locationId);\n        if (!location) {\n          return res.status(400).json({ \n            error: \"Ungültige Location-ID angegeben.\" \n          });\n        }\n      }\n\n      // Handle file upload to object storage\n      try {\n        const objectStorageService = new ObjectStorageService();\n        const { uploadURL, objectPath } = await objectStorageService.getObjectEntityUploadInfo();\n        \n        // Upload file to object storage\n        const uploadResponse = await fetch(uploadURL, {\n          method: 'PUT',\n          body: req.file.buffer,\n          headers: {\n            'Content-Type': req.file.mimetype,\n          },\n        });\n\n        if (!uploadResponse.ok) {\n          throw new Error('Upload zu Object Storage fehlgeschlagen');\n        }\n\n        // Store objectPath for permanent access (don't store expiring displayURL)\n        // We'll generate fresh display URLs on GET requests\n\n        // Create trip photo record with objectPath\n        const tripPhotoData = {\n          locationId: locationId || null, // Optional location tag\n          creatorId: creatorId || null, // Creator who uploaded the photo\n          objectPath: objectPath, // Store permanent path\n          imageUrl: '/placeholder', // Placeholder - real URL generated on GET\n          caption: caption || null,\n          uploadedBy: uploadedBy || null,\n        };\n\n        const tripPhoto = await storage.addTripPhoto(tripPhotoData);\n        res.status(201).json(tripPhoto);\n\n      } catch (uploadError) {\n        console.error(\"File upload error:\", uploadError);\n        return res.status(500).json({ \n          error: \"Datei-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.\" \n        });\n      }\n\n    } catch (error) {\n      console.error(\"Error adding centralized trip photo:\", error);\n      res.status(500).json({ \n        error: \"Foto konnte nicht hochgeladen werden. Bitte versuchen Sie es erneut.\" \n      });\n    }\n  });\n\n  // Paginated trip photos endpoint\n  app.get(\"/api/trip-photos/paginated\", async (req, res) => {\n    try {\n      const { locationId, limit = '10', cursor } = req.query;\n      \n      const params = {\n        locationId: locationId as string || undefined,\n        limit: parseInt(limit as string),\n        cursor: cursor as string || undefined,\n      };\n      \n      const result = await storage.listTripPhotos(params);\n      \n      // Generate direct serving URLs for each photo\n      const itemsWithUrls = result.items.map(photo => ({\n        ...photo,\n        imageUrl: `/api/trip-photos/${photo.id}/image`,\n        videoUrl: photo.videoUrl ? `/api/trip-photos/${photo.id}/video` : null,\n        thumbnailUrl: photo.thumbnailUrl ? `/api/trip-photos/${photo.id}/thumbnail` : null,\n      }));\n      \n      res.json({\n        items: itemsWithUrls,\n        nextCursor: result.nextCursor,\n      });\n    } catch (error) {\n      console.error(\"Error fetching paginated trip photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch trip photos\" });\n    }\n  });\n\n  // Grouped paginated trip photos endpoint\n  app.get(\"/api/trip-photos/paginated-grouped\", async (req, res) => {\n    try {\n      const { locationId, limit = '10', cursor } = req.query;\n      \n      const params = {\n        locationId: locationId as string || undefined,\n        limit: parseInt(limit as string),\n        cursor: cursor as string || undefined,\n      };\n      \n      const result = await storage.listTripPhotosGrouped(params);\n      \n      // Generate direct serving URLs for media items in each group\n      const itemsWithUrls = result.items.map(group => ({\n        ...group,\n        media: group.media.map(mediaItem => ({\n          ...mediaItem,\n          imageUrl: `/api/trip-photos/${mediaItem.id}/image`,\n          videoUrl: mediaItem.videoUrl ? `/api/trip-photos/${mediaItem.id}/video` : null,\n          thumbnailUrl: mediaItem.thumbnailUrl ? `/api/trip-photos/${mediaItem.id}/thumbnail` : null,\n        }))\n      }));\n      \n      res.json({\n        items: itemsWithUrls,\n        nextCursor: result.nextCursor,\n      });\n    } catch (error) {\n      console.error(\"Error fetching grouped trip photos:\", error);\n      res.status(500).json({ error: \"Failed to fetch grouped trip photos\" });\n    }\n  });\n\n  // Video/Media upload endpoint\n  app.post(\"/api/trip-photos/media\", \n    mediaUpload.fields([\n      { name: 'media', maxCount: 1 },\n      { name: 'thumbnail', maxCount: 1 }\n    ]),\n    async (req, res) => {\n    try {\n      const files = req.files as { [fieldname: string]: Express.Multer.File[] };\n      \n      if (!files.media || files.media.length === 0) {\n        return res.status(400).json({ \n          error: \"Bitte wählen Sie eine Datei zum Hochladen.\" \n        });\n      }\n\n      const mediaFile = files.media[0];\n      const thumbnailFile = files.thumbnail?.[0];\n      \n      // Extract form data\n      const { caption, uploadedBy, locationId, creatorId, mediaType = 'image', groupId } = req.body;\n      \n      // Generate delete token\n      const deleteToken = crypto.randomBytes(32).toString('hex');\n      \n      // Validate file types and sizes\n      const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\n      const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\n      const maxImageSize = 10 * 1024 * 1024; // 10MB\n      // No size limit for videos\n      \n      if (mediaType === 'video') {\n        if (!allowedVideoTypes.includes(mediaFile.mimetype)) {\n          return res.status(400).json({ \n            error: \"Ungültiger Videotyp. Erlaubte Formate: MP4, WebM, MOV\" \n          });\n        }\n        // No file size validation for videos - upload any size\n      } else if (mediaType === 'image') {\n        if (!allowedImageTypes.includes(mediaFile.mimetype)) {\n          return res.status(400).json({ \n            error: \"Ungültiger Bildtyp. Erlaubte Formate: JPEG, PNG, WebP, GIF\" \n          });\n        }\n        if (mediaFile.size > maxImageSize) {\n          return res.status(413).json({ \n            error: \"Bild ist zu groß. Maximale Größe: 10MB\" \n          });\n        }\n      }\n\n      try {\n        const objectStorageService = new ObjectStorageService();\n        \n        // Upload main media file\n        const { uploadURL: mediaUploadURL, objectPath: mediaObjectPath } = \n          await objectStorageService.getObjectEntityUploadInfo();\n        \n        const mediaUploadResponse = await fetch(mediaUploadURL, {\n          method: 'PUT',\n          body: mediaFile.buffer,\n          headers: {\n            'Content-Type': mediaFile.mimetype,\n          },\n        });\n\n        if (!mediaUploadResponse.ok) {\n          throw new Error('Upload zu Object Storage fehlgeschlagen');\n        }\n\n        let thumbnailObjectPath = null;\n        \n        // Upload thumbnail if provided (for videos)\n        if (thumbnailFile) {\n          const { uploadURL: thumbUploadURL, objectPath: thumbObjectPath } = \n            await objectStorageService.getObjectEntityUploadInfo();\n          \n          const thumbUploadResponse = await fetch(thumbUploadURL, {\n            method: 'PUT',\n            body: thumbnailFile.buffer,\n            headers: {\n              'Content-Type': thumbnailFile.mimetype,\n            },\n          });\n\n          if (thumbUploadResponse.ok) {\n            thumbnailObjectPath = thumbObjectPath;\n          }\n        }\n\n        // Create trip photo record with media info\n        const tripPhotoData = {\n          locationId: locationId || null,\n          creatorId: creatorId || null,\n          objectPath: mediaObjectPath,\n          imageUrl: '/placeholder',\n          caption: caption || null,\n          uploadedBy: uploadedBy || null,\n          mediaType: mediaType,\n          videoUrl: mediaType === 'video' ? mediaObjectPath : null,\n          thumbnailUrl: thumbnailObjectPath,\n          deleteToken,\n          groupId: groupId || null,\n        };\n\n        const tripPhoto = await storage.createTripPhotoMedia(tripPhotoData);\n        \n        // Return photo with delete token for client-side storage\n        res.status(201).json({\n          ...tripPhoto,\n          imageUrl: `/api/trip-photos/${tripPhoto.id}/image`,\n          videoUrl: tripPhoto.videoUrl ? `/api/trip-photos/${tripPhoto.id}/video` : null,\n          thumbnailUrl: tripPhoto.thumbnailUrl ? `/api/trip-photos/${tripPhoto.id}/thumbnail` : null,\n          deleteToken: deleteToken, // Explicitly include the delete token\n        });\n\n      } catch (uploadError) {\n        console.error(\"Media upload error:\", uploadError);\n        return res.status(500).json({ \n          error: \"Datei-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.\" \n        });\n      }\n\n    } catch (error) {\n      console.error(\"Error adding media trip photo:\", error);\n      res.status(500).json({ \n        error: \"Media konnte nicht hochgeladen werden. Bitte versuchen Sie es erneut.\" \n      });\n    }\n  });\n\n  // Batch media upload endpoint for multiple files\n  app.post(\"/api/trip-photos/media-batch\", \n    (req, res, next) => {\n      mediaUpload.array('media', 10)(req, res, (err) => {\n        if (err) {\n          console.error(\"Multer error:\", err);\n          \n          // Handle specific multer errors\n          if (err.code === 'LIMIT_FILE_SIZE') {\n            return res.status(413).json({ \n              error: \"Datei zu groß. Videos müssen unter 50MB und Bilder unter 10MB sein.\" \n            });\n          } else if (err.code === 'LIMIT_FILE_COUNT') {\n            return res.status(400).json({ \n              error: \"Zu viele Dateien. Maximal 10 Dateien erlaubt.\" \n            });\n          } else if (err.code === 'LIMIT_UNEXPECTED_FILE') {\n            return res.status(400).json({ \n              error: \"Unerwartete Datei. Bitte verwenden Sie das richtige Upload-Feld.\" \n            });\n          } else if (err.message) {\n            return res.status(400).json({ \n              error: err.message \n            });\n          } else {\n            return res.status(500).json({ \n              error: \"Datei-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.\" \n            });\n          }\n        }\n        next();\n      });\n    },\n    async (req, res) => {\n    try {\n      const files = req.files as Express.Multer.File[];\n      \n      if (!files || files.length === 0) {\n        return res.status(400).json({ \n          error: \"Bitte wählen Sie mindestens eine Datei zum Hochladen.\" \n        });\n      }\n\n      // Extract form data\n      const { caption, uploadedBy, locationId, creatorId, exifData } = req.body;\n      \n      // Parse EXIF data if provided\n      let parsedExifData: Record<number, string> = {};\n      try {\n        if (exifData) {\n          parsedExifData = JSON.parse(exifData);\n        }\n      } catch (error) {\n        console.warn(\"Failed to parse EXIF data:\", error);\n      }\n      \n      // Generate a group ID for this batch\n      const groupId = randomUUID();\n      \n      // Validate file types and sizes\n      const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\n      const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\n      const maxImageSize = 10 * 1024 * 1024; // 10MB\n      \n      // Process each file\n      const results = [];\n      \n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const isVideo = allowedVideoTypes.includes(file.mimetype);\n        const isImage = allowedImageTypes.includes(file.mimetype);\n        \n        if (!isVideo && !isImage) {\n          console.warn(`Skipping file ${file.originalname}: invalid type ${file.mimetype}`);\n          continue;\n        }\n        \n        if (isImage && file.size > maxImageSize) {\n          console.warn(`Skipping file ${file.originalname}: too large (${file.size} bytes)`);\n          continue;\n        }\n        \n        try {\n          // Generate delete token for this file\n          const deleteToken = crypto.randomBytes(32).toString('hex');\n          \n          const objectStorageService = new ObjectStorageService();\n          \n          // Upload file to object storage\n          const { uploadURL, objectPath } = await objectStorageService.getObjectEntityUploadInfo();\n          \n          const uploadResponse = await fetch(uploadURL, {\n            method: 'PUT',\n            body: file.buffer,\n            headers: {\n              'Content-Type': file.mimetype,\n            },\n          });\n\n          if (!uploadResponse.ok) {\n            console.warn(`Failed to upload file ${file.originalname} to object storage`);\n            continue;\n          }\n\n          // Get EXIF date for this file if available\n          let takenAt = null;\n          if (parsedExifData[i]) {\n            try {\n              takenAt = new Date(parsedExifData[i]);\n              // Validate the date\n              if (isNaN(takenAt.getTime())) {\n                takenAt = null;\n              }\n            } catch (error) {\n              console.warn(`Invalid EXIF date for file ${file.originalname}:`, error);\n              takenAt = null;\n            }\n          }\n\n          // Create trip photo record\n          const tripPhotoData = {\n            locationId: locationId || null,\n            creatorId: creatorId || null,\n            objectPath: objectPath,\n            imageUrl: '/placeholder',\n            caption: caption || null,\n            uploadedBy: uploadedBy || null,\n            mediaType: isVideo ? 'video' : 'image',\n            videoUrl: isVideo ? objectPath : null,\n            thumbnailUrl: null,\n            deleteToken,\n            groupId: groupId,\n            takenAt: takenAt,\n          };\n\n          const tripPhoto = await storage.createTripPhotoMedia(tripPhotoData);\n          \n          results.push({\n            ...tripPhoto,\n            imageUrl: `/api/trip-photos/${tripPhoto.id}/image`,\n            videoUrl: tripPhoto.videoUrl ? `/api/trip-photos/${tripPhoto.id}/video` : null,\n            thumbnailUrl: tripPhoto.thumbnailUrl ? `/api/trip-photos/${tripPhoto.id}/thumbnail` : null,\n            deleteToken: deleteToken,\n          });\n\n        } catch (fileError) {\n          console.error(`Error processing file ${file.originalname} (${file.mimetype}, ${file.size} bytes):`, fileError);\n          console.error('Failed tripPhotoData for file:', file.originalname);\n          console.error('File metadata:', {\n            originalname: file.originalname,\n            mimetype: file.mimetype,\n            size: file.size,\n            isVideo: allowedVideoTypes.includes(file.mimetype),\n            isImage: allowedImageTypes.includes(file.mimetype)\n          });\n          \n          // Handle Zod validation errors specifically\n          if (fileError instanceof Error && fileError.name === 'ZodError') {\n            const zodError = fileError as any;\n            console.error('Zod validation issues:', zodError.issues);\n            const failedFields = zodError.issues.map((issue: any) => ({\n              path: issue.path.join('.'),\n              message: issue.message,\n              code: issue.code,\n              received: issue.received\n            }));\n            \n            return res.status(400).json({ \n              error: `Validation failed: ${failedFields.map((f: any) => `${f.path}: ${f.message}`).join(', ')}`,\n              details: 'Zod schema validation error',\n              failedFields: failedFields\n            });\n          }\n          \n          // Handle pattern validation errors\n          if (fileError instanceof Error && (\n            fileError.message.includes('string did not match') || \n            fileError.message.includes('pattern') ||\n            fileError.message.includes('Invalid')\n          )) {\n            console.error('Pattern validation error detected');\n            return res.status(400).json({ \n              error: fileError.message,\n              details: 'Pattern validation error during file processing',\n              fileInfo: `${file.originalname} (${file.mimetype}, ${file.size} bytes)`\n            });\n          }\n          \n          console.error('Error details:', fileError instanceof Error ? {\n            name: fileError.name,\n            message: fileError.message,\n            stack: fileError.stack\n          } : fileError);\n          \n          // Continue with other files for other errors\n        }\n      }\n\n      if (results.length === 0) {\n        return res.status(400).json({ \n          error: \"Keine Dateien konnten erfolgreich hochgeladen werden.\" \n        });\n      }\n\n      // Return batch results\n      res.status(201).json({\n        groupId: groupId,\n        uploadedCount: results.length,\n        totalCount: files.length,\n        files: results,\n      });\n\n    } catch (error) {\n      console.error(\"Error in batch media upload:\", error);\n      res.status(500).json({ \n        error: \"Batch-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.\" \n      });\n    }\n  });\n\n  // Like/Unlike endpoint\n  app.post(\"/api/trip-photos/:photoId/like\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      const { userKey } = req.body;\n      \n      if (!userKey) {\n        return res.status(400).json({ error: \"User key is required\" });\n      }\n      \n      const result = await storage.toggleTripPhotoLike(photoId, userKey);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error toggling like:\", error);\n      if (error instanceof Error && error.message === 'Photo not found') {\n        res.status(404).json({ error: \"Photo not found\" });\n      } else {\n        res.status(500).json({ error: \"Failed to toggle like\" });\n      }\n    }\n  });\n\n  // Update trip photo (caption and/or location)\n  app.patch(\"/api/trip-photos/:photoId\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      const { caption, locationId } = req.body;\n      \n      if (caption !== undefined && caption.length > 500) {\n        return res.status(400).json({ error: \"Caption is too long (max 500 characters)\" });\n      }\n      \n      const updatedPhoto = await storage.updateTripPhoto(photoId, { caption, locationId });\n      res.json(updatedPhoto);\n    } catch (error) {\n      console.error(\"Error updating trip photo:\", error);\n      if (error instanceof Error && error.message === 'Photo not found') {\n        res.status(404).json({ error: \"Photo not found\" });\n      } else {\n        res.status(500).json({ error: \"Failed to update trip photo\" });\n      }\n    }\n  });\n\n  // Update caption endpoint\n  app.patch(\"/api/trip-photos/:photoId/caption\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      const { caption } = req.body;\n      \n      if (!caption && caption !== \"\") {\n        return res.status(400).json({ error: \"Caption is required\" });\n      }\n      \n      if (caption.length > 500) {\n        return res.status(400).json({ error: \"Caption is too long (max 500 characters)\" });\n      }\n      \n      const updatedPhoto = await storage.updateTripPhotoCaption(photoId, caption);\n      res.json(updatedPhoto);\n    } catch (error) {\n      console.error(\"Error updating caption:\", error);\n      if (error instanceof Error && error.message === 'Photo not found') {\n        res.status(404).json({ error: \"Photo not found\" });\n      } else {\n        res.status(500).json({ error: \"Failed to update caption\" });\n      }\n    }\n  });\n\n  // Delete photo endpoint\n  app.delete(\"/api/trip-photos/:photoId\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      \n      await storage.deleteTripPhoto(photoId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting photo:\", error);\n      if (error instanceof Error && error.message === 'Photo not found') {\n        res.status(404).json({ error: \"Photo not found\" });\n      } else {\n        res.status(500).json({ error: \"Failed to delete photo\" });\n      }\n    }\n  });\n\n  // Video serving endpoint\n  app.get(\"/api/trip-photos/:photoId/video\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      \n      const tripPhotos = await storage.getAllTripPhotos();\n      const tripPhoto = tripPhotos.find(p => p.id === photoId);\n      \n      if (!tripPhoto || !tripPhoto.videoUrl) {\n        return res.status(404).json({ error: \"Video not found\" });\n      }\n\n      // Serve video file directly from object storage\n      const objectStorageService = new ObjectStorageService();\n      \n      // Handle direct bucket paths (not URLs)\n      let videoPath = tripPhoto.videoUrl;\n      if (videoPath.startsWith('/replit-objstore-')) {\n        // This is a direct bucket path, use it directly to get file\n        const { bucketName, objectName } = parseObjectPath(videoPath);\n        const bucket = objectStorageClient.bucket(bucketName);\n        const file = bucket.file(objectName);\n        const [fileBuffer] = await file.download();\n        \n        res.setHeader('Content-Type', 'video/mp4');\n        res.setHeader('Cache-Control', 'public, max-age=86400');\n        res.send(fileBuffer);\n        return;\n      }\n      \n      // Fallback to original logic for URL-based paths\n      const normalizedVideoPath = objectStorageService.normalizeObjectEntityPath(videoPath);\n      const file = await objectStorageService.getObjectEntityFile(normalizedVideoPath);\n      const [fileBuffer] = await file.download();\n      \n      res.setHeader('Content-Type', 'video/mp4');\n      res.setHeader('Cache-Control', 'public, max-age=86400');\n      res.send(fileBuffer);\n    } catch (error) {\n      console.error(\"Error serving video:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Failed to serve video\" });\n      }\n    }\n  });\n\n  // Thumbnail serving endpoint\n  app.get(\"/api/trip-photos/:photoId/thumbnail\", async (req, res) => {\n    try {\n      const { photoId } = req.params;\n      \n      const tripPhotos = await storage.getAllTripPhotos();\n      const tripPhoto = tripPhotos.find(p => p.id === photoId);\n      \n      if (!tripPhoto || !tripPhoto.thumbnailUrl) {\n        return res.status(404).json({ error: \"Thumbnail not found\" });\n      }\n\n      // Serve thumbnail file directly from object storage\n      const objectStorageService = new ObjectStorageService();\n      const normalizedThumbnailPath = objectStorageService.normalizeObjectEntityPath(tripPhoto.thumbnailUrl);\n      const file = await objectStorageService.getObjectEntityFile(normalizedThumbnailPath);\n      const [fileBuffer] = await file.download();\n      \n      res.setHeader('Content-Type', 'image/jpeg');\n      res.setHeader('Cache-Control', 'public, max-age=86400');\n      res.send(fileBuffer);\n    } catch (error) {\n      console.error(\"Error serving thumbnail:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Failed to serve thumbnail\" });\n      }\n    }\n  });\n\n  // Hero images routes\n  app.get(\"/api/hero-images\", async (req, res) => {\n    try {\n      const heroImages = await storage.getHeroImages();\n      // Cache-busting headers for immediate sync updates\n      res.set({\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      res.json(heroImages);\n    } catch (error) {\n      console.error(\"Error fetching hero images:\", error);\n      res.status(500).json({ error: \"Failed to fetch hero images\" });\n    }\n  });\n\n  app.post(\"/api/hero-images\", async (req, res) => {\n    try {\n      const validation = insertHeroImageSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid hero image data\", details: validation.error });\n      }\n\n      // Validate the image URL security\n      if (validation.data.imageUrl) {\n        const urlValidation = validateImageUrl(validation.data.imageUrl);\n        if (!urlValidation.valid) {\n          return res.status(400).json({ \n            error: urlValidation.error || \"Ungültige Bild-URL\" \n          });\n        }\n      }\n\n      const heroImage = await storage.createHeroImage(validation.data);\n      res.status(201).json(heroImage);\n    } catch (error) {\n      console.error(\"Error creating hero image:\", error);\n      res.status(500).json({ error: \"Failed to create hero image\" });\n    }\n  });\n\n  // IMPORTANT: Specific routes must come BEFORE parameterized routes\n  app.put(\"/api/hero-images/reorder\", async (req, res) => {\n    try {\n      const { imageIds } = req.body;\n      if (!Array.isArray(imageIds)) {\n        return res.status(400).json({ error: \"imageIds must be an array\" });\n      }\n\n      await storage.reorderHeroImages(imageIds);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error reordering hero images:\", error);\n      res.status(500).json({ error: \"Failed to reorder hero images\" });\n    }\n  });\n\n  app.put(\"/api/hero-images/:id\", async (req, res) => {\n    try {\n      const validation = insertHeroImageSchema.partial().safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid hero image data\", details: validation.error });\n      }\n\n      // Validate the image URL security if provided\n      if (validation.data.imageUrl) {\n        const urlValidation = validateImageUrl(validation.data.imageUrl);\n        if (!urlValidation.valid) {\n          return res.status(400).json({ \n            error: urlValidation.error || \"Ungültige Bild-URL\" \n          });\n        }\n      }\n\n      const heroImage = await storage.updateHeroImage(req.params.id, validation.data);\n      res.json(heroImage);\n    } catch (error) {\n      console.error(\"Error updating hero image:\", error);\n      if (error instanceof Error && error.message === \"Hero image not found\") {\n        return res.status(404).json({ error: \"Hero image not found\" });\n      }\n      res.status(500).json({ error: \"Failed to update hero image\" });\n    }\n  });\n\n  app.delete(\"/api/hero-images/:id\", async (req, res) => {\n    try {\n      await storage.deleteHeroImage(req.params.id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting hero image:\", error);\n      res.status(500).json({ error: \"Failed to delete hero image\" });\n    }\n  });\n\n  // Scenic content routes\n  app.get(\"/api/scenic-content\", async (req, res) => {\n    try {\n      const scenicContent = await storage.getScenicContent();\n      // Cache-busting headers for immediate sync updates\n      res.set({\n        'Cache-Control': 'no-store, no-cache, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      res.json(scenicContent);\n    } catch (error) {\n      console.error(\"Error fetching scenic content:\", error);\n      res.status(500).json({ error: \"Failed to fetch scenic content\" });\n    }\n  });\n\n  app.put(\"/api/scenic-content\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      const validation = scenicContentUpdateSchema.partial().safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid scenic content data\", details: validation.error });\n      }\n\n      // Validate image URLs if provided in galleries\n      if (validation.data.galleries && validation.data.galleries.length > 0) {\n        for (const gallery of validation.data.galleries) {\n          if (gallery.imageUrl) {\n            const urlValidation = validateImageUrl(gallery.imageUrl);\n            if (!urlValidation.valid) {\n              return res.status(400).json({ \n                error: `Invalid image URL for gallery item \"${gallery.title}\": ${urlValidation.error}` \n              });\n            }\n          }\n        }\n      }\n\n      const scenicContent = await storage.updateScenicContent(validation.data);\n      res.json(scenicContent);\n    } catch (error) {\n      console.error(\"Error updating scenic content:\", error);\n      res.status(500).json({ error: \"Failed to update scenic content\" });\n    }\n  });\n\n  // Creator routes\n  app.get(\"/api/creators\", async (req, res) => {\n    try {\n      const creators = await storage.getAllCreators();\n      res.json(creators);\n    } catch (error) {\n      console.error(\"Error fetching creators:\", error);\n      res.status(500).json({ error: \"Failed to fetch creators\" });\n    }\n  });\n\n  app.post(\"/api/creators\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      const validation = insertCreatorSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid creator data\", details: validation.error });\n      }\n\n      const creator = await storage.createCreator(validation.data);\n      res.json(creator);\n    } catch (error) {\n      console.error(\"Error creating creator:\", error);\n      res.status(500).json({ error: \"Failed to create creator\" });\n    }\n  });\n\n  app.put(\"/api/creators/:id\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      const validation = insertCreatorSchema.partial().safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid creator data\", details: validation.error });\n      }\n\n      const creator = await storage.updateCreator(req.params.id, validation.data);\n      res.json(creator);\n    } catch (error) {\n      console.error(\"Error updating creator:\", error);\n      res.status(500).json({ error: \"Failed to update creator\" });\n    }\n  });\n\n  app.delete(\"/api/creators/:id\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      await storage.deleteCreator(req.params.id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting creator:\", error);\n      res.status(500).json({ error: \"Failed to delete creator\" });\n    }\n  });\n\n  // Tour settings routes\n  app.get(\"/api/tour-settings\", async (req, res) => {\n    try {\n      const settings = await storage.getTourSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching tour settings:\", error);\n      res.status(500).json({ error: \"Failed to fetch tour settings\" });\n    }\n  });\n\n  app.put(\"/api/tour-settings\", async (req, res) => {\n    try {\n      const validation = insertTourSettingsSchema.partial().safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: \"Invalid settings data\", details: validation.error });\n      }\n\n      const updateData = { ...validation.data };\n\n      // Handle password hashing if privacyPassword is provided\n      if (updateData.privacyPassword) {\n        if (updateData.privacyPassword.trim().length < 6) {\n          return res.status(400).json({ \n            error: \"Passwort muss mindestens 6 Zeichen lang sein\" \n          });\n        }\n        \n        // Hash the password\n        const saltRounds = 12;\n        updateData.privacyPassword = await bcrypt.hash(updateData.privacyPassword.trim(), saltRounds);\n      }\n\n      const settings = await storage.updateTourSettings(updateData);\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error updating tour settings:\", error);\n      res.status(500).json({ error: \"Failed to update tour settings\" });\n    }\n  });\n\n  // Privacy authentication routes\n  app.get(\"/api/privacy-status\", async (req, res) => {\n    try {\n      const settings = await storage.getTourSettings();\n      const privacyEnabled = settings?.privacyEnabled || false;\n      \n      res.json({ \n        privacyEnabled\n      });\n    } catch (error) {\n      console.error(\"Error fetching privacy status:\", error);\n      res.status(500).json({ error: \"Failed to fetch privacy status\" });\n    }\n  });\n\n  app.post(\"/api/simple-login\", async (req, res) => {\n    try {\n      const { password } = req.body;\n      \n      if (!password) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Passwort ist erforderlich\" \n        });\n      }\n\n      // Get tour settings to check password\n      const settings = await storage.getTourSettings();\n      \n      if (!settings?.privacyEnabled) {\n        return res.status(400).json({ \n          success: false, \n          message: \"Privacy-Login ist nicht aktiviert\" \n        });\n      }\n\n      if (!settings.privacyPassword) {\n        return res.status(500).json({ \n          success: false, \n          message: \"Kein Privacy-Passwort konfiguriert\" \n        });\n      }\n\n      // Verify password\n      const isValid = await bcrypt.compare(password, settings.privacyPassword);\n      \n      if (!isValid) {\n        return res.status(401).json({ \n          success: false, \n          message: \"Ungültiges Passwort\" \n        });\n      }\n\n      res.json({ \n        success: true,\n        message: \"Login erfolgreich\"\n      });\n    } catch (error) {\n      console.error(\"Error during simple login:\", error);\n      res.status(500).json({ \n        success: false, \n        message: \"Login fehlgeschlagen\" \n      });\n    }\n  });\n\n\n  // Object storage routes for image uploads\n  app.get(\"/public-objects/:filePath(*)\", async (req, res) => {\n    const filePath = req.params.filePath;\n    const objectStorageService = new ObjectStorageService();\n    try {\n      // First try to find file in public directory\n      let file = await objectStorageService.searchPublicObject(filePath);\n      \n      // If not found in public, try to serve from private directory (migration workaround)\n      if (!file && filePath.startsWith('uploads/')) {\n        try {\n          // Use the private object path directly by constructing the full path\n          const filename = filePath.split('/').pop();\n          if (filename) {\n            // Try to find in database to get the actual object path\n            const photos = await storage.getAllTripPhotos();\n            const photo = photos.find(p => p.objectPath && p.objectPath.includes(filename));\n            if (photo && photo.objectPath) {\n              // Redirect to our new direct serving endpoint instead of signed URLs\n              return res.redirect(`/api/trip-photos/${photo.id}/image`);\n            }\n          }\n        } catch (privateError) {\n          console.log(`Could not serve from private directory: ${privateError}`);\n        }\n      }\n      \n      if (!file) {\n        return res.status(404).json({ error: \"File not found\" });\n      }\n      \n      objectStorageService.downloadObject(file, res);\n    } catch (error) {\n      console.error(\"Error searching for public object:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/objects/upload\", async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ error: \"Failed to get upload URL\" });\n    }\n  });\n\n  app.post(\"/api/objects/upload-public\", async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getPublicObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting public upload URL:\", error);\n      res.status(500).json({ error: \"Failed to get public upload URL\" });\n    }\n  });\n\n  app.post(\"/api/objects/normalize\", async (req, res) => {\n    if (!req.body.imageURL) {\n      return res.status(400).json({ error: \"imageURL is required\" });\n    }\n\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = objectStorageService.normalizeObjectEntityPath(req.body.imageURL);\n      \n      // For direct uploads, the image URL is already public-accessible\n      // We return the original URL as publicURL since it's already accessible\n      res.json({\n        objectPath: objectPath,\n        publicURL: req.body.imageURL\n      });\n    } catch (error) {\n      console.error(\"Error normalizing object path:\", error);\n      res.status(500).json({ error: \"Failed to normalize object path\" });\n    }\n  });\n\n  app.put(\"/api/location-images\", async (req, res) => {\n    if (!req.body.imageURL || !req.body.locationId) {\n      return res.status(400).json({ error: \"imageURL and locationId are required\" });\n    }\n\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = objectStorageService.normalizeObjectEntityPath(req.body.imageURL);\n\n      // Add image to location\n      const image = await storage.addLocationImage({\n        locationId: req.body.locationId,\n        imageUrl: req.body.imageURL,\n        objectPath: objectPath,\n        caption: req.body.caption || \"\",\n        isMain: req.body.isMain || false,\n      });\n\n      res.status(200).json({\n        objectPath: objectPath,\n        image: image\n      });\n    } catch (error) {\n      console.error(\"Error setting location image:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Temporary admin endpoint to migrate images from private to public directory\n  app.post(\"/api/admin/migrate-images\", async (req, res) => {\n    try {\n      console.log(\"Starting image migration from private to public directory...\");\n      \n      // Get all trip photos with private object paths\n      const photosToMigrate = await storage.getAllTripPhotos();\n      const privatePhotos = photosToMigrate.filter(photo => \n        photo.objectPath && photo.objectPath.includes('/.private/uploads/')\n      );\n      \n      console.log(`Found ${privatePhotos.length} photos in private directory to migrate`);\n      \n      const objectStorageService = new ObjectStorageService();\n      const migratedPhotos = [];\n      \n      for (const photo of privatePhotos) {\n        try {\n          // Check if objectPath exists\n          if (!photo.objectPath) {\n            console.log(`Skipping photo ${photo.id}: No object path`);\n            continue;\n          }\n          \n          // Extract filename from private path\n          const filename = photo.objectPath.split('/').pop();\n          if (!filename) {\n            console.log(`Skipping photo ${photo.id}: Cannot extract filename`);\n            continue;\n          }\n          \n          const newPublicPath = `public/uploads/${filename}`;\n          \n          console.log(`Migrating photo ${photo.id}: ${filename}`);\n          \n          // For now, we'll update the database with the correct public path\n          // The actual file copy would need to be done manually or via another process\n          const newObjectPath = photo.objectPath.replace('/.private/uploads/', '/public/uploads/');\n          const publicImageUrl = `/public-objects/uploads/${filename}`;\n          \n          // Update database with public path (using direct SQL)\n          await db.execute(sql`UPDATE ${tripPhotos} SET object_path = ${newObjectPath}, image_url = ${publicImageUrl} WHERE id = ${photo.id}`);\n          \n          migratedPhotos.push({\n            id: photo.id,\n            oldPath: photo.objectPath,\n            newPath: newObjectPath,\n            newUrl: publicImageUrl\n          });\n          \n        } catch (error) {\n          console.error(`Error migrating photo ${photo.id}:`, error instanceof Error ? error.message : String(error));\n        }\n      }\n      \n      console.log(`Migration completed. ${migratedPhotos.length} photos migrated.`);\n      res.json({\n        success: true,\n        migratedCount: migratedPhotos.length,\n        migratedPhotos\n      });\n      \n    } catch (error) {\n      console.error(\"Error during image migration:\", error);\n      res.status(500).json({ error: \"Migration failed\", details: error instanceof Error ? error.message : \"Unknown error\" });\n    }\n  });\n\n  // Location ping routes for live GPS tracking\n  app.post(\"/api/location-ping\", async (req, res) => {\n    try {\n      const validation = insertLocationPingSchema.safeParse(req.body);\n      if (!validation.success) {\n        return res.status(400).json({ \n          error: \"Ungültige GPS-Daten\", \n          details: validation.error.issues \n        });\n      }\n\n      // Validate coordinate ranges\n      const lat = parseFloat(validation.data.latitude);\n      const lng = parseFloat(validation.data.longitude);\n      \n      if (lat < -90 || lat > 90) {\n        return res.status(400).json({ \n          error: \"Ungültige Breitengrad-Koordinate (muss zwischen -90 und 90 sein)\" \n        });\n      }\n      \n      if (lng < -180 || lng > 180) {\n        return res.status(400).json({ \n          error: \"Ungültige Längengrad-Koordinate (muss zwischen -180 und 180 sein)\" \n        });\n      }\n\n      const locationPing = await storage.addLocationPing(validation.data);\n      res.status(201).json(locationPing);\n    } catch (error) {\n      console.error(\"Error saving location ping:\", error);\n      res.status(500).json({ error: \"Fehler beim Speichern der GPS-Position\" });\n    }\n  });\n\n  app.get(\"/api/location-ping/latest\", async (req, res) => {\n    try {\n      const latestPing = await storage.getLatestLocationPing();\n      if (!latestPing) {\n        return res.status(404).json({ error: \"Keine GPS-Position gefunden\" });\n      }\n      res.json(latestPing);\n    } catch (error) {\n      console.error(\"Error fetching latest location ping:\", error);\n      res.status(500).json({ error: \"Fehler beim Abrufen der GPS-Position\" });\n    }\n  });\n\n  app.get(\"/api/location-pings\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : undefined;\n      const locationPings = await storage.getLocationPings(limit);\n      res.json(locationPings);\n    } catch (error) {\n      console.error(\"Error fetching location pings:\", error);\n      res.status(500).json({ error: \"Fehler beim Abrufen der GPS-Positionen\" });\n    }\n  });\n\n  // External data sync endpoint\n  app.post(\"/api/admin/sync-external\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      console.log('Starting external data sync...');\n      await syncExternalData(storage);\n      res.json({ \n        success: true, \n        message: \"External data sync completed successfully\",\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error(\"Error during external data sync:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"External data sync failed\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Location-by-location sync endpoint for precise control\n  app.post(\"/api/admin/sync-location/:slug\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      const { syncLocationBySlug } = await import('./sync-external-data');\n      console.log(`Starting sync for location: ${req.params.slug}`);\n      \n      await syncLocationBySlug(storage, req.params.slug);\n      \n      res.json({ \n        success: true, \n        message: `Location '${req.params.slug}' synced successfully`,\n        slug: req.params.slug,\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error(`Error syncing location ${req.params.slug}:`, error);\n      res.status(500).json({ \n        success: false,\n        error: \"Location sync failed\", \n        details: error instanceof Error ? error.message : \"Unknown error\",\n        slug: req.params.slug\n      });\n    }\n  });\n\n  // Rebuild hero images endpoint (for after location syncs)\n  app.post(\"/api/admin/rebuild-hero\", simpleAuthMiddleware, async (req, res) => {\n    try {\n      const { syncExternalData } = await import('./sync-external-data');\n      console.log('Rebuilding hero images from location galleries...');\n      \n      await syncExternalData(storage);\n      \n      res.json({ \n        success: true, \n        message: \"Hero images rebuilt successfully from external data sync\",\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error(\"Error rebuilding hero images:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"Hero rebuild failed\", \n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":61827},"server/storage.ts":{"content":"import { \n  Location, \n  InsertLocation, \n  LocationImage, \n  InsertLocationImage, \n  Creator,\n  InsertCreator,\n  TripPhoto,\n  InsertTripPhoto,\n  GroupedTripPhoto,\n  TourSettings, \n  InsertTourSettings,\n  LocationPing,\n  InsertLocationPing,\n  HeroImage,\n  InsertHeroImage,\n  ScenicContent,\n  InsertScenicContent,\n  ScenicGalleryItem,\n  RestaurantData,\n  locations,\n  locationImages,\n  creators,\n  tripPhotos,\n  tripPhotoLikes,\n  tourSettings,\n  locationPings,\n  heroImages,\n  scenicContent\n} from \"@shared/schema\";\nimport { randomUUID, createHash } from \"crypto\";\nimport { db } from \"./db\";\nimport { eq, desc, and, isNull, lt, sql, or, asc, inArray } from \"drizzle-orm\";\n\n// Shared location data for both MemStorage and DatabaseStorage \nconst INITIAL_LOCATIONS: InsertLocation[] = [\n  {\n    name: \"Penticton\",\n    slug: \"penticton\",\n    startDate: \"20.09.2025\",\n    endDate: \"22.09.2025\",\n    description: \"Okanagan-Tal Weinreise mit geführten Weintouren, Weingut Burrowing Owl Estate Winery mit Restaurant und Picknick am See.\",\n    accommodation: \"Penticton Beach House\",\n    accommodationPrice: 860,\n    distance: 395,\n    imageUrl: \"https://plus.unsplash.com/premium_photo-1754211686859-913f71e422e1?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 49.4949, lng: -119.5937 },\n    activities: [\n      \"Kunst- und Kulturzentrum Penticton Art Gallery – Kleine Galerie mit regionaler Kunst\",\n      \"Kettle Valley Railway Trail (kurzer Abschnitt) – Ruhiger Spaziergang mit Seeblick, leicht begehbar\",\n      \"Okanagan Falls langer pier\",\n      \"Picknick im Kentucky-Alleyne Provincial Park – Malerische Seenlandschaft, gut erreichbar mit dem Auto\",\n      \"Abbotsford Farm-Tour – Käse, Honig und Obststände, gemütlich mit dem Auto erreichbar\",\n      \"We-Drive Kelowna Wine Tours (https://www.sagebrushtours.ca/wine-tours/naramata-wine-tour)\",\n      \"Besuch von Sunrise Lavendelfarmen – Entspanntes Spazieren, herrlicher Duft\",\n      \"Bootsfahrt auf dem Okanagan Lake – Ruhige Ausflugsmöglichkeiten, auch mit Sitzgelegenheit\",\n      \"Summerhill Pyramid Winery – Weinkellerei mit Restaurant und toller Aussicht\",\n      \"Historic O'Keefe Ranch – Historische Ranch mit gemütlicher Führung\",\n      \"Planet Bee Honey Farm – Spannende Honigverkostung und Bienenführung\"\n    ],\n    restaurants: [\n      { name: \"Elm\", description: \"Für Abends\", websiteUrl: \"https://eatatelma.com\" } as RestaurantData,\n      { name: \"The Bench Market\", description: \"Beliebter All-Day Breakfast/Brunch\" } as RestaurantData,\n      { name: \"Kin & Folk\", description: \"Frühstück & Abends\" } as RestaurantData,\n      { name: \"Naramata Restaurants\", description: \"All great restaurants in Naramata area\" } as RestaurantData,\n      { name: \"EATology\", description: \"Local dining\" } as RestaurantData,\n      { name: \"Diner On Six\", description: \"Local diner\" } as RestaurantData,\n      { name: \"Intermezzo Restaurant\", description: \"Fine dining option\" } as RestaurantData,\n      { name: \"Bean To Cup Coffee House\", description: \"Breakfast coffee spot\" } as RestaurantData\n    ],\n    experiences: [\n      \"Leichte Riesling-Flights und Weinproben\",\n      \"110 km lange wunderbare Strände am Okanagan Lake\",\n      \"Geführte Weintouren mit professionellem Guide\"\n    ],\n    highlights: [\"Weingüter\", \"Okanagan Lake\", \"Weinproben\"],\n    routeHighlights: [\n      \"Cedar and Moss Coffee, Cultus Lake, Bridal Falls\",\n      \"Abbotsford Selbstfahrer-Circle-Farm-Tour: Käse, Honig, Kürbisstand\",\n      \"Abbotsford Mennonite Heritage Village\",\n      \"Historische Montrose Street mit Weingütern und Brauereien\",\n      \"Fahrt durch Manning Park durch Wein- und Obstanbaugebiete\"\n    ]\n  },\n  {\n    name: \"Vernon\", \n    slug: \"vernon\",\n    startDate: \"22.09.2025\",\n    endDate: \"23.09.2025\",\n    description: \"Zwischenstopp am Swan Lake mit dem märchenhaften Castle at Swan Lake.\",\n    accommodation: \"The Castle at Swan Lake\",\n    accommodationPrice: 371,\n    distance: 120,\n    imageUrl: \"https://images.unsplash.com/photo-1755331039789-7e5680e26e8f?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 50.2676, lng: -119.2721 },\n    activities: [\n      \"Polson Park – Ruhige Parkanlage für einen entspannten Spaziergang\"\n    ],\n    restaurants: [\n      { name: \"Castle Restaurant\", description: \"Restaurant im Castle at Swan Lake\" } as RestaurantData,\n      { name: \"Summerhill Pyramid Winery Restaurant\", description: \"Weinkellerei mit Pyramide und Restaurant - einzigartige architektonische Erfahrung\" } as RestaurantData,\n      { name: \"Vernon Downtown Bistro\", description: \"Lokale Küche im Stadtzentrum\" } as RestaurantData\n    ],\n    experiences: [\n      \"Romantischer Aufenthalt im Castle\",\n      \"Malerische Seenlandschaft am Swan Lake\",\n      \"Duftende Lavendelfelder mit geführten Farm-Touren\",\n      \"Hausboot-Erlebnis auf dem Okanagan Lake\",\n      \"Weinverkostungen in der einzigartigen Pyramiden-Weinkellerei\",\n      \"Entspannung an 110 km langen Okanagan-Stränden\"\n    ],\n    highlights: [\"Swan Lake\", \"The Castle\"],\n    routeHighlights: [\n      \"Fahrt durch Wein- und Obstanbaugebiete nach Penticton\",\n      \"Zwischenstopp in Kelowna mit Lavendelfarm und Weingütern\"\n    ]\n  },\n  {\n    name: \"Golden\",\n    slug: \"golden\", \n    startDate: \"23.09.2025\",\n    endDate: \"27.09.2025\",\n    description: \"Rocky Mountains mit den berühmten Seen Lake Moraine und Lake Louise, Banff Gondel auf den Sulphur Mountain.\",\n    accommodation: \"Chalet Ernest Feuz & Cedar House Restaurant\",\n    accommodationPrice: 1975,\n    distance: 295,\n    imageUrl: \"https://images.unsplash.com/photo-1590100958871-a8d13c35ac33?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 51.3003, lng: -116.9637 },\n    activities: [\n      \"Golden Skybridge (nur Plattform-Besuch) – Beeindruckender Ausblick ohne Abenteuer-Teil\",\n      \"Kicking Horse Pedestrian Bridge – Kurzer Spaziergang zur längsten freitragenden Holzbrücke Kanadas\",\n      \"Yoho National Park Stopps – Emerald Lake und Natural Bridge, beide nah am Parkplatz\",\n      \"Blue River Wildlife Bootssafari – Bequeme Sitzboote, um Tiere vom Wasser aus zu beobachten\",\n      \"Besuch des Cedar House Restaurants & Chalets – Bekannt für ruhige Atmosphäre und Gourmetküche\",\n      \"Revelstoke Railway Museum – Gemütlicher Museumsbesuch ohne große Wege\"\n    ],\n    restaurants: [\n      { name: \"Big Bend Cafe\", description: \"Local cafe in Golden area\" } as RestaurantData,\n      { name: \"Whitetooth Bistro\", description: \"Local bistro\" } as RestaurantData,\n      { name: \"Bluebird Cafe\", description: \"Charming local cafe option\" } as RestaurantData,\n      { name: \"Wandering Fern Cafe\", description: \"Alternative cafe option\" } as RestaurantData,\n      { name: \"The Wolf's Den\", description: \"Local restaurant\" } as RestaurantData\n    ],\n    experiences: [\n      \"Der Icefields Parkway - eine der schönsten Panoramastraßen der Welt\",\n      \"Gletschertour am Columbia Icefield\",\n      \"Morgenlicht-Fotografie am Lake Louise\"\n    ],\n    highlights: [\"Lake Louise\", \"Banff\", \"Columbia Icefield\", \"Gondel\"],\n    routeHighlights: [\n      \"Mittags Wildlife-Bootsafari im Blue River-Tal\",\n      \"Sehr bequeme Sitzboote für Wildtier-Beobachtung (riversafari.com)\",\n      \"Weiterfahrt durch spektakuläre Berglandschaft nach Jasper\"\n    ]\n  },\n  {\n    name: \"Jasper\",\n    slug: \"jasper\",\n    startDate: \"27.09.2025\", \n    endDate: \"29.09.2025\",\n    description: \"Jasper Nationalpark mit Bootsfahrt auf dem Maligne Lake zur Spirit Island und Jasper SkyTram.\",\n    accommodation: \"Deluxe Blockhütte\",\n    accommodationPrice: 2349,\n    distance: 330,\n    imageUrl: \"https://images.unsplash.com/photo-1587381419916-78fc843a36f8?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 52.8737, lng: -118.0814 },\n    activities: [\n      \"Pyramid Lake und Pyramid Island – Ruhige See-Insel mit Bank zum Ausruhen\",\n      \"Jasper Yellowhead Museum – Regionale Geschichte, kleines Museum\",\n      \"Abendliche Sternenbeobachtung – Jasper ist offizielles Dark Sky Preserve, perfekt zum Sterneschauen\",\n      \"Icefields Parkway Fahrt – Eine der schönsten Panoramastraßen der Welt\",\n      \"Bootsfahrt auf dem Maligne Lake zur Spirit Island – Ruhig, mit fantastischer Aussicht\",\n      \"Columbia Icefield Besucherzentrum – Gletscherblick ohne anstrengende Wanderung\",\n      \"Maligne Lake – größter natürlicher See\",\n      \"Johnson Lake – Instagram-würdiger Ort\"\n    ],\n    restaurants: [\n      { name: \"Bear's Paw Bakery\", description: \"Local bakery with fresh baked goods\" } as RestaurantData,\n      { name: \"The Raven Bistro\", description: \"Gourmet-Küche mit lokalen Zutaten\" } as RestaurantData,\n      { name: \"Harvest Food & Drink\", description: \"Local dining establishment\" } as RestaurantData,\n      { name: \"Terra Restaurant\", description: \"Fine dining option\" } as RestaurantData\n    ],\n    experiences: [\n      \"Spirit Island - eines der meistfotografierten Motive Kanadas\",\n      \"Rogers-Pass-Centre und Meadow-in-the-Sky Drive\",\n      \"Wildlife Viewing - Bären, Elche und Bergziegen\"\n    ],\n    highlights: [\"Maligne Lake\", \"SkyTram\", \"Spirit Island\", \"Wildlife\"],\n    routeHighlights: [\n      \"Rogers-Pass-Centre Besucherzentrum\",\n      \"Eventuell Meadow-in-the-Sky Drive für Panoramablicke\",\n      \"Icefields Parkway - eine der schönsten Panoramastraßen der Welt\"\n    ]\n  },\n  {\n    name: \"Clearwater\",\n    slug: \"clearwater\",\n    startDate: \"29.09.2025\",\n    endDate: \"01.10.2025\", \n    description: \"Wells Gray Park mit spektakulären Wasserfällen - große Anzahl an Wasserfällen zum Entdecken.\",\n    accommodation: \"Alpine Meadows\",\n    accommodationPrice: 731,\n    distance: 360,\n    imageUrl: \"https://images.unsplash.com/photo-1625458647696-75b52c2e7483?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 51.6428, lng: -120.0275 },\n    activities: [\n      \"Helmcken Falls Aussichtspunkt – Spektakulärer Wasserfall, leicht erreichbar\",\n      \"Moul Falls & Sylvia Falls – Kürzere Spaziergänge mit schöner Natur\"\n    ],\n    restaurants: [\n      { name: \"Alpine Meadows Restaurant\", description: \"Hausgemachte Gerichte in rustikaler Atmosphäre\" } as RestaurantData,\n      { name: \"Wells Gray Inn\", description: \"Traditionelle kanadische Küche\" } as RestaurantData,\n      { name: \"Clearwater Country Inn\", description: \"Gemütliches Restaurant mit regionalen Spezialitäten\" } as RestaurantData\n    ],\n    experiences: [\n      \"Rivers Safari - sehr bequeme Sitzboote für Wildlife-Beobachtung\",\n      \"Wasserfälle-Fotografie in Wells Gray Park\",\n      \"Begegnung mit der unberührten Wildnis\"\n    ],\n    highlights: [\"Helmcken Falls\", \"Wells Gray Park\", \"Wildlife Safari\", \"Wasserfälle\"],\n    routeHighlights: [\n      \"Helmcken Falls - spektakuläre Wasserfälle entlang der Route\",\n      \"Triple Decker Falls, Third Canyon Falls\",\n      \"Moul Falls, Sylvia und Godwin Falls\",\n      \"Zwischenstopp zum Aufbrechen der langen Fahrt nach Kamloops\"\n    ]\n  },\n  {\n    name: \"Lillooet\",\n    slug: \"lillooet\", \n    startDate: \"01.10.2025\",\n    endDate: \"02.10.2025\",\n    description: \"Historische Goldgräberstadt mit Stopps am Duffey Lake Lookout und Kaffeepause.\",\n    accommodation: \"Reynolds Hotel\", \n    accommodationPrice: 346,\n    distance: 400,\n    imageUrl: \"https://images.unsplash.com/photo-1636569878287-48d4d61c0cb2?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 50.6866, lng: -121.9346 },\n    activities: [\n      \"Seton Lake Viewpoint – Eindrucksvoller Bergsee mit Parkmöglichkeiten direkt am Aussichtspunkt\",\n      \"Besuch des Lillooet Museum & Archive – Kleines Heimatmuseum mit lokaler Geschichte\",\n      \"Weinprobe bei Fort Berens Estate Winery – Ruhige Weindegustation mit Bergpanorama\",\n      \"Duffey Lake Lookout – Atemberaubender Aussichtspunkt direkt an der Straße\",\n      \"Spaziergang durch den Ort – Kleine Kaffepause und Erkundung lokaler Geschichte\"\n    ],\n    restaurants: [\n      { name: \"Painted Turtle Restaurant\", description: \"Local restaurant in Lillooet\" } as RestaurantData,\n      { name: \"Hop 'N' Hog Tap & Smokehouse\", description: \"Tap house and smokehouse\" } as RestaurantData,\n      { name: \"Lillooet's Cookhouse Restaurant\", description: \"Local cookhouse style restaurant\" } as RestaurantData,\n      { name: \"The Kitchen at Fort Berens\", description: \"Restaurant at Fort Berens Estate Winery\" } as RestaurantData\n    ],\n    experiences: [\n      \"Goldgräber-Geschichte erleben\",\n      \"Malerische Berglandschaft am Duffey Lake\",\n      \"Einblick in die First Nations Kultur\"\n    ],\n    highlights: [\"Duffey Lake\", \"Geschichte\", \"Fraser River\"],\n    routeHighlights: [\n      \"Duffey Lake Lookout - spektakulärer Aussichtspunkt\",\n      \"Lillooet Kaffeepause im historischen Stadtzentrum\",\n      \"Malerische Bergstraße durch das Fraser River Tal\"\n    ]\n  },\n  {\n    name: \"Sunshine Coast\", \n    slug: \"sunshine-coast\",\n    startDate: \"02.10.2025\",\n    endDate: \"06.10.2025\",\n    description: \"Entspannter Abschluss an der Pazifikküste mit Beachfront Cottage ohne Hund.\",\n    accommodation: \"Beachfront Cottage\",\n    accommodationPrice: 2147,\n    distance: 230,\n    imageUrl: \"https://images.unsplash.com/photo-1602175439588-55b44e8a6719?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\",\n    coordinates: { lat: 49.6247, lng: -123.9707 },\n    activities: [\n      \"Gibsons Public Market – Gemütlicher Markt mit kleinen Cafés und Kunstständen\",\n      \"Porpoise Bay Provincial Park – Ruhiger Strandpark mit Sitzgelegenheiten\",\n      \"Besuch eines Künstlerstudios – Sunshine Coast ist bekannt für kreative Handwerkskunst\",\n      \"Fährfahrt zur Sunshine Coast – Entspannende Überfahrt mit Aussicht\",\n      \"Künstlerdörfer und kleine Cafés – Gemütliche Besuche ohne große Strecken\"\n    ],\n    restaurants: [\n      { name: \"The Pink House Bistro\", description: \"Charming bistro on Sunshine Coast\" } as RestaurantData,\n      { name: \"Laughing Oyster Restaurant\", description: \"Restaurant with ocean views\" } as RestaurantData\n    ],\n    experiences: [\n      \"Sonnenuntergang über dem Pazifik\",\n      \"Entspannung nach der intensiven Reise\",\n      \"Abschied von der kanadischen Wildnis\"\n    ],\n    highlights: [\"Pazifik\", \"Strand\", \"Entspannung\", \"Cottage\"],\n    routeHighlights: [\n      \"Scenic Sea-to-Sky Highway entlang der Küste\",\n      \"Übergang von den Bergen zur Pazifikküste\",\n      \"Letzte spektakuläre Landschaftsabschnitte der Reise\"\n    ]\n  }\n];\n\n// Interface for storage operations\nexport interface IStorage {\n  // Location operations\n  getLocations(): Promise<Location[]>;\n  getLocation(id: string): Promise<Location | undefined>;\n  getLocationBySlug(slug: string): Promise<Location | undefined>;\n  createLocation(location: InsertLocation): Promise<Location>;\n  updateLocation(id: string, location: Partial<InsertLocation>): Promise<Location>;\n  deleteLocation(id: string): Promise<void>;\n\n  // Location images\n  getLocationImages(locationId: string): Promise<LocationImage[]>;\n  addLocationImage(image: InsertLocationImage): Promise<LocationImage>;\n  deleteLocationImage(id: string): Promise<void>;\n  setMainImage(locationId: string, imageId: string): Promise<void>;\n\n  // Trip photos\n  getTripPhotos(locationId: string): Promise<TripPhoto[]>;\n  getAllTripPhotos(): Promise<TripPhoto[]>;\n  listTripPhotos(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: TripPhoto[]; nextCursor?: string }>;\n  listTripPhotosGrouped(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: GroupedTripPhoto[]; nextCursor?: string }>;\n  addTripPhoto(tripPhoto: InsertTripPhoto): Promise<TripPhoto>;\n  createTripPhotoMedia(tripPhoto: InsertTripPhoto & { deleteToken: string }): Promise<TripPhoto & { deleteToken: string }>;\n  toggleTripPhotoLike(photoId: string, userKey: string): Promise<{ liked: boolean; likesCount: number }>;\n  updateTripPhoto(photoId: string, updates: { caption?: string; locationId?: string }): Promise<TripPhoto>;\n  updateTripPhotoCaption(photoId: string, caption: string): Promise<TripPhoto>;\n  deleteTripPhoto(photoId: string, deleteToken?: string): Promise<void>;\n  cleanupBrokenTripPhotos(): Promise<number>; // Returns number of photos removed\n\n  // Tour settings\n  getTourSettings(): Promise<TourSettings | undefined>;\n  updateTourSettings(settings: Partial<InsertTourSettings>): Promise<TourSettings>;\n\n  // Location pings for live GPS tracking\n  addLocationPing(ping: InsertLocationPing): Promise<LocationPing>;\n  getLatestLocationPing(): Promise<LocationPing | undefined>;\n  getLocationPings(limit?: number): Promise<LocationPing[]>;\n\n  // Hero images for homepage slideshow\n  getHeroImages(): Promise<HeroImage[]>;\n  createHeroImage(heroImage: InsertHeroImage): Promise<HeroImage>;\n  updateHeroImage(id: string, heroImage: Partial<InsertHeroImage>): Promise<HeroImage>;\n  deleteHeroImage(id: string): Promise<void>;\n  reorderHeroImages(imageIds: string[]): Promise<void>;\n\n  // Scenic content for \"Spektakuläre Landschaften erwarten uns\" section\n  getScenicContent(): Promise<ScenicContent | undefined>;\n  updateScenicContent(data: Partial<InsertScenicContent>): Promise<ScenicContent>;\n\n  // Creator operations\n  getAllCreators(): Promise<Creator[]>;\n  createCreator(creator: InsertCreator): Promise<Creator>;\n  updateCreator(id: string, creator: Partial<InsertCreator>): Promise<Creator>;\n  deleteCreator(id: string): Promise<void>;\n}\n\nexport class MemStorage implements IStorage {\n  private locations: Map<string, Location>;\n  private locationImages: Map<string, LocationImage>;\n  private tripPhotos: Map<string, TripPhoto>;\n  private tripPhotoLikes: Map<string, { photoId: string; userKey: string; liked: boolean }>;\n  private locationPings: Map<string, LocationPing>;\n  private heroImages: Map<string, HeroImage>;\n  private tourSettings: TourSettings | undefined;\n  private scenicContent: ScenicContent | undefined;\n  private creators: Map<string, Creator>;\n\n  constructor() {\n    this.locations = new Map();\n    this.locationImages = new Map();\n    this.tripPhotos = new Map();\n    this.tripPhotoLikes = new Map();\n    this.locationPings = new Map();\n    this.heroImages = new Map();\n    this.creators = new Map();\n    this.initializeData();\n  }\n\n  private initializeData() {\n    // Initialize default creators\n    const defaultCreators = [\"Rimas\", \"Susanne\", \"Ursula\", \"Helmut\"];\n    defaultCreators.forEach(name => {\n      const id = randomUUID();\n      const creator: Creator = {\n        id,\n        name,\n        createdAt: new Date(),\n      };\n      this.creators.set(id, creator);\n    });\n\n    // Use shared location data\n    const initialLocations = INITIAL_LOCATIONS;\n\n    // Create locations\n    initialLocations.forEach(location => {\n      const id = randomUUID();\n      const newLocation: Location = {\n        ...location,\n        id,\n        accommodation: location.accommodation || null,\n        accommodationWebsite: location.accommodationWebsite || null,\n        accommodationImageUrl: (location as any).accommodationImageUrl || null,\n        accommodationPrice: location.accommodationPrice || null,\n        accommodationCurrency: location.accommodationCurrency || null,\n        accommodationInclusiveServices: (location as any).accommodationInclusiveServices || null,\n        accommodationAmenities: (location as any).accommodationAmenities || null,\n        accommodationCheckinTime: (location as any).accommodationCheckinTime || null,\n        accommodationCheckoutTime: (location as any).accommodationCheckoutTime || null,\n        distance: location.distance || null,\n        imageUrl: location.imageUrl || null,\n        mapImageUrl: (location as any).mapImageUrl || null,\n        coordinates: location.coordinates || null,\n        activities: location.activities ? [...location.activities] : null,\n        restaurants: location.restaurants ? [...location.restaurants] as RestaurantData[] : null,\n        experiences: location.experiences ? [...location.experiences] : null,\n        highlights: location.highlights ? [...location.highlights] : null,\n        funFacts: location.funFacts ? [...location.funFacts] : null,\n        routeHighlights: location.routeHighlights ? [...location.routeHighlights] : null,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n      this.locations.set(id, newLocation);\n    });\n\n    // Initialize tour settings\n    this.tourSettings = {\n      id: randomUUID(),\n      tourName: \"Weinberg Tour 2025\",\n      startDate: \"20.09.2025\",\n      endDate: \"06.10.2025\", \n      totalDistance: 2130,\n      totalCost: 8779,\n      currency: \"CAD\",\n      heroImageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n      description: \"Entdecke die atemberaubende Schönheit Kanadas - von den Weinbergen des Okanagan-Tals bis zu den majestätischen Rocky Mountains\",\n      privacyEnabled: false,\n      privacyPassword: null,\n      sessionTimeout: 10080, // 7 days in minutes\n      gpsActivatedByAdmin: false,\n      gpsUpdateInterval: 30, // GPS update interval in seconds\n      updatedAt: new Date(),\n    };\n\n    // Initialize hero images with the existing hardcoded images\n    const defaultHeroImages: InsertHeroImage[] = [\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1528190336454-13cd56b45b5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Penticton Wine Country\",\n        description: \"Naramata Bench Weinberge über dem Okanagan Lake\",\n        sortOrder: 0\n      },\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Jasper National Park\",\n        description: \"Maligne Lake mit der berühmten Spirit Island\",\n        sortOrder: 1\n      },\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Golden Rocky Mountains\",\n        description: \"Kicking Horse River zwischen majestätischen Gipfeln\",\n        sortOrder: 2\n      },\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1501594907352-04cda38ebc29?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Vernon - Kalamalka Lake\",\n        description: \"Das türkisfarbene Juwel des Okanagan Valley\",\n        sortOrder: 3\n      },\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Wells Gray Provincial Park\",\n        description: \"Helmcken Falls - 141 Meter spektakulärer Wasserfall\",\n        sortOrder: 4\n      },\n      {\n        imageUrl: \"https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n        title: \"Sunshine Coast\",\n        description: \"Powell River & Desolation Sound Marine Park\",\n        sortOrder: 5\n      }\n    ];\n\n    // Create hero images\n    defaultHeroImages.forEach(heroImageData => {\n      const id = randomUUID();\n      const heroImage: HeroImage = {\n        id,\n        title: heroImageData.title,\n        description: heroImageData.description,\n        imageUrl: heroImageData.imageUrl,\n        sortOrder: heroImageData.sortOrder ?? 0, // Use default if undefined\n        objectPath: null,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n      this.heroImages.set(id, heroImage);\n    });\n\n    // Initialize scenic content with default data from hardcoded values\n    this.scenicContent = {\n      id: randomUUID(),\n      title: \"Spektakuläre Landschaften erwarten uns\",\n      subtitle: \"Von den türkisfarbenen Seen des Okanagan-Tals bis zu den majestätischen Gipfeln der Rocky Mountains - jeder Ort ist ein Fotomotiv\",\n      galleries: [\n        {\n          id: randomUUID(),\n          title: \"Penticton Wine Country\",\n          description: \"Okanagan Valley mit über 170 Weingütern\",\n          imageUrl: \"https://images.unsplash.com/photo-1528190336454-13cd56b45b5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800\",\n          linkUrl: \"/location/penticton\" as string,\n          isLarge: true,\n          order: 1\n        },\n        {\n          id: randomUUID(),\n          title: \"Maligne Lake\",\n          description: \"Spirit Island\",\n          imageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n          linkUrl: \"\" as string,\n          isLarge: false,\n          order: 2\n        },\n        {\n          id: randomUUID(),\n          title: \"Golden Rockies\",\n          description: \"Kicking Horse River\",\n          imageUrl: \"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n          linkUrl: \"/location/golden\" as string,\n          isLarge: false,\n          order: 3\n        },\n        {\n          id: randomUUID(),\n          title: \"Kalamalka Lake\",\n          description: \"Türkisfarbenes Juwel\",\n          imageUrl: \"https://images.unsplash.com/photo-1501594907352-04cda38ebc29?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n          linkUrl: \"/location/vernon\" as string,\n          isLarge: false,\n          order: 4\n        },\n        {\n          id: randomUUID(),\n          title: \"Sunshine Coast\",\n          description: \"Desolation Sound\",\n          imageUrl: \"https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n          linkUrl: \"\" as string,\n          isLarge: false,\n          order: 5\n        },\n        {\n          id: randomUUID(),\n          title: \"Wells Gray Falls\",\n          description: \"Helmcken Falls\",\n          imageUrl: \"https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n          linkUrl: \"\" as string,\n          isLarge: false,\n          order: 6\n        }\n      ] as ScenicGalleryItem[],\n      isActive: true,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n  }\n\n  async getLocations(): Promise<Location[]> {\n    return Array.from(this.locations.values()).sort((a, b) => \n      new Date(a.startDate.split('.').reverse().join('-')).getTime() - \n      new Date(b.startDate.split('.').reverse().join('-')).getTime()\n    );\n  }\n\n  async getLocation(id: string): Promise<Location | undefined> {\n    return this.locations.get(id);\n  }\n\n  async getLocationBySlug(slug: string): Promise<Location | undefined> {\n    return Array.from(this.locations.values()).find(loc => loc.slug === slug);\n  }\n\n  async createLocation(location: InsertLocation): Promise<Location> {\n    const id = randomUUID();\n    const newLocation: Location = {\n      ...location,\n      id,\n      accommodation: location.accommodation || null,\n      accommodationWebsite: location.accommodationWebsite || null,\n      accommodationImageUrl: (location as any).accommodationImageUrl || null,\n      accommodationPrice: location.accommodationPrice || null,\n      accommodationCurrency: location.accommodationCurrency || null,\n      accommodationInclusiveServices: location.accommodationInclusiveServices ? [...location.accommodationInclusiveServices] : null,\n      accommodationAmenities: location.accommodationAmenities ? [...location.accommodationAmenities] : null,\n      accommodationCheckinTime: location.accommodationCheckinTime || null,\n      accommodationCheckoutTime: location.accommodationCheckoutTime || null,\n      distance: location.distance || null,\n      imageUrl: location.imageUrl || null,\n      mapImageUrl: (location as any).mapImageUrl || null,\n      coordinates: location.coordinates || null,\n      activities: location.activities ? [...location.activities] : null,\n      restaurants: location.restaurants ? [...location.restaurants] as RestaurantData[] : null,\n      experiences: location.experiences ? [...location.experiences] : null,\n      highlights: location.highlights ? [...location.highlights] : null,\n      funFacts: location.funFacts ? [...location.funFacts] : null,\n      routeHighlights: location.routeHighlights ? [...location.routeHighlights] : null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.locations.set(id, newLocation);\n    return newLocation;\n  }\n\n  async updateLocation(id: string, location: Partial<InsertLocation>): Promise<Location> {\n    const existing = this.locations.get(id);\n    if (!existing) {\n      throw new Error(\"Location not found\");\n    }\n    \n    // Handle array updates properly to avoid type issues\n    const updatedData = { ...location };\n    delete updatedData.activities;\n    delete updatedData.restaurants;\n    delete updatedData.experiences;\n    delete updatedData.highlights;\n    delete updatedData.funFacts;\n    delete updatedData.routeHighlights;\n    \n    const updated: Location = {\n      ...existing,\n      ...updatedData,\n      // Ensure arrays are properly typed when updating\n      activities: location.activities ? [...location.activities] : existing.activities,\n      restaurants: location.restaurants ? [...location.restaurants] as RestaurantData[] : existing.restaurants,\n      experiences: location.experiences ? [...location.experiences] : existing.experiences,\n      highlights: location.highlights ? [...location.highlights] : existing.highlights,\n      funFacts: location.funFacts ? [...location.funFacts] : existing.funFacts,\n      routeHighlights: location.routeHighlights ? [...location.routeHighlights] : existing.routeHighlights,\n      // Handle new accommodation fields\n      accommodationInclusiveServices: location.accommodationInclusiveServices !== undefined ? (location.accommodationInclusiveServices ? [...location.accommodationInclusiveServices] : null) : existing.accommodationInclusiveServices,\n      accommodationAmenities: location.accommodationAmenities !== undefined ? (location.accommodationAmenities ? [...location.accommodationAmenities] : null) : existing.accommodationAmenities,\n      accommodationCheckinTime: location.accommodationCheckinTime !== undefined ? location.accommodationCheckinTime : existing.accommodationCheckinTime,\n      accommodationCheckoutTime: location.accommodationCheckoutTime !== undefined ? location.accommodationCheckoutTime : existing.accommodationCheckoutTime,\n      updatedAt: new Date(),\n    };\n    this.locations.set(id, updated);\n    return updated;\n  }\n\n  async deleteLocation(id: string): Promise<void> {\n    this.locations.delete(id);\n    // Also delete related images\n    const imagesToDelete = Array.from(this.locationImages.values())\n      .filter(img => img.locationId === id);\n    imagesToDelete.forEach(img => this.locationImages.delete(img.id));\n  }\n\n  async getLocationImages(locationId: string): Promise<LocationImage[]> {\n    return Array.from(this.locationImages.values())\n      .filter(img => img.locationId === locationId)\n      .sort((a, b) => b.isMain ? 1 : -1);\n  }\n\n  async addLocationImage(image: InsertLocationImage): Promise<LocationImage> {\n    const id = randomUUID();\n    const newImage: LocationImage = {\n      ...image,\n      id,\n      caption: image.caption || null,\n      isMain: image.isMain || null,\n      objectPath: image.objectPath || null,\n      createdAt: new Date(),\n    };\n    this.locationImages.set(id, newImage);\n    return newImage;\n  }\n\n  async deleteLocationImage(id: string): Promise<void> {\n    this.locationImages.delete(id);\n  }\n\n  async setMainImage(locationId: string, imageId: string): Promise<void> {\n    // Set all images for location to not main\n    Array.from(this.locationImages.values())\n      .filter(img => img.locationId === locationId)\n      .forEach(img => {\n        this.locationImages.set(img.id, { ...img, isMain: false });\n      });\n    \n    // Set specified image as main\n    const image = this.locationImages.get(imageId);\n    if (image) {\n      this.locationImages.set(imageId, { ...image, isMain: true });\n    }\n  }\n\n  async getTripPhotos(locationId: string): Promise<TripPhoto[]> {\n    return Array.from(this.tripPhotos.values())\n      .filter(photo => photo.locationId === locationId)\n      .sort((a, b) => {\n        // Within same location, sort by takenAt (EXIF) then uploadedAt\n        const dateA = a.takenAt || a.uploadedAt || new Date(0);\n        const dateB = b.takenAt || b.uploadedAt || new Date(0);\n        return new Date(dateB).getTime() - new Date(dateA).getTime();\n      });\n  }\n\n  async getAllTripPhotos(): Promise<TripPhoto[]> {\n    return Array.from(this.tripPhotos.values())\n      .sort((a, b) => {\n        // Get location start dates for tour ordering\n        const locationA = Array.from(this.locations.values()).find(loc => loc.id === a.locationId);\n        const locationB = Array.from(this.locations.values()).find(loc => loc.id === b.locationId);\n        \n        const startDateA = locationA?.startDate ? new Date(locationA.startDate) : new Date(0);\n        const startDateB = locationB?.startDate ? new Date(locationB.startDate) : new Date(0);\n        \n        // First sort by location tour order (later locations on top)\n        const locationOrder = startDateB.getTime() - startDateA.getTime();\n        if (locationOrder !== 0) return locationOrder;\n        \n        // Within same location, sort by takenAt (EXIF) then uploadedAt\n        const dateA = a.takenAt || a.uploadedAt || new Date(0);\n        const dateB = b.takenAt || b.uploadedAt || new Date(0);\n        return new Date(dateB).getTime() - new Date(dateA).getTime(); // Most recent first\n      });\n  }\n\n  async addTripPhoto(tripPhoto: InsertTripPhoto): Promise<TripPhoto> {\n    const id = randomUUID();\n    const newTripPhoto: TripPhoto = {\n      id,\n      imageUrl: tripPhoto.imageUrl,\n      locationId: tripPhoto.locationId || null, // Explicit null handling\n      creatorId: tripPhoto.creatorId || null, // Explicit null handling\n      caption: tripPhoto.caption || null,\n      objectPath: tripPhoto.objectPath || null,\n      mediaType: tripPhoto.mediaType || 'image',\n      videoUrl: tripPhoto.videoUrl || null,\n      thumbnailUrl: tripPhoto.thumbnailUrl || null,\n      deleteTokenHash: null,\n      uploadedBy: tripPhoto.uploadedBy || null,\n      uploadedAt: new Date(),\n      likesCount: 0,\n      groupId: tripPhoto.groupId || null,\n      takenAt: tripPhoto.takenAt || null,\n    };\n    this.tripPhotos.set(id, newTripPhoto);\n    return newTripPhoto;\n  }\n\n  async listTripPhotos(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: TripPhoto[]; nextCursor?: string }> {\n    const { locationId, limit = 10, cursor } = params;\n    \n    let photos = Array.from(this.tripPhotos.values());\n    \n    // Filter by location if specified\n    if (locationId) {\n      photos = photos.filter(photo => photo.locationId === locationId);\n    }\n    \n    // Sort by location tour order (startDate), then by takenAt/uploadedAt within location\n    photos.sort((a, b) => {\n      // Get location start dates for tour ordering\n      const locationA = a.locationId ? Array.from(this.locations.values()).find(loc => loc.id === a.locationId) : null;\n      const locationB = b.locationId ? Array.from(this.locations.values()).find(loc => loc.id === b.locationId) : null;\n      \n      // Photos with null locationId go to the top (most recent)\n      const startDateA = locationA?.startDate ? new Date(locationA.startDate) : new Date('2099-12-31');\n      const startDateB = locationB?.startDate ? new Date(locationB.startDate) : new Date('2099-12-31');\n      \n      // First sort by location tour order (later locations on top)\n      const locationOrder = startDateB.getTime() - startDateA.getTime();\n      if (locationOrder !== 0) return locationOrder;\n      \n      // Within same location, sort by takenAt (EXIF) then uploadedAt\n      const dateA = a.takenAt || a.uploadedAt || new Date(0);\n      const dateB = b.takenAt || b.uploadedAt || new Date(0);\n      return new Date(dateB).getTime() - new Date(dateA).getTime();\n    });\n    \n    // Apply cursor pagination\n    if (cursor) {\n      const [cursorDate, cursorId] = cursor.split('_');\n      const cursorTimestamp = parseInt(cursorDate);\n      photos = photos.filter(photo => {\n        const photoTimestamp = photo.uploadedAt ? new Date(photo.uploadedAt).getTime() : 0;\n        return photoTimestamp < cursorTimestamp || (photoTimestamp === cursorTimestamp && photo.id < cursorId);\n      });\n    }\n    \n    // Apply limit and get next cursor\n    const items = photos.slice(0, limit);\n    const nextCursor = items.length === limit && photos.length > limit \n      ? `${items[items.length - 1].uploadedAt ? new Date(items[items.length - 1].uploadedAt!).getTime() : 0}_${items[items.length - 1].id}`\n      : undefined;\n    \n    return { items, nextCursor };\n  }\n\n  async listTripPhotosGrouped(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: GroupedTripPhoto[]; nextCursor?: string }> {\n    const { locationId, limit = 10, cursor } = params;\n    \n    let photos = Array.from(this.tripPhotos.values());\n    \n    // Filter by location if specified\n    if (locationId) {\n      photos = photos.filter(photo => photo.locationId === locationId);\n    }\n    \n    // Group photos by groupId (fallback to individual id for backward compatibility)\n    const groups = new Map<string, TripPhoto[]>();\n    photos.forEach(photo => {\n      const groupKey = photo.groupId || photo.id;\n      if (!groups.has(groupKey)) {\n        groups.set(groupKey, []);\n      }\n      groups.get(groupKey)!.push(photo);\n    });\n    \n    // Transform groups into GroupedTripPhoto format\n    const groupedPhotos: GroupedTripPhoto[] = Array.from(groups.entries()).map(([groupId, groupPhotos]) => {\n      // Sort photos within group by takenAt (fallback to uploadedAt)\n      const sortedPhotos = groupPhotos.sort((a, b) => {\n        const dateA = a.takenAt || a.uploadedAt || new Date(0);\n        const dateB = b.takenAt || b.uploadedAt || new Date(0);\n        return new Date(dateA).getTime() - new Date(dateB).getTime();\n      });\n      \n      // Use the first photo for group metadata\n      const firstPhoto = sortedPhotos[0];\n      const earliestTakenAt = sortedPhotos.find(p => p.takenAt)?.takenAt || firstPhoto.uploadedAt || new Date();\n      \n      return {\n        id: groupId,\n        caption: firstPhoto.caption,\n        locationId: firstPhoto.locationId,\n        creatorId: firstPhoto.creatorId,\n        uploadedAt: firstPhoto.uploadedAt || new Date(),\n        groupTakenAt: earliestTakenAt,\n        media: sortedPhotos.map(photo => ({\n          id: photo.id,\n          mediaType: photo.mediaType || 'image',\n          imageUrl: photo.imageUrl,\n          videoUrl: photo.videoUrl,\n          thumbnailUrl: photo.thumbnailUrl,\n          takenAt: photo.takenAt,\n          likesCount: photo.likesCount || 0,\n        }))\n      };\n    });\n    \n    // Sort groups by groupTakenAt desc (most recent first)\n    groupedPhotos.sort((a, b) => {\n      return new Date(b.groupTakenAt).getTime() - new Date(a.groupTakenAt).getTime();\n    });\n    \n    // Apply cursor pagination\n    let filteredGroups = groupedPhotos;\n    if (cursor) {\n      const [cursorDate, cursorId] = cursor.split('_');\n      const cursorTimestamp = parseInt(cursorDate);\n      filteredGroups = groupedPhotos.filter(group => {\n        const groupTimestamp = new Date(group.groupTakenAt).getTime();\n        return groupTimestamp < cursorTimestamp || (groupTimestamp === cursorTimestamp && group.id < cursorId);\n      });\n    }\n    \n    // Apply limit and get next cursor\n    const items = filteredGroups.slice(0, limit);\n    const nextCursor = items.length === limit && filteredGroups.length > limit \n      ? `${new Date(items[items.length - 1].groupTakenAt).getTime()}_${items[items.length - 1].id}`\n      : undefined;\n    \n    return { items, nextCursor };\n  }\n\n  async createTripPhotoMedia(tripPhoto: InsertTripPhoto & { deleteToken: string }): Promise<TripPhoto & { deleteToken: string }> {\n    const id = randomUUID();\n    const deleteTokenHash = createHash('sha256').update(tripPhoto.deleteToken).digest('hex');\n    \n    const newTripPhoto: TripPhoto = {\n      id,\n      imageUrl: tripPhoto.imageUrl,\n      locationId: tripPhoto.locationId || null,\n      creatorId: tripPhoto.creatorId || null,\n      caption: tripPhoto.caption || null,\n      objectPath: tripPhoto.objectPath || null,\n      mediaType: tripPhoto.mediaType || 'image',\n      videoUrl: tripPhoto.videoUrl || null,\n      thumbnailUrl: tripPhoto.thumbnailUrl || null,\n      deleteTokenHash,\n      uploadedBy: tripPhoto.uploadedBy || null,\n      uploadedAt: new Date(),\n      likesCount: 0,\n      groupId: tripPhoto.groupId || null,\n      takenAt: tripPhoto.takenAt || null,\n    };\n    \n    this.tripPhotos.set(id, newTripPhoto);\n    return { ...newTripPhoto, deleteToken: tripPhoto.deleteToken };\n  }\n\n  async toggleTripPhotoLike(photoId: string, userKey: string): Promise<{ liked: boolean; likesCount: number }> {\n    const photo = this.tripPhotos.get(photoId);\n    if (!photo) {\n      throw new Error('Photo not found');\n    }\n    \n    const likeKey = `${photoId}_${userKey}`;\n    const existingLike = this.tripPhotoLikes.get(likeKey);\n    \n    let liked: boolean;\n    let likesCount = photo.likesCount || 0;\n    \n    if (existingLike?.liked) {\n      // Unlike\n      this.tripPhotoLikes.set(likeKey, { photoId, userKey, liked: false });\n      likesCount = Math.max(0, likesCount - 1);\n      liked = false;\n    } else {\n      // Like\n      this.tripPhotoLikes.set(likeKey, { photoId, userKey, liked: true });\n      likesCount += 1;\n      liked = true;\n    }\n    \n    // Update photo likes count\n    const updatedPhoto = { ...photo, likesCount };\n    this.tripPhotos.set(photoId, updatedPhoto);\n    \n    return { liked, likesCount };\n  }\n\n  async updateTripPhoto(photoId: string, updates: { caption?: string; locationId?: string }): Promise<TripPhoto> {\n    const photo = this.tripPhotos.get(photoId);\n    if (!photo) {\n      throw new Error('Photo not found');\n    }\n\n    // Update the fields\n    const updatedPhoto = {\n      ...photo,\n      ...(updates.caption !== undefined && { caption: updates.caption || null }),\n      ...(updates.locationId !== undefined && { locationId: updates.locationId || null }),\n    };\n\n    this.tripPhotos.set(photoId, updatedPhoto);\n    return updatedPhoto;\n  }\n\n  async updateTripPhotoCaption(photoId: string, caption: string): Promise<TripPhoto> {\n    const photo = this.tripPhotos.get(photoId);\n    if (!photo) {\n      throw new Error('Photo not found');\n    }\n\n    // Update the caption\n    const updatedPhoto = {\n      ...photo,\n      caption: caption || null, // Set to null if caption is empty\n    };\n\n    this.tripPhotos.set(photoId, updatedPhoto);\n    return updatedPhoto;\n  }\n\n  async deleteTripPhoto(photoId: string, deleteToken?: string): Promise<void> {\n    const photo = this.tripPhotos.get(photoId);\n    if (!photo) {\n      throw new Error('Photo not found');\n    }\n    \n    // Verify delete token if provided\n    if (deleteToken && photo.deleteTokenHash) {\n      const providedHash = createHash('sha256').update(deleteToken).digest('hex');\n      if (providedHash !== photo.deleteTokenHash) {\n        throw new Error('Invalid delete token');\n      }\n    }\n    \n    // Delete the photo\n    this.tripPhotos.delete(photoId);\n    \n    // Clean up likes for this photo\n    const likesToRemove: string[] = [];\n    const likeEntries = Array.from(this.tripPhotoLikes.entries());\n    for (const [key, like] of likeEntries) {\n      if (like.photoId === photoId) {\n        likesToRemove.push(key);\n      }\n    }\n    likesToRemove.forEach(key => this.tripPhotoLikes.delete(key));\n  }\n\n  async cleanupBrokenTripPhotos(): Promise<number> {\n    // Remove photos without objectPath (old broken uploads)\n    const photosToRemove: string[] = [];\n    \n    // Use Array.from to avoid MapIterator issues\n    const photoEntries = Array.from(this.tripPhotos.entries());\n    for (const [id, photo] of photoEntries) {\n      if (!photo.objectPath) {\n        photosToRemove.push(id);\n      }\n    }\n    \n    // Remove the broken photos\n    photosToRemove.forEach(id => this.tripPhotos.delete(id));\n    \n    console.log(`Cleaned up ${photosToRemove.length} broken trip photos without objectPath`);\n    return photosToRemove.length;\n  }\n\n  async getTourSettings(): Promise<TourSettings | undefined> {\n    return this.tourSettings;\n  }\n\n  async updateTourSettings(settings: Partial<InsertTourSettings>): Promise<TourSettings> {\n    if (!this.tourSettings) {\n      const id = randomUUID();\n      this.tourSettings = {\n        ...settings,\n        id,\n        updatedAt: new Date(),\n      } as TourSettings;\n    } else {\n      this.tourSettings = {\n        ...this.tourSettings,\n        ...settings,\n        updatedAt: new Date(),\n      };\n    }\n    return this.tourSettings;\n  }\n\n  async addLocationPing(ping: InsertLocationPing): Promise<LocationPing> {\n    const id = randomUUID();\n    const newLocationPing: LocationPing = {\n      ...ping,\n      id,\n      deviceId: ping.deviceId || null,\n      accuracy: ping.accuracy || null,\n      timestamp: ping.timestamp || new Date(),\n      createdAt: new Date(),\n    };\n    this.locationPings.set(id, newLocationPing);\n    return newLocationPing;\n  }\n\n  async getLatestLocationPing(): Promise<LocationPing | undefined> {\n    const pings = Array.from(this.locationPings.values())\n      .sort((a, b) => {\n        const dateA = a.timestamp ? new Date(a.timestamp).getTime() : 0;\n        const dateB = b.timestamp ? new Date(b.timestamp).getTime() : 0;\n        return dateB - dateA;\n      });\n    return pings[0];\n  }\n\n  async getLocationPings(limit?: number): Promise<LocationPing[]> {\n    const pings = Array.from(this.locationPings.values())\n      .sort((a, b) => {\n        const dateA = a.timestamp ? new Date(a.timestamp).getTime() : 0;\n        const dateB = b.timestamp ? new Date(b.timestamp).getTime() : 0;\n        return dateB - dateA;\n      });\n    \n    if (limit) {\n      return pings.slice(0, limit);\n    }\n    return pings;\n  }\n\n  async getHeroImages(): Promise<HeroImage[]> {\n    return Array.from(this.heroImages.values())\n      .sort((a, b) => a.sortOrder - b.sortOrder);\n  }\n\n  async createHeroImage(heroImage: InsertHeroImage): Promise<HeroImage> {\n    const id = randomUUID();\n    const newHeroImage: HeroImage = {\n      id,\n      title: heroImage.title,\n      description: heroImage.description,\n      imageUrl: heroImage.imageUrl,\n      sortOrder: heroImage.sortOrder ?? 0, // Use default if undefined\n      objectPath: heroImage.objectPath || null,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.heroImages.set(id, newHeroImage);\n    return newHeroImage;\n  }\n\n  async updateHeroImage(id: string, heroImage: Partial<InsertHeroImage>): Promise<HeroImage> {\n    const existing = this.heroImages.get(id);\n    if (!existing) {\n      throw new Error(\"Hero image not found\");\n    }\n    \n    const updated: HeroImage = {\n      ...existing,\n      ...heroImage,\n      updatedAt: new Date(),\n    };\n    this.heroImages.set(id, updated);\n    return updated;\n  }\n\n  async deleteHeroImage(id: string): Promise<void> {\n    this.heroImages.delete(id);\n  }\n\n  async reorderHeroImages(imageIds: string[]): Promise<void> {\n    imageIds.forEach((imageId, index) => {\n      const image = this.heroImages.get(imageId);\n      if (image) {\n        this.heroImages.set(imageId, {\n          ...image,\n          sortOrder: index,\n          updatedAt: new Date(),\n        });\n      }\n    });\n  }\n\n  // Scenic content methods\n  async getScenicContent(): Promise<ScenicContent | undefined> {\n    return this.scenicContent;\n  }\n\n  async updateScenicContent(data: Partial<InsertScenicContent>): Promise<ScenicContent> {\n    if (this.scenicContent) {\n      this.scenicContent = {\n        ...this.scenicContent,\n        ...data,\n        galleries: data.galleries ? (data.galleries as ScenicGalleryItem[]) : this.scenicContent.galleries, // Ensure proper array type\n        updatedAt: new Date(),\n      };\n    } else {\n      const id = randomUUID();\n      this.scenicContent = {\n        id,\n        title: data.title || 'Default Title',\n        subtitle: data.subtitle || 'Default Subtitle',\n        galleries: data.galleries ? (data.galleries as ScenicGalleryItem[]) : [],\n        isActive: data.isActive ?? true,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n    }\n    // This will never be undefined because we set it above\n    return this.scenicContent!;\n  }\n\n  // Creator methods\n  async getAllCreators(): Promise<Creator[]> {\n    return Array.from(this.creators.values()).sort((a, b) => \n      a.name.localeCompare(b.name)\n    );\n  }\n\n  async createCreator(creator: InsertCreator): Promise<Creator> {\n    const id = randomUUID();\n    const newCreator: Creator = {\n      ...creator,\n      id,\n      createdAt: new Date(),\n    };\n    this.creators.set(id, newCreator);\n    return newCreator;\n  }\n\n  async updateCreator(id: string, creator: Partial<InsertCreator>): Promise<Creator> {\n    const existing = this.creators.get(id);\n    if (!existing) {\n      throw new Error(\"Creator not found\");\n    }\n    \n    const updated: Creator = {\n      ...existing,\n      ...creator,\n    };\n    this.creators.set(id, updated);\n    return updated;\n  }\n\n  async deleteCreator(id: string): Promise<void> {\n    this.creators.delete(id);\n  }\n}\n\n// Database Storage implementation using PostgreSQL\nexport class DatabaseStorage implements IStorage {\n  private initialized = false;\n\n  constructor() {\n    this.ensureInitialized();\n  }\n\n  private async ensureInitialized() {\n    if (this.initialized) return;\n    await this.initializeDatabase();\n    this.initialized = true;\n  }\n\n  private async migrateRestaurantData() {\n    try {\n      console.log(\"Starting restaurant data migration...\");\n      \n      // Get all existing locations from database\n      const allLocations = await db.select().from(locations);\n      \n      let migratedCount = 0;\n      \n      // Create a map of slug -> restaurant data from INITIAL_LOCATIONS for quick lookup\n      const restaurantDataBySlug = new Map<string, RestaurantData[]>();\n      INITIAL_LOCATIONS.forEach(initialLocation => {\n        if (initialLocation.restaurants && initialLocation.restaurants.length > 0) {\n          restaurantDataBySlug.set(initialLocation.slug, initialLocation.restaurants as RestaurantData[]);\n        }\n      });\n      \n      // Update each location's restaurant data if it exists in INITIAL_LOCATIONS\n      for (const location of allLocations) {\n        const correctRestaurantData = restaurantDataBySlug.get(location.slug);\n        \n        if (correctRestaurantData) {\n          console.log(`Migrating restaurant data for location: ${location.name} (${location.slug})`);\n          \n          await db.update(locations)\n            .set({ \n              restaurants: correctRestaurantData,\n              updatedAt: new Date() // Force cache invalidation\n            })\n            .where(eq(locations.id, location.id));\n          \n          migratedCount++;\n          console.log(`  ✓ Updated ${correctRestaurantData.length} restaurants for ${location.name}`);\n        }\n      }\n      \n      console.log(`Restaurant data migration completed. Updated ${migratedCount} locations.`);\n    } catch (error) {\n      console.error(\"Error during restaurant data migration:\", error);\n      throw error;\n    }\n  }\n\n  private async initializeDatabase() {\n    try {\n      // Check if we have any data in the database\n      const existingLocations = await db.select().from(locations).limit(1);\n      const existingCreators = await db.select().from(creators).limit(1);\n      \n      // Only initialize if database is empty\n      if (existingLocations.length === 0) {\n        console.log(\"Initializing database with default data...\");\n        \n        // Initialize default creators first\n        const defaultCreators = [\"Rimas\", \"Susanne\", \"Ursula\", \"Helmut\"];\n        for (const name of defaultCreators) {\n          await db.insert(creators).values({ name });\n        }\n\n        // Use shared location data\n        const initialLocations = INITIAL_LOCATIONS;\n\n        // Insert all locations\n        await db.insert(locations).values(initialLocations as any);\n\n        // Initialize tour settings\n        await db.insert(tourSettings).values({\n          tourName: \"Weinberg Tour 2025\",\n          startDate: \"20.09.2025\",\n          endDate: \"06.10.2025\", \n          totalDistance: 2130,\n          totalCost: 8779,\n          currency: \"CAD\",\n          heroImageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n          description: \"Entdecke die atemberaubende Schönheit Kanadas - von den Weinbergen des Okanagan-Tals bis zu den majestätischen Rocky Mountains\",\n          privacyEnabled: false,\n          privacyPassword: null,\n          sessionTimeout: 10080,\n          gpsActivatedByAdmin: false,\n        });\n\n        // Initialize hero images\n        const defaultHeroImages = [\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1528190336454-13cd56b45b5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Penticton Wine Country\",\n            description: \"Naramata Bench Weinberge über dem Okanagan Lake\",\n            sortOrder: 0\n          },\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Jasper National Park\",\n            description: \"Maligne Lake mit der berühmten Spirit Island\",\n            sortOrder: 1\n          },\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Golden Rocky Mountains\",\n            description: \"Kicking Horse River zwischen majestätischen Gipfeln\",\n            sortOrder: 2\n          },\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1501594907352-04cda38ebc29?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Vernon - Kalamalka Lake\",\n            description: \"Das türkisfarbene Juwel des Okanagan Valley\",\n            sortOrder: 3\n          },\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Wells Gray Provincial Park\",\n            description: \"Helmcken Falls - 141 Meter spektakulärer Wasserfall\",\n            sortOrder: 4\n          },\n          {\n            imageUrl: \"https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080\",\n            title: \"Sunshine Coast\",\n            description: \"Powell River & Desolation Sound Marine Park\",\n            sortOrder: 5\n          }\n        ];\n\n        for (const heroImage of defaultHeroImages) {\n          await db.insert(heroImages).values(heroImage);\n        }\n\n        // Initialize scenic content\n        await db.insert(scenicContent).values({\n          title: \"Spektakuläre Landschaften erwarten uns\",\n          subtitle: \"Von den türkisfarbenen Seen des Okanagan-Tals bis zu den majestätischen Gipfeln der Rocky Mountains - jeder Ort ist ein Fotomotiv\",\n          galleries: [\n            {\n              id: randomUUID(),\n              title: \"Penticton Wine Country\",\n              description: \"Okanagan Valley mit über 170 Weingütern\",\n              imageUrl: \"https://images.unsplash.com/photo-1528190336454-13cd56b45b5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800\",\n              linkUrl: \"/location/penticton\",\n              isLarge: true,\n              order: 1\n            },\n            {\n              id: randomUUID(),\n              title: \"Maligne Lake\",\n              description: \"Spirit Island\",\n              imageUrl: \"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n              linkUrl: \"\",\n              isLarge: false,\n              order: 2\n            },\n            {\n              id: randomUUID(),\n              title: \"Golden Rockies\",\n              description: \"Kicking Horse River\",\n              imageUrl: \"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n              linkUrl: \"/location/golden\",\n              isLarge: false,\n              order: 3\n            },\n            {\n              id: randomUUID(),\n              title: \"Kalamalka Lake\",\n              description: \"Türkisfarbenes Juwel\",\n              imageUrl: \"https://images.unsplash.com/photo-1501594907352-04cda38ebc29?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n              linkUrl: \"/location/vernon\",\n              isLarge: false,\n              order: 4\n            },\n            {\n              id: randomUUID(),\n              title: \"Sunshine Coast\",\n              description: \"Desolation Sound\",\n              imageUrl: \"https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n              linkUrl: \"\",\n              isLarge: false,\n              order: 5\n            },\n            {\n              id: randomUUID(),\n              title: \"Wells Gray Falls\",\n              description: \"Helmcken Falls\",\n              imageUrl: \"https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=400\",\n              linkUrl: \"\",\n              isLarge: false,\n              order: 6\n            }\n          ] as ScenicGalleryItem[],\n          isActive: true,\n        });\n\n        console.log(\"Database initialized with default data\");\n      } else {\n        console.log(\"Database already has data, skipping initialization\");\n      }\n\n      // Run restaurant data migration (idempotent - safe to run multiple times)\n      await this.migrateRestaurantData();\n      \n    } catch (error) {\n      console.error(\"Error initializing database:\", error);\n      throw error;\n    }\n  }\n\n  // Location operations\n  async getLocations(): Promise<Location[]> {\n    await this.ensureInitialized();\n    const results = await db.select().from(locations);\n    return results.sort((a, b) => \n      new Date(a.startDate.split('.').reverse().join('-')).getTime() - \n      new Date(b.startDate.split('.').reverse().join('-')).getTime()\n    );\n  }\n\n  async getLocation(id: string): Promise<Location | undefined> {\n    await this.ensureInitialized();\n    const result = await db.select().from(locations).where(eq(locations.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getLocationBySlug(slug: string): Promise<Location | undefined> {\n    await this.ensureInitialized();\n    const result = await db.select().from(locations).where(eq(locations.slug, slug)).limit(1);\n    return result[0];\n  }\n\n  async createLocation(location: InsertLocation): Promise<Location> {\n    await this.ensureInitialized();\n    const result = await db.insert(locations).values([location as any]).returning();\n    return result[0];\n  }\n\n  async updateLocation(id: string, location: Partial<InsertLocation>): Promise<Location> {\n    await this.ensureInitialized();\n    const updateData = { ...location, updatedAt: new Date() } as any;\n    const result = await db.update(locations)\n      .set(updateData)\n      .where(eq(locations.id, id))\n      .returning();\n    \n    if (!result[0]) {\n      throw new Error(\"Location not found\");\n    }\n    return result[0];\n  }\n\n  async deleteLocation(id: string): Promise<void> {\n    await this.ensureInitialized();\n    // Delete related images first\n    await db.delete(locationImages).where(eq(locationImages.locationId, id));\n    // Delete related trip photos\n    await db.delete(tripPhotos).where(eq(tripPhotos.locationId, id));\n    // Delete location\n    await db.delete(locations).where(eq(locations.id, id));\n  }\n\n  // Location images\n  async getLocationImages(locationId: string): Promise<LocationImage[]> {\n    await this.ensureInitialized();\n    const result = await db.select().from(locationImages)\n      .where(eq(locationImages.locationId, locationId));\n    return result.sort((a, b) => (b.isMain ? 1 : 0) - (a.isMain ? 1 : 0));\n  }\n\n  async addLocationImage(image: InsertLocationImage): Promise<LocationImage> {\n    await this.ensureInitialized();\n    const result = await db.insert(locationImages).values(image).returning();\n    return result[0];\n  }\n\n  async deleteLocationImage(id: string): Promise<void> {\n    await this.ensureInitialized();\n    await db.delete(locationImages).where(eq(locationImages.id, id));\n  }\n\n  async setMainImage(locationId: string, imageId: string): Promise<void> {\n    await this.ensureInitialized();\n    // Set all images for location to not main\n    await db.update(locationImages)\n      .set({ isMain: false })\n      .where(eq(locationImages.locationId, locationId));\n    \n    // Set specified image as main\n    await db.update(locationImages)\n      .set({ isMain: true })\n      .where(eq(locationImages.id, imageId));\n  }\n\n  // Trip photos\n  async getTripPhotos(locationId: string): Promise<TripPhoto[]> {\n    await this.ensureInitialized();\n    const result = await db.select().from(tripPhotos)\n      .where(eq(tripPhotos.locationId, locationId))\n      .orderBy(desc(tripPhotos.uploadedAt));\n    return result;\n  }\n\n  async getAllTripPhotos(): Promise<TripPhoto[]> {\n    await this.ensureInitialized();\n    const result = await db.select().from(tripPhotos)\n      .orderBy(desc(tripPhotos.uploadedAt));\n    return result;\n  }\n\n  async addTripPhoto(tripPhoto: InsertTripPhoto): Promise<TripPhoto> {\n    await this.ensureInitialized();\n    const result = await db.insert(tripPhotos).values(tripPhoto).returning();\n    return result[0];\n  }\n\n  async listTripPhotos(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: TripPhoto[]; nextCursor?: string }> {\n    await this.ensureInitialized();\n    \n    const { locationId, limit = 10, cursor } = params;\n    \n    let query = db.select().from(tripPhotos);\n    \n    // Filter by location if specified\n    if (locationId) {\n      query = query.where(eq(tripPhotos.locationId, locationId)) as any;\n    }\n    \n    // Apply cursor pagination\n    if (cursor) {\n      const [cursorDate, cursorId] = cursor.split('_');\n      const cursorTimestamp = new Date(parseInt(cursorDate));\n      query = query.where(\n        sql`(${tripPhotos.uploadedAt} < ${cursorTimestamp} OR (${tripPhotos.uploadedAt} = ${cursorTimestamp} AND ${tripPhotos.id} < ${cursorId}))`\n      ) as any;\n    }\n    \n    // Order by location tour order (startDate) descending, then by takenAt/uploadedAt, then by ID\n    const resultWithLocation = await query\n      .leftJoin(locations, eq(tripPhotos.locationId, locations.id))\n      .orderBy(\n        sql`COALESCE(${locations.startDate}, '1900-01-01') DESC`,\n        sql`COALESCE(${tripPhotos.takenAt}, ${tripPhotos.uploadedAt}) DESC`, \n        desc(tripPhotos.id)\n      )\n      .limit(limit + 1); // Get one extra to determine if there's a next page\n    \n    // Extract trip photos from joined result\n    const result = resultWithLocation.map(row => row.trip_photos);\n    \n    // Check if there are more items\n    const hasMore = result.length > limit;\n    const items = hasMore ? result.slice(0, limit) : result;\n    \n    const nextCursor = hasMore && items.length > 0\n      ? `${items[items.length - 1].uploadedAt!.getTime()}_${items[items.length - 1].id}`\n      : undefined;\n    \n    return { items, nextCursor };\n  }\n\n  async listTripPhotosGrouped(params: { locationId?: string; limit?: number; cursor?: string }): Promise<{ items: GroupedTripPhoto[]; nextCursor?: string }> {\n    await this.ensureInitialized();\n    \n    const { locationId, limit = 10, cursor } = params;\n    \n    // PERFORMANCE OPTIMIZATION: Use database-level pagination instead of fetching all photos\n    let baseQuery = db.select().from(tripPhotos);\n    \n    // Filter by location if specified\n    if (locationId) {\n      baseQuery = baseQuery.where(eq(tripPhotos.locationId, locationId)) as any;\n    }\n    \n    // Apply cursor filtering at database level for better performance\n    if (cursor) {\n      const [cursorDate, cursorId] = cursor.split('_');\n      if (cursorDate && cursorId) {\n        const cursorTimestamp = new Date(parseInt(cursorDate));\n        baseQuery = baseQuery.where(\n          or(\n            lt(tripPhotos.uploadedAt, cursorTimestamp),\n            and(\n              eq(tripPhotos.uploadedAt, cursorTimestamp),\n              lt(tripPhotos.id, cursorId)\n            )\n          )\n        ) as any;\n      }\n    }\n    \n    // Fetch limited set of photos with optimized limit for grouping\n    const photos = await baseQuery\n      .orderBy(desc(tripPhotos.uploadedAt), desc(tripPhotos.id))\n      .limit(limit * 4); // Get 4x limit to handle group boundaries efficiently\n    \n    if (photos.length === 0) {\n      return { items: [] };\n    }\n    \n    // Group photos by groupId (fallback to individual id for backward compatibility)  \n    const groups = new Map<string, TripPhoto[]>();\n    const seenGroupIds = new Set<string>();\n    \n    for (const photo of photos) {\n      const groupKey = photo.groupId || photo.id;\n      if (!groups.has(groupKey)) {\n        groups.set(groupKey, []);\n      }\n      groups.get(groupKey)!.push(photo);\n      seenGroupIds.add(groupKey);\n    }\n    \n    // For groups with actual groupId (not single photo groups), fetch complete groups\n    const realGroupIds = Array.from(seenGroupIds).filter(id => {\n      // Only fetch complete groups for actual group IDs (which are longer UUIDs)\n      // Single photos use their photo ID as groupKey, so skip those\n      const isRealGroup = photos.some(p => p.groupId === id && p.groupId !== null);\n      return isRealGroup;\n    });\n    \n    // Fetch complete groups in a single efficient query\n    if (realGroupIds.length > 0) {\n      const completeGroupPhotos = await db.select().from(tripPhotos)\n        .where(inArray(tripPhotos.groupId, realGroupIds))\n        .orderBy(asc(tripPhotos.takenAt), asc(tripPhotos.uploadedAt));\n      \n      // Replace partial groups with complete groups\n      const completeGroups = new Map<string, TripPhoto[]>();\n      for (const photo of completeGroupPhotos) {\n        const groupId = photo.groupId!;\n        if (!completeGroups.has(groupId)) {\n          completeGroups.set(groupId, []);\n        }\n        completeGroups.get(groupId)!.push(photo);\n      }\n      \n      // Merge complete groups back\n      for (const [groupId, groupPhotos] of completeGroups) {\n        groups.set(groupId, groupPhotos);\n      }\n    }\n    \n    // Transform groups into GroupedTripPhoto format\n    const groupedPhotos: GroupedTripPhoto[] = Array.from(groups.entries()).map(([groupId, groupPhotos]) => {\n      // Sort photos within group by takenAt (fallback to uploadedAt)\n      const sortedPhotos = groupPhotos.sort((a, b) => {\n        const dateA = a.takenAt || a.uploadedAt || new Date(0);\n        const dateB = b.takenAt || b.uploadedAt || new Date(0);\n        return new Date(dateA).getTime() - new Date(dateB).getTime();\n      });\n      \n      // Use the first photo for group metadata\n      const firstPhoto = sortedPhotos[0];\n      const earliestTakenAt = sortedPhotos.find(p => p.takenAt)?.takenAt || firstPhoto.uploadedAt || new Date();\n      \n      return {\n        id: groupId,\n        caption: firstPhoto.caption,\n        locationId: firstPhoto.locationId,\n        creatorId: firstPhoto.creatorId,\n        uploadedAt: firstPhoto.uploadedAt || new Date(),\n        groupTakenAt: earliestTakenAt,\n        media: sortedPhotos.map(photo => ({\n          id: photo.id,\n          mediaType: photo.mediaType || 'image',\n          imageUrl: photo.imageUrl,\n          videoUrl: photo.videoUrl,\n          thumbnailUrl: photo.thumbnailUrl,\n          takenAt: photo.takenAt,\n          likesCount: photo.likesCount || 0,\n        }))\n      };\n    });\n    \n    // Sort groups by uploadedAt (database order preserved mostly, just need final sort)\n    groupedPhotos.sort((a, b) => {\n      return new Date(b.uploadedAt).getTime() - new Date(a.uploadedAt).getTime();\n    });\n    \n    // Take only the requested limit of groups and generate next cursor\n    const items = groupedPhotos.slice(0, limit);\n    const nextCursor = items.length === limit && groupedPhotos.length > limit \n      ? `${new Date(items[items.length - 1].uploadedAt).getTime()}_${items[items.length - 1].id}`\n      : undefined;\n    \n    return { items, nextCursor };\n  }\n\n  async createTripPhotoMedia(tripPhoto: InsertTripPhoto & { deleteToken: string }): Promise<TripPhoto & { deleteToken: string }> {\n    await this.ensureInitialized();\n    \n    const deleteTokenHash = createHash('sha256').update(tripPhoto.deleteToken).digest('hex');\n    \n    const photoToInsert = {\n      ...tripPhoto,\n      deleteTokenHash,\n      mediaType: tripPhoto.mediaType || 'image',\n      likesCount: 0,\n    };\n    \n    const result = await db.insert(tripPhotos).values(photoToInsert).returning();\n    return { ...result[0], deleteToken: tripPhoto.deleteToken };\n  }\n\n  async toggleTripPhotoLike(photoId: string, userKey: string): Promise<{ liked: boolean; likesCount: number }> {\n    await this.ensureInitialized();\n    \n    // Check if like already exists\n    const existingLike = await db.select().from(tripPhotoLikes)\n      .where(and(\n        eq(tripPhotoLikes.tripPhotoId, photoId),\n        eq(tripPhotoLikes.userIdentifier, userKey)\n      ))\n      .limit(1);\n    \n    let liked: boolean;\n    \n    if (existingLike.length > 0) {\n      // Remove like\n      await db.delete(tripPhotoLikes)\n        .where(and(\n          eq(tripPhotoLikes.tripPhotoId, photoId),\n          eq(tripPhotoLikes.userIdentifier, userKey)\n        ));\n      \n      // Decrement likes count\n      await db.update(tripPhotos)\n        .set({ likesCount: sql`GREATEST(0, ${tripPhotos.likesCount} - 1)` })\n        .where(eq(tripPhotos.id, photoId));\n      \n      liked = false;\n    } else {\n      // Add like\n      await db.insert(tripPhotoLikes).values({\n        tripPhotoId: photoId,\n        userIdentifier: userKey,\n        creatorId: null, // For anonymous likes\n      });\n      \n      // Increment likes count\n      await db.update(tripPhotos)\n        .set({ likesCount: sql`${tripPhotos.likesCount} + 1` })\n        .where(eq(tripPhotos.id, photoId));\n      \n      liked = true;\n    }\n    \n    // Get updated likes count\n    const updatedPhoto = await db.select({ likesCount: tripPhotos.likesCount })\n      .from(tripPhotos)\n      .where(eq(tripPhotos.id, photoId))\n      .limit(1);\n    \n    return { liked, likesCount: updatedPhoto[0]?.likesCount || 0 };\n  }\n\n  async updateTripPhoto(photoId: string, updates: { caption?: string; locationId?: string }): Promise<TripPhoto> {\n    await this.ensureInitialized();\n    \n    // Build update object\n    const updateData: any = {};\n    if (updates.caption !== undefined) {\n      updateData.caption = updates.caption || null;\n    }\n    if (updates.locationId !== undefined) {\n      updateData.locationId = updates.locationId || null;\n    }\n    \n    // Update the trip photo in the database\n    const result = await db.update(tripPhotos)\n      .set(updateData)\n      .where(eq(tripPhotos.id, photoId))\n      .returning();\n    \n    if (result.length === 0) {\n      throw new Error('Photo not found');\n    }\n    \n    return result[0];\n  }\n\n  async updateTripPhotoCaption(photoId: string, caption: string): Promise<TripPhoto> {\n    await this.ensureInitialized();\n    \n    // Update the caption in the database\n    const result = await db.update(tripPhotos)\n      .set({ caption: caption || null })\n      .where(eq(tripPhotos.id, photoId))\n      .returning();\n    \n    if (result.length === 0) {\n      throw new Error('Photo not found');\n    }\n    \n    return result[0];\n  }\n\n  async deleteTripPhoto(photoId: string, deleteToken?: string): Promise<void> {\n    await this.ensureInitialized();\n    \n    // Get photo to verify delete token if provided\n    if (deleteToken) {\n      const photo = await db.select({ deleteTokenHash: tripPhotos.deleteTokenHash })\n        .from(tripPhotos)\n        .where(eq(tripPhotos.id, photoId))\n        .limit(1);\n      \n      if (photo.length === 0) {\n        throw new Error('Photo not found');\n      }\n      \n      if (photo[0].deleteTokenHash) {\n        const providedHash = createHash('sha256').update(deleteToken).digest('hex');\n        if (providedHash !== photo[0].deleteTokenHash) {\n          throw new Error('Invalid delete token');\n        }\n      }\n    }\n    \n    // Delete associated likes first\n    await db.delete(tripPhotoLikes)\n      .where(eq(tripPhotoLikes.tripPhotoId, photoId));\n    \n    // Delete the photo\n    await db.delete(tripPhotos)\n      .where(eq(tripPhotos.id, photoId));\n  }\n\n  async cleanupBrokenTripPhotos(): Promise<number> {\n    await this.ensureInitialized();\n    const result = await db.delete(tripPhotos)\n      .where(isNull(tripPhotos.objectPath))\n      .returning();\n    \n    console.log(`Cleaned up ${result.length} broken trip photos without objectPath`);\n    return result.length;\n  }\n\n  // Tour settings\n  async getTourSettings(): Promise<TourSettings | undefined> {\n    await this.ensureInitialized();\n    const result = await db.select().from(tourSettings).limit(1);\n    return result[0];\n  }\n\n  async updateTourSettings(settings: Partial<InsertTourSettings>): Promise<TourSettings> {\n    await this.ensureInitialized();\n    \n    // Check if settings exist\n    const existing = await db.select().from(tourSettings).limit(1);\n    \n    if (existing.length === 0) {\n      // Create new settings\n      const result = await db.insert(tourSettings).values([settings as any]).returning();\n      return result[0];\n    } else {\n      // Update existing settings\n      const result = await db.update(tourSettings)\n        .set({ ...settings, updatedAt: new Date() })\n        .where(eq(tourSettings.id, existing[0].id))\n        .returning();\n      return result[0];\n    }\n  }\n\n  // Location pings for live GPS tracking\n  async addLocationPing(ping: InsertLocationPing): Promise<LocationPing> {\n    await this.ensureInitialized();\n    const result = await db.insert(locationPings).values(ping).returning();\n    return result[0];\n  }\n\n  async getLatestLocationPing(): Promise<LocationPing | undefined> {\n    await this.ensureInitialized();\n    const result = await db.select().from(locationPings)\n      .orderBy(desc(locationPings.timestamp))\n      .limit(1);\n    return result[0];\n  }\n\n  async getLocationPings(limit?: number): Promise<LocationPing[]> {\n    await this.ensureInitialized();\n    const query = db.select().from(locationPings).orderBy(desc(locationPings.timestamp));\n    \n    if (limit) {\n      return await query.limit(limit);\n    }\n    \n    return await query;\n  }\n\n  // Hero images for homepage slideshow\n  async getHeroImages(): Promise<HeroImage[]> {\n    await this.ensureInitialized();\n    const result = await db.select().from(heroImages)\n      .orderBy(heroImages.sortOrder);\n    return result;\n  }\n\n  async createHeroImage(heroImage: InsertHeroImage): Promise<HeroImage> {\n    await this.ensureInitialized();\n    const result = await db.insert(heroImages).values(heroImage).returning();\n    return result[0];\n  }\n\n  async updateHeroImage(id: string, heroImage: Partial<InsertHeroImage>): Promise<HeroImage> {\n    await this.ensureInitialized();\n    const result = await db.update(heroImages)\n      .set({ ...heroImage, updatedAt: new Date() })\n      .where(eq(heroImages.id, id))\n      .returning();\n    \n    if (!result[0]) {\n      throw new Error(\"Hero image not found\");\n    }\n    return result[0];\n  }\n\n  async deleteHeroImage(id: string): Promise<void> {\n    await this.ensureInitialized();\n    await db.delete(heroImages).where(eq(heroImages.id, id));\n  }\n\n  async reorderHeroImages(imageIds: string[]): Promise<void> {\n    await this.ensureInitialized();\n    for (let i = 0; i < imageIds.length; i++) {\n      await db.update(heroImages)\n        .set({ sortOrder: i, updatedAt: new Date() })\n        .where(eq(heroImages.id, imageIds[i]));\n    }\n  }\n\n  // Scenic content for \"Spektakuläre Landschaften erwarten uns\" section\n  async getScenicContent(): Promise<ScenicContent | undefined> {\n    await this.ensureInitialized();\n    const result = await db.select().from(scenicContent)\n      .where(eq(scenicContent.isActive, true))\n      .limit(1);\n    return result[0];\n  }\n\n  async updateScenicContent(data: Partial<InsertScenicContent>): Promise<ScenicContent> {\n    await this.ensureInitialized();\n    \n    // Check if content exists\n    const existing = await db.select().from(scenicContent).limit(1);\n    \n    if (existing.length === 0) {\n      // Create new content\n      const result = await db.insert(scenicContent).values([{\n        title: data.title || 'Default Title',\n        subtitle: data.subtitle || 'Default Subtitle',\n        galleries: data.galleries || [],\n        isActive: data.isActive ?? true,\n      } as any]).returning();\n      return result[0];\n    } else {\n      // Update existing content\n      const updateData = { ...data, updatedAt: new Date() } as any;\n      const result = await db.update(scenicContent)\n        .set(updateData)\n        .where(eq(scenicContent.id, existing[0].id))\n        .returning();\n      return result[0];\n    }\n  }\n\n  // Creator operations\n  async getAllCreators(): Promise<Creator[]> {\n    await this.ensureInitialized();\n    const result = await db.select().from(creators);\n    return result.sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  async createCreator(creator: InsertCreator): Promise<Creator> {\n    await this.ensureInitialized();\n    const result = await db.insert(creators).values(creator).returning();\n    return result[0];\n  }\n\n  async updateCreator(id: string, creator: Partial<InsertCreator>): Promise<Creator> {\n    await this.ensureInitialized();\n    const result = await db.update(creators)\n      .set(creator)\n      .where(eq(creators.id, id))\n      .returning();\n    \n    if (!result[0]) {\n      throw new Error(\"Creator not found\");\n    }\n    return result[0];\n  }\n\n  async deleteCreator(id: string): Promise<void> {\n    await this.ensureInitialized();\n    await db.delete(creators).where(eq(creators.id, id));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":78582},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, jsonb, timestamp, boolean, uniqueIndex } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Locations table for storing tour destinations\nexport const locations = pgTable(\"locations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  slug: text(\"slug\").notNull().unique(),\n  startDate: text(\"start_date\").notNull(),\n  endDate: text(\"end_date\").notNull(),\n  description: text(\"description\").notNull(),\n  accommodation: text(\"accommodation\"),\n  accommodationWebsite: text(\"accommodation_website\"),\n  accommodationImageUrl: text(\"accommodation_image_url\"),\n  accommodationPrice: integer(\"accommodation_price\"),\n  accommodationCurrency: text(\"accommodation_currency\").default(\"CAD\"),\n  accommodationInclusiveServices: jsonb(\"accommodation_inclusive_services\").$type<string[]>().default([]),\n  accommodationAmenities: jsonb(\"accommodation_amenities\").$type<string[]>().default([]),\n  accommodationCheckinTime: text(\"accommodation_checkin_time\"),\n  accommodationCheckoutTime: text(\"accommodation_checkout_time\"),\n  distance: integer(\"distance\"), // km from previous location\n  imageUrl: text(\"image_url\"),\n  mapImageUrl: text(\"map_image_url\"), // Map screenshot/snippet for location\n  coordinates: jsonb(\"coordinates\").$type<{ lat: number; lng: number }>(),\n  activities: jsonb(\"activities\").$type<string[]>().default([]),\n  restaurants: jsonb(\"restaurants\").$type<RestaurantData[]>().default([]),\n  experiences: jsonb(\"experiences\").$type<string[]>().default([]),\n  highlights: jsonb(\"highlights\").$type<string[]>().default([]),\n  funFacts: jsonb(\"fun_facts\").$type<string[]>().default([]),\n  routeHighlights: jsonb(\"route_highlights\").$type<string[]>().default([]), // Along the way stops and attractions\n  // English translations\n  nameEn: text(\"name_en\"),\n  descriptionEn: text(\"description_en\"),\n  accommodationEn: text(\"accommodation_en\"),\n  activitiesEn: jsonb(\"activities_en\").$type<string[]>().default([]),\n  restaurantsEn: jsonb(\"restaurants_en\").$type<RestaurantData[]>().default([]),\n  experiencesEn: jsonb(\"experiences_en\").$type<string[]>().default([]),\n  highlightsEn: jsonb(\"highlights_en\").$type<string[]>().default([]),\n  funFactsEn: jsonb(\"fun_facts_en\").$type<string[]>().default([]),\n  accommodationInclusiveServicesEn: jsonb(\"accommodation_inclusive_services_en\").$type<string[]>().default([]),\n  accommodationAmenitiesEn: jsonb(\"accommodation_amenities_en\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Images table for location galleries\nexport const locationImages = pgTable(\"location_images\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  locationId: varchar(\"location_id\").references(() => locations.id).notNull(),\n  imageUrl: text(\"image_url\").notNull(),\n  caption: text(\"caption\"),\n  isMain: boolean(\"is_main\").default(false),\n  objectPath: text(\"object_path\"), // for object storage\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Creators for tracking who uploads content\nexport const creators = pgTable(\"creators\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Trip photos for centralized live feed during tour\nexport const tripPhotos = pgTable(\"trip_photos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  locationId: varchar(\"location_id\").references(() => locations.id), // optional location tag\n  creatorId: varchar(\"creator_id\").references(() => creators.id, { onDelete: \"set null\" }), // who uploaded this photo\n  imageUrl: text(\"image_url\").notNull(), // Required - for images and video thumbnails\n  caption: text(\"caption\"),\n  objectPath: text(\"object_path\"), // for object storage\n  mediaType: text(\"media_type\").notNull().default(\"image\"), // 'image' or 'video'\n  videoUrl: text(\"video_url\"), // for video posts\n  thumbnailUrl: text(\"thumbnail_url\"), // video thumbnail (also stored in imageUrl for compatibility)\n  deleteTokenHash: text(\"delete_token_hash\"), // hashed delete token for secure deletion\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n  uploadedBy: text(\"uploaded_by\"), // deprecated - kept for backward compatibility\n  likesCount: integer(\"likes_count\").default(0), // denormalized likes count for performance\n  groupId: text(\"group_id\"), // optional - links multiple files uploaded together\n  takenAt: timestamp(\"taken_at\"), // when photo was actually taken (from EXIF data)\n});\n\n// Likes for trip photos\nexport const tripPhotoLikes = pgTable(\"trip_photo_likes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tripPhotoId: varchar(\"trip_photo_id\").references(() => tripPhotos.id, { onDelete: \"cascade\" }).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => creators.id, { onDelete: \"cascade\" }), // optional: track who liked\n  userIdentifier: text(\"user_identifier\"), // fallback for anonymous likes (IP, session, etc.)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  // Prevent duplicate likes from same user on same photo\n  uniqueLike: uniqueIndex(\"unique_trip_photo_like\").on(table.tripPhotoId, table.creatorId, table.userIdentifier),\n}));\n\n// Tour settings for general configuration\nexport const tourSettings = pgTable(\"tour_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tourName: text(\"tour_name\").notNull(),\n  startDate: text(\"start_date\").notNull(),\n  endDate: text(\"end_date\").notNull(),\n  totalDistance: integer(\"total_distance\"),\n  totalCost: integer(\"total_cost\"),\n  currency: text(\"currency\").default(\"CAD\"),\n  heroImageUrl: text(\"hero_image_url\"),\n  description: text(\"description\"),\n  // Privacy settings\n  privacyEnabled: boolean(\"privacy_enabled\").default(false),\n  privacyPassword: text(\"privacy_password\"), // hashed password\n  sessionTimeout: integer(\"session_timeout\").default(10080), // default 7 days in minutes\n  // GPS settings\n  gpsActivatedByAdmin: boolean(\"gps_activated_by_admin\").default(false),\n  gpsUpdateInterval: integer(\"gps_update_interval\").default(30), // GPS update interval in seconds\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Location pings for live GPS tracking\nexport const locationPings = pgTable(\"location_pings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  latitude: text(\"latitude\").notNull(), // Store as text for precision\n  longitude: text(\"longitude\").notNull(), // Store as text for precision\n  accuracy: integer(\"accuracy\"), // GPS accuracy in meters\n  deviceId: text(\"device_id\"), // Optional device/session identifier\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Hero images for slideshow on homepage\nexport const heroImages = pgTable(\"hero_images\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  imageUrl: text(\"image_url\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  objectPath: text(\"object_path\"), // for object storage\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Scenic content for \"Spektakuläre Landschaften erwarten uns\" section\nexport const scenicContent = pgTable(\"scenic_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  subtitle: text(\"subtitle\").notNull(),\n  galleries: jsonb(\"galleries\").$type<ScenicGalleryItem[]>().notNull().default([]),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Restaurant data type\nexport interface RestaurantData {\n  name: string;\n  description: string;\n  cuisine?: string;\n  websiteUrl?: string;\n  imageUrl?: string;\n}\n\n// Scenic gallery item type\nexport interface ScenicGalleryItem {\n  id: string;\n  title: string;\n  description: string;\n  imageUrl: string;\n  linkUrl?: string;\n  isLarge: boolean; // For the 2x2 main card\n  order: number;\n}\n\n// Scenic Gallery Item Validation Schema\nexport const scenicGalleryItemSchema = z.object({\n  id: z.string().min(1, \"Gallery-ID ist erforderlich\"),\n  title: z.string().min(1, \"Titel ist erforderlich\").max(100, \"Titel ist zu lang (maximal 100 Zeichen)\"),\n  description: z.string().min(1, \"Beschreibung ist erforderlich\").max(500, \"Beschreibung ist zu lang (maximal 500 Zeichen)\"),\n  imageUrl: z.string().url(\"Ungültige Bild-URL\"),\n  linkUrl: z.string().url(\"Ungültige Link-URL\").optional().or(z.literal(\"\")).or(z.null()),\n  isLarge: z.boolean(),\n  order: z.number().int().min(0, \"Reihenfolge muss eine positive Zahl sein\").max(10, \"Reihenfolge zu hoch\"),\n});\n\n// Scenic Content Update Schema with strict validation\nexport const scenicContentUpdateSchema = z.object({\n  title: z.string().min(1, \"Titel ist erforderlich\").max(200, \"Titel ist zu lang (maximal 200 Zeichen)\"),\n  subtitle: z.string().min(1, \"Untertitel ist erforderlich\").max(300, \"Untertitel ist zu lang (maximal 300 Zeichen)\"),\n  galleries: z.array(scenicGalleryItemSchema)\n    .length(6, \"Genau 6 Galerie-Elemente sind erforderlich\")\n    .refine(\n      (galleries) => galleries.filter(g => g.isLarge).length === 1,\n      \"Genau ein großes Galerie-Element ist erforderlich\"\n    )\n    .refine(\n      (galleries) => {\n        const orders = galleries.map(g => g.order);\n        return new Set(orders).size === orders.length;\n      },\n      \"Alle Galerie-Elemente müssen eindeutige Reihenfolge-Nummern haben\"\n    ),\n  isActive: z.boolean().optional(),\n});\n\n// Restaurant data validation schema\nexport const restaurantDataSchema = z.object({\n  name: z.string().min(1, \"Restaurant-Name ist erforderlich\").max(100, \"Name ist zu lang\"),\n  description: z.string().min(1, \"Beschreibung ist erforderlich\").max(500, \"Beschreibung ist zu lang\"),\n  cuisine: z.string().max(50, \"Küchen-Typ ist zu lang\").optional(),\n  websiteUrl: z.string().url(\"Ungültige Website-URL\").optional().or(z.literal(\"\")).or(z.null()),\n  imageUrl: z.string().url(\"Ungültige Bild-URL\").optional().or(z.literal(\"\")).or(z.null()),\n});\n\n// Schema exports\nexport const insertLocationSchema = createInsertSchema(locations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertLocationImageSchema = createInsertSchema(locationImages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCreatorSchema = createInsertSchema(creators).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTripPhotoSchema = createInsertSchema(tripPhotos).omit({\n  id: true,\n  uploadedAt: true,\n  likesCount: true, // Let server handle likes count\n  deleteTokenHash: true, // Let server handle delete token\n});\n\nexport const insertTourSettingsSchema = createInsertSchema(tourSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertLocationPingSchema = createInsertSchema(locationPings).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertHeroImageSchema = createInsertSchema(heroImages).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertScenicContentSchema = createInsertSchema(scenicContent).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTripPhotoLikeSchema = createInsertSchema(tripPhotoLikes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Location = typeof locations.$inferSelect;\nexport type InsertLocation = z.infer<typeof insertLocationSchema>;\nexport type LocationImage = typeof locationImages.$inferSelect;\nexport type InsertLocationImage = z.infer<typeof insertLocationImageSchema>;\nexport type Creator = typeof creators.$inferSelect;\nexport type InsertCreator = z.infer<typeof insertCreatorSchema>;\nexport type TripPhoto = typeof tripPhotos.$inferSelect;\nexport type InsertTripPhoto = z.infer<typeof insertTripPhotoSchema>;\nexport type TripPhotoLike = typeof tripPhotoLikes.$inferSelect;\nexport type InsertTripPhotoLike = z.infer<typeof insertTripPhotoLikeSchema>;\nexport type TourSettings = typeof tourSettings.$inferSelect;\nexport type InsertTourSettings = z.infer<typeof insertTourSettingsSchema>;\nexport type LocationPing = typeof locationPings.$inferSelect;\nexport type InsertLocationPing = z.infer<typeof insertLocationPingSchema>;\nexport type HeroImage = typeof heroImages.$inferSelect;\nexport type InsertHeroImage = z.infer<typeof insertHeroImageSchema>;\nexport type ScenicContent = typeof scenicContent.$inferSelect;\nexport type InsertScenicContent = z.infer<typeof insertScenicContentSchema>;\n\n// Grouped trip photo type for the gallery feature\nexport interface GroupedTripPhoto {\n  id: string; // groupId for grouped photos, regular id for single photos\n  caption: string | null;\n  locationId: string | null;\n  creatorId: string | null;\n  uploadedAt: Date;\n  groupTakenAt: Date; // earliest takenAt in the group\n  media: {\n    id: string;\n    mediaType: string;\n    imageUrl: string;\n    videoUrl: string | null;\n    thumbnailUrl: string | null;\n    takenAt: Date | null;\n    likesCount: number;\n  }[];\n}\n","size_bytes":13314},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider } from \"@/hooks/useAuth\";\nimport { LanguageProvider } from \"@/contexts/LanguageContext\";\nimport PrivacyWrapper from \"@/components/PrivacyWrapper\";\nimport FloatingUploadButton from \"@/components/FloatingUploadButton\";\nimport DocumentTitle from \"@/components/DocumentTitle\";\nimport NotFound from \"@/pages/not-found\";\nimport Home from \"@/pages/Home\";\nimport LocationDetail from \"@/pages/LocationDetail\";\nimport AdminPanel from \"@/pages/AdminPanel\";\nimport LiveFeedPage from \"@/pages/LiveFeed\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/location/:slug\" component={LocationDetail} />\n      <Route path=\"/live-feed\" component={LiveFeedPage} />\n      <Route path=\"/admin\" component={AdminPanel} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <LanguageProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <Toaster />\n            <DocumentTitle />\n            <PrivacyWrapper>\n              <Router />\n              <FloatingUploadButton />\n            </PrivacyWrapper>\n          </TooltipProvider>\n        </AuthProvider>\n      </LanguageProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1559},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0 0% 100%);\n  --foreground: hsl(215 25% 27%);\n  --card: hsl(0 0% 100%);\n  --card-foreground: hsl(215 25% 27%);\n  --primary: hsl(173 80% 40%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(210 40% 96%);\n  --secondary-foreground: hsl(215 25% 27%);\n  --muted: hsl(210 40% 96%);\n  --muted-foreground: hsl(215 20% 55%);\n  --accent: hsl(173 80% 40%);\n  --accent-foreground: hsl(0 0% 100%);\n  --border: hsl(220 13% 91%);\n  --input: hsl(220 13% 91%);\n  --ring: hsl(173 80% 40%);\n  --destructive: hsl(0 84% 60%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --popover: hsl(0 0% 100%);\n  --popover-foreground: hsl(215 25% 27%);\n  --radius: 0.75rem;\n  --font-sans: 'Inter', sans-serif;\n}\n\n.dark {\n  --background: hsl(222 84% 4%);\n  --foreground: hsl(210 40% 98%);\n  --card: hsl(222 84% 4%);\n  --card-foreground: hsl(210 40% 98%);\n  --primary: hsl(173 80% 40%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(217 32% 17%);\n  --secondary-foreground: hsl(210 40% 98%);\n  --muted: hsl(217 32% 17%);\n  --muted-foreground: hsl(215 20% 65%);\n  --accent: hsl(173 80% 40%);\n  --accent-foreground: hsl(0 0% 100%);\n  --border: hsl(217 32% 17%);\n  --input: hsl(217 32% 17%);\n  --ring: hsl(173 80% 40%);\n  --destructive: hsl(0 84% 60%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --popover: hsl(222 84% 4%);\n  --popover-foreground: hsl(210 40% 98%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  \n  body {\n    @apply bg-background text-foreground font-sans antialiased;\n  }\n}\n\n@layer utilities {\n  .glass-effect {\n    backdrop-filter: blur(10px);\n    background: rgba(255, 255, 255, 0.95);\n  }\n  \n  .dark .glass-effect {\n    background: rgba(0, 0, 0, 0.95);\n  }\n}\n\n@keyframes fadeIn {\n  from { \n    opacity: 0; \n    transform: translateY(20px); \n  }\n  to { \n    opacity: 1; \n    transform: translateY(0); \n  }\n}\n\n@keyframes slideUp {\n  from { \n    transform: translateY(100%); \n  }\n  to { \n    transform: translateY(0); \n  }\n}\n\n@keyframes float {\n  0%, 100% { \n    transform: translateY(0px); \n  }\n  50% { \n    transform: translateY(-10px); \n  }\n}\n\n.animate-fade-in {\n  animation: fadeIn 0.6s ease-in-out;\n}\n\n.animate-slide-up {\n  animation: slideUp 0.4s ease-out;\n}\n\n.animate-float {\n  animation: float 3s ease-in-out infinite;\n}","size_bytes":2429},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/AdminLocationForm.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { X, Plus, Minus, Hotel, UtensilsCrossed, ExternalLink, Image, Check } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ImageInput } from \"@/components/ImageInput\";\nimport type { Location, RestaurantData } from \"@shared/schema\";\n\ninterface AdminLocationFormProps {\n  location?: Location | null;\n  onClose: () => void;\n}\n\n// Helper function to convert DD.MM.YYYY to YYYY-MM-DDTHH:MM for datetime-local input\nconst convertToDateTimeLocal = (germanDate: string): string => {\n  if (!germanDate) return \"\";\n  \n  // Handle DD.MM.YYYY format\n  const parts = germanDate.split('.');\n  if (parts.length === 3) {\n    const [day, month, year] = parts;\n    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}T12:00`;\n  }\n  \n  // If already in a different format, try to parse as Date\n  const date = new Date(germanDate);\n  if (!isNaN(date.getTime())) {\n    return date.toISOString().slice(0, 16);\n  }\n  \n  return \"\";\n};\n\n// Helper function to convert YYYY-MM-DDTHH:MM back to DD.MM.YYYY for storage\nconst convertToGermanDate = (dateTimeLocal: string): string => {\n  if (!dateTimeLocal) return \"\";\n  \n  const date = new Date(dateTimeLocal);\n  if (isNaN(date.getTime())) return \"\";\n  \n  const day = date.getDate().toString().padStart(2, '0');\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const year = date.getFullYear();\n  \n  return `${day}.${month}.${year}`;\n};\n\nexport default function AdminLocationForm({ location, onClose }: AdminLocationFormProps) {\n  const [formData, setFormData] = useState({\n    name: \"\",\n    slug: \"\",\n    startDate: \"\",\n    endDate: \"\",\n    description: \"\",\n    accommodation: \"\",\n    accommodationWebsite: \"\",\n    accommodationImageUrl: \"\",\n    accommodationInclusiveServices: [\"\"],\n    accommodationAmenities: [\"\"],\n    accommodationCheckinTime: \"\",\n    accommodationCheckoutTime: \"\",\n    distance: 0,\n    imageUrl: \"\",\n    mapImageUrl: \"\",\n    activities: [\"\"],\n    restaurants: [{ name: \"\", description: \"\", cuisine: \"\", websiteUrl: \"\", imageUrl: \"\" }] as RestaurantData[],\n    experiences: [\"\"],\n    highlights: [\"\"],\n    funFacts: [\"\"],\n  });\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  useEffect(() => {\n    if (location) {\n      setFormData({\n        name: location.name || \"\",\n        slug: location.slug || \"\",\n        startDate: convertToDateTimeLocal(location.startDate || \"\"),\n        endDate: convertToDateTimeLocal(location.endDate || \"\"),\n        description: location.description || \"\",\n        accommodation: location.accommodation || \"\",\n        accommodationWebsite: (location as any).accommodationWebsite || \"\",\n        accommodationImageUrl: (location as any).accommodationImageUrl || \"\",\n        accommodationInclusiveServices: (location as any).accommodationInclusiveServices?.length ? (location as any).accommodationInclusiveServices : [\"\"],\n        accommodationAmenities: (location as any).accommodationAmenities?.length ? (location as any).accommodationAmenities : [\"\"],\n        accommodationCheckinTime: (location as any).accommodationCheckinTime || \"\",\n        accommodationCheckoutTime: (location as any).accommodationCheckoutTime || \"\",\n        distance: location.distance || 0,\n        imageUrl: location.imageUrl || \"\",\n        mapImageUrl: (location as any).mapImageUrl || \"\",\n        activities: location.activities?.length ? location.activities : [\"\"],\n        restaurants: location.restaurants?.length ? location.restaurants.map(r => ({\n          name: r.name || \"\",\n          description: r.description || \"\",\n          cuisine: r.cuisine || \"\",\n          websiteUrl: r.websiteUrl || \"\",\n          imageUrl: r.imageUrl || \"\"\n        })) : [{ name: \"\", description: \"\", cuisine: \"\", websiteUrl: \"\", imageUrl: \"\" }],\n        experiences: location.experiences?.length ? location.experiences : [\"\"],\n        highlights: location.highlights?.length ? location.highlights : [\"\"],\n        funFacts: (location as any).funFacts?.length ? (location as any).funFacts : [\"\"],\n      });\n    }\n  }, [location]);\n\n  const saveLocationMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const payload = {\n        ...data,\n        startDate: convertToGermanDate(data.startDate),\n        endDate: convertToGermanDate(data.endDate),\n        activities: data.activities.filter(a => a.trim()),\n        restaurants: data.restaurants.filter(r => r.name.trim()),\n        experiences: data.experiences.filter(e => e.trim()),\n        highlights: data.highlights.filter(h => h.trim()),\n        funFacts: data.funFacts.filter(f => f.trim()),\n        accommodationInclusiveServices: data.accommodationInclusiveServices.filter(s => s.trim()),\n        accommodationAmenities: data.accommodationAmenities.filter(a => a.trim()),\n        coordinates: location?.coordinates || { lat: 0, lng: 0 },\n      };\n\n      if (location) {\n        await apiRequest(\"PUT\", `/api/locations/${location.id}`, payload);\n      } else {\n        await apiRequest(\"POST\", \"/api/locations\", payload);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\"] });\n      toast({\n        title: \"Erfolg\",\n        description: location ? \"Ort wurde aktualisiert\" : \"Ort wurde erstellt\",\n      });\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Speichern: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    saveLocationMutation.mutate(formData);\n  };\n\n  const addArrayItem = (field: keyof typeof formData, defaultValue: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: [...(prev[field] as any[]), defaultValue]\n    }));\n  };\n\n  const removeArrayItem = (field: keyof typeof formData, index: number) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: (prev[field] as any[]).filter((_, i) => i !== index)\n    }));\n  };\n\n  const updateArrayItem = (field: keyof typeof formData, index: number, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: (prev[field] as any[]).map((item, i) => i === index ? value : item)\n    }));\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4\" data-testid=\"location-form-modal\">\n      <Card className=\"w-full max-w-4xl max-h-[90vh] flex flex-col\">\n        <CardHeader className=\"flex flex-row items-center justify-between flex-shrink-0\">\n          <CardTitle data-testid=\"form-title\">\n            {location ? `${location.name} bearbeiten` : \"Neuen Ort hinzufügen\"}\n          </CardTitle>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose} data-testid=\"form-close-button\">\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </CardHeader>\n        <CardContent className=\"flex-1 overflow-auto\">\n          <form onSubmit={handleSubmit} className=\"space-y-6 pb-20\">\n            {/* Basic Information */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"name\">Name</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                  required\n                  data-testid=\"input-name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"slug\">URL-Slug</Label>\n                <Input\n                  id=\"slug\"\n                  value={formData.slug}\n                  onChange={(e) => setFormData(prev => ({ ...prev, slug: e.target.value }))}\n                  required\n                  data-testid=\"input-slug\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"start-date\">Start-Datum</Label>\n                <Input\n                  id=\"start-date\"\n                  type=\"datetime-local\"\n                  value={formData.startDate}\n                  onChange={(e) => setFormData(prev => ({ ...prev, startDate: e.target.value }))}\n                  required\n                  data-testid=\"input-start-date\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"end-date\">End-Datum</Label>\n                <Input\n                  id=\"end-date\"\n                  type=\"datetime-local\"\n                  value={formData.endDate}\n                  onChange={(e) => setFormData(prev => ({ ...prev, endDate: e.target.value }))}\n                  required\n                  data-testid=\"input-end-date\"\n                />\n              </div>\n            </div>\n\n            {/* Description */}\n            <div>\n              <Label htmlFor=\"description\">Beschreibung</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n                rows={3}\n                required\n                data-testid=\"textarea-description\"\n              />\n            </div>\n\n            {/* Distance */}\n            <div>\n              <Label htmlFor=\"distance\">Entfernung (km)</Label>\n              <Input\n                id=\"distance\"\n                type=\"number\"\n                value={formData.distance}\n                onChange={(e) => setFormData(prev => ({ ...prev, distance: parseInt(e.target.value) || 0 }))}\n                data-testid=\"input-distance\"\n              />\n            </div>\n\n            {/* Main Location Image */}\n            <ImageInput\n              label=\"Hauptbild des Orts\"\n              value={formData.imageUrl}\n              onChange={(value) => setFormData(prev => ({ ...prev, imageUrl: value }))}\n              placeholder=\"https://example.com/location-image.jpg\"\n              testId=\"location-main-image\"\n            />\n\n            {/* Map Image */}\n            <ImageInput\n              label=\"Karten-Snippet (Screenshot)\"\n              value={formData.mapImageUrl}\n              onChange={(value) => setFormData(prev => ({ ...prev, mapImageUrl: value }))}\n              placeholder=\"https://example.com/map-screenshot.jpg\"\n              testId=\"location-map-image\"\n              usePublicUpload={true}\n            />\n\n            {/* Activities */}\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <Label>Aktivitäten</Label>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => addArrayItem('activities', '')}\n                  data-testid=\"add-activity\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              </div>\n              {formData.activities.map((activity, index) => (\n                <div key={index} className=\"flex gap-2 mb-2\">\n                  <Input\n                    value={activity}\n                    onChange={(e) => updateArrayItem('activities', index, e.target.value)}\n                    placeholder=\"Aktivität beschreiben...\"\n                    data-testid={`activity-${index}`}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => removeArrayItem('activities', index)}\n                    data-testid={`remove-activity-${index}`}\n                  >\n                    <Minus className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n\n            {/* ACCOMMODATION & RESTAURANTS MANAGEMENT - PROMINENT SECTION */}\n            <Card data-testid=\"accommodation-restaurants-section\">\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-base font-medium\">Unterkunft & Restaurants verwalten</CardTitle>\n                <p className=\"text-xs text-muted-foreground\">\n                  Hier können Sie die Unterkunft und Restaurants für {formData.name || 'diese Location'} hinzufügen und bearbeiten.\n                </p>\n              </CardHeader>\n              <CardContent className=\"space-y-8\">\n                {/* ACCOMMODATION SECTION */}\n                <div className=\"border rounded p-3\" data-testid=\"accommodation-management\">\n                  <h4 className=\"text-sm font-medium mb-3\">Unterkunft</h4>\n                  \n                  <div className=\"space-y-3\">\n                    <div>\n                      <Label htmlFor=\"accommodation\" className=\"text-sm\">Unterkunft Name</Label>\n                      <Input\n                        id=\"accommodation\"\n                        value={formData.accommodation}\n                        onChange={(e) => setFormData(prev => ({ ...prev, accommodation: e.target.value }))}\n                        placeholder=\"z.B. Hotel Bellevue, Gasthof Zur Post...\"\n                        data-testid=\"input-accommodation\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"accommodation-website\" className=\"text-sm\">\n                        Unterkunft Website\n                      </Label>\n                      <Input\n                        id=\"accommodation-website\"\n                        type=\"url\"\n                        value={formData.accommodationWebsite}\n                        onChange={(e) => setFormData(prev => ({ ...prev, accommodationWebsite: e.target.value }))}\n                        placeholder=\"https://hotel-website.com\"\n                        data-testid=\"input-accommodation-website\"\n                      />\n                      {formData.accommodationWebsite && (\n                        <div className=\"flex items-center gap-2 mt-1 text-sm text-green-600 dark:text-green-400\">\n                          <Check className=\"w-4 h-4\" />\n                          Website-Link hinzugefügt\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-sm\">\n                        Unterkunft Bild\n                      </Label>\n                      <ImageInput\n                        label=\"\"\n                        value={formData.accommodationImageUrl}\n                        onChange={(value) => setFormData(prev => ({ ...prev, accommodationImageUrl: value }))}\n                        placeholder=\"https://example.com/hotel-image.jpg\"\n                        testId=\"accommodation-image\"\n                      />\n                      {formData.accommodationImageUrl && (\n                        <div className=\"mt-3 border border-border rounded-lg overflow-hidden\">\n                          <img \n                            src={formData.accommodationImageUrl} \n                            alt=\"Unterkunft Vorschau\" \n                            className=\"w-full h-32 object-cover\"\n                            onError={(e) => {\n                              (e.target as HTMLImageElement).style.display = 'none';\n                            }}\n                          />\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Check-in/Check-out Times */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"checkin-time\" className=\"text-sm\">Check-in Zeit</Label>\n                        <Input\n                          id=\"checkin-time\"\n                          value={formData.accommodationCheckinTime}\n                          onChange={(e) => setFormData(prev => ({ ...prev, accommodationCheckinTime: e.target.value }))}\n                          placeholder=\"z.B. 15:00 Uhr\"\n                          data-testid=\"input-checkin-time\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"checkout-time\" className=\"text-sm\">Check-out Zeit</Label>\n                        <Input\n                          id=\"checkout-time\"\n                          value={formData.accommodationCheckoutTime}\n                          onChange={(e) => setFormData(prev => ({ ...prev, accommodationCheckoutTime: e.target.value }))}\n                          placeholder=\"z.B. 11:00 Uhr\"\n                          data-testid=\"input-checkout-time\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Inclusive Services */}\n                    <div>\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <Label className=\"text-sm\">Inklusive Leistungen</Label>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => addArrayItem('accommodationInclusiveServices', '')}\n                          data-testid=\"add-inclusive-service\"\n                        >\n                          <Plus className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                      {formData.accommodationInclusiveServices.map((service, index) => (\n                        <div key={index} className=\"flex gap-2 mb-2\">\n                          <Input\n                            value={service}\n                            onChange={(e) => updateArrayItem('accommodationInclusiveServices', index, e.target.value)}\n                            placeholder=\"z.B. Inkl. Frühstück, 2 Nächte Aufenthalt...\"\n                            data-testid={`inclusive-service-${index}`}\n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => removeArrayItem('accommodationInclusiveServices', index)}\n                            data-testid={`remove-inclusive-service-${index}`}\n                          >\n                            <Minus className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                    \n                    {/* Amenities */}\n                    <div>\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <Label className=\"text-sm\">Ausstattung & Annehmlichkeiten</Label>\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => addArrayItem('accommodationAmenities', '')}\n                          data-testid=\"add-amenity\"\n                        >\n                          <Plus className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                      {formData.accommodationAmenities.map((amenity, index) => (\n                        <div key={index} className=\"flex gap-2 mb-2\">\n                          <Input\n                            value={amenity}\n                            onChange={(e) => updateArrayItem('accommodationAmenities', index, e.target.value)}\n                            placeholder=\"z.B. Klimaanlage, Privates Bad, TV & Minibar...\"\n                            data-testid={`amenity-${index}`}\n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => removeArrayItem('accommodationAmenities', index)}\n                            data-testid={`remove-amenity-${index}`}\n                          >\n                            <Minus className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n\n                {/* RESTAURANTS SECTION */}\n                <div className=\"border rounded p-3\" data-testid=\"restaurants-management\">\n                  <div className=\"flex justify-between items-center mb-3\">\n                    <h4 className=\"text-sm font-medium\">Restaurants</h4>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => addArrayItem('restaurants', { name: '', description: '', cuisine: '', websiteUrl: '', imageUrl: '' })}\n                      data-testid=\"add-restaurant\"\n                    >\n                      <Plus className=\"w-3 h-3 mr-1\" />\n                      Restaurant hinzufügen\n                    </Button>\n                  </div>\n                  \n                  {formData.restaurants.length === 0 || (formData.restaurants.length === 1 && !formData.restaurants[0].name) ? (\n                    <div className=\"text-center py-4 text-muted-foreground\">\n                      <p className=\"text-sm\">Noch keine Restaurants hinzugefügt</p>\n                      <p className=\"text-xs\">Klicken Sie auf \"Restaurant hinzufügen\" um zu starten</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {formData.restaurants.map((restaurant, index) => (\n                        <Card key={index} className=\"border\">\n                          <CardHeader className=\"py-2\">\n                            <div className=\"flex justify-between items-center\">\n                              <CardTitle className=\"text-sm font-medium\">\n                                Restaurant #{index + 1}\n                              </CardTitle>\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => removeArrayItem('restaurants', index)}\n                                className=\"hover:text-destructive\"\n                                data-testid={`remove-restaurant-${index}`}\n                              >\n                                <X className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          </CardHeader>\n                          <CardContent className=\"space-y-4\">\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                              <div>\n                                <Label className=\"text-sm\">Restaurant Name*</Label>\n                                <Input\n                                  value={restaurant.name}\n                                  onChange={(e) => updateArrayItem('restaurants', index, { ...restaurant, name: e.target.value })}\n                                  placeholder=\"z.B. Ristorante Mario, Café Central...\"\n                                  data-testid={`restaurant-name-${index}`}\n                                />\n                              </div>\n                              <div>\n                                <Label className=\"text-sm\">Küchenstil</Label>\n                                <Input\n                                  value={restaurant.cuisine || ''}\n                                  onChange={(e) => updateArrayItem('restaurants', index, { ...restaurant, cuisine: e.target.value })}\n                                  placeholder=\"z.B. Italienisch, Lokal, International...\"\n                                  data-testid={`restaurant-cuisine-${index}`}\n                                />\n                              </div>\n                            </div>\n                            \n                            <div>\n                              <Label className=\"text-sm\">Beschreibung</Label>\n                              <Textarea\n                                value={restaurant.description}\n                                onChange={(e) => updateArrayItem('restaurants', index, { ...restaurant, description: e.target.value })}\n                                placeholder=\"Kurze Beschreibung des Restaurants...\"\n                                rows={2}\n                                data-testid={`restaurant-description-${index}`}\n                              />\n                            </div>\n                            \n                            <div>\n                              <Label className=\"text-sm\">\n                                Website URL\n                              </Label>\n                              <Input\n                                value={(restaurant as any).websiteUrl || ''}\n                                onChange={(e) => updateArrayItem('restaurants', index, { ...restaurant, websiteUrl: e.target.value })}\n                                placeholder=\"https://restaurant-website.com\"\n                                data-testid={`restaurant-website-${index}`}\n                              />\n                              {(restaurant as any).websiteUrl && (\n                                <div className=\"flex items-center gap-2 mt-1 text-sm text-green-600 dark:text-green-400\">\n                                  <Check className=\"w-4 h-4\" />\n                                  Website-Link hinzugefügt\n                                </div>\n                              )}\n                            </div>\n                            \n                            <div>\n                              <Label className=\"text-sm\">\n                                Restaurant Bild\n                              </Label>\n                              <ImageInput\n                                label=\"\"\n                                value={(restaurant as any).imageUrl || ''}\n                                onChange={(value) => updateArrayItem('restaurants', index, { ...restaurant, imageUrl: value })}\n                                placeholder=\"https://example.com/restaurant-image.jpg\"\n                                testId={`restaurant-image-${index}`}\n                              />\n                              {(restaurant as any).imageUrl && (\n                                <div className=\"mt-3 border border-border rounded-lg overflow-hidden\">\n                                  <img \n                                    src={(restaurant as any).imageUrl} \n                                    alt={`${restaurant.name} Vorschau`} \n                                    className=\"w-full h-32 object-cover\"\n                                    onError={(e) => {\n                                      (e.target as HTMLImageElement).style.display = 'none';\n                                    }}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Experiences */}\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <Label>Erlebnisse</Label>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => addArrayItem('experiences', '')}\n                  data-testid=\"add-experience\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              </div>\n              {formData.experiences.map((experience, index) => (\n                <div key={index} className=\"flex gap-2 mb-2\">\n                  <Input\n                    value={experience}\n                    onChange={(e) => updateArrayItem('experiences', index, e.target.value)}\n                    placeholder=\"Erlebnis beschreiben...\"\n                    data-testid={`experience-${index}`}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => removeArrayItem('experiences', index)}\n                    data-testid={`remove-experience-${index}`}\n                  >\n                    <Minus className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n\n            {/* Highlights */}\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <Label>Highlights</Label>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => addArrayItem('highlights', '')}\n                  data-testid=\"add-highlight\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              </div>\n              {formData.highlights.map((highlight, index) => (\n                <div key={index} className=\"flex gap-2 mb-2\">\n                  <Input\n                    value={highlight}\n                    onChange={(e) => updateArrayItem('highlights', index, e.target.value)}\n                    placeholder=\"Highlight...\"\n                    data-testid={`highlight-${index}`}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => removeArrayItem('highlights', index)}\n                    data-testid={`remove-highlight-${index}`}\n                  >\n                    <Minus className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n\n            {/* Fun Facts */}\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <Label>Wissenswertes & Fun Facts</Label>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => addArrayItem('funFacts', '')}\n                  data-testid=\"add-fun-fact\"\n                >\n                  <Plus className=\"w-3 h-3\" />\n                </Button>\n              </div>\n              {formData.funFacts.map((funFact, index) => (\n                <div key={index} className=\"flex gap-2 mb-2\">\n                  <Input\n                    value={funFact}\n                    onChange={(e) => updateArrayItem('funFacts', index, e.target.value)}\n                    placeholder=\"Interessante Tatsache oder Fun Fact...\"\n                    data-testid={`fun-fact-${index}`}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => removeArrayItem('funFacts', index)}\n                    data-testid={`remove-fun-fact-${index}`}\n                  >\n                    <Minus className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n\n          </form>\n        </CardContent>\n        \n        {/* Sticky Form Actions */}\n        <div className=\"flex-shrink-0 border-t border-border bg-background p-4\">\n          <div className=\"flex justify-end space-x-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose} data-testid=\"form-cancel\">\n              Abbrechen\n            </Button>\n            <Button \n              onClick={handleSubmit}\n              disabled={saveLocationMutation.isPending}\n              data-testid=\"form-submit\"\n            >\n              {saveLocationMutation.isPending ? \"Speichere...\" : location ? \"Aktualisieren\" : \"Erstellen\"}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":32464},"client/src/components/Hero.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ChevronDown, ArrowLeft, ArrowRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport type { TourSettings, HeroImage } from \"@shared/schema\";\n\ninterface HeroProps {\n  tourSettings?: TourSettings;\n}\n\n\nexport default function Hero({ tourSettings }: HeroProps) {\n  const [currentImage, setCurrentImage] = useState(0);\n\n  // Fetch hero images from database\n  const { data: dbHeroImages, isLoading: heroImagesLoading, error } = useQuery<HeroImage[]>({\n    queryKey: [\"/api/hero-images\"],\n  });\n\n  // Use ONLY database images - no fallbacks\n  const heroImages = dbHeroImages || [];\n  \n\n  useEffect(() => {\n    // Only run interval if there are hero images\n    if (heroImages.length > 0) {\n      const interval = setInterval(() => {\n        setCurrentImage((prev) => (prev + 1) % heroImages.length);\n      }, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [heroImages.length]);\n\n  const scrollToTimeline = () => {\n    const element = document.getElementById('timeline');\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  const nextImage = () => {\n    setCurrentImage((prev) => (prev + 1) % heroImages.length);\n  };\n\n  const prevImage = () => {\n    setCurrentImage((prev) => (prev - 1 + heroImages.length) % heroImages.length);\n  };\n\n  // Show loading state if hero images are loading\n  if (heroImagesLoading) {\n    return (\n      <section className=\"h-auto md:min-h-[75vh] relative overflow-hidden pt-8 md:pt-12 flex items-center justify-center\" data-testid=\"hero-loading\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary\"></div>\n      </section>\n    );\n  }\n\n  // Empty state - no hero images configured\n  if (heroImages.length === 0) {\n    return (\n      <section className=\"relative min-h-[80vh] flex items-center justify-center overflow-hidden pt-16 pb-8\" data-testid=\"hero-section\">\n        {/* Enhanced gradient background for empty state */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/40 via-primary/60 to-primary/80\"></div>\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent\"></div>\n        \n        {/* Content */}\n        <div className=\"relative z-10 text-center px-4 max-w-6xl mx-auto\">\n          <div className=\"animate-fade-in space-y-8\">\n            <div>\n              <h1 className=\"text-4xl sm:text-6xl md:text-7xl lg:text-8xl font-bold text-white mb-4\" data-testid=\"hero-title\">\n                <span className=\"block leading-tight\">\n                  {tourSettings?.tourName?.split(' ').slice(0, -1).join(' ') || 'Weinberg'}\n                </span>\n                <span className=\"block text-3xl sm:text-5xl md:text-6xl lg:text-7xl font-light text-white/90 leading-tight\">\n                  {tourSettings?.tourName?.split(' ').slice(-1)[0] || 'Tour 2025'}\n                </span>\n              </h1>\n            </div>\n            \n            <p className=\"text-lg sm:text-xl md:text-2xl text-white/95 mb-8 max-w-4xl mx-auto font-light leading-relaxed\" data-testid=\"hero-description\">\n              {tourSettings?.description || 'Reiseführer für das kanadische Weinland-Abenteuer durch British Columbia'}\n            </p>\n            \n            <div className=\"flex flex-col gap-6 items-center\">\n              <Button\n                onClick={scrollToTimeline}\n                size=\"lg\"\n                className=\"bg-white text-primary hover:bg-white/95 px-10 py-4 text-lg font-semibold shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-105\"\n                data-testid=\"hero-cta-button\"\n              >\n                Reiseplan ansehen\n              </Button>\n              \n              <div className=\"bg-white/25 backdrop-blur-md rounded-2xl px-8 py-4 shadow-xl border border-white/20\" data-testid=\"hero-dates\">\n                <div className=\"text-white text-lg sm:text-xl md:text-2xl font-bold\">\n                  {tourSettings?.startDate || '20. September'} - {tourSettings?.endDate || '6. Oktober 2025'}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n          \n        {/* Animated scroll indicator */}\n        <div className=\"absolute bottom-6 left-1/2 transform -translate-x-1/2 animate-float z-20\" data-testid=\"scroll-indicator\">\n          <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3 border border-white/30\">\n            <ChevronDown className=\"w-6 h-6 text-white\" />\n          </div>\n        </div>\n      </section>\n    );\n  }\n\n  // Normal state - hero images exist\n  return (\n    <section className=\"h-auto md:min-h-[75vh] relative overflow-hidden pt-8 md:pt-12\" data-testid=\"hero-section\">\n      {/* Background Image Slideshow */}\n      <div className=\"absolute inset-0\">\n        {heroImages.map((image, index) => (\n          <div\n            key={index}\n            className={`absolute inset-0 transition-opacity duration-1000 ${\n              index === currentImage ? 'opacity-100' : 'opacity-0'\n            }`}\n          >\n            <div \n              style={{\n                backgroundImage: `url('${image.imageUrl}')`,\n                backgroundSize: 'cover',\n                backgroundPosition: 'center'\n              }}\n              className=\"w-full h-full\"\n            ></div>\n            <div className=\"absolute inset-0 bg-black/40\"></div>\n          </div>\n        ))}\n      </div>\n\n      {/* Navigation Controls - Only show if more than 1 image */}\n      {heroImages.length > 1 && (\n        <>\n          <button\n            onClick={prevImage}\n            className=\"hidden sm:flex absolute left-4 top-1/2 transform -translate-y-1/2 z-20 bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-all items-center justify-center\"\n            data-testid=\"hero-prev-button\"\n          >\n            <ArrowLeft className=\"w-6 h-6\" />\n          </button>\n          <button\n            onClick={nextImage}\n            className=\"hidden sm:flex absolute right-4 top-1/2 transform -translate-y-1/2 z-20 bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-all items-center justify-center\"\n            data-testid=\"hero-next-button\"\n          >\n            <ArrowRight className=\"w-6 h-6\" />\n          </button>\n        </>\n      )}\n\n      {/* Content */}\n      <div className=\"relative z-10 text-center px-4 max-w-5xl mx-auto flex items-center justify-center min-h-0 md:min-h-[75vh] py-8 md:py-0 pb-24 md:pb-0\">\n        <div className=\"animate-fade-in\">\n          <div className=\"mb-4\">\n            <span className=\"inline-block bg-primary/20 text-white px-4 py-2 rounded-full text-sm font-medium backdrop-blur-sm border border-white/20\">\n              {heroImages[currentImage].title}\n            </span>\n          </div>\n          <h1 className=\"text-3xl sm:text-5xl md:text-7xl lg:text-8xl font-bold text-white mb-4 md:mb-6\" data-testid=\"hero-title\">\n            <span className=\"block\">\n              {tourSettings?.tourName?.split(' ').slice(0, -1).join(' ') || 'Weinberg'}\n            </span>\n            <span className=\"block text-2xl sm:text-4xl md:text-6xl lg:text-7xl font-light text-primary\">\n              {tourSettings?.tourName?.split(' ').slice(-1)[0] || 'Tour 2025'}\n            </span>\n          </h1>\n          <p className=\"text-base sm:text-lg md:text-2xl text-white/90 mb-3 md:mb-4 max-w-3xl mx-auto font-light\" data-testid=\"hero-description\">\n            {tourSettings?.description || 'Reiseführer für das kanadische Weinland-Abenteuer durch British Columbia'}\n          </p>\n          <p className=\"text-sm sm:text-base md:text-lg text-white/70 mb-6 md:mb-8\" data-testid=\"hero-location-description\">\n            {heroImages[currentImage].description}\n          </p>\n          <div className=\"flex flex-col gap-6 justify-center items-center\">\n            <Button\n              onClick={scrollToTimeline}\n              className=\"bg-primary text-white px-8 py-3 text-base sm:text-lg font-semibold hover:bg-primary/90 transition-all shadow-xl backdrop-blur-sm border border-white/10\"\n              data-testid=\"hero-cta-button\"\n            >\n              Reiseplan ansehen\n            </Button>\n            <div className=\"text-white text-base sm:text-lg md:text-xl font-bold bg-primary/20 px-6 py-3 md:px-8 md:py-4 rounded-lg backdrop-blur-sm border border-white/20 shadow-lg\" data-testid=\"hero-dates\">\n              {tourSettings?.startDate || '20. September'} - {tourSettings?.endDate || '6. Oktober 2025'}\n            </div>\n          </div>\n        </div>\n      </div>\n\n        \n      {/* Animated scroll indicator - Hidden on mobile */}\n      <div className=\"hidden sm:block absolute bottom-2 sm:bottom-4 left-1/2 transform -translate-x-1/2 animate-float z-20\" data-testid=\"scroll-indicator\">\n        <ChevronDown className=\"w-8 h-8 text-white/80\" />\n      </div>\n    </section>\n  );\n}\n","size_bytes":8975},"client/src/components/ImageGallery.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Trash2, Star, Plus, Upload, Link, Camera, X, CheckCircle, Loader2 } from \"lucide-react\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { Lightbox } from \"@/components/Lightbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport type { LocationImage } from \"@shared/schema\";\n\ninterface ImageGalleryProps {\n  locationId: string;\n  isAdmin?: boolean;\n  className?: string;\n}\n\ninterface AddImageFormData {\n  imageUrl: string;\n  caption: string;\n}\n\nexport function ImageGallery({ locationId, isAdmin = false, className = \"\" }: ImageGalleryProps) {\n  const [isAddingImage, setIsAddingImage] = useState(false);\n  const [uploadMode, setUploadMode] = useState<'upload' | 'url'>('upload');\n  const [newImageData, setNewImageData] = useState<AddImageFormData>({\n    imageUrl: \"\",\n    caption: \"\"\n  });\n  // Lightbox state\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n  const { toast } = useToast();\n  const { t } = useLanguage();\n\n  // Fetch images for the location\n  const { data: images = [], isLoading } = useQuery<LocationImage[]>({\n    queryKey: [\"/api/locations\", locationId, \"images\"],\n  });\n\n  // Add image via URL mutation\n  const addImageMutation = useMutation({\n    mutationFn: async (data: AddImageFormData) => {\n      const response = await apiRequest(\"POST\", `/api/locations/${locationId}/images`, {\n        imageUrl: data.imageUrl,\n        caption: data.caption,\n        isMain: images.length === 0 // Set as main if first image\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\", locationId, \"images\"] });\n      setNewImageData({ imageUrl: \"\", caption: \"\" });\n      setIsAddingImage(false);\n      toast({\n        title: \"Bild hinzugefügt\",\n        description: \"Das Bild wurde erfolgreich zur Galerie hinzugefügt.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Bild konnte nicht hinzugefügt werden: ${error.message}`,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Delete image mutation\n  const deleteImageMutation = useMutation({\n    mutationFn: async (imageId: string) => {\n      await apiRequest(\"DELETE\", `/api/locations/${locationId}/images/${imageId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\", locationId, \"images\"] });\n      toast({\n        title: \"Bild gelöscht\",\n        description: \"Das Bild wurde erfolgreich aus der Galerie entfernt.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Bild konnte nicht gelöscht werden: ${error.message}`,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Set main image mutation\n  const setMainImageMutation = useMutation({\n    mutationFn: async (imageId: string) => {\n      await apiRequest(\"PUT\", `/api/locations/${locationId}/images/${imageId}/main`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\", locationId, \"images\"] });\n      toast({\n        title: t('mainImageSet'),\n        description: t('mainImageSetDescription'),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Fehler\", \n        description: `${t('mainImageSetError')}: ${error.message}`,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Handle file upload completion\n  const handleImageUploadComplete = (result: any) => {\n    if (result.successful && result.successful.length > 0) {\n      const uploadedFile = result.successful[0];\n      \n      // Add the uploaded image to the location\n      const imageData = {\n        imageUrl: uploadedFile.uploadURL,\n        caption: uploadedFile.name || \"\",\n      };\n      \n      addImageMutation.mutate(imageData);\n    }\n  };\n\n  // Handle upload parameters\n  const handleGetUploadParameters = async () => {\n    try {\n      const response = await apiRequest(\"POST\", \"/api/objects/upload\");\n      const data = await response.json();\n      return {\n        method: \"PUT\" as const,\n        url: data.uploadURL,\n        fields: {},\n        headers: {\n          \"Content-Type\": \"application/octet-stream\",\n        },\n      };\n    } catch (error) {\n      toast({\n        title: \"Fehler\",\n        description: \"Upload-Parameter konnten nicht abgerufen werden.\",\n        variant: \"destructive\",\n      });\n      throw error;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className={`${className}`}>\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"aspect-square bg-muted rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const mainImage = images.find(img => img.isMain);\n  const otherImages = images.filter(img => !img.isMain);\n\n  // Prepare images for lightbox (main image first, then others)\n  const lightboxImages = mainImage \n    ? [mainImage, ...otherImages]\n    : otherImages;\n\n  // Lightbox handlers\n  const openLightbox = (imageId: string) => {\n    const index = lightboxImages.findIndex(img => img.id === imageId);\n    if (index !== -1) {\n      setLightboxIndex(index);\n      setLightboxOpen(true);\n    }\n  };\n\n  const closeLightbox = () => {\n    setLightboxOpen(false);\n  };\n\n  const goToNextImage = () => {\n    if (lightboxIndex < lightboxImages.length - 1) {\n      setLightboxIndex(lightboxIndex + 1);\n    }\n  };\n\n  const goToPreviousImage = () => {\n    if (lightboxIndex > 0) {\n      setLightboxIndex(lightboxIndex - 1);\n    }\n  };\n\n  return (\n    <Card className={className} data-testid=\"image-gallery\">\n      <CardHeader>\n        <CardTitle>{t('galleryImages')} ({images.length})</CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Empty State with Modern Upload Area */}\n        {images.length === 0 ? (\n          <div className=\"text-center py-12 px-6\">\n            <div className=\"mx-auto w-24 h-24 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-6\">\n              <Camera className=\"w-12 h-12 text-primary\" />\n            </div>\n            <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n              {t('noImagesYet')}\n            </h3>\n            <p className=\"text-muted-foreground mb-8 max-w-sm mx-auto\">\n              {isAdmin \n                ? t('noImagesAdmin')\n                : t('imagesComingSoon')}\n            </p>\n            \n            {/* Modern Integrated Upload Area */}\n            {isAdmin && (\n              <div className=\"max-w-md mx-auto\">\n                <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-xl bg-muted/5 hover:bg-muted/10 transition-all duration-200 p-8\">\n                  <div className=\"flex flex-col items-center text-center space-y-4\">\n                    <div className=\"p-4 rounded-full bg-primary/10\">\n                      <Upload className=\"w-8 h-8 text-primary\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-lg mb-2\">{t('addImage')}</h4>\n                      <p className=\"text-muted-foreground text-sm mb-4\">\n                        {t('dragFilesOrSelect')}\n                      </p>\n                    </div>\n                    \n                    <div className=\"flex gap-3\">\n                      <ObjectUploader\n                        maxNumberOfFiles={5}\n                        maxFileSize={10485760}\n                        onGetUploadParameters={handleGetUploadParameters}\n                        onComplete={handleImageUploadComplete}\n                        buttonClassName=\"min-w-[120px]\"\n                      >\n                        <Upload className=\"w-4 h-4 mr-2\" />\n                        {t('selectFiles')}\n                      </ObjectUploader>\n                      <Button \n                        variant=\"outline\" \n                        size=\"default\" \n                        className=\"min-w-[120px]\" \n                        onClick={() => setIsAddingImage(true)}\n                        data-testid=\"button-add-url\"\n                      >\n                        <Link className=\"w-4 h-4 mr-2\" />\n                        {t('addUrlImage')}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        ) : (\n          <>\n            {/* Main Image */}\n            {mainImage && (\n              <div className=\"mb-8\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h4 className=\"font-semibold text-lg\">{t('mainImage')}</h4>\n                  {isAdmin && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setIsAddingImage(true)}\n                      data-testid=\"button-add-more-images\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      {t('addMoreImages')}\n                    </Button>\n                  )}\n                </div>\n                <div className=\"relative group\">\n                  <div \n                    className=\"aspect-video rounded-xl overflow-hidden bg-muted cursor-pointer\"\n                    onClick={() => openLightbox(mainImage.id)}\n                    data-testid=\"main-image-container\"\n                  >\n                    <img\n                      src={mainImage.imageUrl}\n                      alt={mainImage.caption || t('mainImage')}\n                      className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n                      loading=\"lazy\"\n                      decoding=\"async\"\n                      data-testid=\"main-image\"\n                    />\n                  </div>\n                  <div className=\"absolute top-4 left-4\">\n                    <Badge className=\"bg-yellow-500 text-yellow-900 shadow-lg\">\n                      <Star className=\"w-3 h-3 mr-1\" />\n                      {t('mainImage')}\n                    </Badge>\n                  </div>\n                  {isAdmin && (\n                    <div className=\"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        onClick={() => deleteImageMutation.mutate(mainImage.id)}\n                        data-testid={`button-delete-${mainImage.id}`}\n                        className=\"shadow-lg\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  )}\n                  {mainImage.caption && (\n                    <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 rounded-b-xl\">\n                      <p className=\"text-white font-medium\">{mainImage.caption}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Image Grid */}\n            <div>\n              <h4 className=\"font-semibold text-lg mb-4\">\n                {otherImages.length > 0 ? `${t('moreImages')} (${otherImages.length})` : t('images')}\n              </h4>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                {otherImages.map((image) => (\n                  <div key={image.id} className=\"relative group\">\n                    <div \n                      className=\"aspect-square rounded-lg overflow-hidden bg-muted cursor-pointer\"\n                      onClick={() => openLightbox(image.id)}\n                      data-testid={`gallery-image-container-${image.id}`}\n                    >\n                      <img\n                        src={image.imageUrl}\n                        alt={image.caption || \"Galerie Bild\"}\n                        className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200\"\n                        loading=\"lazy\"\n                        decoding=\"async\"\n                        data-testid={`gallery-image-${image.id}`}\n                      />\n                    </div>\n                    {isAdmin && (\n                      <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"secondary\"\n                          className=\"h-8 w-8 p-0 shadow-lg\"\n                          onClick={() => setMainImageMutation.mutate(image.id)}\n                          data-testid={`button-set-main-${image.id}`}\n                          title={t('setAsMain')}\n                        >\n                          <Star className=\"w-3 h-3\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          className=\"h-8 w-8 p-0 shadow-lg\"\n                          onClick={() => deleteImageMutation.mutate(image.id)}\n                          data-testid={`button-delete-${image.id}`}\n                        >\n                          <Trash2 className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                    )}\n                    {image.caption && (\n                      <div className=\"mt-2\">\n                        <p className=\"text-sm text-muted-foreground truncate\">{image.caption}</p>\n                      </div>\n                    )}\n                  </div>\n                ))}\n                \n                {/* Add New Image Card */}\n                {isAdmin && (\n                  <div className=\"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/25 flex items-center justify-center hover:border-primary/50 hover:bg-muted/5 transition-all cursor-pointer group\">\n                    <Button \n                      variant=\"ghost\" \n                      size=\"lg\" \n                      className=\"h-full w-full flex-col gap-2 text-muted-foreground group-hover:text-primary transition-colors\" \n                      onClick={() => setIsAddingImage(true)}\n                      data-testid=\"button-add-image-card\"\n                    >\n                      <Plus className=\"w-8 h-8\" />\n                      <span className=\"text-sm\">{t('addImage')}</span>\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </>\n        )}\n\n        {/* Add Image Modal/Form */}\n        {isAdmin && isAddingImage && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\" data-testid=\"add-image-modal\">\n            <Card className=\"w-full max-w-lg mx-4\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle>{t('addImage')}</CardTitle>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setIsAddingImage(false);\n                      setNewImageData({ imageUrl: \"\", caption: \"\" });\n                      setUploadMode('upload');\n                    }}\n                    data-testid=\"button-close-modal\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Mode Toggle */}\n                <div className=\"flex items-center space-x-2 p-1 bg-muted rounded-lg\">\n                  <Button \n                    variant={uploadMode === 'upload' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    onClick={() => setUploadMode('upload')}\n                    data-testid=\"toggle-upload-mode\"\n                  >\n                    <Upload className=\"w-4 h-4 mr-2\" />\n                    Upload\n                  </Button>\n                  <Button \n                    variant={uploadMode === 'url' ? 'default' : 'ghost'}\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    onClick={() => setUploadMode('url')}\n                    data-testid=\"toggle-url-mode\"\n                  >\n                    <Link className=\"w-4 h-4 mr-2\" />\n                    URL\n                  </Button>\n                </div>\n\n                {/* Upload Mode */}\n                {uploadMode === 'upload' && (\n                  <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center\">\n                    <div className=\"space-y-4\">\n                      <div className=\"p-3 rounded-full bg-primary/10 mx-auto w-fit\">\n                        <Upload className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"font-medium mb-2\">{t('uploadFiles')}</p>\n                        <p className=\"text-sm text-muted-foreground mb-4\">\n                          {t('uploadDescription')}\n                        </p>\n                      </div>\n                      <ObjectUploader\n                        maxNumberOfFiles={5}\n                        maxFileSize={10485760}\n                        onGetUploadParameters={handleGetUploadParameters}\n                        onComplete={handleImageUploadComplete}\n                        buttonClassName=\"w-full\"\n                      >\n                        <Upload className=\"w-4 h-4 mr-2\" />\n                        {t('selectFiles')}\n                      </ObjectUploader>\n                    </div>\n                  </div>\n                )}\n\n                {/* URL Mode */}\n                {uploadMode === 'url' && (\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"image-url\" className=\"text-sm font-medium\">Bild-URL</Label>\n                      <Input\n                        id=\"image-url\"\n                        placeholder=\"https://example.com/image.jpg\"\n                        value={newImageData.imageUrl}\n                        onChange={(e) => setNewImageData({ ...newImageData, imageUrl: e.target.value })}\n                        data-testid=\"input-image-url\"\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"image-caption\" className=\"text-sm font-medium\">Bildunterschrift (optional)</Label>\n                      <Textarea\n                        id=\"image-caption\"\n                        placeholder=\"Beschreibung des Bildes...\"\n                        value={newImageData.caption}\n                        onChange={(e) => setNewImageData({ ...newImageData, caption: e.target.value })}\n                        data-testid=\"input-image-caption\"\n                        className=\"mt-1 resize-none\"\n                        rows={3}\n                      />\n                    </div>\n                    \n                    {/* URL Preview */}\n                    {newImageData.imageUrl && (\n                      <div className=\"border rounded-lg p-3\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-16 h-16 rounded bg-muted flex-shrink-0 overflow-hidden\">\n                            <img\n                              src={newImageData.imageUrl}\n                              alt={t('preview')}\n                              className=\"w-full h-full object-cover\"\n                              onError={(e) => {\n                                (e.target as HTMLImageElement).style.display = 'none';\n                              }}\n                            />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-sm font-medium truncate\">{t('imagePreview')}</p>\n                            <p className=\"text-xs text-muted-foreground truncate\">{newImageData.imageUrl}</p>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    <div className=\"flex space-x-3 pt-4\">\n                      <Button\n                        onClick={() => addImageMutation.mutate(newImageData)}\n                        disabled={!newImageData.imageUrl || addImageMutation.isPending}\n                        className=\"flex-1\"\n                        data-testid=\"button-save-image\"\n                      >\n                        {addImageMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            {t('saving')}\n                          </>\n                        ) : (\n                          <>\n                            <CheckCircle className=\"w-4 h-4 mr-2\" />\n                            {t('addImage')}\n                          </>\n                        )}\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => {\n                          setIsAddingImage(false);\n                          setNewImageData({ imageUrl: \"\", caption: \"\" });\n                        }}\n                        data-testid=\"button-cancel-add-image\"\n                      >\n                        {t('cancel')}\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Lightbox */}\n        <Lightbox\n          images={lightboxImages.map(img => ({\n            id: img.id,\n            imageUrl: img.imageUrl,\n            caption: img.caption || undefined\n          }))}\n          currentIndex={lightboxIndex}\n          isOpen={lightboxOpen}\n          onClose={closeLightbox}\n          onNext={goToNextImage}\n          onPrevious={goToPreviousImage}\n        />\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":22873},"client/src/components/LocationCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Wine, Mountain, Network, MapPin, ArrowRight } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport type { Location } from \"@shared/schema\";\n\ninterface LocationCardProps {\n  location: Location;\n}\n\nexport default function LocationCard({ location }: LocationCardProps) {\n  const [, setLocation] = useLocation();\n  \n  const getCategoryFromHighlights = (highlights: string[] | null): string => {\n    if (!highlights || highlights.length === 0) return \"Alpine Adventure\";\n    \n    const highlightStr = highlights.join(' ').toLowerCase();\n    if (highlightStr.includes('wein') || highlightStr.includes('wine')) {\n      return \"Wine Country\";\n    }\n    if (highlightStr.includes('berg') || highlightStr.includes('mountain') || highlightStr.includes('alpine')) {\n      return \"Alpine Adventure\";\n    }\n    if (highlightStr.includes('wild') || highlightStr.includes('natur') || highlightStr.includes('wilderness')) {\n      return \"Wilderness\";\n    }\n    return \"Alpine Adventure\";\n  };\n\n  const getIcon = (category: string) => {\n    switch (category) {\n      case \"Wine Country\":\n        return <Wine className=\"mr-2 h-4 w-4\" />;\n      case \"Alpine Adventure\":\n        return <Mountain className=\"mr-2 h-4 w-4\" />;\n      case \"Wilderness\":\n        return <Network className=\"mr-2 h-4 w-4\" />;\n      default:\n        return <Mountain className=\"mr-2 h-4 w-4\" />;\n    }\n  };\n\n  const formatDateRange = (startDate: string, endDate: string) => {\n    // Handle German date format (DD.MM.YYYY)\n    const start = new Date(startDate.split('.').reverse().join('-'));\n    const end = new Date(endDate.split('.').reverse().join('-'));\n    const startMonth = start.toLocaleDateString('de-DE', { month: 'short' });\n    const endMonth = end.toLocaleDateString('de-DE', { month: 'short' });\n    \n    if (startMonth === endMonth) {\n      return `${startMonth} ${start.getDate()}-${end.getDate()}`;\n    }\n    return `${startMonth} ${start.getDate()} - ${endMonth} ${end.getDate()}`;\n  };\n\n  const category = getCategoryFromHighlights(location.highlights);\n\n  return (\n    <Link href={`/location/${location.slug}`}>\n      <Card className=\"group cursor-pointer hover:shadow-lg transition-shadow\" data-testid={`location-card-${location.slug}`}>\n        <div className=\"relative overflow-hidden\">\n          {location.imageUrl ? (\n            <img \n              src={location.imageUrl}\n              alt={location.name}\n              className=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\"\n              loading=\"lazy\"\n              decoding=\"async\"\n            />\n          ) : (\n            <div className=\"w-full h-48 bg-gray-100 flex items-center justify-center\">\n              <div className=\"text-center text-gray-400\">\n                <MapPin className=\"w-8 h-8 mx-auto mb-2\" />\n                <p className=\"text-sm\">Bild wird hinzugefügt</p>\n              </div>\n            </div>\n          )}\n        </div>\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h3 className=\"text-xl font-semibold\">{location.name}</h3>\n            <span className=\"text-sm text-muted-foreground\">\n              {formatDateRange(location.startDate, location.endDate)}\n            </span>\n          </div>\n          <p className=\"text-muted-foreground text-sm mb-3\">{location.description}</p>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center text-primary text-sm\">\n              {getIcon(category)}\n              <span>{category}</span>\n            </div>\n            <div \n              className=\"opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity px-3 py-1 text-sm border border-border rounded-md flex items-center hover:bg-accent cursor-pointer relative z-10\"\n              data-testid={`view-details-button-${location.slug}`}\n              role=\"button\"\n              tabIndex={0}\n              onClick={(e) => {\n                e.stopPropagation();\n                setLocation(`/location/${location.slug}`);\n              }}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' || e.key === ' ') {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  setLocation(`/location/${location.slug}`);\n                }\n              }}\n            >\n              Details <ArrowRight className=\"w-4 h-4 ml-1\" />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </Link>\n  );\n}","size_bytes":4675},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport { DashboardModal } from \"@uppy/react\";\n// Uppy CSS is loaded through the package itself\nimport AwsS3 from \"@uppy/aws-s3\";\nimport type { UploadResult } from \"@uppy/core\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n * \n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n * \n * The component uses Uppy under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n * \n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 10)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters (method and URL).\n *   Typically used to fetch a presigned URL from the backend server for direct-to-S3\n *   uploads.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 10,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result: any) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}\n","size_bytes":2838},"client/src/components/Timeline.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Calendar, ChevronRight, MapPin, Car, Navigation } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport CarIcon from \"@/components/CarIcon\";\nimport geolocationService from \"@/lib/geolocationService\";\nimport { getCurrentCarPosition, getPositionMessage, calculateTimelinePosition } from \"@/lib/positionCalculator\";\nimport type { Location, LocationPing, TourSettings } from \"@shared/schema\";\n\ninterface TimelineProps {\n  locations: Location[];\n}\n\nfunction formatDateRange(startDate: string, endDate: string): string {\n  const start = new Date(startDate.split('.').reverse().join('-'));\n  const end = new Date(endDate.split('.').reverse().join('-'));\n  \n  const startMonth = start.toLocaleDateString('de-DE', { month: 'short' });\n  const endMonth = end.toLocaleDateString('de-DE', { month: 'short' });\n  const startDay = start.getDate();\n  const endDay = end.getDate();\n  \n  if (startMonth === endMonth) {\n    return `${startMonth} ${startDay}-${endDay}`;\n  }\n  return `${startMonth} ${startDay} - ${endMonth} ${endDay}`;\n}\n\nexport default function Timeline({ locations }: TimelineProps) {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const timelineRef = useRef<HTMLDivElement>(null);\n  const [carPosition, setCarPosition] = useState<any>(null);\n  const [isTrackingEnabled, setIsTrackingEnabled] = useState(false);\n  const [isRequestingPermission, setIsRequestingPermission] = useState(false);\n  \n  // Interactive marker state - persists until manually changed\n  const [activeMarker, setActiveMarker] = useState<{\n    type: 'location' | 'custom';\n    locationId?: string;\n    position?: { top: number };\n  } | null>(() => {\n    // Load from localStorage on initialization\n    try {\n      const saved = localStorage.getItem('timeline-active-marker');\n      return saved ? JSON.parse(saved) : null;\n    } catch {\n      return null;\n    }\n  });\n\n  // Ensure marker persists and repositions properly during viewport changes\n  useEffect(() => {\n    if (activeMarker && activeMarker.type === 'location' && activeMarker.locationId && timelineRef.current) {\n      // Recalculate position for location-based markers on viewport/content changes\n      const locationIndex = locations.findIndex(loc => loc.id === activeMarker.locationId);\n      if (locationIndex !== -1) {\n        // Recompute position after layout changes\n        const timelineElement = document.querySelector(`[data-testid=\"timeline-item-${locations[locationIndex].slug}\"]`);\n        if (timelineElement) {\n          const rect = timelineElement.getBoundingClientRect();\n          const containerRect = timelineRef.current.getBoundingClientRect();\n          const relativeTop = rect.top - containerRect.top + rect.height / 2;\n          setActiveMarker(prev => prev ? { ...prev, position: { top: relativeTop } } : null);\n        }\n      }\n    }\n  }, [locations, activeMarker?.locationId]);\n\n  // Handle window resize for marker repositioning\n  useEffect(() => {\n    const handleResize = () => {\n      if (activeMarker && activeMarker.type === 'location' && activeMarker.locationId && timelineRef.current) {\n        const locationIndex = locations.findIndex(loc => loc.id === activeMarker.locationId);\n        if (locationIndex !== -1) {\n          const timelineElement = document.querySelector(`[data-testid=\"timeline-item-${locations[locationIndex].slug}\"]`);\n          if (timelineElement) {\n            const rect = timelineElement.getBoundingClientRect();\n            const containerRect = timelineRef.current.getBoundingClientRect();\n            const relativeTop = rect.top - containerRect.top + rect.height / 2;\n            setActiveMarker(prev => prev ? { ...prev, position: { top: relativeTop } } : null);\n          }\n        }\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, [activeMarker, locations]);\n\n  // Save activeMarker to localStorage whenever it changes\n  useEffect(() => {\n    try {\n      if (activeMarker) {\n        localStorage.setItem('timeline-active-marker', JSON.stringify(activeMarker));\n      } else {\n        localStorage.removeItem('timeline-active-marker');\n      }\n    } catch {\n      // Ignore localStorage errors (incognito mode, storage full, etc.)\n    }\n  }, [activeMarker]);\n\n  // Restore marker position after locations are loaded and layout is ready\n  useEffect(() => {\n    if (activeMarker && activeMarker.type === 'location' && activeMarker.locationId && locations.length > 0 && timelineRef.current) {\n      // Delay to ensure DOM elements are rendered\n      const timer = setTimeout(() => {\n        const locationIndex = locations.findIndex(loc => loc.id === activeMarker.locationId);\n        if (locationIndex !== -1) {\n          const timelineElement = document.querySelector(`[data-testid=\"timeline-item-${locations[locationIndex].slug}\"]`);\n          if (timelineElement && timelineRef.current) {\n            const rect = timelineElement.getBoundingClientRect();\n            const containerRect = timelineRef.current.getBoundingClientRect();\n            const relativeTop = rect.top - containerRect.top + rect.height / 2;\n            setActiveMarker(prev => prev ? { ...prev, position: { top: relativeTop } } : null);\n          }\n        }\n      }, 100);\n      \n      return () => clearTimeout(timer);\n    }\n  }, [locations, activeMarker?.locationId]);\n\n  // Fetch tour settings to check if GPS is activated by admin\n  const { data: tourSettings } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  // Fetch latest location ping for car positioning\n  const { data: latestPing, refetch: refetchPing } = useQuery<LocationPing>({\n    queryKey: [\"/api/location-ping/latest\"],\n    enabled: Boolean(isTrackingEnabled || tourSettings?.gpsActivatedByAdmin), // Ensure strict boolean type\n    refetchInterval: 2 * 60 * 1000, // Check every 2 minutes for updates\n  });\n\n  // Calculate car position when latest ping changes\n  useEffect(() => {\n    if (latestPing && locations.length > 0) {\n      // Ensure latestPing has all required properties before processing\n      if (latestPing.id && latestPing.latitude && latestPing.longitude) {\n        const newCarPosition = getCurrentCarPosition(latestPing, locations);\n        setCarPosition(newCarPosition);\n      }\n    }\n  }, [latestPing, locations]);\n\n  // Handle GPS permission request\n  const handleEnableTracking = async () => {\n    setIsRequestingPermission(true);\n    \n    try {\n      const result = await geolocationService.requestLocationTracking();\n      \n      toast({\n        title: result.success ? \"🚗 Live-Tracking aktiviert!\" : \"ℹ️ GPS optional\",\n        description: result.message,\n        variant: result.success ? \"default\" : \"destructive\",\n      });\n\n      if (result.success) {\n        setIsTrackingEnabled(true);\n        // Immediately fetch the first ping\n        setTimeout(() => refetchPing(), 1000);\n      }\n    } catch (error) {\n      toast({\n        title: \"GPS-Fehler\",\n        description: \"Das Live-Auto ist optional. Die App funktioniert trotzdem!\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsRequestingPermission(false);\n    }\n  };\n\n  // Calculate car visual position on timeline\n  const carTimelinePosition = carPosition && timelineRef.current\n    ? calculateTimelinePosition(carPosition, timelineRef.current)\n    : null;\n\n  // Handle location dot click\n  const handleLocationDotClick = (locationId: string, event: React.MouseEvent) => {\n    if (!timelineRef.current) return;\n    \n    const rect = timelineRef.current.getBoundingClientRect();\n    const clickY = event.currentTarget.getBoundingClientRect().top - rect.top + 32; // 32px = half of dot height\n    \n    setActiveMarker({\n      type: 'location',\n      locationId: locationId,\n      position: { top: clickY }\n    });\n  };\n\n  // Handle trip line click\n  const handleTripLineClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    if (!timelineRef.current) return;\n    \n    const rect = timelineRef.current.getBoundingClientRect();\n    const clickY = event.clientY - rect.top;\n    \n    setActiveMarker({\n      type: 'custom',\n      position: { top: clickY }\n    });\n  };\n\n  return (\n    <div className=\"relative py-8 min-h-full\" data-testid=\"timeline\" ref={timelineRef}>\n      {/* Timeline line - visible on all devices, positioned responsive */}\n      <div \n        className=\"absolute left-4 md:left-1/2 top-0 h-full w-0.5 md:w-1 bg-primary transform md:-translate-x-1/2 shadow-md hover:w-1 md:hover:w-2 transition-all duration-200\"\n        data-testid=\"timeline-line\"\n      ></div>\n      \n      {/* Expanded clickable area for timeline line - below location dots */}\n      <div \n        className=\"hidden md:block absolute left-1/2 top-0 h-full w-12 transform -translate-x-1/2 cursor-pointer z-0\"\n        onClick={handleTripLineClick}\n        onMouseEnter={(e) => {\n          // Visual feedback on hover\n          const line = e.currentTarget.previousElementSibling as HTMLElement;\n          if (line) line.style.width = '8px';\n        }}\n        onMouseLeave={(e) => {\n          // Reset on leave\n          const line = e.currentTarget.previousElementSibling as HTMLElement;\n          if (line) line.style.width = '4px';\n        }}\n        data-testid=\"timeline-line-clickable-area\"\n        title=\"Klicken Sie hier, um Ihre Position zu markieren\"\n      ></div>\n      \n      {/* Mobile timeline clickable area - positioned safely to avoid card overlap */}\n      <div \n        className=\"md:hidden absolute left-0 top-0 h-full w-8 cursor-pointer z-10 pointer-events-auto\"\n        onClick={handleTripLineClick}\n        data-testid=\"mobile-timeline-clickable-area\"\n        title=\"Tippen Sie hier, um Ihre Position zu markieren\"\n      ></div>\n      \n      {/* Car Icon positioned on timeline - positioned clear of cards */}\n      {carTimelinePosition && carTimelinePosition.isVisible && (\n        <div \n          className=\"absolute -left-1 md:left-1/2 transform md:-translate-x-1/2 z-40\"\n          style={{ top: `${carTimelinePosition.top}px` }}\n        >\n          <CarIcon\n            isVisible={true}\n            position=\"middle\"\n            isMoving={carPosition?.isMoving || false}\n          />\n        </div>\n      )}\n\n      {/* \"Wir sind hier\" Interactive Marker - Positioned clear of cards */}\n      {activeMarker && (\n        <div \n          className=\"absolute -left-1 md:left-1/2 transform md:-translate-x-1/2 z-50 animate-in fade-in zoom-in duration-300\"\n          style={{ \n            top: `${activeMarker.position?.top || 0}px`\n          }}\n          data-testid=\"active-location-marker\"\n        >\n          <div className=\"relative\">\n            {/* Marker Icon - tablet optimized sizing */}\n            <div className=\"bg-red-500 text-white p-2 md:p-2 lg:p-3 rounded-full shadow-lg border-2 md:border-2 lg:border-4 border-white animate-pulse min-w-[44px] min-h-[44px] flex items-center justify-center\">\n              <Navigation className=\"w-4 h-4 md:w-5 md:h-5 lg:w-6 lg:h-6\" />\n            </div>\n            \n            {/* \"Wir sind hier\" Label - tablet optimized */}\n            <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 md:mt-1 lg:mt-2 bg-red-500 text-white px-2 md:px-3 lg:px-4 py-1 md:py-1 lg:py-2 rounded-lg shadow-lg text-xs md:text-xs lg:text-sm font-semibold whitespace-nowrap\">\n              <div className=\"absolute -top-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-red-500 rotate-45\"></div>\n              Wir sind hier\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* GPS activation is only available in Admin Panel - no frontend prompts */}\n\n      {/* Car Position Status - shown when tracking is enabled */}\n      {isTrackingEnabled && carPosition && (\n        <div className=\"mb-8 text-center\">\n          <Card className=\"inline-block p-4 bg-green-50 border-green-200\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"text-2xl\">🚗</div>\n              <div>\n                <div className=\"text-sm font-medium text-green-800\">\n                  Live-Tracking aktiv\n                </div>\n                <div className=\"text-xs text-green-600\">\n                  {getPositionMessage(carPosition, locations)}\n                </div>\n              </div>\n            </div>\n          </Card>\n        </div>\n      )}\n      \n      <div>\n        {locations.map((location, index) => (\n          <div \n            key={location.id} \n            className={`relative ${\n              index === 0 ? 'mt-0' : 'mt-6 md:-mt-[160px] lg:-mt-[200px] xl:-mt-[234px]'\n            }`}\n            style={{ zIndex: locations.length - index + 20 }}\n            data-testid={`timeline-item-${location.slug}`}>\n            {/* Connector line between cards - only on desktop */}\n            {index > 0 && (\n              <div className=\"hidden md:block absolute left-1/2 -top-20 w-px h-24 bg-gray-300 transform -translate-x-1/2 z-0\"></div>\n            )}\n            \n            {/* Timeline marker - positioned clear of card content */}\n            <div \n              className=\"hidden md:block absolute left-1/2 -top-4 w-8 h-8 bg-primary rounded-full transform -translate-x-1/2 z-20 border-4 border-white shadow-lg cursor-pointer hover:scale-110 transition-all duration-200\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleLocationDotClick(location.id, e);\n              }}\n              data-testid={`location-dot-${location.slug}`}\n            >\n            </div>\n            \n            {/* Mobile timeline marker - positioned left of card with higher z-index */}\n            <div \n              className=\"md:hidden absolute -left-2 top-8 w-10 h-10 bg-primary rounded-full z-30 border-4 border-white shadow-lg cursor-pointer hover:scale-110 transition-all duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleLocationDotClick(location.id, e);\n              }}\n              data-testid={`mobile-location-dot-${location.slug}`}\n            >\n              <div className=\"w-5 h-5 bg-primary rounded-full\"></div>\n            </div>\n            \n            {/* Mobile timeline dot - removed to avoid clutter */}\n            \n            {/* Card positioned alternating left/right with clearance from timeline elements */}\n            <div className={`flex ${index % 2 === 0 ? 'md:justify-start md:pr-4 lg:pr-6 xl:pr-10' : 'md:justify-end md:pl-4 lg:pl-6 xl:pl-10'}`}>\n              <div className=\"w-full pl-12 md:pl-0 md:w-[calc(50%-2rem)] lg:w-[calc(50%-2rem)] xl:w-[calc(50%-2.5rem)]\">\n                <Card \n                  className={`w-full bg-white border border-gray-200 shadow-sm hover:shadow-lg transition-all duration-300 cursor-pointer hover:scale-[1.02] ${index % 2 === 0 ? 'md:mr-auto' : 'md:ml-auto'}`}\n                  onClick={() => setLocation(`/location/${location.slug}`)}\n                >\n                {/* Header with location name and date - tablet proportioned */}\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between p-4 md:p-5 lg:p-6 pb-3 md:pb-4 gap-2 md:gap-0\">\n                  <h3 className=\"text-lg md:text-xl lg:text-2xl font-bold text-gray-900\" data-testid={`location-name-${location.slug}`}>\n                    {location.name}\n                  </h3>\n                  <div className=\"flex items-center text-primary font-medium\">\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    <span className=\"text-sm\">{formatDateRange(location.startDate, location.endDate)}</span>\n                  </div>\n                </div>\n\n                {/* Image - tablet proportioned dimensions */}\n                {location.imageUrl ? (\n                  <div className=\"px-4 md:px-5 lg:px-6 pb-4\">\n                    <img \n                      src={location.imageUrl}\n                      alt={location.name}\n                      className=\"w-full h-44 md:h-48 lg:h-56 xl:h-64 object-cover rounded-lg\"\n                      data-testid={`location-image-${location.slug}`}\n                    />\n                  </div>\n                ) : (\n                  <div className=\"px-4 md:px-5 lg:px-6 pb-4\">\n                    <div className=\"w-full h-44 md:h-48 lg:h-56 xl:h-64 bg-gray-100 rounded-lg flex items-center justify-center\" data-testid={`location-image-placeholder-${location.slug}`}>\n                      <div className=\"text-center text-gray-400\">\n                        <MapPin className=\"w-8 h-8 mx-auto mb-2\" />\n                        <p className=\"text-sm\">Bild wird bald hinzugefügt</p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description - tablet proportioned */}\n                <div className=\"px-4 md:px-5 lg:px-6 pb-3 md:pb-4\">\n                  <p className=\"text-gray-600 text-sm md:text-sm lg:text-base leading-relaxed\" data-testid={`location-description-${location.slug}`}>\n                    {location.description}\n                  </p>\n                </div>\n\n                {/* Restaurants and Activities grid - boxed in subtle gray - tablet responsive */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 px-4 md:px-5 lg:px-6 pb-3 md:pb-4\">\n                  {/* Restaurants */}\n                  <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-100\">\n                    <div className=\"flex items-center mb-3\">\n                      <span className=\"text-lg mr-2\">🍽️</span>\n                      <h4 className=\"font-semibold text-primary\">Restaurants</h4>\n                    </div>\n                    <div className=\"space-y-3\">\n                      {location.restaurants?.slice(0, 2).map((restaurant, idx) => (\n                        <div key={idx} className=\"flex items-center gap-3\" data-testid={`restaurant-item-${idx}`}>\n                          {(restaurant as any).imageUrl && (\n                            <img \n                              src={(restaurant as any).imageUrl} \n                              alt={typeof restaurant === 'string' ? restaurant : restaurant.name}\n                              className=\"w-12 h-12 rounded-lg object-cover flex-shrink-0\"\n                              data-testid={`restaurant-image-${idx}`}\n                            />\n                          )}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"text-sm text-gray-700\">\n                              • {(restaurant as any).websiteUrl ? (\n                                <a \n                                  href={(restaurant as any).websiteUrl} \n                                  target=\"_blank\" \n                                  rel=\"noopener noreferrer\" \n                                  className=\"text-primary hover:text-primary/80 underline\" \n                                  data-testid={`restaurant-link-${idx}`}\n                                  onClick={(e) => e.stopPropagation()}\n                                >\n                                  {typeof restaurant === 'string' ? restaurant : restaurant.name}\n                                </a>\n                              ) : (\n                                <span data-testid={`restaurant-name-${idx}`}>\n                                  {typeof restaurant === 'string' ? restaurant : restaurant.name}\n                                </span>\n                              )}\n                            </div>\n                            {(restaurant as any).cuisine && (\n                              <div className=\"text-xs text-gray-500 mt-1\">\n                                {(restaurant as any).cuisine}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      )) || (\n                        <div className=\"text-sm text-gray-500\">• Lokale Spezialitäten entdecken</div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Activities */}\n                  <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-100\">\n                    <div className=\"flex items-center mb-3\">\n                      <span className=\"text-lg mr-2\">⭐</span>\n                      <h4 className=\"font-semibold text-primary\">Aktivitäten</h4>\n                    </div>\n                    <ul className=\"space-y-2\">\n                      {location.activities?.slice(0, 2).map((activity, idx) => (\n                        <li key={idx} className=\"text-sm text-gray-700\">\n                          • {activity}\n                        </li>\n                      )) || (\n                        <li className=\"text-sm text-gray-500\">• Entdeckungstouren vor Ort</li>\n                      )}\n                    </ul>\n                  </div>\n                </div>\n\n                {/* Accommodation - boxed in subtle gray - tablet optimized */}\n                <div className=\"px-4 md:px-6 pb-4\">\n                  <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-100\">\n                    <p className=\"text-sm text-gray-700\">\n                      <span className=\"font-medium\">Unterkunft:</span> {(location as any).accommodationWebsite ? (\n                        <a \n                          href={(location as any).accommodationWebsite} \n                          target=\"_blank\" \n                          rel=\"noopener noreferrer\" \n                          className=\"text-primary hover:text-primary/80 underline ml-1\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          {location.accommodation || 'Komfortable Unterkunft'}\n                        </a>\n                      ) : (\n                        <span className=\"ml-1\">{location.accommodation || 'Komfortable Unterkunft'}</span>\n                      )} • 2 Nächte\n                    </p>\n                  </div>\n                </div>\n\n                {/* Fun Facts Preview - tablet optimized */}\n                <div className=\"px-4 md:px-6 pb-4\">\n                  <div className=\"bg-amber-50 rounded-lg p-4 border border-amber-200\">\n                    <div className=\"flex items-center mb-2\">\n                      <span className=\"text-lg mr-2\">🎯</span>\n                      <h4 className=\"font-semibold text-amber-800\">Wussten Sie schon?</h4>\n                    </div>\n                    <p className=\"text-sm text-amber-700\">\n                      {(() => {\n                        // Show first fun fact or default based on location\n                        if ((location as any).funFacts?.length > 0) {\n                          return (location as any).funFacts[0];\n                        }\n                        switch (location.slug) {\n                          case 'penticton':\n                            return '\"Penticton\" bedeutet \"ein Ort, um für immer zu bleiben\" auf der ursprünglichen Okanagan-Sprache.';\n                          case 'vernon':\n                            return 'Vernon veranstaltet Westkanadas größten Winterkarneval - den zweitgrößten in ganz Nordamerika!';\n                          case 'jasper':\n                            return 'Jasper ist ein Dark Sky Reserve - einer der besten Orte für Sterne und Nordlichter in Kanada.';\n                          case 'golden':\n                            return 'Golden bietet Zugang zu über 300 Kilometern Mountainbike-Strecken in den Rocky Mountains.';\n                          case 'wells-gray':\n                            return 'Wells Gray ist als \"Kanadas Wasserfall-Park\" bekannt mit über 40 spektakulären Wasserfällen.';\n                          case 'sunshine-coast':\n                            return 'Die Sunshine Coast ist nur mit der Fähre erreichbar, obwohl sie auf dem Festland liegt.';\n                          default:\n                            return 'Entdecken Sie faszinierende Fakten über diese einzigartige kanadische Destination!';\n                        }\n                      })()}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Clickable indicator - tablet optimized with proper z-index */}\n                <div className=\"px-4 md:px-6 pb-4 md:pb-6\">\n                  <div className=\"flex justify-end relative z-10\">\n                    <Button \n                      variant=\"ghost\"\n                      className=\"text-gray-700 hover:text-primary p-2 h-auto font-normal relative z-20 cursor-pointer hover:bg-gray-100\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setLocation(`/location/${location.slug}`);\n                      }}\n                      data-testid={`details-button-${location.slug}`}\n                    >\n                      Details ansehen\n                      <ChevronRight className=\"w-4 h-4 ml-1\" />\n                    </Button>\n                  </div>\n                </div>\n                </Card>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":25537},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 10 * 60 * 1000, // 10 minutes - aggressive caching for performance\n      gcTime: 30 * 60 * 1000, // 30 minutes cache retention for better performance\n      retry: false,\n      // Network mode optimization\n      networkMode: 'online',\n    },\n    mutations: {\n      retry: false,\n      // Faster mutation timeouts\n      mutationCacheTime: 5 * 60 * 1000,\n    },\n  },\n});\n","size_bytes":1661},"client/src/lib/tourData.ts":{"content":"// Tour data constants and utilities\nexport const TOUR_CONSTANTS = {\n  TOTAL_DAYS: 17,\n  TOTAL_DISTANCE: 2130,\n  TOTAL_COST: 8779,\n  CURRENCY: \"CAD\",\n  START_DATE: \"20.09.2025\",\n  END_DATE: \"06.10.2025\",\n} as const;\n\nexport const formatDate = (dateString: string) => {\n  // Convert DD.MM.YYYY to a more readable format\n  const [day, month, year] = dateString.split('.');\n  const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n  return date.toLocaleDateString('de-DE', { \n    day: '2-digit', \n    month: 'short',\n    year: 'numeric'\n  });\n};\n\nexport const calculateDaysBetween = (startDate: string, endDate: string) => {\n  const [startDay, startMonth, startYear] = startDate.split('.').map(Number);\n  const [endDay, endMonth, endYear] = endDate.split('.').map(Number);\n  \n  const start = new Date(startYear, startMonth - 1, startDay);\n  const end = new Date(endYear, endMonth - 1, endDay);\n  \n  const diffTime = Math.abs(end.getTime() - start.getTime());\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n  \n  return diffDays;\n};\n\nexport const formatCurrency = (amount: number, currency: string = \"CAD\") => {\n  return new Intl.NumberFormat('de-DE', {\n    style: 'currency',\n    currency: currency,\n    minimumFractionDigits: 0,\n  }).format(amount);\n};\n","size_bytes":1287},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Calculate the number of nights between two date strings\n * Supports both DD.MM.YYYY format and ISO datetime strings\n * @param startDate - Start date in DD.MM.YYYY or ISO format\n * @param endDate - End date in DD.MM.YYYY or ISO format\n * @returns Number of nights between the dates\n */\nexport function calculateNights(startDate: string, endDate: string): number {\n  if (!startDate || !endDate) return 0;\n  \n  // Parse date string - handles both DD.MM.YYYY and ISO datetime formats\n  const parseDate = (dateStr: string): Date => {\n    // Check if it's ISO datetime format (contains T or looks like YYYY-MM-DD)\n    if (dateStr.includes('T') || dateStr.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\n      return new Date(dateStr);\n    }\n    \n    // Otherwise, assume DD.MM.YYYY format\n    const [day, month, year] = dateStr.split('.');\n    if (!day || !month || !year) {\n      console.warn(`Invalid date format: ${dateStr}. Expected DD.MM.YYYY or ISO format.`);\n      return new Date(dateStr); // Fallback to native Date parsing\n    }\n    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n  };\n\n  const start = parseDate(startDate);\n  const end = parseDate(endDate);\n  \n  // Validate parsed dates\n  if (isNaN(start.getTime()) || isNaN(end.getTime())) {\n    console.warn(`Invalid dates: start=${startDate}, end=${endDate}`);\n    return 0;\n  }\n  \n  // Calculate difference in milliseconds and convert to days\n  const diffTime = end.getTime() - start.getTime();\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n  \n  return Math.max(0, diffDays); // Ensure non-negative result\n}\n\n/**\n * Format nights count with proper German singular/plural form\n * @param nights - Number of nights\n * @returns Formatted string (e.g., \"1 Nacht\", \"2 Nächte\")\n */\nexport function formatNights(nights: number): string {\n  if (nights === 1) {\n    return \"1 Nacht\";\n  }\n  return `${nights} Nächte`;\n}\n","size_bytes":2067},"client/src/pages/AdminPanel.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Plus, Edit, Trash2, Upload, Lock, Eye, EyeOff, Hotel, UtensilsCrossed, AlertCircle, Star, ChevronDown, ChevronUp, Camera, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ImageGallery } from \"@/components/ImageGallery\";\nimport { ImageInput } from \"@/components/ImageInput\";\nimport AdminLocationForm from \"@/components/AdminLocationForm\";\nimport Header from \"@/components/Header\";\nimport type { Location, TourSettings, HeroImage, ScenicContent, ScenicGalleryItem, Creator } from \"@shared/schema\";\n\nexport default function AdminPanel() {\n  const [selectedLocation, setSelectedLocation] = useState<Location | null>(null);\n  const [showLocationForm, setShowLocationForm] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [privacyPassword, setPrivacyPassword] = useState(\"\");\n  const [editingHeroImage, setEditingHeroImage] = useState<HeroImage | null>(null);\n  const [heroImageForm, setHeroImageForm] = useState({ title: \"\", description: \"\", imageUrl: \"\" });\n  \n  // Bulk upload state\n  const [bulkUploadMode, setBulkUploadMode] = useState(false);\n  const [bulkImageUrls, setBulkImageUrls] = useState<string[]>([]);\n  const [bulkUploadDefaults, setBulkUploadDefaults] = useState({\n    titlePrefix: \"Hero Bild\",\n    description: \"Automatisch hochgeladenes Hero-Bild\"\n  });\n  \n  // Scenic content state\n  const [scenicTitle, setScenicTitle] = useState(\"\");\n  const [scenicSubtitle, setScenicSubtitle] = useState(\"\");\n  const [galleries, setGalleries] = useState<ScenicGalleryItem[]>([]);\n  \n  // Creator management state\n  const [creatorName, setCreatorName] = useState(\"\");\n  const [editingCreator, setEditingCreator] = useState<Creator | null>(null);\n  const [editingCreatorName, setEditingCreatorName] = useState(\"\");\n  \n  // Collapsible sections state - all collapsed by default for cleaner admin interface\n  const [collapsedSections, setCollapsedSections] = useState({\n    tourSettings: true,\n    heroImages: true,\n    privacySettings: true,\n    gpsSettings: true,\n    restaurantAccommodation: true,\n    locationsManagement: true,\n    imageManagement: true,\n    scenicLandscapes: true,\n    quickActions: true,\n    creatorManagement: true,\n  });\n\n  const toggleSection = (section: keyof typeof collapsedSections) => {\n    setCollapsedSections(prev => ({ ...prev, [section]: !prev[section] }));\n  };\n\n  // Smooth scroll to section function\n  const scrollToSection = (sectionId: string) => {\n    const element = document.querySelector(`[data-testid=\"${sectionId}\"]`);\n    if (element) {\n      element.scrollIntoView({ \n        behavior: 'smooth', \n        block: 'start',\n        inline: 'nearest'\n      });\n    }\n  };\n\n  // Combined navigation function - toggles section and scrolls to it\n  const navigateToSection = (section: keyof typeof collapsedSections, sectionId: string) => {\n    if (collapsedSections[section]) {\n      toggleSection(section);\n    }\n    // Small delay to ensure section is expanded before scrolling\n    setTimeout(() => scrollToSection(sectionId), 100);\n  };\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: locations, isLoading: locationsLoading } = useQuery<Location[]>({\n    queryKey: [\"/api/locations\"],\n  });\n\n  const { data: tourSettings, isLoading: settingsLoading } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  const { data: heroImages, isLoading: heroImagesLoading } = useQuery<HeroImage[]>({\n    queryKey: [\"/api/hero-images\"],\n  });\n\n  const { data: scenicContent, isLoading: scenicContentLoading } = useQuery<ScenicContent>({\n    queryKey: [\"/api/scenic-content\"],\n  });\n\n  const { data: creators, isLoading: creatorsLoading } = useQuery<Creator[]>({\n    queryKey: [\"/api/creators\"],\n  });\n\n  // Initialize scenic content form when data is loaded\n  useEffect(() => {\n    if (scenicContent) {\n      setScenicTitle(scenicContent.title || \"\");\n      setScenicSubtitle(scenicContent.subtitle || \"\");\n      setGalleries(scenicContent.galleries || []);\n    }\n  }, [scenicContent]);\n\n  const updateTourSettingsMutation = useMutation({\n    mutationFn: async (data: Partial<TourSettings>) => {\n      await apiRequest(\"PUT\", \"/api/tour-settings\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tour-settings\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Tour-Einstellungen wurden aktualisiert\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Aktualisieren der Einstellungen: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePrivacySettingsMutation = useMutation({\n    mutationFn: async (data: { privacyEnabled?: boolean; privacyPassword?: string; sessionTimeout?: number }) => {\n      // If password is provided, hash it on the server side\n      const payload: any = {};\n      \n      if (data.privacyEnabled !== undefined) {\n        payload.privacyEnabled = data.privacyEnabled;\n      }\n      \n      if (data.privacyPassword !== undefined) {\n        // Password will be hashed on the server\n        payload.privacyPassword = data.privacyPassword;\n      }\n      \n      if (data.sessionTimeout !== undefined) {\n        payload.sessionTimeout = data.sessionTimeout;\n      }\n      \n      await apiRequest(\"PUT\", \"/api/tour-settings\", payload);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tour-settings\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Privacy-Einstellungen wurden aktualisiert\",\n      });\n      setPrivacyPassword(\"\"); // Clear password field after save\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Aktualisieren der Privacy-Einstellungen: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteLocationMutation = useMutation({\n    mutationFn: async (locationId: string) => {\n      await apiRequest(\"DELETE\", `/api/locations/${locationId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Ort wurde gelöscht\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Löschen des Orts: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Hero Images mutations\n  const createHeroImageMutation = useMutation({\n    mutationFn: async (data: { title: string; description: string; imageUrl: string; sortOrder: number }) => {\n      await apiRequest(\"POST\", \"/api/hero-images\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hero-images\"] });\n      setHeroImageForm({ title: \"\", description: \"\", imageUrl: \"\" });\n      toast({\n        title: \"Erfolg\",\n        description: \"Hero-Bild wurde hinzugefügt\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Hinzufügen des Hero-Bilds: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Scenic content mutation\n  const updateScenicContentMutation = useMutation({\n    mutationFn: async (data: { title?: string; subtitle?: string; galleries?: ScenicGalleryItem[] }) => {\n      await apiRequest(\"PUT\", \"/api/scenic-content\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/scenic-content\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Spektakuläre Landschaften wurden aktualisiert\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Aktualisieren der Landschaften: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateHeroImageMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<{ title: string; description: string; imageUrl: string }> }) => {\n      await apiRequest(\"PUT\", `/api/hero-images/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hero-images\"] });\n      setEditingHeroImage(null);\n      setHeroImageForm({ title: \"\", description: \"\", imageUrl: \"\" });\n      toast({\n        title: \"Erfolg\",\n        description: \"Hero-Bild wurde aktualisiert\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Aktualisieren des Hero-Bilds: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteHeroImageMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/hero-images/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hero-images\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Hero-Bild wurde gelöscht\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Löschen des Hero-Bilds: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Bulk creation mutation\n  const createBulkHeroImagesMutation = useMutation({\n    mutationFn: async (imageUrls: string[]) => {\n      const currentSortOrder = heroImages?.length || 0;\n      const promises = imageUrls.map((url, index) => \n        apiRequest(\"POST\", \"/api/hero-images\", {\n          title: `${bulkUploadDefaults.titlePrefix} ${currentSortOrder + index + 1}`,\n          description: bulkUploadDefaults.description,\n          imageUrl: url,\n          sortOrder: currentSortOrder + index\n        })\n      );\n      await Promise.all(promises);\n    },\n    onSuccess: (_, imageUrls) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/hero-images\"] });\n      setBulkImageUrls([]);\n      setBulkUploadMode(false);\n      toast({\n        title: \"Erfolg\",\n        description: `${imageUrls.length} Hero-Bilder wurden erfolgreich hinzugefügt`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Hinzufügen der Hero-Bilder: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Creator mutations\n  const createCreatorMutation = useMutation({\n    mutationFn: async (name: string) => {\n      await apiRequest(\"POST\", \"/api/creators\", { name });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators\"] });\n      setCreatorName(\"\");\n      toast({\n        title: \"Erfolg\",\n        description: \"Person wurde hinzugefügt\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Hinzufügen der Person: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateCreatorMutation = useMutation({\n    mutationFn: async ({ id, name }: { id: string; name: string }) => {\n      await apiRequest(\"PUT\", `/api/creators/${id}`, { name });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators\"] });\n      setEditingCreator(null);\n      setEditingCreatorName(\"\");\n      toast({\n        title: \"Erfolg\",\n        description: \"Person wurde aktualisiert\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Aktualisieren der Person: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteCreatorMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/creators/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators\"] });\n      toast({\n        title: \"Erfolg\",\n        description: \"Person wurde gelöscht\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Fehler\",\n        description: `Fehler beim Löschen der Person: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n\n  if (locationsLoading || settingsLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\" data-testid=\"admin-loading\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"admin-panel\">\n      <Header />\n      {/* Admin Header */}\n      <div className=\"border-b py-4\" data-testid=\"admin-header\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <h1 className=\"text-2xl font-semibold\">Admin Panel</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">Verwalte deine Tour-Inhalte</p>\n        </div>\n      </div>\n\n      {/* Main Layout with Sidebar */}\n      <div className=\"flex min-h-screen\">\n        {/* Left Sidebar Navigation */}\n        <div className=\"w-56 border-r sticky top-0 h-screen overflow-y-auto\" data-testid=\"admin-sidebar\">\n          <div className=\"p-3\">\n            <h3 className=\"font-medium text-sm text-muted-foreground mb-3 uppercase\">Navigation</h3>\n            <nav className=\"space-y-1\">\n              <button \n                onClick={() => navigateToSection('tourSettings', 'tour-settings-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.tourSettings ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-tour-settings\"\n              >\n                Tour-Einstellungen\n              </button>\n              <button \n                onClick={() => navigateToSection('heroImages', 'hero-images-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.heroImages ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-hero-images\"\n              >\n                Hero-Bilder\n              </button>\n              <button \n                onClick={() => navigateToSection('scenicLandscapes', 'scenic-landscapes-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.scenicLandscapes ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-scenic-landscapes\"\n              >\n                Landschaften\n              </button>\n              <button \n                onClick={() => navigateToSection('privacySettings', 'privacy-settings-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.privacySettings ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-privacy-settings\"\n              >\n                Privacy\n              </button>\n              <button \n                onClick={() => navigateToSection('gpsSettings', 'gps-settings-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.gpsSettings ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-gps-settings\"\n              >\n                GPS Tracking\n              </button>\n              <button \n                onClick={() => navigateToSection('restaurantAccommodation', 'restaurant-accommodation-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.restaurantAccommodation ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-restaurant-accommodation\"\n              >\n                Restaurants & Hotels\n              </button>\n              <button \n                onClick={() => navigateToSection('creatorManagement', 'creator-management-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.creatorManagement ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-creator-management\"\n              >\n                Personen\n              </button>\n              <button \n                onClick={() => navigateToSection('locationsManagement', 'locations-management-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.locationsManagement ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-locations-management\"\n              >\n                Orte\n              </button>\n              <button \n                onClick={() => navigateToSection('imageManagement', 'image-management-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.imageManagement ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-image-management\"\n              >\n                Bilder\n              </button>\n              <button \n                onClick={() => navigateToSection('quickActions', 'quick-actions-card')}\n                className={`w-full text-left px-3 py-1.5 rounded text-sm hover:bg-muted ${!collapsedSections.quickActions ? 'bg-muted font-medium' : ''}`}\n                data-testid=\"nav-quick-actions\"\n              >\n                Schnellaktionen\n              </button>\n            </nav>\n          </div>\n        </div>\n\n        {/* Main Content Area */}\n        <div className=\"flex-1 max-w-5xl mx-auto px-4 py-6\">\n          <div className=\"space-y-4\">\n            <Card data-testid=\"tour-settings-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('tourSettings')}\n                data-testid=\"tour-settings-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Tour-Einstellungen</CardTitle>\n                  {collapsedSections.tourSettings ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.tourSettings && (\n                <CardContent className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"tour-name\">Tour-Name</Label>\n                  <Input\n                    id=\"tour-name\"\n                    defaultValue={tourSettings?.tourName}\n                    onBlur={(e) => {\n                      updateTourSettingsMutation.mutate({ tourName: e.target.value });\n                    }}\n                    data-testid=\"input-tour-name\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"start-date\">Start-Datum</Label>\n                    <Input\n                      id=\"start-date\"\n                      defaultValue={tourSettings?.startDate}\n                      onBlur={(e) => {\n                        updateTourSettingsMutation.mutate({ startDate: e.target.value });\n                      }}\n                      data-testid=\"input-start-date\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"end-date\">End-Datum</Label>\n                    <Input\n                      id=\"end-date\"\n                      defaultValue={tourSettings?.endDate}\n                      onBlur={(e) => {\n                        updateTourSettingsMutation.mutate({ endDate: e.target.value });\n                      }}\n                      data-testid=\"input-end-date\"\n                    />\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"total-distance\">Gesamt-Distanz (km)</Label>\n                    <Input\n                      id=\"total-distance\"\n                      type=\"number\"\n                      defaultValue={tourSettings?.totalDistance || \"\"}\n                      onBlur={(e) => {\n                        updateTourSettingsMutation.mutate({ totalDistance: parseInt(e.target.value) || 0 });\n                      }}\n                      data-testid=\"input-total-distance\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"total-cost\">Gesamt-Kosten</Label>\n                    <Input\n                      id=\"total-cost\"\n                      type=\"number\"\n                      defaultValue={tourSettings?.totalCost || \"\"}\n                      onBlur={(e) => {\n                        updateTourSettingsMutation.mutate({ totalCost: parseInt(e.target.value) || 0 });\n                      }}\n                      data-testid=\"input-total-cost\"\n                    />\n                  </div>\n                </div>\n                <ImageInput\n                  label=\"Hero-Bild der Tour\"\n                  value={tourSettings?.heroImageUrl || \"\"}\n                  onChange={(value) => {\n                    updateTourSettingsMutation.mutate({ heroImageUrl: value });\n                  }}\n                  placeholder=\"https://example.com/hero-image.jpg\"\n                  testId=\"tour-hero-image\"\n                />\n                <div>\n                  <Label htmlFor=\"description\">Beschreibung</Label>\n                  <Textarea\n                    id=\"description\"\n                    defaultValue={tourSettings?.description || \"\"}\n                    onBlur={(e) => {\n                      updateTourSettingsMutation.mutate({ description: e.target.value });\n                    }}\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Hero Images Management */}\n            <Card data-testid=\"hero-images-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('heroImages')}\n                data-testid=\"hero-images-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-base font-medium\">Hero-Bilder verwalten</CardTitle>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Verwalte die Slideshow-Bilder auf der Startseite\n                    </p>\n                  </div>\n                  {collapsedSections.heroImages ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.heroImages && (\n                <CardContent className=\"space-y-6\">\n                {/* Upload Mode Toggle */}\n                <div className=\"border rounded p-3 space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <h4 className=\"text-sm font-medium\">Hero-Bilder hinzufügen</h4>\n                    <div className=\"flex items-center gap-3\">\n                      <Label htmlFor=\"bulk-upload-toggle\" className=\"text-sm cursor-pointer\">\n                        {bulkUploadMode ? \"Mehrere Bilder\" : \"Einzelnes Bild\"}\n                      </Label>\n                      <Switch\n                        id=\"bulk-upload-toggle\"\n                        checked={bulkUploadMode}\n                        onCheckedChange={(checked) => {\n                          setBulkUploadMode(checked);\n                          if (checked) {\n                            // Reset single image form when switching to bulk\n                            setEditingHeroImage(null);\n                            setHeroImageForm({ title: \"\", description: \"\", imageUrl: \"\" });\n                          } else {\n                            // Reset bulk form when switching to single\n                            setBulkImageUrls([]);\n                          }\n                        }}\n                        data-testid=\"toggle-bulk-upload\"\n                      />\n                    </div>\n                  </div>\n\n                  {!bulkUploadMode ? (\n                    /* Single Image Upload Form */\n                    <div className=\"space-y-3\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"hero-title\" className=\"flex items-center gap-1\">\n                            Titel\n                            <span className=\"text-red-500\">*</span>\n                          </Label>\n                          <Input\n                            id=\"hero-title\"\n                            value={heroImageForm.title}\n                            onChange={(e) => setHeroImageForm(prev => ({ ...prev, title: e.target.value }))}\n                            placeholder=\"z.B. Penticton Wine Country\"\n                            className={!heroImageForm.title ? \"border-red-200 focus:border-red-500\" : \"\"}\n                            data-testid=\"input-hero-title\"\n                          />\n                          {!heroImageForm.title && (\n                            <p className=\"text-xs text-red-500 mt-1\">Titel ist erforderlich</p>\n                          )}\n                        </div>\n                        <div>\n                          <Label htmlFor=\"hero-description\" className=\"flex items-center gap-1\">\n                            Beschreibung\n                            <span className=\"text-red-500\">*</span>\n                          </Label>\n                          <Input\n                            id=\"hero-description\"\n                            value={heroImageForm.description}\n                            onChange={(e) => setHeroImageForm(prev => ({ ...prev, description: e.target.value }))}\n                            placeholder=\"z.B. Naramata Bench Weinberge über dem Okanagan Lake\"\n                            className={!heroImageForm.description ? \"border-red-200 focus:border-red-500\" : \"\"}\n                            data-testid=\"input-hero-description\"\n                          />\n                          {!heroImageForm.description && (\n                            <p className=\"text-xs text-red-500 mt-1\">Beschreibung ist erforderlich</p>\n                          )}\n                        </div>\n                      </div>\n                      <div>\n                        <Label className=\"flex items-center gap-1\">\n                          Bild-URL\n                          <span className=\"text-red-500\">*</span>\n                        </Label>\n                        <ImageInput\n                          label=\"\"\n                          value={heroImageForm.imageUrl}\n                          onChange={(value) => setHeroImageForm(prev => ({ ...prev, imageUrl: value }))}\n                          placeholder=\"https://example.com/image.jpg\"\n                          testId=\"hero-image-url\"\n                        />\n                        {!heroImageForm.imageUrl && (\n                          <p className=\"text-xs text-red-500 mt-1\">Bild-URL ist erforderlich</p>\n                        )}\n                      </div>\n                      \n                      {/* Status message showing what's missing */}\n                      {(!heroImageForm.title || !heroImageForm.description || !heroImageForm.imageUrl) && (\n                        <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-md\">\n                          <div className=\"flex items-start gap-2\">\n                            <AlertCircle className=\"h-4 w-4 text-amber-600 mt-0.5\" />\n                            <div>\n                              <p className=\"text-sm text-amber-800 font-medium\">Fehlende Angaben</p>\n                              <p className=\"text-xs text-amber-700 mt-1\">\n                                Bitte fülle alle Pflichtfelder (*) aus, um das Hero-Bild hinzuzufügen.\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                      \n                      <div className=\"flex gap-2\">\n                        <Button\n                          onClick={() => {\n                            if (editingHeroImage) {\n                              updateHeroImageMutation.mutate({\n                                id: editingHeroImage.id,\n                                data: heroImageForm\n                              });\n                            } else {\n                              createHeroImageMutation.mutate({\n                                ...heroImageForm,\n                                sortOrder: (heroImages?.length || 0)\n                              });\n                            }\n                          }}\n                          disabled={!heroImageForm.title || !heroImageForm.description || !heroImageForm.imageUrl || createHeroImageMutation.isPending || updateHeroImageMutation.isPending}\n                          data-testid=\"button-save-hero-image\"\n                        >\n                          {createHeroImageMutation.isPending || updateHeroImageMutation.isPending \n                            ? \"Speichern...\" \n                            : editingHeroImage \n                              ? \"Änderungen speichern\" \n                              : \"Hero-Bild hinzufügen\"\n                          }\n                        </Button>\n                        {editingHeroImage && (\n                          <Button\n                            variant=\"outline\"\n                            onClick={() => {\n                              setEditingHeroImage(null);\n                              setHeroImageForm({ title: \"\", description: \"\", imageUrl: \"\" });\n                            }}\n                            data-testid=\"button-cancel-edit\"\n                          >\n                            Abbrechen\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  ) : (\n                    /* Bulk Upload Form */\n                    <div className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"bulk-title-prefix\">Titel-Präfix</Label>\n                          <Input\n                            id=\"bulk-title-prefix\"\n                            value={bulkUploadDefaults.titlePrefix}\n                            onChange={(e) => setBulkUploadDefaults(prev => ({ ...prev, titlePrefix: e.target.value }))}\n                            placeholder=\"z.B. Hero Bild\"\n                            data-testid=\"input-bulk-title-prefix\"\n                          />\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            Automatisch nummeriert: \"Hero Bild 1\", \"Hero Bild 2\", etc.\n                          </p>\n                        </div>\n                        <div>\n                          <Label htmlFor=\"bulk-description\">Standard-Beschreibung</Label>\n                          <Input\n                            id=\"bulk-description\"\n                            value={bulkUploadDefaults.description}\n                            onChange={(e) => setBulkUploadDefaults(prev => ({ ...prev, description: e.target.value }))}\n                            placeholder=\"z.B. Automatisch hochgeladenes Hero-Bild\"\n                            data-testid=\"input-bulk-description\"\n                          />\n                        </div>\n                      </div>\n                      \n                      <ImageInput\n                        label=\"Mehrere Bilder hochladen\"\n                        value=\"\"\n                        onChange={() => {}} // Not used in bulk mode\n                        allowMultiple={true}\n                        onMultipleChange={(urls) => setBulkImageUrls(urls)}\n                        placeholder=\"Mehrere Bilder auswählen...\"\n                        testId=\"bulk-hero-images\"\n                      />\n\n                      {bulkImageUrls.length > 0 && (\n                        <div className=\"space-y-3\">\n                          <h5 className=\"text-sm font-medium\">Vorschau ({bulkImageUrls.length} Bilder)</h5>\n                          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                            {bulkImageUrls.map((url, index) => (\n                              <div key={index} className=\"relative group\">\n                                <img\n                                  src={url}\n                                  alt={`Bulk upload ${index + 1}`}\n                                  className=\"w-full h-24 object-cover rounded border\"\n                                  data-testid={`bulk-preview-${index}`}\n                                />\n                                <div className=\"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center\">\n                                  <p className=\"text-white text-xs text-center\">\n                                    {bulkUploadDefaults.titlePrefix} {(heroImages?.length || 0) + index + 1}\n                                  </p>\n                                </div>\n                                <Button\n                                  variant=\"destructive\"\n                                  size=\"sm\"\n                                  className=\"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                  onClick={() => {\n                                    setBulkImageUrls(prev => prev.filter((_, i) => i !== index));\n                                  }}\n                                  data-testid={`button-remove-bulk-${index}`}\n                                >\n                                  <X className=\"w-3 h-3\" />\n                                </Button>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n\n                      <div className=\"flex gap-2\">\n                        <Button\n                          onClick={() => {\n                            if (bulkImageUrls.length > 0) {\n                              createBulkHeroImagesMutation.mutate(bulkImageUrls);\n                            }\n                          }}\n                          disabled={bulkImageUrls.length === 0 || !bulkUploadDefaults.titlePrefix || !bulkUploadDefaults.description || createBulkHeroImagesMutation.isPending}\n                          data-testid=\"button-save-bulk-hero-images\"\n                        >\n                          {createBulkHeroImagesMutation.isPending \n                            ? `Speichern (${bulkImageUrls.length})...` \n                            : `${bulkImageUrls.length} Hero-Bilder hinzufügen`\n                          }\n                        </Button>\n                        {bulkImageUrls.length > 0 && (\n                          <Button\n                            variant=\"outline\"\n                            onClick={() => setBulkImageUrls([])}\n                            data-testid=\"button-clear-bulk-images\"\n                          >\n                            Alle entfernen\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Hero Images List */}\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-medium\">Aktuelle Hero-Bilder ({heroImages?.length || 0})</h4>\n                  {heroImagesLoading ? (\n                    <div className=\"flex items-center justify-center py-8\" data-testid=\"hero-images-loading\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                    </div>\n                  ) : heroImages && heroImages.length > 0 ? (\n                    <div className=\"space-y-3\">\n                      {heroImages.map((image) => (\n                        <div key={image.id} className=\"flex items-center gap-4 p-4 border rounded-lg\" data-testid={`hero-image-${image.id}`}>\n                          <img \n                            src={image.imageUrl} \n                            alt={image.title}\n                            className=\"w-20 h-16 object-cover rounded\"\n                            onError={(e) => {\n                              e.currentTarget.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA4MCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjY0IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNCAyNEg1NlY0MEgyNFYyNFoiIGZpbGw9IiNEMUQ1REIiLz4KPC9zdmc+';\n                            }}\n                          />\n                          <div className=\"flex-1 min-w-0\">\n                            <h5 className=\"font-medium truncate\">{image.title}</h5>\n                            <p className=\"text-sm text-muted-foreground truncate\">{image.description}</p>\n                            <p className=\"text-xs text-muted-foreground\">Reihenfolge: {image.sortOrder + 1}</p>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setEditingHeroImage(image);\n                                setHeroImageForm({\n                                  title: image.title,\n                                  description: image.description,\n                                  imageUrl: image.imageUrl\n                                });\n                              }}\n                              data-testid={`button-edit-hero-${image.id}`}\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                if (confirm(\"Hero-Bild wirklich löschen?\")) {\n                                  deleteHeroImageMutation.mutate(image.id);\n                                }\n                              }}\n                              disabled={deleteHeroImageMutation.isPending}\n                              data-testid={`button-delete-hero-${image.id}`}\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"no-hero-images\">\n                      <Upload className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                      <p>Noch keine Hero-Bilder vorhanden</p>\n                      <p className=\"text-sm\">Füge das erste Hero-Bild für die Startseiten-Slideshow hinzu</p>\n                    </div>\n                  )}\n                </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Scenic Landscapes Management */}\n            <Card data-testid=\"scenic-landscapes-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('scenicLandscapes')}\n                data-testid=\"scenic-landscapes-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Spektakuläre Landschaften verwalten</CardTitle>\n                  {collapsedSections.scenicLandscapes ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.scenicLandscapes && (\n                <CardContent className=\"space-y-6\">\n                  {scenicContentLoading ? (\n                    <div className=\"text-center py-4 text-muted-foreground\">\n                      Landschaften werden geladen...\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {/* Title & Subtitle editing */}\n                      <div className=\"space-y-4\">\n                        <div>\n                          <Label htmlFor=\"scenic-title\" className=\"flex justify-between\">\n                            <span>Titel</span>\n                            <span className={`text-sm ${scenicTitle.length > 200 ? 'text-destructive' : 'text-muted-foreground'}`}>\n                              {scenicTitle.length}/200\n                            </span>\n                          </Label>\n                          <Input\n                            id=\"scenic-title\"\n                            value={scenicTitle}\n                            onChange={(e) => {\n                              if (e.target.value.length <= 200) {\n                                setScenicTitle(e.target.value);\n                              } else {\n                                toast({\n                                  title: \"Fehler\",\n                                  description: \"Titel ist zu lang (maximal 200 Zeichen)\",\n                                  variant: \"destructive\",\n                                });\n                              }\n                            }}\n                            placeholder=\"Spektakuläre Landschaften erwarten uns\"\n                            data-testid=\"input-scenic-title\"\n                            className={scenicTitle.length > 200 ? 'border-destructive' : ''}\n                          />\n                        </div>\n                        <div>\n                          <Label htmlFor=\"scenic-subtitle\" className=\"flex justify-between\">\n                            <span>Untertitel</span>\n                            <span className={`text-sm ${scenicSubtitle.length > 300 ? 'text-destructive' : 'text-muted-foreground'}`}>\n                              {scenicSubtitle.length}/300\n                            </span>\n                          </Label>\n                          <Textarea\n                            id=\"scenic-subtitle\"\n                            value={scenicSubtitle}\n                            onChange={(e) => {\n                              if (e.target.value.length <= 300) {\n                                setScenicSubtitle(e.target.value);\n                              } else {\n                                toast({\n                                  title: \"Fehler\",\n                                  description: \"Untertitel ist zu lang (maximal 300 Zeichen)\",\n                                  variant: \"destructive\",\n                                });\n                              }\n                            }}\n                            placeholder=\"Von den türkisfarbenen Seen des Okanagan-Tals bis zu den majestätischen Gipfeln der Rocky Mountains - jeder Ort ist ein Fotomotiv\"\n                            rows={3}\n                            data-testid=\"textarea-scenic-subtitle\"\n                            className={scenicSubtitle.length > 300 ? 'border-destructive' : ''}\n                          />\n                        </div>\n                      </div>\n\n                      {/* Gallery Items */}\n                      <div className=\"space-y-4\">\n                        <h4 className=\"font-semibold flex items-center gap-2\">\n                          <span>📸</span>\n                          Galerie-Bilder (6 Stück)\n                        </h4>\n                        {galleries?.map((gallery, index) => (\n                          <Card key={gallery.id} className=\"border-l-4 border-l-primary/20\">\n                            <CardContent className=\"p-4\">\n                              <div className=\"grid gap-4\">\n                                <div className=\"flex items-center justify-between\">\n                                  <Label className=\"font-semibold\">\n                                    Bild {index + 1} {gallery.isLarge && \"(Groß - 2x2)\"}\n                                  </Label>\n                                  <div className=\"flex items-center gap-2\">\n                                    <input\n                                      type=\"checkbox\"\n                                      checked={gallery.isLarge}\n                                      onChange={(e) => {\n                                        if (e.target.checked) {\n                                          // Ensure only one large image\n                                          const updatedGalleries = galleries.map(g => \n                                            g.id === gallery.id ? { ...g, isLarge: true } : { ...g, isLarge: false }\n                                          );\n                                          setGalleries(updatedGalleries);\n                                        } else {\n                                          // Don't allow unchecking if it's the only large image\n                                          const largeCount = galleries.filter(g => g.isLarge).length;\n                                          if (largeCount <= 1) {\n                                            toast({\n                                              title: \"Fehler\",\n                                              description: \"Mindestens ein großes Bild ist erforderlich\",\n                                              variant: \"destructive\",\n                                            });\n                                            return;\n                                          }\n                                          const updatedGalleries = galleries.map(g => \n                                            g.id === gallery.id ? { ...g, isLarge: false } : g\n                                          );\n                                          setGalleries(updatedGalleries);\n                                        }\n                                      }}\n                                      data-testid={`checkbox-large-${index}`}\n                                    />\n                                    <Label className=\"text-sm\">Großes Bild</Label>\n                                  </div>\n                                </div>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                  <div>\n                                    <Label htmlFor={`gallery-title-${index}`}>Titel</Label>\n                                    <Input\n                                      id={`gallery-title-${index}`}\n                                      placeholder=\"z.B. Penticton Wine Country\"\n                                      value={gallery.title}\n                                      onChange={(e) => {\n                                        const updatedGalleries = galleries.map(g => \n                                          g.id === gallery.id ? { ...g, title: e.target.value } : g\n                                        );\n                                        setGalleries(updatedGalleries);\n                                      }}\n                                      data-testid={`input-gallery-title-${index}`}\n                                    />\n                                  </div>\n                                  <div>\n                                    <Label htmlFor={`gallery-description-${index}`}>Beschreibung</Label>\n                                    <Input\n                                      id={`gallery-description-${index}`}\n                                      placeholder=\"z.B. Okanagan Valley mit über 170 Weingütern\"\n                                      value={gallery.description}\n                                      onChange={(e) => {\n                                        const updatedGalleries = galleries.map(g => \n                                          g.id === gallery.id ? { ...g, description: e.target.value } : g\n                                        );\n                                        setGalleries(updatedGalleries);\n                                      }}\n                                      data-testid={`input-gallery-description-${index}`}\n                                    />\n                                  </div>\n                                </div>\n                                <div>\n                                  <Label htmlFor={`gallery-imageurl-${index}`}>Bild URL</Label>\n                                  <Input\n                                    id={`gallery-imageurl-${index}`}\n                                    placeholder=\"https://images.unsplash.com/...\"\n                                    value={gallery.imageUrl}\n                                    onChange={(e) => {\n                                      const updatedGalleries = galleries.map(g => \n                                        g.id === gallery.id ? { ...g, imageUrl: e.target.value } : g\n                                      );\n                                      setGalleries(updatedGalleries);\n                                    }}\n                                    data-testid={`input-gallery-imageurl-${index}`}\n                                  />\n                                </div>\n                                <div>\n                                  <Label htmlFor={`gallery-linkurl-${index}`}>Link URL (optional)</Label>\n                                  <Input\n                                    id={`gallery-linkurl-${index}`}\n                                    placeholder=\"/location/penticton oder externe URL\"\n                                    value={gallery.linkUrl || \"\"}\n                                    onChange={(e) => {\n                                      const updatedGalleries = galleries.map(g => \n                                        g.id === gallery.id ? { ...g, linkUrl: e.target.value } : g\n                                      );\n                                      setGalleries(updatedGalleries);\n                                    }}\n                                    data-testid={`input-gallery-linkurl-${index}`}\n                                  />\n                                </div>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n\n                      {/* Save Button */}\n                      <Button\n                        onClick={() => {\n                          updateScenicContentMutation.mutate({\n                            title: scenicTitle,\n                            subtitle: scenicSubtitle,\n                            galleries: galleries,\n                          });\n                        }}\n                        disabled={updateScenicContentMutation.isPending}\n                        className=\"w-full\"\n                        data-testid=\"button-update-scenic-content\"\n                      >\n                        {updateScenicContentMutation.isPending ? \"Aktualisiere...\" : \"🏞️ Landschaften aktualisieren\"}\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Restaurant & Accommodation Management */}\n            <Card data-testid=\"restaurant-accommodation-card\" className=\"border-2 border-orange-200 bg-orange-50 dark:bg-orange-950/20 dark:border-orange-800\">\n              <CardHeader \n                className=\"cursor-pointer hover:bg-orange-100 dark:hover:bg-orange-950/40 transition-colors\"\n                onClick={() => toggleSection('restaurantAccommodation')}\n                data-testid=\"restaurant-accommodation-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-xl font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2\">\n                      <Hotel className=\"w-6 h-6\" />\n                      🏨🍽️ Restaurant & Unterkunft verwalten\n                    </CardTitle>\n                    <p className=\"text-orange-700 dark:text-orange-300 text-sm\">\n                      Verwalte Restaurants und Unterkünfte für jeden Ort deiner Tour-Route.\n                    </p>\n                  </div>\n                  {collapsedSections.restaurantAccommodation ? \n                    <ChevronDown className=\"w-4 h-4 text-orange-800 dark:text-orange-200\" /> : \n                    <ChevronUp className=\"w-4 h-4 text-orange-800 dark:text-orange-200\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.restaurantAccommodation && (\n                <CardContent>\n                <div className=\"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-4\">\n                  <div className=\"flex items-center gap-2 text-blue-800 dark:text-blue-200 mb-2\">\n                    <AlertCircle className=\"w-5 h-5\" />\n                    <span className=\"font-medium\">So funktioniert's:</span>\n                  </div>\n                  <p className=\"text-blue-700 dark:text-blue-300 text-sm\">\n                    Klicken Sie auf \"Bearbeiten\" bei einem Ort unten, um Restaurants und Unterkünfte hinzuzufügen.\n                    Im Bearbeitungsfenster finden Sie prominent die Restaurant & Unterkunft-Verwaltung.\n                  </p>\n                </div>\n                \n                {locations && locations.length > 0 && (\n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium text-orange-800 dark:text-orange-200\">Quick-Access zu Orten:</h4>\n                    <div className=\"grid gap-3\">\n                      {locations.map((location) => {\n                        const hasRestaurants = location.restaurants && location.restaurants.length > 0;\n                        const hasAccommodation = location.accommodation && location.accommodation.trim() !== '';\n                        \n                        return (\n                          <div key={location.id} className=\"bg-white dark:bg-gray-800 border border-orange-200 dark:border-orange-700 rounded-lg p-4\" data-testid={`quick-access-location-${location.slug}`}>\n                            <div className=\"flex items-center justify-between\">\n                              <div className=\"flex-1\">\n                                <h3 className=\"font-medium text-gray-900 dark:text-gray-100\">{location.name}</h3>\n                                <div className=\"flex items-center gap-4 mt-2 text-sm\">\n                                  <div className=\"flex items-center gap-1\">\n                                    <Hotel className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                                    <span className={`${hasAccommodation ? 'text-green-600 dark:text-green-400' : 'text-gray-400'}`}>\n                                      {hasAccommodation ? 'Unterkunft ✓' : 'Keine Unterkunft'}\n                                    </span>\n                                  </div>\n                                  <div className=\"flex items-center gap-1\">\n                                    <UtensilsCrossed className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n                                    <span className={`${hasRestaurants ? 'text-green-600 dark:text-green-400' : 'text-gray-400'}`}>\n                                      {hasRestaurants ? `${location.restaurants?.length || 0} Restaurant(s) ✓` : 'Keine Restaurants'}\n                                    </span>\n                                  </div>\n                                </div>\n                              </div>\n                              <Button\n                                onClick={() => {\n                                  setSelectedLocation(location);\n                                  setShowLocationForm(true);\n                                }}\n                                className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n                                size=\"sm\"\n                                data-testid={`quick-edit-${location.slug}`}\n                              >\n                                <Edit className=\"w-4 h-4 mr-1\" />\n                                Restaurants & Unterkunft bearbeiten\n                              </Button>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                )}\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Privacy Settings */}\n            <Card data-testid=\"privacy-settings-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('privacySettings')}\n                data-testid=\"privacy-settings-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Privacy-Einstellungen</CardTitle>\n                  {collapsedSections.privacySettings ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.privacySettings && (\n                <CardContent className=\"space-y-6\">\n                {/* Privacy Toggle */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"privacy-enabled\">Privacy-Login aktivieren</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Wenn aktiviert, ist ein Passwort erforderlich, um die Tour zu sehen\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"privacy-enabled\"\n                    checked={tourSettings?.privacyEnabled || false}\n                    onCheckedChange={(checked) => {\n                      updatePrivacySettingsMutation.mutate({ privacyEnabled: checked });\n                    }}\n                    data-testid=\"switch-privacy-enabled\"\n                  />\n                </div>\n\n                {/* Password Section - only show when privacy is enabled */}\n                {tourSettings?.privacyEnabled && (\n                  <>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"privacy-password\">Privacy-Passwort</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"privacy-password\"\n                          type={showPassword ? \"text\" : \"password\"}\n                          value={privacyPassword}\n                          onChange={(e) => setPrivacyPassword(e.target.value)}\n                          placeholder=\"Neues Passwort eingeben...\"\n                          className=\"pr-10\"\n                          data-testid=\"input-privacy-password\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                          onClick={() => setShowPassword(!showPassword)}\n                          data-testid=\"button-toggle-password-visibility\"\n                        >\n                          {showPassword ? (\n                            <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4 text-gray-400\" />\n                          )}\n                        </Button>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          onClick={() => {\n                            if (privacyPassword.trim()) {\n                              updatePrivacySettingsMutation.mutate({ privacyPassword: privacyPassword.trim() });\n                            }\n                          }}\n                          disabled={!privacyPassword.trim() || updatePrivacySettingsMutation.isPending}\n                          size=\"sm\"\n                          data-testid=\"button-save-password\"\n                        >\n                          {updatePrivacySettingsMutation.isPending ? \"Speichern...\" : \"Passwort speichern\"}\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setPrivacyPassword(\"\")}\n                          size=\"sm\"\n                          data-testid=\"button-clear-password\"\n                        >\n                          Leeren\n                        </Button>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Das Passwort wird sicher gehasht gespeichert. Leer lassen, um das aktuelle Passwort zu behalten.\n                      </p>\n                    </div>\n\n                    {/* Session Timeout */}\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"session-timeout\">Session-Timeout (Minuten)</Label>\n                      <Select\n                        value={(tourSettings?.sessionTimeout || 10080).toString()}\n                        onValueChange={(value) => {\n                          updatePrivacySettingsMutation.mutate({ sessionTimeout: parseInt(value) });\n                        }}\n                      >\n                        <SelectTrigger data-testid=\"select-session-timeout\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"60\">1 Stunde</SelectItem>\n                          <SelectItem value=\"360\">6 Stunden</SelectItem>\n                          <SelectItem value=\"720\">12 Stunden</SelectItem>\n                          <SelectItem value=\"1440\">1 Tag</SelectItem>\n                          <SelectItem value=\"4320\">3 Tage</SelectItem>\n                          <SelectItem value=\"10080\">7 Tage (Standard)</SelectItem>\n                          <SelectItem value=\"20160\">14 Tage</SelectItem>\n                          <SelectItem value=\"43200\">30 Tage</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Wie lange sollen Nutzer eingeloggt bleiben?\n                      </p>\n                    </div>\n                  </>\n                )}\n\n                {/* Current Status */}\n                <div className=\"bg-muted p-2 rounded\">\n                  <p className=\"text-sm\">\n                    Status: {tourSettings?.privacyEnabled ? \"Privacy aktiviert\" : \"Öffentlich zugänglich\"}\n                  </p>\n                  {tourSettings?.privacyEnabled && (\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Session-Timeout: {Math.floor((tourSettings?.sessionTimeout || 10080) / 1440)} Tag(e)\n                    </p>\n                  )}\n                </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* GPS Settings */}\n            <Card data-testid=\"gps-settings-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('gpsSettings')}\n                data-testid=\"gps-settings-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">GPS Live-Tracking Einstellungen</CardTitle>\n                  {collapsedSections.gpsSettings ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.gpsSettings && (\n                <CardContent className=\"space-y-6\">\n                {/* GPS Toggle */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-1\">\n                    <Label htmlFor=\"gps-activated\">GPS Live-Tracking für alle aktivieren</Label>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Wenn aktiviert, läuft GPS automatisch für alle Besucher - keine GPS-Berechtigung erforderlich\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"gps-activated\"\n                    checked={tourSettings?.gpsActivatedByAdmin || false}\n                    onCheckedChange={(checked) => {\n                      updateTourSettingsMutation.mutate({ gpsActivatedByAdmin: checked });\n                    }}\n                    data-testid=\"switch-gps-activated\"\n                  />\n                </div>\n\n                {/* GPS Status */}\n                <div className=\"bg-muted p-2 rounded\">\n                  <p className=\"text-sm\">\n                    Status: {tourSettings?.gpsActivatedByAdmin ? \"GPS Live-Tracking aktiv\" : \"GPS manuell aktivierbar\"}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {tourSettings?.gpsActivatedByAdmin \n                      ? \"Das Live-Auto wird automatisch auf der Timeline angezeigt\" \n                      : \"Besucher können GPS-Tracking manuell aktivieren\"\n                    }\n                  </p>\n                </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Creator Management */}\n            <Card data-testid=\"creator-management-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('creatorManagement')}\n                data-testid=\"creator-management-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Personen verwalten</CardTitle>\n                  {collapsedSections.creatorManagement ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.creatorManagement && (\n                <CardContent className=\"space-y-6\">\n                  {/* Add New Creator */}\n                  <div className=\"space-y-3\">\n                    <h3 className=\"text-sm font-medium\">Neue Person hinzufügen</h3>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        placeholder=\"Name der Person\"\n                        value={creatorName}\n                        onChange={(e) => setCreatorName(e.target.value)}\n                        onKeyPress={(e) => {\n                          if (e.key === 'Enter' && creatorName.trim()) {\n                            createCreatorMutation.mutate(creatorName.trim());\n                          }\n                        }}\n                        data-testid=\"input-creator-name\"\n                      />\n                      <Button\n                        onClick={() => {\n                          if (creatorName.trim()) {\n                            createCreatorMutation.mutate(creatorName.trim());\n                          }\n                        }}\n                        disabled={!creatorName.trim() || createCreatorMutation.isPending}\n                        data-testid=\"button-add-creator\"\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        Hinzufügen\n                      </Button>\n                    </div>\n                  </div>\n\n                  {/* List of Creators */}\n                  <div className=\"space-y-3\">\n                    <h3 className=\"text-sm font-medium\">Vorhandene Personen</h3>\n                    {creatorsLoading ? (\n                      <div className=\"text-center py-4 text-muted-foreground\">\n                        Personen werden geladen...\n                      </div>\n                    ) : creators && creators.length > 0 ? (\n                      <div className=\"space-y-2\">\n                        {creators.map((creator) => (\n                          <div key={creator.id} className=\"flex items-center justify-between border p-2 rounded\" data-testid={`creator-item-${creator.id}`}>\n                            {editingCreator?.id === creator.id ? (\n                              <div className=\"flex gap-2 flex-1\">\n                                <Input\n                                  value={editingCreatorName}\n                                  onChange={(e) => setEditingCreatorName(e.target.value)}\n                                  onKeyPress={(e) => {\n                                    if (e.key === 'Enter' && editingCreatorName.trim()) {\n                                      updateCreatorMutation.mutate({ id: creator.id, name: editingCreatorName.trim() });\n                                    }\n                                  }}\n                                  data-testid={`input-edit-creator-${creator.id}`}\n                                />\n                                <Button\n                                  size=\"sm\"\n                                  onClick={() => {\n                                    if (editingCreatorName.trim()) {\n                                      updateCreatorMutation.mutate({ id: creator.id, name: editingCreatorName.trim() });\n                                    }\n                                  }}\n                                  disabled={!editingCreatorName.trim() || updateCreatorMutation.isPending}\n                                  data-testid={`button-save-creator-${creator.id}`}\n                                >\n                                  Speichern\n                                </Button>\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"outline\"\n                                  onClick={() => {\n                                    setEditingCreator(null);\n                                    setEditingCreatorName(\"\");\n                                  }}\n                                  data-testid={`button-cancel-edit-${creator.id}`}\n                                >\n                                  Abbrechen\n                                </Button>\n                              </div>\n                            ) : (\n                              <>\n                                <span className=\"font-medium\">{creator.name}</span>\n                                <div className=\"flex gap-2\">\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"outline\"\n                                    onClick={() => {\n                                      setEditingCreator(creator);\n                                      setEditingCreatorName(creator.name);\n                                    }}\n                                    data-testid={`button-edit-creator-${creator.id}`}\n                                  >\n                                    <Edit className=\"w-4 h-4\" />\n                                  </Button>\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"destructive\"\n                                    onClick={() => {\n                                      if (confirm(`Möchten Sie \"${creator.name}\" wirklich löschen?`)) {\n                                        deleteCreatorMutation.mutate(creator.id);\n                                      }\n                                    }}\n                                    disabled={deleteCreatorMutation.isPending}\n                                    data-testid={`button-delete-creator-${creator.id}`}\n                                  >\n                                    <Trash2 className=\"w-4 h-4\" />\n                                  </Button>\n                                </div>\n                              </>\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-4 text-muted-foreground\">\n                        Keine Personen vorhanden. Fügen Sie oben eine neue Person hinzu.\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n\n\n            {/* Image Management - Fixed and moved from sidebar */}\n            <Card data-testid=\"image-management-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('imageManagement')}\n                data-testid=\"image-management-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-base font-medium\">Bilder für Orte verwalten</CardTitle>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Lade Bilder hoch und verwalte die Bildergalerien für jeden Ort deiner Tour.\n                    </p>\n                  </div>\n                  {collapsedSections.imageManagement ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.imageManagement && (\n                <CardContent className=\"space-y-6\">\n                  {!selectedLocation ? (\n                    <div className=\"space-y-6\">\n                      {/* Modern Header Section */}\n                      <div className=\"text-center max-w-md mx-auto\">\n                        <h3 className=\"text-sm font-medium mb-2\">\n                          Ort für Bilderverwaltung auswählen\n                        </h3>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Wählen Sie einen Ort aus, um dessen Bilder zu verwalten. Sie können Bilder hochladen, bearbeiten und als Hauptbild festlegen.\n                        </p>\n                      </div>\n                      \n                      {/* Location Grid */}\n                      {locations && locations.length > 0 ? (\n                        <div className=\"grid gap-4\">\n                          {locations.map((location) => (\n                            <Card \n                              key={location.id} \n                              className=\"cursor-pointer hover:border-primary\" \n                              onClick={() => setSelectedLocation(location)}\n                              data-testid={`select-location-${location.slug}`}\n                            >\n                              <CardContent className=\"p-3\">\n                                <div className=\"flex items-center justify-between\">\n                                  <div className=\"flex-1\">\n                                    <h4 className=\"font-medium text-sm\">\n                                      {location.name}\n                                    </h4>\n                                    <p className=\"text-xs text-muted-foreground\">\n                                      {location.startDate} - {location.endDate}\n                                    </p>\n                                    {location.description && (\n                                      <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                                        {location.description}\n                                      </p>\n                                    )}\n                                  </div>\n                                  <ArrowLeft className=\"w-4 h-4 rotate-180 text-muted-foreground\" />\n                                </div>\n                              </CardContent>\n                            </Card>\n                          ))}\n                        </div>\n                      ) : (\n                        <div className=\"text-center py-12\">\n                          <div className=\"mx-auto w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\n                            <Star className=\"w-10 h-10 text-muted-foreground/50\" />\n                          </div>\n                          <h4 className=\"font-medium text-foreground mb-2\">Noch keine Orte vorhanden</h4>\n                          <p className=\"text-sm text-muted-foreground mb-4\">\n                            Erstellen Sie zuerst einen Ort, um Bilder hochladen zu können\n                          </p>\n                          <Button \n                            variant=\"outline\" \n                            onClick={() => navigateToSection('locationsManagement', 'locations-management-card')}\n                            data-testid=\"button-create-location\"\n                          >\n                            <Plus className=\"w-4 h-4 mr-2\" />\n                            Ort erstellen\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {/* Clean Location Header */}\n                      <Card className=\"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-950/50 dark:to-blue-900/30 border-blue-200 dark:border-blue-700\">\n                        <CardContent className=\"p-6\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-4\">\n                              <div className=\"w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center\">\n                                <Camera className=\"w-6 h-6 text-white\" />\n                              </div>\n                              <div>\n                                <h2 className=\"text-xl font-bold text-blue-900 dark:text-blue-100 mb-1\">\n                                  {selectedLocation.name}\n                                </h2>\n                                <p className=\"text-blue-700 dark:text-blue-300 text-sm flex items-center gap-2\">\n                                  📅 {selectedLocation.startDate} - {selectedLocation.endDate}\n                                </p>\n                              </div>\n                            </div>\n                            <Button\n                              variant=\"outline\"\n                              onClick={() => setSelectedLocation(null)}\n                              size=\"default\"\n                              className=\"bg-white/80 hover:bg-white dark:bg-blue-900/50 dark:hover:bg-blue-900\"\n                              data-testid=\"button-back-to-location-list\"\n                            >\n                              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                              Anderen Ort wählen\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                      \n                      {/* Image Gallery */}\n                      <ImageGallery \n                        locationId={selectedLocation.id} \n                        isAdmin={true}\n                        className=\"shadow-sm\"\n                      />\n                    </div>\n                  )}\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Locations Management */}\n            <Card data-testid=\"locations-management-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('locationsManagement')}\n                data-testid=\"locations-management-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Orte verwalten</CardTitle>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      onClick={(e) => {\n                        e.stopPropagation(); // Prevent header toggle when clicking button\n                        setSelectedLocation(null);\n                        setShowLocationForm(true);\n                      }}\n                      data-testid=\"button-add-location\"\n                      size=\"sm\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Ort hinzufügen\n                    </Button>\n                    {collapsedSections.locationsManagement ? \n                      <ChevronDown className=\"w-4 h-4\" /> : \n                      <ChevronUp className=\"w-4 h-4\" />\n                    }\n                  </div>\n                </div>\n              </CardHeader>\n              {!collapsedSections.locationsManagement && (\n                <CardContent>\n                <div className=\"space-y-4\">\n                  {locations?.map((location) => (\n                    <div key={location.id} className=\"flex items-center justify-between p-4 border border-border rounded-lg\" data-testid={`location-item-${location.slug}`}>\n                      <div>\n                        <h3 className=\"font-medium\">{location.name}</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {location.startDate} - {location.endDate}\n                        </p>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedLocation(location);\n                            setShowLocationForm(true);\n                          }}\n                          data-testid={`button-edit-${location.slug}`}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => deleteLocationMutation.mutate(location.id)}\n                          data-testid={`button-delete-${location.slug}`}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Privacy Settings */}\n            <Card data-testid=\"privacy-settings-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('privacySettings')}\n                data-testid=\"privacy-settings-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Privacy-Einstellungen</CardTitle>\n                  {collapsedSections.privacySettings ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.privacySettings && (\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <Label htmlFor=\"privacy-enabled\">Privacy-Schutz aktivieren</Label>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Aktiviert Passwort-Schutz für die gesamte Tour-Website\n                      </p>\n                    </div>\n                    <Switch \n                      id=\"privacy-enabled\"\n                      checked={tourSettings?.privacyEnabled || false}\n                      onCheckedChange={(checked) => {\n                        updatePrivacySettingsMutation.mutate({ privacyEnabled: checked });\n                      }}\n                      data-testid=\"switch-privacy-enabled\"\n                    />\n                  </div>\n                  \n                  {tourSettings?.privacyEnabled && (\n                    <>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"privacy-password\">Privacy-Passwort</Label>\n                        <div className=\"flex\">\n                          <Input\n                            id=\"privacy-password\"\n                            type={showPassword ? \"text\" : \"password\"}\n                            value={privacyPassword}\n                            onChange={(e) => setPrivacyPassword(e.target.value)}\n                            placeholder=\"Neues Passwort eingeben\"\n                            data-testid=\"input-privacy-password\"\n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"icon\"\n                            className=\"ml-2\"\n                            onClick={() => setShowPassword(!showPassword)}\n                            data-testid=\"button-toggle-password-visibility\"\n                          >\n                            {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                          </Button>\n                        </div>\n                      </div>\n                      \n                      <div>\n                        <Label htmlFor=\"session-timeout\">Session-Timeout (Minuten)</Label>\n                        <Input\n                          id=\"session-timeout\"\n                          type=\"number\"\n                          defaultValue={tourSettings?.sessionTimeout || 60}\n                          onBlur={(e) => {\n                            updatePrivacySettingsMutation.mutate({ sessionTimeout: parseInt(e.target.value) || 60 });\n                          }}\n                          data-testid=\"input-session-timeout\"\n                        />\n                      </div>\n                      \n                      <Button\n                        onClick={() => {\n                          if (privacyPassword.trim()) {\n                            updatePrivacySettingsMutation.mutate({ privacyPassword: privacyPassword });\n                          }\n                        }}\n                        disabled={!privacyPassword.trim() || updatePrivacySettingsMutation.isPending}\n                        data-testid=\"button-save-privacy-password\"\n                      >\n                        {updatePrivacySettingsMutation.isPending ? \"Speichern...\" : \"Passwort speichern\"}\n                      </Button>\n                    </>\n                  )}\n                </CardContent>\n              )}\n            </Card>\n\n            {/* GPS Settings */}\n            <Card data-testid=\"gps-settings-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('gpsSettings')}\n                data-testid=\"gps-settings-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">GPS Live-Tracking</CardTitle>\n                  {collapsedSections.gpsSettings ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.gpsSettings && (\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <Label htmlFor=\"gps-enabled\">Live GPS-Tracking aktivieren</Label>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Zeigt die aktuelle Position der Tour in Echtzeit an\n                      </p>\n                    </div>\n                    <Switch \n                      id=\"gps-enabled\"\n                      checked={tourSettings?.gpsActivatedByAdmin || false}\n                      onCheckedChange={(checked) => {\n                        updateTourSettingsMutation.mutate({ gpsActivatedByAdmin: checked });\n                      }}\n                      data-testid=\"switch-gps-enabled\"\n                    />\n                  </div>\n                  \n                  <div>\n                    <Label htmlFor=\"gps-update-interval\">Update-Intervall (Sekunden)</Label>\n                    <Input\n                      id=\"gps-update-interval\"\n                      type=\"number\"\n                      defaultValue={tourSettings?.gpsUpdateInterval || 30}\n                      onBlur={(e) => {\n                        updateTourSettingsMutation.mutate({ gpsUpdateInterval: parseInt(e.target.value) || 30 });\n                      }}\n                      data-testid=\"input-gps-update-interval\"\n                    />\n                  </div>\n                  \n                  <div className=\"bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-2 text-yellow-800 dark:text-yellow-200 mb-2\">\n                      <AlertCircle className=\"w-5 h-5\" />\n                      <span className=\"font-medium\">GPS Live-Tracking Info:</span>\n                    </div>\n                    <p className=\"text-yellow-700 dark:text-yellow-300 text-sm\">\n                      Das GPS-Tracking funktioniert nur, wenn Location-Services im Browser aktiviert sind. \n                      Die Position wird automatisch auf der Live-Feed Seite angezeigt.\n                    </p>\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* Quick Actions */}\n            <Card data-testid=\"quick-actions-card\">\n              <CardHeader \n                className=\"cursor-pointer py-3\"\n                onClick={() => toggleSection('quickActions')}\n                data-testid=\"quick-actions-header\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-base font-medium\">Schnellaktionen</CardTitle>\n                  {collapsedSections.quickActions ? \n                    <ChevronDown className=\"w-4 h-4\" /> : \n                    <ChevronUp className=\"w-4 h-4\" />\n                  }\n                </div>\n              </CardHeader>\n              {!collapsedSections.quickActions && (\n                <CardContent className=\"space-y-2\">\n                  <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-export\">\n                    📱 Daten exportieren\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full justify-start\"\n                    onClick={() => {\n                      queryClient.invalidateQueries();\n                      toast({\n                        title: \"Cache geleert\",\n                        description: \"Alle Daten wurden neu geladen\",\n                      });\n                    }}\n                    data-testid=\"button-clear-cache\"\n                  >\n                    🔄 Cache leeren\n                  </Button>\n                  <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-statistics\">\n                    📊 Statistiken anzeigen\n                  </Button>\n                </CardContent>\n              )}\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      {/* Location Form Modal */}\n      {showLocationForm && (\n        <AdminLocationForm\n          location={selectedLocation}\n          onClose={() => {\n            setShowLocationForm(false);\n            setSelectedLocation(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":93495},"client/src/pages/Home.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Hero from \"@/components/Hero\";\nimport Timeline from \"@/components/Timeline\";\nimport LocationCard from \"@/components/LocationCard\";\nimport Header from \"@/components/Header\";\nimport { Lightbox } from \"@/components/Lightbox\";\nimport { Link } from \"wouter\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport type { Location, TourSettings, ScenicContent } from \"@shared/schema\";\n\nexport default function Home() {\n  const { t } = useLanguage();\n  \n  // Lightbox state\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n\n  const { data: locations, isLoading: locationsLoading } = useQuery<Location[]>({\n    queryKey: [\"/api/locations\"],\n  });\n\n  const { data: tourSettings } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  const { data: scenicContent } = useQuery<ScenicContent>({\n    queryKey: [\"/api/scenic-content\"],\n  });\n\n  // Prevent cache mutation by creating a new sorted array\n  const sortedGalleries = useMemo(() => {\n    return [...(scenicContent?.galleries ?? [])].sort((a, b) => a.order - b.order);\n  }, [scenicContent?.galleries]);\n\n  // Convert scenic gallery to lightbox format (only non-linked images for consistent UX)\n  const lightboxImages = useMemo(() => {\n    return sortedGalleries\n      .filter(gallery => !gallery.linkUrl) // Exclude linked galleries from lightbox\n      .map(gallery => ({\n        id: gallery.id,\n        imageUrl: gallery.imageUrl,\n        caption: `${gallery.title} - ${gallery.description}`\n      }));\n  }, [sortedGalleries]);\n\n  // Lightbox handlers with proper index clamping (no wrap-around to match Lightbox UI)\n  const openLightbox = (index: number) => {\n    // Map from sortedGalleries index to lightboxImages index\n    const galleryItemsUpToIndex = sortedGalleries.slice(0, index + 1);\n    const lightboxIndex = galleryItemsUpToIndex.filter(g => !g.linkUrl).length - 1;\n    setLightboxIndex(Math.max(0, lightboxIndex));\n    setLightboxOpen(true);\n  };\n\n  const closeLightbox = () => {\n    setLightboxOpen(false);\n  };\n\n  const nextImage = () => {\n    setLightboxIndex((prev) => Math.min(prev + 1, lightboxImages.length - 1));\n  };\n\n  const previousImage = () => {\n    setLightboxIndex((prev) => Math.max(prev - 1, 0));\n  };\n\n  if (locationsLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"home-page\">\n      <Header />\n\n      {/* Hero Section */}\n      <section id=\"home\">\n        <Hero tourSettings={tourSettings} />\n      </section>\n\n      {/* Quick Stats */}\n      <section className=\"py-16 bg-secondary\" data-testid=\"stats-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-8 text-center\">\n            <div className=\"animate-fade-in\" data-testid=\"stat-days\">\n              <div className=\"text-3xl font-bold text-primary mb-2\">17</div>\n              <div className=\"text-muted-foreground\">{t('travelDays')}</div>\n            </div>\n            <div className=\"animate-fade-in\" data-testid=\"stat-destinations\">\n              <div className=\"text-3xl font-bold text-primary mb-2\">{locations?.length || 7}</div>\n              <div className=\"text-muted-foreground\">{t('destinations')}</div>\n            </div>\n            <div className=\"animate-fade-in\" data-testid=\"stat-distance\">\n              <div className=\"text-3xl font-bold text-primary mb-2\">\n                {tourSettings?.totalDistance?.toLocaleString('de-DE') || '2.130'}\n              </div>\n              <div className=\"text-muted-foreground\">{t('kilometers')}</div>\n            </div>\n            <div className=\"animate-fade-in\" data-testid=\"stat-memories\">\n              <div className=\"text-3xl font-bold text-primary mb-2\">∞</div>\n              <div className=\"text-muted-foreground\">{t('memories')}</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Interactive Timeline */}\n      <section id=\"timeline\" className=\"py-20 bg-background\" data-testid=\"timeline-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-foreground mb-4\">{t('ourItinerary')}</h2>\n            <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n              {t('itineraryDescription')}\n            </p>\n          </div>\n          <Timeline locations={locations || []} />\n        </div>\n      </section>\n\n      {/* Featured Scenic Highlights */}\n      <section id=\"locations\" className=\"py-20 bg-secondary\" data-testid=\"locations-section\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-foreground mb-4\">\n              {scenicContent?.title || t('spectacularLandscapes')}\n            </h2>\n            <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n              {scenicContent?.subtitle || t('landscapeDescription')}\n            </p>\n          </div>\n\n          {/* Scenic Gallery Grid */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12\">\n            {sortedGalleries.map((gallery, index) => {\n                const GalleryContent = (\n                  <div className={`relative ${gallery.isLarge ? 'h-80 lg:h-full' : 'h-40 lg:h-48'} rounded-xl overflow-hidden group cursor-pointer`}>\n                    <img \n                      src={gallery.imageUrl}\n                      alt={gallery.title}\n                      className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n                      data-testid={`gallery-image-${index}`}\n                    />\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\"></div>\n                    <div className={`absolute ${gallery.isLarge ? 'bottom-6 left-6' : 'bottom-4 left-4'} text-white`}>\n                      <h3 className={`${gallery.isLarge ? 'text-2xl font-bold mb-2' : 'text-lg font-semibold'}`}>{gallery.title}</h3>\n                      <p className={`text-white/90 ${gallery.isLarge ? 'text-base' : 'text-sm'}`}>{gallery.description}</p>\n                    </div>\n                    {/* Click to expand indicator */}\n                    <div className=\"absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300\">\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7\" />\n                      </svg>\n                    </div>\n                  </div>\n                );\n\n                return (\n                  <div \n                    key={gallery.id} \n                    className={gallery.isLarge ? \"lg:col-span-2 lg:row-span-2\" : \"\"}\n                  >\n                    {gallery.linkUrl ? (\n                      <Link href={gallery.linkUrl}>\n                        <div className=\"cursor-pointer\">\n                          {GalleryContent}\n                        </div>\n                      </Link>\n                    ) : (\n                      <div \n                        onClick={() => openLightbox(index)}\n                        data-testid={`gallery-item-${index}`}\n                      >\n                        {GalleryContent}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n          </div>\n\n          {/* Location Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {locations?.slice(0, 6).map((location) => (\n              <LocationCard key={location.id} location={location} />\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-foreground text-background py-12\" data-testid=\"footer\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <div className=\"flex items-center justify-center space-x-3 mb-4\">\n              <div className=\"w-8 h-8 bg-primary rounded-lg flex items-center justify-center\">\n                <span className=\"text-primary-foreground font-bold text-sm\">WT</span>\n              </div>\n              <h3 className=\"text-xl font-semibold\">{tourSettings?.tourName || \"Kanada Tour 2025\"}</h3>\n            </div>\n            <p className=\"text-background/80 mb-6\">\n              {tourSettings?.description || t('unforgettableJourney')}\n            </p>\n            <div className=\"text-background/60 text-sm\">\n              {tourSettings?.startDate} - {tourSettings?.endDate} • {locations?.length} {t('destinations')} • {tourSettings?.totalDistance?.toLocaleString('de-DE')} km\n            </div>\n          </div>\n        </div>\n      </footer>\n\n      {/* Lightbox for scenic gallery images */}\n      <Lightbox\n        images={lightboxImages}\n        currentIndex={lightboxIndex}\n        isOpen={lightboxOpen}\n        onClose={closeLightbox}\n        onNext={nextImage}\n        onPrevious={previousImage}\n      />\n    </div>\n  );\n}\n","size_bytes":9657},"client/src/pages/LocationDetail.tsx":{"content":"import { useParams, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ArrowLeft, MapPin, Calendar, DollarSign, Camera } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ImageGallery } from \"@/components/ImageGallery\";\nimport Header from \"@/components/Header\";\nimport { calculateNights, formatNights } from \"@/lib/utils\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport type { Location } from \"@shared/schema\";\n\nexport default function LocationDetail() {\n  const { slug } = useParams<{ slug: string }>();\n  const [checkedActivities, setCheckedActivities] = useState<Set<number>>(new Set());\n  const { t, getLocationText, getLocationArray } = useLanguage();\n\n  const { data: location, isLoading } = useQuery<Location>({\n    queryKey: [\"/api/locations\", slug],\n  });\n\n  const toggleActivity = (index: number) => {\n    setCheckedActivities(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(index)) {\n        newSet.delete(index);\n      } else {\n        newSet.add(index);\n      }\n      return newSet;\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\" data-testid=\"loading-spinner\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!location) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\" data-testid=\"location-not-found\">\n        <Card className=\"w-full max-w-md mx-4\">\n          <CardContent className=\"pt-6 text-center\">\n            <h1 className=\"text-2xl font-bold text-foreground mb-4\">{t('locationNotFound')}</h1>\n            <p className=\"text-muted-foreground mb-4\">{t('locationNotFoundDescription')}</p>\n            <Link href=\"/\">\n              <Button>{t('backToHomepage')}</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" data-testid=\"location-detail\">\n      <Header />\n      {/* Location Header */}\n      <div className=\"bg-primary text-primary-foreground py-8\" data-testid=\"location-header\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center space-x-4 mb-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"text-primary-foreground hover:bg-primary-foreground/10\" data-testid=\"back-button\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                {t('backButton')}\n              </Button>\n            </Link>\n          </div>\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-2 pr-8\" data-testid=\"location-title\">\n            {getLocationText(location.name, location.nameEn)}\n          </h1>\n          <div className=\"flex flex-wrap gap-4 text-primary-foreground/90\">\n            <div className=\"flex items-center\">\n              <Calendar className=\"w-4 h-4 mr-2\" />\n              <span data-testid=\"location-dates\">{location.startDate} - {location.endDate}</span>\n            </div>\n            {location.distance && (\n              <div className=\"flex items-center\">\n                <MapPin className=\"w-4 h-4 mr-2\" />\n                <span data-testid=\"location-distance\">{location.distance} km</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-2 space-y-8\">\n            {/* Hero Image */}\n            {location.imageUrl && (\n              <div className=\"aspect-video rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-800\" data-testid=\"location-hero-image\">\n                <img \n                  src={location.imageUrl} \n                  alt={location.name}\n                  className=\"w-full h-full object-cover\"\n                  onError={(e) => {\n                    const target = e.target as HTMLImageElement;\n                    target.style.display = 'none';\n                    const fallback = target.nextElementSibling as HTMLElement;\n                    if (fallback) fallback.style.display = 'flex';\n                  }}\n                />\n                <div className=\"w-full h-full bg-gradient-to-br from-blue-400 to-green-400 hidden items-center justify-center\">\n                  <div className=\"text-center text-white\">\n                    <div className=\"w-16 h-16 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center\">\n                      <Camera className=\"w-8 h-8\" />\n                    </div>\n                    <p className=\"text-lg font-medium\">{location.name}</p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Image Gallery */}\n            <ImageGallery \n              locationId={location.id} \n              isAdmin={false}\n            />\n\n            {/* Map Snippet */}\n            {(location as any).mapImageUrl && (\n              <Card data-testid=\"location-map\">\n                <CardContent className=\"pt-6\">\n                  <h2 className=\"text-2xl font-bold text-foreground mb-4 flex items-center\">\n                    🗺️ <span className=\"ml-2\">{t('locationMap')}</span>\n                  </h2>\n                  <div className=\"rounded-xl overflow-hidden border border-border bg-gray-100 dark:bg-gray-800\">\n                    <img \n                      src={(location as any).mapImageUrl} \n                      alt={`Map of ${getLocationText(location.name, location.nameEn)}`}\n                      className=\"w-full h-64 object-cover\"\n                      data-testid=\"location-map-image\"\n                      onError={(e) => {\n                        const target = e.target as HTMLImageElement;\n                        target.style.display = 'none';\n                        const fallback = target.nextElementSibling as HTMLElement;\n                        if (fallback) fallback.style.display = 'flex';\n                      }}\n                    />\n                    <div className=\"w-full h-64 bg-gradient-to-br from-gray-400 to-gray-600 hidden items-center justify-center\">\n                      <div className=\"text-center text-white\">\n                        <div className=\"w-12 h-12 mx-auto mb-3 bg-white/20 rounded-full flex items-center justify-center\">\n                          <MapPin className=\"w-6 h-6\" />\n                        </div>\n                        <p className=\"text-sm font-medium\">Loading map...</p>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Description */}\n            <Card data-testid=\"location-description\">\n              <CardContent className=\"pt-6\">\n                <h2 className=\"text-2xl font-bold text-foreground mb-4\">\n                  {t('aboutLocation')} {getLocationText(location.name, location.nameEn)}\n                </h2>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  {getLocationText(location.description, location.descriptionEn)}\n                </p>\n              </CardContent>\n            </Card>\n\n            {/* Activities */}\n            {(getLocationArray(location.activities, location.activitiesEn).length > 0) && (\n              <Card data-testid=\"location-activities\">\n                <CardContent className=\"pt-6\">\n                  <h2 className=\"text-2xl font-bold text-foreground mb-4\">🎯 {t('activities')}</h2>\n                  <ul className=\"space-y-3\">\n                    {getLocationArray(location.activities, location.activitiesEn).map((activity, index) => (\n                      <li key={index} className=\"flex items-start\" data-testid={`activity-${index}`}>\n                        <label className=\"flex items-start cursor-pointer w-full\">\n                          <input\n                            type=\"checkbox\"\n                            checked={checkedActivities.has(index)}\n                            onChange={() => toggleActivity(index)}\n                            className=\"mt-2 mr-3 flex-shrink-0 text-primary focus:ring-primary\"\n                            data-testid={`activity-checkbox-${index}`}\n                          />\n                          <span className={`text-muted-foreground transition-all duration-200 ${checkedActivities.has(index) ? 'line-through opacity-60' : ''}`}>\n                            {activity}\n                          </span>\n                        </label>\n                      </li>\n                    ))}\n                  </ul>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Restaurants & Kulinarik */}\n            {location.restaurants && location.restaurants.length > 0 && (\n              <Card data-testid=\"location-restaurants\">\n                <CardContent className=\"pt-6\">\n                  <h2 className=\"text-2xl font-bold text-foreground mb-6\">🍽️ {t('restaurantsAndCulinary')}</h2>\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    {location.restaurants.map((restaurant, index) => (\n                      <div key={index} className=\"border border-border rounded-xl p-6 hover:shadow-lg transition-all duration-300 bg-gradient-to-br from-white to-gray-50/50\" data-testid={`restaurant-${index}`}>\n                        {/* Restaurant Image */}\n                        {restaurant.imageUrl && (\n                          <div className=\"mb-4 aspect-video rounded-lg overflow-hidden\">\n                            <img \n                              src={restaurant.imageUrl} \n                              alt={restaurant.name}\n                              className=\"w-full h-full object-cover hover:scale-105 transition-transform duration-300\"\n                              data-testid={`restaurant-image-${index}`}\n                            />\n                          </div>\n                        )}\n                        \n                        <div className=\"space-y-3\">\n                          <div>\n                            <h3 className=\"font-bold text-foreground text-xl mb-2\">{restaurant.name}</h3>\n                            <p className=\"text-muted-foreground leading-relaxed\">{restaurant.description}</p>\n                          </div>\n                          \n                          <div className=\"flex items-center gap-2\">\n                            {restaurant.cuisine && (\n                              <Badge variant=\"secondary\" className=\"text-sm px-3 py-1\">\n                                {restaurant.cuisine}\n                              </Badge>\n                            )}\n                          </div>\n                          \n                          {restaurant.websiteUrl && (\n                            <div className=\"pt-2\">\n                              <a \n                                href={restaurant.websiteUrl} \n                                target=\"_blank\" \n                                rel=\"noopener noreferrer\"\n                                className=\"inline-flex items-center bg-primary text-primary-foreground px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors shadow-sm\"\n                                data-testid={`restaurant-website-${index}`}\n                              >\n                                🌐 Website & Reservierung\n                                <svg className=\"w-4 h-4 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" />\n                                </svg>\n                              </a>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Experiences */}\n            {location.experiences && location.experiences.length > 0 && (\n              <Card data-testid=\"location-experiences\">\n                <CardContent className=\"pt-6\">\n                  <h2 className=\"text-2xl font-bold text-foreground mb-4\">✨ {t('specialExperiences')}</h2>\n                  <ul className=\"space-y-3\">\n                    {location.experiences.map((experience, index) => (\n                      <li key={index} className=\"flex items-start\" data-testid={`experience-${index}`}>\n                        <span className=\"w-2 h-2 bg-accent rounded-full mt-2 mr-3 flex-shrink-0\"></span>\n                        <span className=\"text-muted-foreground\">{experience}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Live Trip Feed - Link to Centralized Feed */}\n            <Card className=\"bg-gradient-to-br from-teal-50 to-cyan-50 border-teal-200\" data-testid=\"location-live-feed-link\">\n              <CardContent className=\"pt-6\">\n                <div className=\"text-center space-y-4\">\n                  <div className=\"text-4xl mb-2\">📸</div>\n                  <h2 className=\"text-2xl font-bold text-foreground\">\n                    Reise-Fotos teilen\n                  </h2>\n                  <p className=\"text-muted-foreground\">\n                    Teile deine besten Momente von {location.name} im zentralen Live-Feed\n                  </p>\n                  <Link href={`/live-feed?locationId=${location.id}&focus=first`}>\n                    <Button className=\"bg-teal-600 hover:bg-teal-700 text-white\" data-testid=\"button-go-to-live-feed\">\n                      🚗 Zum Live-Feed gehen\n                    </Button>\n                  </Link>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Enhanced Accommodation Details */}\n            {location.accommodation && (\n              <Card className=\"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10\" data-testid=\"location-accommodation\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"text-lg font-bold text-foreground flex items-center\">\n                      🏨 <span className=\"ml-2\">{t('yourAccommodation')}</span>\n                    </h3>\n                    <div className=\"bg-primary/20 text-primary px-2 py-1 rounded-full text-xs font-medium\">\n                      Premium\n                    </div>\n                  </div>\n                  \n                  {/* Accommodation Name with Image and Link */}\n                  <div className=\"mb-6 p-4 bg-white rounded-lg border border-primary/10 shadow-sm\">\n                    <div className=\"flex items-start gap-4\">\n                      {/* Accommodation Image */}\n                      {(location as any).accommodationImageUrl && (\n                        <img \n                          src={(location as any).accommodationImageUrl} \n                          alt={location.accommodation}\n                          className=\"w-20 h-20 object-cover rounded-lg flex-shrink-0\"\n                          data-testid=\"accommodation-image\"\n                        />\n                      )}\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-bold text-foreground text-base mb-2\">{location.accommodation}</h4>\n                        <p className=\"text-sm text-muted-foreground mb-3\">{t('accommodationDescription')}</p>\n                        {(location as any).accommodationWebsite && (\n                          <a \n                            href={(location as any).accommodationWebsite} \n                            target=\"_blank\" \n                            rel=\"noopener noreferrer\"\n                            className=\"inline-flex items-center bg-primary text-primary-foreground px-3 py-2 rounded-md text-sm font-medium hover:bg-primary/90 transition-colors\"\n                            data-testid=\"accommodation-website-link\"\n                          >\n                            🌐 Website & Reservierung\n                            <svg className=\"w-4 h-4 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" />\n                            </svg>\n                          </a>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Included Services */}\n                  <div className=\"bg-white rounded-lg p-4 mb-4 border border-primary/10\">\n                    <h5 className=\"text-sm font-bold text-foreground mb-3 flex items-center\">\n                      ✨ <span className=\"ml-2\">Inklusiv-Leistungen</span>\n                    </h5>\n                    <div className=\"space-y-2 text-sm text-muted-foreground\">\n                      {/* Always show the nights calculation first */}\n                      <div className=\"flex items-center\">\n                        <span className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></span>\n                        {formatNights(calculateNights(location.startDate, location.endDate))} Aufenthalt\n                      </div>\n                      {/* Dynamic inclusive services */}\n                      {location.accommodationInclusiveServices && location.accommodationInclusiveServices.length > 0 ? (\n                        location.accommodationInclusiveServices.map((service, index) => (\n                          <div key={index} className=\"flex items-center\" data-testid={`inclusive-service-${index}`}>\n                            <span className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></span>\n                            {service}\n                          </div>\n                        ))\n                      ) : (\n                        // Fallback services if no data exists\n                        <>\n                          <div className=\"flex items-center\">\n                            <span className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></span>\n                            Inkl. Frühstück\n                          </div>\n                          <div className=\"flex items-center\">\n                            <span className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></span>\n                            Kostenfreies WLAN\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Amenities */}\n                  <div className=\"mb-4\">\n                    <h5 className=\"text-sm font-bold text-foreground mb-3 flex items-center\">\n                      🛏️ <span className=\"ml-2\">Ausstattung</span>\n                    </h5>\n                    {location.accommodationAmenities && location.accommodationAmenities.length > 0 ? (\n                      <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground\">\n                        {location.accommodationAmenities.map((amenity, index) => (\n                          <div key={index} className=\"flex items-center\" data-testid={`amenity-${index}`}>\n                            <span className=\"w-1.5 h-1.5 bg-primary rounded-full mr-2\"></span>\n                            {amenity}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      // Fallback amenities if no data exists\n                      <div className=\"grid grid-cols-2 gap-2 text-xs text-muted-foreground\">\n                        <div className=\"flex items-center\">\n                          <span className=\"w-1.5 h-1.5 bg-primary rounded-full mr-2\"></span>\n                          Klimaanlage\n                        </div>\n                        <div className=\"flex items-center\">\n                          <span className=\"w-1.5 h-1.5 bg-primary rounded-full mr-2\"></span>\n                          Privates Bad\n                        </div>\n                        <div className=\"flex items-center\">\n                          <span className=\"w-1.5 h-1.5 bg-primary rounded-full mr-2\"></span>\n                          TV & Minibar\n                        </div>\n                        <div className=\"flex items-center\">\n                          <span className=\"w-1.5 h-1.5 bg-primary rounded-full mr-2\"></span>\n                          Concierge\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Check-in Information */}\n                  <div className=\"border-t border-primary/20 pt-4\">\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div className=\"text-center p-2 bg-white rounded border border-primary/10\" data-testid=\"check-in-info\">\n                        <span className=\"font-bold text-foreground block\">Check-in</span>\n                        <div className=\"text-primary font-medium\">\n                          {location.accommodationCheckinTime || \"15:00 Uhr\"}\n                        </div>\n                      </div>\n                      <div className=\"text-center p-2 bg-white rounded border border-primary/10\" data-testid=\"check-out-info\">\n                        <span className=\"font-bold text-foreground block\">Check-out</span>\n                        <div className=\"text-primary font-medium\">\n                          {location.accommodationCheckoutTime || \"11:00 Uhr\"}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n\n            {/* Highlights */}\n            {location.highlights && location.highlights.length > 0 && (\n              <Card data-testid=\"location-highlights\">\n                <CardContent className=\"pt-6\">\n                  <h3 className=\"font-semibold text-foreground mb-4\">🌟 {t('highlights')}</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {location.highlights.map((highlight, index) => (\n                      <Badge key={index} variant=\"outline\" className=\"text-xs\" data-testid={`highlight-${index}`}>\n                        {highlight}\n                      </Badge>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Fun Facts Section - Now for ALL locations */}\n            <Card className=\"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200\" data-testid=\"location-fun-facts\">\n              <CardContent className=\"pt-6\">\n                <h3 className=\"font-bold text-foreground mb-4 flex items-center\">\n                  🎯 <span className=\"ml-2\">Wussten Sie schon?</span>\n                </h3>\n                <div className=\"space-y-3\">\n                  {(location as any).funFacts?.length > 0 ? (location as any).funFacts.map((fact: string, index: number) => (\n                    <div key={index} className=\"flex items-start bg-white/60 rounded-lg p-3 border border-amber-100\" data-testid={`fun-fact-${index}`}>\n                      <span className=\"text-amber-600 font-bold mr-3 mt-0.5\">•</span>\n                      <p className=\"text-sm text-foreground leading-relaxed\">{fact}</p>\n                    </div>\n                  )) : (() => {\n                    // Default fun facts based on location slug\n                    const getDefaultFunFacts = (slug: string) => {\n                      switch (slug) {\n                        case 'penticton':\n                          return [\n                            '\"Penticton\" bedeutet auf der ursprünglichen Okanagan-Sprache \"ein Ort, um für immer zu bleiben\" - bezogen auf die Wasserwege zwischen Okanagan und Skaha Lake.',\n                            'Das südliche Okanagan ist Teil der nördlichsten Spitze der Sonoran-Wüste, die sich 3.000 Meilen bis nach Mexiko erstreckt.',\n                            'Die Region erhält bis zu 2.000 Sonnenstunden pro Jahr und 14 Stunden direktes Sonnenlicht täglich im Sommer - mehr als die Weinberge in Kalifornien.',\n                            'Der erste Weinberg wurde 1859 von einem französischen katholischen Priester namens Charles Pandosy angelegt - ausschließlich für Messwein.',\n                            'Bären sind ein großes Problem in den Weinbergen - sie essen nicht nur die Trauben, sondern reißen ganze Rebstöcke mitsamt den Wurzeln heraus!'\n                          ];\n                        case 'vernon':\n                          return [\n                            'Vernons ursprünglicher indigener Name war \"Nintle-Moos-Chin\", was \"über den Bach springen\" bedeutet - die Ufer des BX Creek waren so nah, dass Menschen wortwörtlich darüber springen konnten.',\n                            'Vernon veranstaltet Westkanadas größten Winterkarneval und ist der zweitgrößte in ganz Nordamerika!',\n                            'Die Vernon Vipers gewannen den Royal Bank Cup sechs Mal, einschließlich aufeinanderfolgender Siege 2009 und 2010.',\n                            'Vernons Flagge wurde von kanadischen Soldaten in Afghanistan gehisst, bevor sie 2010 offiziell angenommen wurde.',\n                            'Die Stadt hat 28 historische Wandgemälde im Stadtzentrum, die ihre Geschichte darstellen.'\n                          ];\n                        case 'jasper':\n                          return [\n                            'Jasper ist der größte Nationalpark in den kanadischen Rocky Mountains und gehört zum UNESCO-Weltkulturerbe.',\n                            'Der Park ist ein Dark Sky Reserve - einer der besten Orte, um Sterne und Nordlichter in den kanadischen Rockies zu sehen.',\n                            'Jasper beherbergt Tausende von einheimischen Tieren, darunter Maultierhirsche, Dickhornschafe, Karibus, Luchse und Pumas.',\n                            'Die berühmte Maligne Lake und Spirit Island gehören zu den meistfotografierten Orten Kanadas.',\n                            'Der Park bietet ganzjährig Outdoor-Aktivitäten von Rafting und Wandern bis hin zu Skifahren und Camping.'\n                          ];\n                        case 'golden':\n                          return [\n                            'Golden ist berühmt für Wildwasser-Rafting am Kicking Horse River - einer der Top-Rafting-Destinationen in den kanadischen Rockies.',\n                            'Die strategische Lage macht es zum perfekten Stopp auf dem Trans-Canada Highway zwischen den Rockies und dem Inneren von BC.',\n                            'Golden ist ein beliebter Ausgangspunkt für die Erkundung sowohl des Yoho National Parks als auch des Glacier National Parks.',\n                            'Die Stadt liegt auf 1.024 Metern über dem Meeresspiegel im Columbia River Valley.',\n                            'Golden bietet Zugang zu über 300 Kilometern Mountainbike-Strecken und gilt als Mekka für Outdoor-Enthusiasten.'\n                          ];\n                        case 'wells-gray':\n                          return [\n                            'Wells Gray ist als \"Kanadas Wasserfall-Park\" bekannt - der berühmteste Park für Wasserfälle in der Region.',\n                            'Die Helmcken Falls stürzen beeindruckende 140 Meter in einen Abgrund und frieren im Winter zu einem Eisturm.',\n                            'Der Park wurde 1939 über 541.000 Hektar gegründet und ist der viertgrößte Provinzpark in BC.',\n                            'Schwarzbären werden häufig im Mai und Juni beim Fressen neuer Triebe gesehen.',\n                            'Clearwater Lake Touren bietet Wildtier-Kreuzfahrten, bei denen man Karibus und Hirsche beim Schwimmen über den See sehen kann!'\n                          ];\n                        case 'sunshine-coast':\n                          return [\n                            'Obwohl sie auf dem Festland liegt, ist die Sunshine Coast nur mit der Fähre erreichbar - was ihr ein Inselgefühl verleiht.',\n                            'Die Region ist eine weniger touristische Alternative zu anderen Küstenzielen und bietet ein authentischeres Küsten-BC-Erlebnis.',\n                            'Die Sunshine Coast erstreckt sich über 180 Kilometer entlang der Pazifikküste nordwestlich von Vancouver.',\n                            'Powell River ist bekannt als \"Dive Capital of Canada\" mit über 40 Schiffswracks zum Erkunden.',\n                            'Das Gebiet bietet perfekte Outdoor-Abenteuer ohne die Menschenmengen berühmterer Ziele.'\n                          ];\n                        default:\n                          return [\n                            'Diese wunderschöne kanadische Destination bietet atemberaubende Landschaften und einzigartige Erlebnisse.',\n                            'British Columbia ist bekannt für seine vielfältige Natur von Weinregionen bis zu alpinen Gipfeln.',\n                            'Die Region ist ein Paradies für Outdoor-Enthusiasten und Naturliebhaber.',\n                            'Jede Destination auf unserer Reise wurde sorgfältig für ihre besonderen Eigenschaften ausgewählt.',\n                            'Kanada bietet einige der spektakulärsten Landschaften der Welt.'\n                          ];\n                      }\n                    };\n                    \n                    return getDefaultFunFacts(location.slug).map((fact, index) => (\n                      <div key={index} className=\"flex items-start bg-white/60 rounded-lg p-3 border border-amber-100\" data-testid={`fun-fact-${index}`}>\n                        <span className=\"text-amber-600 font-bold mr-3 mt-0.5\">•</span>\n                        <p className=\"text-sm text-foreground leading-relaxed\">{fact}</p>\n                      </div>\n                    ));\n                  })()}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Live Feed Button */}\n            <Link href={`/live-feed?locationId=${location.id}&focus=first`}>\n              <Button className=\"w-full mb-3\" data-testid=\"live-feed-button\">\n                <Camera className=\"w-4 h-4 mr-2\" />\n                📸 Live Feed für {location.name}\n              </Button>\n            </Link>\n\n            {/* Edit Button */}\n            <Link href=\"/admin\">\n              <Button className=\"w-full\" variant=\"outline\" data-testid=\"edit-location-button\">\n                📝 {t('editLocation')}\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":31239},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\n\nexport default function NotFound() {\n  const { t } = useLanguage();\n  \n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">{t('pageNotFound')}</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            {t('pageNotFoundDescription')}\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":789},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ImageInput.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { Upload, Link, AlertCircle, CheckCircle, Loader2, X, Camera } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface ImageInputProps {\n  label: string;\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  className?: string;\n  testId?: string;\n  required?: boolean;\n  allowMultiple?: boolean;\n  onMultipleChange?: (urls: string[]) => void;\n  usePublicUpload?: boolean; // New prop to use public uploads for publicly accessible images\n}\n\ninterface ImageValidationState {\n  isValidating: boolean;\n  isValid: boolean | null;\n  error?: string;\n}\n\nexport function ImageInput({ \n  label, \n  value, \n  onChange, \n  placeholder = \"https://example.com/image.jpg\",\n  className = \"\",\n  testId = \"image-input\",\n  required = false,\n  allowMultiple = false,\n  onMultipleChange,\n  usePublicUpload = false\n}: ImageInputProps) {\n  const [inputMode, setInputMode] = useState<\"url\" | \"upload\">(\"url\");\n  const [showUpload, setShowUpload] = useState(false);\n  const [imageValidation, setImageValidation] = useState<ImageValidationState>({\n    isValidating: false,\n    isValid: null,\n  });\n  const [previewError, setPreviewError] = useState(false);\n\n  // Validate image URL\n  const validateImageUrl = async (url: string) => {\n    if (!url.trim()) {\n      setImageValidation({ isValidating: false, isValid: null });\n      return;\n    }\n\n    setImageValidation({ isValidating: true, isValid: null });\n    \n    try {\n      // Check if URL is a valid image by attempting to load it\n      const img = new Image();\n      \n      const loadPromise = new Promise((resolve, reject) => {\n        img.onload = () => resolve(true);\n        img.onerror = () => reject(new Error(\"Bild kann nicht geladen werden\"));\n      });\n\n      img.src = url;\n      await loadPromise;\n      \n      setImageValidation({ isValidating: false, isValid: true });\n      setPreviewError(false);\n    } catch (error) {\n      setImageValidation({\n        isValidating: false,\n        isValid: false,\n        error: \"Ungültige Bild-URL\"\n      });\n      setPreviewError(true);\n    }\n  };\n\n  // Debounced validation effect\n  useEffect(() => {\n    if (!value) return;\n    \n    const timeoutId = setTimeout(() => {\n      validateImageUrl(value);\n    }, 500);\n\n    return () => clearTimeout(timeoutId);\n  }, [value]);\n\n  // Handle upload completion\n  const handleUploadComplete = async (result: any) => {\n    if (result.successful && result.successful.length > 0) {\n      if (allowMultiple && result.successful.length > 1) {\n        // Handle multiple files\n        try {\n          const normalizedUrls = await Promise.all(\n            result.successful.map(async (file: any) => {\n              try {\n                const response = await apiRequest(\"POST\", \"/api/objects/normalize\", {\n                  imageURL: file.uploadURL\n                });\n                const data = await response.json();\n                return data.publicURL || file.uploadURL;\n              } catch (error) {\n                console.error(\"Error processing uploaded image:\", error);\n                return file.uploadURL; // Fallback to direct URL\n              }\n            })\n          );\n          onMultipleChange?.(normalizedUrls);\n          setShowUpload(false);\n          setInputMode(\"url\");\n        } catch (error) {\n          console.error(\"Error processing multiple uploaded images:\", error);\n          // Fallback: use direct URLs\n          const fallbackUrls = result.successful.map((file: any) => file.uploadURL);\n          onMultipleChange?.(fallbackUrls);\n          setShowUpload(false);\n          setInputMode(\"url\");\n        }\n      } else {\n        // Handle single file (original behavior)\n        const uploadedFile = result.successful[0];\n        const uploadUrl = uploadedFile.uploadURL;\n        \n        try {\n          // Normalize the object path and get the public URL\n          const response = await apiRequest(\"POST\", \"/api/objects/normalize\", {\n            imageURL: uploadUrl\n          });\n          const data = await response.json();\n          onChange(data.publicURL || uploadUrl);\n          setShowUpload(false); // Close upload mode\n          setInputMode(\"url\"); // Switch to URL mode to show the result\n        } catch (error) {\n          console.error(\"Error processing uploaded image:\", error);\n          onChange(uploadUrl); // Fallback to direct URL\n          setShowUpload(false);\n          setInputMode(\"url\");\n        }\n      }\n    }\n  };\n\n  // Get upload parameters for ObjectUploader\n  const getUploadParameters = async () => {\n    const endpoint = usePublicUpload ? \"/api/objects/upload-public\" : \"/api/objects/upload\";\n    const response = await apiRequest(\"POST\", endpoint);\n    const data = await response.json();\n    return {\n      method: \"PUT\" as const,\n      url: data.uploadURL,\n    };\n  };\n\n  const handleUrlChange = (newValue: string) => {\n    onChange(newValue);\n    setPreviewError(false);\n    if (newValue.trim()) {\n      setImageValidation({ isValidating: true, isValid: null });\n    } else {\n      setImageValidation({ isValidating: false, isValid: null });\n    }\n  };\n\n  const clearImage = () => {\n    onChange(\"\");\n    setImageValidation({ isValidating: false, isValid: null });\n    setPreviewError(false);\n  };\n\n  return (\n    <div className={`space-y-4 ${className}`} data-testid={testId}>\n      <Label className=\"text-sm font-medium\">\n        {label}\n        {required && <span className=\"text-red-500 ml-1\">*</span>}\n      </Label>\n\n      {/* Main Input Area */}\n      {!showUpload ? (\n        <div className=\"space-y-3\">\n          {/* URL Input with Upload Option */}\n          <div className=\"relative\">\n            <Input\n              type=\"url\"\n              value={value}\n              onChange={(e) => handleUrlChange(e.target.value)}\n              placeholder={placeholder}\n              className=\"pr-24\"\n              data-testid={`${testId}-url-input`}\n            />\n            <div className=\"absolute inset-y-0 right-0 flex items-center gap-1 pr-2\">\n              {value && (\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6 w-6 p-0\"\n                  onClick={clearImage}\n                  data-testid={`${testId}-clear-button`}\n                >\n                  <X className=\"w-3 h-3\" />\n                </Button>\n              )}\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-6 w-6 p-0 text-muted-foreground hover:text-primary\"\n                onClick={() => setShowUpload(true)}\n                data-testid={`${testId}-toggle-upload`}\n                title=\"Stattdessen Datei hochladen\"\n              >\n                <Upload className=\"w-3 h-3\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Alternative Upload Button for better discoverability */}\n          <div className=\"flex items-center justify-center\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setShowUpload(true)}\n              className=\"text-muted-foreground border-dashed\"\n              data-testid={`${testId}-show-upload`}\n            >\n              <Upload className=\"w-4 h-4 mr-2\" />\n              oder Datei hochladen\n            </Button>\n          </div>\n\n          {/* Validation indicators */}\n          {imageValidation.isValidating && (\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\" data-testid={`${testId}-validating`}>\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n              Bild wird überprüft...\n            </div>\n          )}\n          \n          {imageValidation.isValid === true && (\n            <div className=\"flex items-center gap-2 text-sm text-green-600\" data-testid={`${testId}-valid`}>\n              <CheckCircle className=\"w-4 h-4\" />\n              Gültiges Bild\n            </div>\n          )}\n          \n          {imageValidation.isValid === false && (\n            <div className=\"flex items-center gap-2 text-sm text-red-600\" data-testid={`${testId}-invalid`}>\n              <AlertCircle className=\"w-4 h-4\" />\n              {imageValidation.error}\n            </div>\n          )}\n        </div>\n      ) : (\n        /* Upload Mode */\n        <Card className=\"border-2 border-dashed border-muted-foreground/25 hover:border-primary/50 transition-colors\">\n          <CardContent className=\"p-6\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"mx-auto w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\n                <Camera className=\"w-8 h-8 text-primary\" />\n              </div>\n              <div>\n                <h4 className=\"font-medium mb-2\">{allowMultiple ? \"Bilder hochladen\" : \"Bild hochladen\"}</h4>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  {allowMultiple \n                    ? \"Wählen Sie mehrere Bilder von Ihrem Gerät aus (max. 10 Dateien, je 10MB)\"\n                    : \"Wählen Sie ein Bild von Ihrem Gerät aus (max. 10MB)\"\n                  }\n                </p>\n              </div>\n              \n              <div className=\"flex flex-col items-center gap-3\">\n                <ObjectUploader\n                  maxNumberOfFiles={allowMultiple ? 10 : 1}\n                  maxFileSize={10485760} // 10MB\n                  onGetUploadParameters={getUploadParameters}\n                  onComplete={handleUploadComplete}\n                  buttonClassName=\"w-full max-w-xs\"\n                >\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  {allowMultiple ? \"Dateien auswählen\" : \"Datei auswählen\"}\n                </ObjectUploader>\n                \n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setShowUpload(false)}\n                  data-testid={`${testId}-back-to-url`}\n                  className=\"text-muted-foreground\"\n                >\n                  <Link className=\"w-4 h-4 mr-2\" />\n                  oder URL eingeben\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Enhanced Image Preview */}\n      {value && !imageValidation.isValidating && (\n        <Card className=\"overflow-hidden border-primary/20\" data-testid={`${testId}-preview-card`}>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"relative w-24 h-24 rounded-lg overflow-hidden bg-muted flex-shrink-0\">\n                {!previewError ? (\n                  <img\n                    src={value}\n                    alt=\"Vorschau\"\n                    className=\"w-full h-full object-cover\"\n                    onError={() => setPreviewError(true)}\n                    data-testid={`${testId}-preview-image`}\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center text-muted-foreground\">\n                    <AlertCircle className=\"w-8 h-8\" />\n                  </div>\n                )}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-medium mb-1\" data-testid={`${testId}-preview-filename`}>\n                  Bild-Vorschau\n                </p>\n                <p className=\"text-sm text-muted-foreground truncate mb-2\">\n                  {value.split('/').pop() || 'Unbenannt'}\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  {imageValidation.isValid === true && (\n                    <Badge variant=\"secondary\" className=\"text-xs\" data-testid={`${testId}-preview-status-valid`}>\n                      <CheckCircle className=\"w-3 h-3 mr-1\" />\n                      Gültig\n                    </Badge>\n                  )}\n                  {imageValidation.isValid === false && (\n                    <Badge variant=\"destructive\" className=\"text-xs\" data-testid={`${testId}-preview-status-invalid`}>\n                      <AlertCircle className=\"w-3 h-3 mr-1\" />\n                      Fehler\n                    </Badge>\n                  )}\n                </div>\n              </div>\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={clearImage}\n                data-testid={`${testId}-remove-preview`}\n                className=\"text-muted-foreground hover:text-destructive\"\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":13175},"client/src/components/LiveTripFeed.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useInfiniteQuery, useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Plus, Clock, User, Camera, Send, Image, Upload, Heart, Trash2, Video, Play, Edit } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { TripPhoto, Creator, GroupedTripPhoto } from \"@shared/schema\";\n\ninterface LiveTripFeedProps {\n  locationId: string;\n  locationName: string;\n  showUpload?: boolean;\n}\n\nexport function LiveTripFeed({ locationId, locationName, showUpload = true }: LiveTripFeedProps) {\n  const [caption, setCaption] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [selectedCreatorId, setSelectedCreatorId] = useState<string>(\"\");\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [mediaType, setMediaType] = useState<'image' | 'video'>('image');\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState<{current: number, total: number}>({current: 0, total: 0});\n  const [userKey] = useState(() => localStorage.getItem('userKey') || `user_${Date.now()}_${Math.random()}`);\n  const [likedPhotos, setLikedPhotos] = useState(new Set<string>());\n  const [deleteTokens, setDeleteTokens] = useState<Record<string, string>>(() => {\n    // Load delete tokens from localStorage on mount\n    try {\n      const saved = localStorage.getItem(`deleteTokens_${userKey}`);\n      return saved ? JSON.parse(saved) : {};\n    } catch {\n      return {};\n    }\n  });\n  const [currentImageIndex, setCurrentImageIndex] = useState<Record<string, number>>({});\n  const [editingPost, setEditingPost] = useState<string | null>(null);\n  const [editCaption, setEditCaption] = useState(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const loadMoreRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Image preloading for performance\n  const preloadNextImages = useCallback((photos: GroupedTripPhoto[], currentIndex: number) => {\n    // Preload next 3 images to improve perceived loading speed\n    const nextPhotos = photos.slice(currentIndex + 1, currentIndex + 4);\n    nextPhotos.forEach(group => {\n      group.media.forEach(media => {\n        if (media.imageUrl && media.mediaType === 'image') {\n          const img = new window.Image();\n          img.src = media.imageUrl;\n        }\n      });\n    });\n  }, []);\n\n\n  // Save user key to localStorage\n  useEffect(() => {\n    localStorage.setItem('userKey', userKey);\n  }, [userKey]);\n\n  // Save delete tokens to localStorage whenever they change\n  useEffect(() => {\n    try {\n      localStorage.setItem(`deleteTokens_${userKey}`, JSON.stringify(deleteTokens));\n    } catch {\n      // Ignore localStorage errors\n    }\n  }, [deleteTokens, userKey]);\n\n  // Query to fetch creators\n  const { data: creators = [] } = useQuery<Creator[]>({\n    queryKey: [\"/api/creators\"],\n  });\n\n  // Infinite query for grouped paginated trip photos with optimized caching\n  const {\n    data,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage,\n    isLoading,\n    refetch,\n  } = useInfiniteQuery({\n    queryKey: [\"/api/trip-photos/paginated-grouped\", locationId],\n    queryFn: async ({ pageParam }) => {\n      const params = new URLSearchParams({\n        limit: '15', // Slightly larger pages for better performance\n        ...(locationId && { locationId }),\n        ...(pageParam && { cursor: pageParam }),\n      });\n      \n      const response = await fetch(`/api/trip-photos/paginated-grouped?${params}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch photos');\n      }\n      return response.json();\n    },\n    getNextPageParam: (lastPage) => lastPage.nextCursor,\n    initialPageParam: undefined as string | undefined,\n    staleTime: 15 * 60 * 1000, // 15 minutes - much longer for performance\n    gcTime: 45 * 60 * 1000, // 45 minutes cache for better image retention\n    refetchInterval: 5 * 60 * 1000, // Reduced to 5 minutes for better performance\n  });\n\n  // Flatten all pages into a single array of grouped photos\n  const groupedPhotos = data?.pages.flatMap(page => page.items) || [] as GroupedTripPhoto[];\n\n  // Trigger image preloading when new data loads\n  useEffect(() => {\n    if (groupedPhotos.length > 0) {\n      // Preload images for better performance, starting from the visible ones\n      preloadNextImages(groupedPhotos, Math.max(0, groupedPhotos.length - 10));\n    }\n  }, [groupedPhotos.length, preloadNextImages]);\n\n  // Enhanced media upload mutation using new API\n  const uploadMutation = useMutation({\n    mutationFn: async ({ file, caption, uploadedBy, creatorId, mediaType }: { \n      file: File; \n      caption: string; \n      uploadedBy: string; \n      creatorId: string;\n      mediaType: 'image' | 'video';\n    }) => {\n      // Extract EXIF data for proper date sorting\n      let exifData: Record<number, string> = {};\n      if (mediaType === 'image') {\n        try {\n          const exifr = await import('exifr');\n          const parsed = await exifr.parse(file);\n          const dateTime = parsed?.DateTimeOriginal || parsed?.DateTime || parsed?.CreateDate;\n          if (dateTime && dateTime instanceof Date) {\n            exifData[0] = dateTime.toISOString();\n          }\n        } catch (error) {\n          console.warn('Failed to extract EXIF data:', error);\n        }\n      }\n\n      const formData = new FormData();\n      formData.append('media', file);\n      if (caption) formData.append('caption', caption);\n      if (uploadedBy) formData.append('uploadedBy', uploadedBy);\n      if (creatorId) formData.append('creatorId', creatorId);\n      if (locationId) formData.append('locationId', locationId);\n      if (Object.keys(exifData).length > 0) {\n        formData.append('exifData', JSON.stringify(exifData));\n      }\n\n      const response = await fetch('/api/trip-photos/media-batch', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Upload fehlgeschlagen\");\n      }\n      const result = await response.json();\n      return result.files?.[0] || result; // Return first file from batch result\n    },\n    onSuccess: (newPhoto) => {\n      // Store delete token locally\n      if (newPhoto.deleteToken) {\n        setDeleteTokens(prev => ({\n          ...prev,\n          [newPhoto.id]: newPhoto.deleteToken\n        }));\n      }\n      \n      // Refetch the first page to include new photo\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos/paginated-grouped\", locationId] });\n      refetch();\n      \n      setCaption(\"\");\n      setName(\"\");\n      setSelectedCreatorId(\"\");\n      setSelectedFiles([]);\n      setMediaType('image');\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n      toast({\n        title: \"Gepostet!\",\n        description: \"Ihr Beitrag wurde erfolgreich geteilt.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Upload fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Like mutation with proper cache updates\n  const likeMutation = useMutation({\n    mutationFn: async ({ photoId }: { photoId: string }) => {\n      const response = await fetch(`/api/trip-photos/${photoId}/like`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userKey }),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to toggle like');\n      }\n      return response.json();\n    },\n    onMutate: async ({ photoId }) => {\n      // Cancel outgoing refetches\n      await queryClient.cancelQueries({ queryKey: [\"/api/trip-photos/paginated-grouped\", locationId] });\n      \n      // Optimistic update\n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (newSet.has(photoId)) {\n          newSet.delete(photoId);\n        } else {\n          newSet.add(photoId);\n        }\n        return newSet;\n      });\n      \n      // Update cache optimistically\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated-grouped\", locationId],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((group: any) => ({\n                ...group,\n                media: group.media.map((mediaItem: any) => {\n                  if (mediaItem.id === photoId) {\n                    const isLiked = likedPhotos.has(photoId);\n                    return {\n                      ...mediaItem,\n                      likesCount: Math.max(0, (mediaItem.likesCount || 0) + (isLiked ? -1 : 1))\n                    };\n                  }\n                  return mediaItem;\n                })\n              }))\n            }))\n          };\n        }\n      );\n    },\n    onSuccess: (result, { photoId }) => {\n      // Update with server response\n      const { liked, likesCount } = result;\n      \n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (liked) {\n          newSet.add(photoId);\n        } else {\n          newSet.delete(photoId);\n        }\n        return newSet;\n      });\n      \n      // Update cache with actual server data\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated-grouped\", locationId],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((group: any) => ({\n                ...group,\n                media: group.media.map((mediaItem: any) => \n                  mediaItem.id === photoId ? { ...mediaItem, likesCount } : mediaItem\n                )\n              }))\n            }))\n          };\n        }\n      );\n    },\n    onError: (error, { photoId }) => {\n      // Revert optimistic update\n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (newSet.has(photoId)) {\n          newSet.delete(photoId);\n        } else {\n          newSet.add(photoId);\n        }\n        return newSet;\n      });\n      \n      // Invalidate and refetch to get correct state\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos/paginated-grouped\", locationId] });\n      \n      toast({\n        title: \"Fehler\",\n        description: \"Like konnte nicht gespeichert werden.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Edit post mutation\n  const editMutation = useMutation({\n    mutationFn: async ({ postId, caption }: { postId: string; caption: string }) => {\n      const response = await fetch(`/api/trip-photos/${postId}/caption`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ caption }),\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update caption');\n      }\n      \n      return response.json();\n    },\n    onSuccess: (_, { postId, caption }) => {\n      // Update cache with new caption\n      queryClient.setQueryData(\n        ['/api/trip-photos/paginated-grouped', locationId],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((group: any) => \n                group.id === postId \n                  ? { ...group, caption }\n                  : group\n              )\n            }))\n          };\n        }\n      );\n      \n      setEditingPost(null);\n      setEditCaption(\"\");\n      \n      toast({\n        title: \"Aktualisiert\",\n        description: \"Ihr Beitrag wurde erfolgreich bearbeitet.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Fehler\",\n        description: error.message || \"Bearbeitung fehlgeschlagen.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async ({ photoId }: { photoId: string }) => {\n      const deleteToken = deleteTokens[photoId];\n      const response = await fetch(`/api/trip-photos/${photoId}`, {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ deleteToken }),\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to delete photo');\n      }\n    },\n    onSuccess: (_, { photoId }) => {\n      // Remove from delete tokens (this will trigger localStorage update via useEffect)\n      setDeleteTokens(prev => {\n        const newTokens = { ...prev };\n        delete newTokens[photoId];\n        return newTokens;\n      });\n      \n      // Invalidate all trip-photos related caches\n      queryClient.invalidateQueries({ \n        predicate: (query) => Array.isArray(query.queryKey) && \n                              String(query.queryKey[0]).startsWith('/api/trip-photos') \n      });\n      \n      // Optimistically update grouped caches for all locations\n      queryClient.getQueryCache().getAll().forEach(query => {\n        if (Array.isArray(query.queryKey) && \n            query.queryKey[0] === '/api/trip-photos/paginated-grouped') {\n          queryClient.setQueryData(query.queryKey, (oldData: any) => {\n            if (!oldData) return oldData;\n            \n            return {\n              ...oldData,\n              pages: oldData.pages.map((page: any) => ({\n                ...page,\n                items: page.items.map((group: any) => ({\n                  ...group,\n                  media: group.media.filter((mediaItem: any) => mediaItem.id !== photoId)\n                })).filter((group: any) => group.media.length > 0) // Remove empty groups\n              }))\n            };\n          });\n        }\n      });\n      \n      toast({\n        title: \"Gelöscht\",\n        description: \"Ihr Beitrag wurde erfolgreich gelöscht.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Löschen fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Optimized infinite scroll with aggressive preloading for smooth scrolling\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasNextPage && !isFetchingNextPage) {\n          fetchNextPage();\n        }\n      },\n      { threshold: 0, rootMargin: '500px 0px' } // Optimized for smooth preloading\n    );\n\n    if (loadMoreRef.current) {\n      observer.observe(loadMoreRef.current);\n    }\n\n    return () => {\n      if (loadMoreRef.current) {\n        observer.unobserve(loadMoreRef.current);\n      }\n      observer.disconnect();\n    };\n  }, [hasNextPage, isFetchingNextPage, fetchNextPage]);\n\n  // Image preloading effect - preload next 3 images when data loads\n  useEffect(() => {\n    if (groupedPhotos.length > 0) {\n      preloadNextImages(groupedPhotos, Math.max(0, groupedPhotos.length - 3));\n    }\n  }, [groupedPhotos, preloadNextImages]);\n\n  // Enhanced file selection with multiple file support\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (files.length === 0) return;\n\n    const validFiles: File[] = [];\n    let hasErrors = false;\n\n    // Validate each file\n    for (const file of files) {\n      // File size validation (50MB for videos, 10MB for images)\n      const maxSize = file.type.startsWith('video/') ? 52428800 : 10485760;\n      if (file.size > maxSize) {\n        toast({\n          title: \"Datei zu groß\",\n          description: `${file.name}: ${file.type.startsWith('video/') ? 'Videos müssen unter 50MB' : 'Bilder müssen unter 10MB'} sein.`,\n          variant: \"destructive\",\n        });\n        hasErrors = true;\n        continue;\n      }\n      \n      // File type validation\n      const allowedImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];\n      const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\n      const allAllowedTypes = [...allowedImageTypes, ...allowedVideoTypes];\n      \n      if (!allAllowedTypes.includes(file.type)) {\n        toast({\n          title: \"Ungültiger Dateityp\",\n          description: `${file.name}: Nur Bilder (JPG, PNG, WebP, GIF) und Videos (MP4, WebM, MOV) sind erlaubt.`,\n          variant: \"destructive\",\n        });\n        hasErrors = true;\n        continue;\n      }\n      \n      validFiles.push(file);\n    }\n\n    if (validFiles.length > 0) {\n      setSelectedFiles(validFiles);\n      // Set media type based on first file\n      const firstFileType = validFiles[0].type.startsWith('video/') ? 'video' : 'image';\n      setMediaType(firstFileType);\n      \n      const fileCount = validFiles.length;\n      const mixedTypes = validFiles.some(f => f.type.startsWith('video/')) && validFiles.some(f => f.type.startsWith('image/'));\n      \n      toast({\n        title: `${fileCount} ${fileCount === 1 ? 'Datei' : 'Dateien'} ausgewählt`,\n        description: mixedTypes ? 'Bilder und Videos bereit zum Hochladen.' : `${fileCount} ${firstFileType === 'video' ? 'Video(s)' : 'Foto(s)'} bereit zum Hochladen.`,\n      });\n    }\n\n    if (hasErrors && validFiles.length === 0) {\n      // Clear selection if all files were invalid\n      setSelectedFiles([]);\n    }\n  };\n\n  // Enhanced upload handler with multiple file support\n  const handleUpload = async () => {\n    if (selectedFiles.length === 0) {\n      toast({\n        title: `Bitte ${mediaType === 'video' ? 'Video' : 'Foto'} wählen`,\n        description: `Wählen Sie ${mediaType === 'video' ? 'Videos' : 'Fotos'} zum Hochladen aus.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    setUploadProgress({current: 0, total: selectedFiles.length});\n    \n    try {\n      // Upload all files as a batch\n      await uploadMultipleFiles(selectedFiles);\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n    } finally {\n      setUploading(false);\n      setUploadProgress({current: 0, total: 0});\n    }\n  };\n\n  // Upload multiple files using the batch endpoint\n  const uploadMultipleFiles = async (files: File[]) => {\n    try {\n      // Extract EXIF data for all image files\n      const exifDataMap: Record<number, string> = {};\n      \n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        if (file.type.startsWith('image/')) {\n          try {\n            const exifr = await import('exifr');\n            const parsed = await exifr.parse(file);\n            const dateTime = parsed?.DateTimeOriginal || parsed?.DateTime || parsed?.CreateDate;\n            if (dateTime && dateTime instanceof Date) {\n              exifDataMap[i] = dateTime.toISOString();\n            }\n          } catch (error) {\n            console.warn(`Failed to extract EXIF data for ${file.name}:`, error);\n          }\n        }\n      }\n\n      const formData = new FormData();\n      \n      // Append all files\n      files.forEach(file => {\n        formData.append('media', file);\n      });\n      \n      // Append form data\n      if (caption.trim()) formData.append('caption', caption.trim());\n      if (name.trim()) formData.append('uploadedBy', name.trim());\n      if (selectedCreatorId) formData.append('creatorId', selectedCreatorId);\n      if (locationId) formData.append('locationId', locationId);\n      if (Object.keys(exifDataMap).length > 0) {\n        formData.append('exifData', JSON.stringify(exifDataMap));\n      }\n\n      const response = await fetch('/api/trip-photos/media-batch', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Upload fehlgeschlagen\");\n      }\n      \n      const result = await response.json();\n      \n      // Store delete tokens for all uploaded files\n      if (result.files) {\n        result.files.forEach((photo: any) => {\n          if (photo.deleteToken) {\n            setDeleteTokens(prev => ({\n              ...prev,\n              [photo.id]: photo.deleteToken\n            }));\n          }\n        });\n      }\n      \n      // Refresh the feed\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos/paginated-grouped\", locationId] });\n      refetch();\n      \n      // Clear form\n      setCaption(\"\");\n      setName(\"\");\n      setSelectedCreatorId(\"\");\n      setSelectedFiles([]);\n      setMediaType('image');\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n      \n      const fileCount = result.files?.length || files.length;\n      toast({\n        title: \"Erfolgreich hochgeladen!\",\n        description: `${fileCount} ${fileCount === 1 ? 'Datei' : 'Dateien'} erfolgreich geteilt.`,\n      });\n      \n    } catch (error: any) {\n      toast({\n        title: \"Upload fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n      throw error;\n    }\n  };\n\n  // Handle like click\n  const handleLike = async (photoId: string) => {\n    await likeMutation.mutateAsync({ photoId });\n  };\n\n  // Handle delete click\n  const handleDelete = async (photoId: string) => {\n    if (!deleteTokens[photoId]) {\n      toast({\n        title: \"Löschen nicht möglich\",\n        description: \"Sie können nur eigene Beiträge löschen.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (confirm(\"Möchten Sie diesen Beitrag wirklich löschen?\")) {\n      await deleteMutation.mutateAsync({ photoId });\n    }\n  };\n\n  // Format timestamp with date only\n  const formatTime = (date: Date | string | null) => {\n    if (!date) return '';\n    const timestamp = typeof date === 'string' ? new Date(date) : date;\n    return timestamp.toLocaleString('de-DE', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\" data-testid=\"live-trip-feed\">\n      {/* Large, Prominent Upload Area - Facebook Style */}\n      {showUpload && (\n        <Card className=\"p-6\" data-testid=\"upload-area\">\n          <div className=\"space-y-4\">\n            {selectedFiles.length === 0 ? (\n              /* Large Upload Button */\n              <Button\n                variant=\"outline\"\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploading}\n                className=\"w-full h-20 border-2 border-dashed border-blue-300 hover:border-blue-400 hover:bg-blue-50 flex flex-col items-center justify-center space-y-2 text-blue-600 disabled:opacity-50\"\n                data-testid=\"large-upload-button\"\n              >\n                {uploading ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n                    <span className=\"text-lg font-medium\">Upload läuft...</span>\n                    <span className=\"text-sm text-muted-foreground\">Ihre Dateien werden verarbeitet, bitte warten...</span>\n                  </>\n                ) : (\n                  <>\n                    <Upload className=\"w-8 h-8\" />\n                    <span className=\"text-lg font-medium\">Fotos oder Videos aus {locationName} hochladen</span>\n                    <span className=\"text-sm text-muted-foreground\">Mehrere Dateien möglich: Bilder (JPG, PNG, WebP, GIF - max. 10MB) oder Videos (MP4, WebM, MOV - max. 50MB)</span>\n                  </>\n                )}\n              </Button>\n            ) : (\n              /* Files Selected - Show Preview and Details */\n              <div className=\"space-y-4\">\n                {/* Enhanced Upload Progress Indicator */}\n                {uploading && (\n                  <div className=\"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-300 shadow-md\">\n                    <div className=\"flex items-center space-x-4 mb-3\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-4 border-blue-200 border-t-blue-600\"></div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-blue-900 text-lg\">Upload läuft...</h3>\n                        <p className=\"text-blue-700\">\n                          {selectedFiles.length} {selectedFiles.length === 1 ? 'Datei wird' : 'Dateien werden'} hochgeladen\n                        </p>\n                      </div>\n                    </div>\n                    \n                    {/* Progress Bar */}\n                    <div className=\"w-full bg-blue-200 rounded-full h-3 mb-3 shadow-inner\">\n                      <div \n                        className=\"bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all duration-500 ease-out shadow-sm\"\n                        style={{\n                          width: `${uploadProgress.total > 0 ? 100 : 30}%`,\n                          animation: uploadProgress.total === 0 ? 'pulse 2s infinite' : 'none'\n                        }}\n                      ></div>\n                    </div>\n                    \n                    {/* Status Messages */}\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-blue-700 font-medium\">\n                        📤 Dateien werden verarbeitet...\n                      </span>\n                      <span className=\"text-blue-600\">\n                        {selectedFiles.length} von {selectedFiles.length}\n                      </span>\n                    </div>\n                    \n                    <p className=\"text-xs text-blue-600 mt-3 bg-blue-100 p-2 rounded text-center\">\n                      ⏳ Bitte schließen Sie dieses Fenster nicht während des Uploads\n                    </p>\n                  </div>\n                )}\n                \n                {/* File List */}\n                <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                  {selectedFiles.map((file, index) => {\n                    const isVideo = file.type.startsWith('video/');\n                    return (\n                      <div key={index} className=\"flex items-center space-x-3 p-3 bg-green-50 rounded-lg border border-green-200\" data-testid={`file-preview-${index}`}>\n                        {isVideo ? (\n                          <Video className=\"w-5 h-5 text-green-600\" />\n                        ) : (\n                          <Image className=\"w-5 h-5 text-green-600\" />\n                        )}\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-medium text-green-800 truncate\">{file.name}</p>\n                          <p className=\"text-sm text-green-600\">{(file.size / 1024 / 1024).toFixed(2)} MB • {isVideo ? 'Video' : 'Bild'}</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedFiles(prev => prev.filter((_, i) => i !== index));\n                          }}\n                          className=\"text-green-700 hover:text-green-800 flex-shrink-0\"\n                          data-testid={`remove-file-${index}`}\n                          disabled={uploading}\n                        >\n                          ×\n                        </Button>\n                      </div>\n                    );\n                  })}\n                </div>\n                \n                {/* Summary */}\n                {selectedFiles.length > 1 && (\n                  <div className=\"text-sm text-green-600 bg-green-50 p-2 rounded text-center\">\n                    {selectedFiles.length} Dateien ausgewählt • Gesamt: {(selectedFiles.reduce((sum, file) => sum + file.size, 0) / 1024 / 1024).toFixed(2)} MB\n                  </div>\n                )}\n\n                {/* Creator Selection */}\n                <Select value={selectedCreatorId} onValueChange={setSelectedCreatorId}>\n                  <SelectTrigger data-testid=\"creator-select\">\n                    <SelectValue placeholder=\"Wer postet dieses Foto?\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {creators.map((creator) => (\n                      <SelectItem key={creator.id} value={creator.id}>\n                        {creator.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                {/* Caption Input */}\n                <Textarea\n                  placeholder={`Beschreibung für Ihr Foto aus ${locationName}...`}\n                  value={caption}\n                  onChange={(e) => setCaption(e.target.value)}\n                  className=\"text-base\"\n                  rows={3}\n                  maxLength={500}\n                  data-testid=\"post-text-input\"\n                />\n\n                {/* Name Input - Optional for additional context */}\n                <Input\n                  placeholder=\"Zusätzliche Namensangabe (optional)\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  maxLength={100}\n                  data-testid=\"name-input\"\n                />\n\n                {/* Action Buttons */}\n                <div className=\"flex items-center justify-between pt-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setSelectedFiles([]);\n                      if (fileInputRef.current) fileInputRef.current.value = \"\";\n                    }}\n                    data-testid=\"change-photo\"\n                    disabled={uploading}\n                  >\n                    {selectedFiles.length > 1 ? 'Andere Dateien wählen' : 'Andere Datei wählen'}\n                  </Button>\n                  \n                  <Button\n                    onClick={handleUpload}\n                    disabled={uploading || selectedFiles.length === 0}\n                    className=\"flex items-center space-x-2 px-6\"\n                    data-testid=\"post-button\"\n                  >\n                    {uploading ? (\n                      <>\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                        <span>Hochladen...</span>\n                      </>\n                    ) : (\n                      <>\n                        <Upload className=\"w-4 h-4\" />\n                        <span>{selectedFiles.length > 1 ? `${selectedFiles.length} Dateien posten` : 'Datei posten'}</span>\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n            )}\n            \n            {/* Hidden File Input - Now supports multiple files and videos */}\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*,video/*\"\n              multiple\n              onChange={handleFileSelect}\n              className=\"hidden\"\n              data-testid=\"file-input\"\n            />\n          </div>\n        </Card>\n      )}\n\n      {/* Feed Title */}\n      <div className=\"flex items-center space-x-2 px-1\" data-testid=\"feed-title\">\n        <Camera className=\"w-5 h-5 text-primary\" />\n        <h3 className=\"font-semibold text-lg\">Live aus {locationName}</h3>\n        <div className=\"ml-auto text-xs text-muted-foreground\">\n          {groupedPhotos.length} {groupedPhotos.length === 1 ? 'Beitrag' : 'Beiträge'}\n        </div>\n      </div>\n\n      {/* Feed Content */}\n      {isLoading ? (\n        <Card className=\"p-8\" data-testid=\"loading-posts\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        </Card>\n      ) : groupedPhotos.length === 0 ? (\n        <Card className=\"p-8 text-center\" data-testid=\"no-posts\">\n          <Camera className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground/50\" />\n          <p className=\"font-medium text-muted-foreground\">Noch keine Beiträge</p>\n          <p className=\"text-sm text-muted-foreground/70\">Seien Sie der Erste, der etwas aus {locationName} teilt!</p>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {groupedPhotos.map((group) => {\n            const hasMultipleMedia = group.media.length > 1;\n            const totalLikes = group.media.reduce((sum: number, media: any) => sum + (media.likesCount || 0), 0);\n            const firstMedia = group.media[0];\n            \n            return (\n              <Card key={group.id} className=\"overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700\" data-testid={`post-${group.id}`}>\n                {/* Post Header */}\n                <div className=\"p-3 pb-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"flex items-center space-x-1\" data-testid={`post-author-${group.id}`}>\n                        <User className=\"w-4 h-4 text-muted-foreground\" />\n                        <span className=\"font-medium text-sm\">Von {group.creatorId || 'Anonym'}</span>\n                      </div>\n                      {hasMultipleMedia && (\n                        <div className=\"flex items-center space-x-1 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full\">\n                          <Camera className=\"w-3 h-3\" />\n                          <span>{group.media.length} Fotos</span>\n                        </div>\n                      )}\n                      {firstMedia.mediaType === 'video' && (\n                        <div className=\"flex items-center space-x-1 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full\">\n                          <Video className=\"w-3 h-3\" />\n                          <span>Video</span>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex items-center space-x-1 text-xs text-muted-foreground\" data-testid={`post-time-${group.id}`}>\n                      <Clock className=\"w-3 h-3\" />\n                      <span>Aufgenommen: {formatTime(group.groupTakenAt)}</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Post Media - Single or Gallery */}\n                {hasMultipleMedia ? (\n                  /* Carousel Gallery */\n                  <div className=\"relative\" data-testid={`post-gallery-${group.id}`}>\n                    {(() => {\n                      const currentIndex = currentImageIndex[group.id] || 0;\n                      const currentMedia = group.media[currentIndex];\n                      return (\n                        <>\n                          {/* Main Image/Video Display */}\n                          <div className=\"relative\">\n                            {currentMedia.mediaType === 'video' && currentMedia.videoUrl ? (\n                              <video\n                                src={currentMedia.videoUrl}\n                                poster={currentMedia.thumbnailUrl || undefined}\n                                controls\n                                className=\"w-full h-64 sm:h-80 md:h-96 lg:h-[32rem] xl:h-[36rem] object-cover rounded-t-lg cursor-pointer transition-transform hover:scale-[1.01]\"\n                                data-testid={`gallery-video-${currentMedia.id}`}\n                              >\n                                <source src={currentMedia.videoUrl} type=\"video/mp4\" />\n                                Ihr Browser unterstützt das Video-Element nicht.\n                              </video>\n                            ) : (\n                              <img\n                                src={currentMedia.imageUrl}\n                                alt={group.caption || \"Gallery image\"}\n                                className=\"w-full h-64 sm:h-80 md:h-96 lg:h-[32rem] xl:h-[36rem] object-cover rounded-t-lg cursor-pointer transition-transform hover:scale-[1.01]\"\n                                loading=\"lazy\"\n                                decoding=\"async\"\n                                data-testid={`gallery-image-${currentMedia.id}`}\n                              />\n                            )}\n                            {currentMedia.mediaType === 'video' && (\n                              <div className=\"absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-md text-xs flex items-center space-x-1\">\n                                <Video className=\"w-3 h-3\" />\n                                <span>Video</span>\n                              </div>\n                            )}\n                          </div>\n                          \n                          {/* Navigation Dots */}\n                          {group.media.length > 1 && (\n                            <div className=\"flex justify-center items-center space-x-2 py-4 bg-gray-50/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700\">\n                              {group.media.map((_: any, index: number) => (\n                                <button\n                                  key={index}\n                                  onClick={() => setCurrentImageIndex(prev => ({ ...prev, [group.id]: index }))}\n                                  className={`w-2 h-2 rounded-full transition-all duration-200 ${\n                                    index === currentIndex \n                                      ? 'bg-primary scale-125' \n                                      : 'bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500'\n                                  }`}\n                                  data-testid={`gallery-dot-${index}`}\n                                  aria-label={`Go to image ${index + 1}`}\n                                />\n                              ))}\n                            </div>\n                          )}\n                        </>\n                      );\n                    })()}\n                  </div>\n                ) : (\n                  /* Single Media */\n                  firstMedia.mediaType === 'video' && firstMedia.videoUrl ? (\n                    <div className=\"relative\">\n                      <video\n                        src={firstMedia.videoUrl}\n                        poster={firstMedia.thumbnailUrl || undefined}\n                        controls\n                        className=\"w-full h-64 sm:h-80 md:h-96 lg:h-[32rem] xl:h-[36rem] object-cover rounded-t-lg cursor-pointer transition-transform hover:scale-[1.01]\"\n                        data-testid={`post-video-${firstMedia.id}`}\n                      >\n                        <source src={firstMedia.videoUrl} type=\"video/mp4\" />\n                        Ihr Browser unterstützt das Video-Element nicht.\n                      </video>\n                      <div className=\"absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-md text-xs flex items-center space-x-1\">\n                        <Video className=\"w-3 h-3\" />\n                        <span>Video</span>\n                      </div>\n                    </div>\n                  ) : firstMedia.imageUrl ? (\n                    <div className=\"relative\">\n                      <img\n                        src={firstMedia.imageUrl}\n                        alt={group.caption || \"Reisefoto\"}\n                        className=\"w-full h-64 sm:h-80 md:h-96 lg:h-[32rem] xl:h-[36rem] object-cover rounded-t-lg cursor-pointer transition-transform hover:scale-[1.01]\"\n                        loading=\"lazy\"\n                        decoding=\"async\"\n                        data-testid={`post-image-${firstMedia.id}`}\n                      />\n                    </div>\n                  ) : null\n                )}\n\n                {/* Post Caption and Edit */}\n                <div className=\"px-3 py-2 border-t border-border/50\">\n                  <div className=\"flex items-start justify-between\">\n                    {group.caption ? (\n                      <p className=\"text-sm text-foreground flex-1 mr-2\" data-testid={`post-caption-${group.id}`}>\n                        {group.caption}\n                      </p>\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground flex-1 mr-2 italic\">\n                        Keine Beschreibung\n                      </p>\n                    )}\n                    \n                    {/* Edit button - always accessible */}\n                    <Dialog open={editingPost === group.id} onOpenChange={(open) => {\n                      if (!open) {\n                        setEditingPost(null);\n                        setEditCaption(\"\");\n                      }\n                    }}>\n                      <DialogTrigger asChild>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setEditingPost(group.id);\n                            setEditCaption(group.caption || \"\");\n                          }}\n                          className=\"text-muted-foreground hover:text-primary p-1 h-auto\"\n                          data-testid={`edit-button-${group.id}`}\n                          title=\"Beitrag bearbeiten\"\n                        >\n                          <Edit className=\"w-3 h-3\" />\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"sm:max-w-md\">\n                        <DialogHeader>\n                          <DialogTitle>Beitrag bearbeiten</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"space-y-4\">\n                          <Textarea\n                            placeholder=\"Beschreibung hinzufügen oder bearbeiten...\"\n                            value={editCaption}\n                            onChange={(e) => setEditCaption(e.target.value)}\n                            className=\"text-base\"\n                            rows={4}\n                            maxLength={500}\n                            data-testid=\"edit-caption-input\"\n                          />\n                          <div className=\"flex items-center justify-end space-x-2\">\n                            <Button\n                              variant=\"outline\"\n                              onClick={() => {\n                                setEditingPost(null);\n                                setEditCaption(\"\");\n                              }}\n                              data-testid=\"cancel-edit-button\"\n                            >\n                              Abbrechen\n                            </Button>\n                            <Button\n                              onClick={() => editMutation.mutate({ postId: group.id, caption: editCaption })}\n                              disabled={editMutation.isPending}\n                              data-testid=\"save-edit-button\"\n                            >\n                              {editMutation.isPending ? \"Speichern...\" : \"Speichern\"}\n                            </Button>\n                          </div>\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </div>\n                </div>\n\n                {/* Post Actions - Like and Delete */}\n                <div className=\"p-3 pt-2 border-t border-border/50\">\n                  <div className=\"flex items-center justify-between\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleLike(firstMedia.id)}\n                      className={`flex items-center space-x-2 ${\n                        likedPhotos.has(firstMedia.id) ? 'text-red-500' : 'text-muted-foreground'\n                      }`}\n                      data-testid={`like-button-${group.id}`}\n                    >\n                      <Heart \n                        className={`w-4 h-4 ${likedPhotos.has(firstMedia.id) ? 'fill-current' : ''}`} \n                      />\n                      <span>{hasMultipleMedia ? totalLikes : (firstMedia.likesCount || 0)}</span>\n                    </Button>\n                    \n                    {group.media.some((media: any) => deleteTokens[media.id]) && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleDelete(firstMedia.id)}\n                        className=\"text-muted-foreground hover:text-red-500\"\n                        data-testid={`delete-button-${group.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            );\n          })}\n          \n          {/* Infinite Scroll Trigger */}\n          <div ref={loadMoreRef} className=\"flex justify-center p-4\">\n            {isFetchingNextPage ? (\n              <div className=\"flex items-center space-x-2 text-muted-foreground\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary\"></div>\n                <span className=\"text-sm\">Lade weitere Beiträge...</span>\n              </div>\n            ) : hasNextPage ? (\n              <Button\n                variant=\"outline\"\n                onClick={() => fetchNextPage()}\n                className=\"text-sm\"\n                data-testid=\"load-more-button\"\n              >\n                Weitere Beiträge laden\n              </Button>\n            ) : groupedPhotos.length > 0 ? (\n              <p className=\"text-sm text-muted-foreground\">Alle Beiträge geladen</p>\n            ) : null}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":46840},"client/src/pages/LiveFeed.tsx":{"content":"import Header from \"@/components/Header\";\nimport GlobalTripFeed from \"@/components/GlobalTripFeed\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Filter, SortAsc } from \"lucide-react\";\nimport type { Location } from \"@shared/schema\";\n\nexport default function LiveFeedPage() {\n  const { t } = useLanguage();\n\n  // Get URL parameters for deep linking\n  const urlParams = new URLSearchParams(window.location.search);\n  const filterLocationId = urlParams.get('locationId');\n\n  // Filter and sort state\n  const [selectedLocationFilter, setSelectedLocationFilter] = useState<string>(filterLocationId || 'all');\n  const [sortOption, setSortOption] = useState<string>(urlParams.get('sortBy') || 'newest');\n\n  // Fetch locations for the filter dropdown\n  const { data: locations = [] } = useQuery<Location[]>({ queryKey: ['/api/locations'] });\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-950\" data-testid=\"live-feed-page\">\n      <Header />\n      \n      {/* Page Title with Filter and Sort Controls */}\n      <div className=\"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800\">\n        <div className=\"max-w-2xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between gap-4\">\n            <div className=\"flex-1\">\n              <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"live-feed-title\">{t('liveFeed')}</h1>\n              <p className=\"text-muted-foreground mt-1\">Teile deine Reisemomente</p>\n            </div>\n            \n            {/* Filter and Sort Controls */}\n            <div className=\"flex items-center gap-3\" data-testid=\"filter-sort-controls\">\n              {/* Location Filter */}\n              <div className=\"flex items-center gap-2\">\n                <Filter className=\"w-4 h-4 text-muted-foreground\" />\n                <Select value={selectedLocationFilter} onValueChange={setSelectedLocationFilter}>\n                  <SelectTrigger className=\"w-40 h-8 text-sm\" data-testid=\"location-filter\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">Alle Orte</SelectItem>\n                    {locations.map((location) => (\n                      <SelectItem key={location.id} value={location.id}>\n                        {location.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Sort Options */}\n              <div className=\"flex items-center gap-2\">\n                <SortAsc className=\"w-4 h-4 text-muted-foreground\" />\n                <Select value={sortOption} onValueChange={setSortOption}>\n                  <SelectTrigger className=\"w-36 h-8 text-sm\" data-testid=\"sort-option\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"newest\">Neueste zuerst</SelectItem>\n                    <SelectItem value=\"oldest\">Älteste zuerst</SelectItem>\n                    <SelectItem value=\"most-liked\">Meist gelikt</SelectItem>\n                    <SelectItem value=\"photo-date\">Nach Fotodatum</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-2xl mx-auto px-4 py-6\">\n        <GlobalTripFeed \n          selectedLocationFilter={selectedLocationFilter}\n          sortOption={sortOption}\n        />\n      </div>\n    </div>\n  );\n}","size_bytes":3807},"client/src/components/CarIcon.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ninterface CarIconProps {\n  isVisible: boolean;\n  position: \"top\" | \"middle\" | \"bottom\";\n  isMoving?: boolean;\n  className?: string;\n}\n\nexport default function CarIcon({ \n  isVisible, \n  position, \n  isMoving = false, \n  className = \"\" \n}: CarIconProps) {\n  const [showExhaust, setShowExhaust] = useState(false);\n\n  useEffect(() => {\n    if (isMoving) {\n      setShowExhaust(true);\n      const timer = setTimeout(() => setShowExhaust(false), 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [isMoving]);\n\n  const getPositionStyles = () => {\n    switch (position) {\n      case \"top\":\n        return { top: \"10px\" };\n      case \"middle\":\n        return { top: \"50%\", transform: \"translateY(-50%)\" };\n      case \"bottom\":\n        return { bottom: \"10px\" };\n      default:\n        return { top: \"50%\", transform: \"translateY(-50%)\" };\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ scale: 0, opacity: 0, rotate: -180 }}\n          animate={{ \n            scale: 1, \n            opacity: 1, \n            rotate: 0,\n            y: isMoving ? [0, -5, 0] : 0\n          }}\n          exit={{ scale: 0, opacity: 0, rotate: 180 }}\n          transition={{\n            duration: 0.8,\n            ease: \"easeOut\",\n            y: {\n              duration: 1.5,\n              repeat: isMoving ? Infinity : 0,\n              ease: \"easeInOut\"\n            }\n          }}\n          className={`absolute left-1/2 transform -translate-x-1/2 z-20 ${className}`}\n          style={getPositionStyles()}\n          data-testid=\"car-icon\"\n        >\n          <div className=\"relative\">\n            {/* Car Body */}\n            <motion.div\n              animate={{\n                rotate: isMoving ? [0, 1, -1, 0] : 0\n              }}\n              transition={{\n                duration: 0.5,\n                repeat: isMoving ? Infinity : 0,\n                ease: \"easeInOut\"\n              }}\n              className=\"relative\"\n            >\n              {/* Main Car SVG */}\n              <svg\n                width=\"40\"\n                height=\"24\"\n                viewBox=\"0 0 40 24\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                className=\"drop-shadow-lg\"\n              >\n                {/* Car Shadow */}\n                <ellipse\n                  cx=\"20\"\n                  cy=\"22\"\n                  rx=\"16\"\n                  ry=\"2\"\n                  fill=\"#000000\"\n                  opacity=\"0.1\"\n                />\n                \n                {/* Car Body */}\n                <rect\n                  x=\"4\"\n                  y=\"8\"\n                  width=\"32\"\n                  height=\"10\"\n                  rx=\"2\"\n                  fill=\"#0d9488\"\n                  className=\"drop-shadow-sm\"\n                />\n                \n                {/* Car Top */}\n                <rect\n                  x=\"8\"\n                  y=\"4\"\n                  width=\"24\"\n                  height=\"8\"\n                  rx=\"4\"\n                  fill=\"#0f766e\"\n                  className=\"drop-shadow-sm\"\n                />\n                \n                {/* Windows */}\n                <rect\n                  x=\"10\"\n                  y=\"6\"\n                  width=\"8\"\n                  height=\"4\"\n                  rx=\"1\"\n                  fill=\"#a7f3d0\"\n                  opacity=\"0.8\"\n                />\n                <rect\n                  x=\"22\"\n                  y=\"6\"\n                  width=\"8\"\n                  height=\"4\"\n                  rx=\"1\"\n                  fill=\"#a7f3d0\"\n                  opacity=\"0.8\"\n                />\n                \n                {/* Headlights */}\n                <circle\n                  cx=\"36\"\n                  cy=\"13\"\n                  r=\"2\"\n                  fill=\"#fef9c3\"\n                  stroke=\"#fbbf24\"\n                  strokeWidth=\"0.5\"\n                />\n                \n                {/* Wheels */}\n                <circle\n                  cx=\"10\"\n                  cy=\"18\"\n                  r=\"3\"\n                  fill=\"#374151\"\n                  className=\"drop-shadow-sm\"\n                />\n                <circle\n                  cx=\"30\"\n                  cy=\"18\"\n                  r=\"3\"\n                  fill=\"#374151\"\n                  className=\"drop-shadow-sm\"\n                />\n                \n                {/* Wheel centers */}\n                <circle cx=\"10\" cy=\"18\" r=\"1.5\" fill=\"#6b7280\" />\n                <circle cx=\"30\" cy=\"18\" r=\"1.5\" fill=\"#6b7280\" />\n              </svg>\n\n              {/* Cute exhaust puffs when moving */}\n              <AnimatePresence>\n                {showExhaust && (\n                  <motion.div\n                    initial={{ scale: 0, opacity: 0, x: 0 }}\n                    animate={{ \n                      scale: [0, 1, 1.5],\n                      opacity: [0, 0.6, 0],\n                      x: [-15, -20, -25]\n                    }}\n                    exit={{ opacity: 0 }}\n                    transition={{ duration: 1, repeat: Infinity, repeatDelay: 0.5 }}\n                    className=\"absolute top-2 left-0\"\n                  >\n                    <div className=\"text-gray-400 text-xs\">💨</div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </motion.div>\n\n            {/* Position indicator dot */}\n            <motion.div\n              animate={{\n                scale: [1, 1.2, 1],\n                opacity: [0.7, 1, 0.7]\n              }}\n              transition={{\n                duration: 2,\n                repeat: Infinity,\n                ease: \"easeInOut\"\n              }}\n              className=\"absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-primary rounded-full\"\n            />\n\n            {/* \"Live\" indicator */}\n            <motion.div\n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 whitespace-nowrap\"\n            >\n              <div className=\"bg-primary text-white text-xs px-2 py-1 rounded-full font-medium shadow-md\">\n                🔴 Live\n              </div>\n            </motion.div>\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\n// Simple animated car for loading states\nexport function CarLoadingIcon({ className = \"\" }: { className?: string }) {\n  return (\n    <motion.div\n      animate={{\n        x: [0, 10, 0],\n        rotate: [0, 2, -2, 0]\n      }}\n      transition={{\n        duration: 2,\n        repeat: Infinity,\n        ease: \"easeInOut\"\n      }}\n      className={`text-2xl ${className}`}\n      data-testid=\"car-loading-icon\"\n    >\n      🚗\n    </motion.div>\n  );\n}","size_bytes":6860},"client/src/components/PrivacyLoginPage.tsx":{"content":"import { useState } from \"react\";\nimport { Eye, EyeOff, Lock, Wine } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { TourSettings } from \"@shared/schema\";\n\nexport default function PrivacyLoginPage() {\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const { login, isLoading } = useAuth();\n  const { toast } = useToast();\n\n  // Fetch tour settings to get the current tour name\n  const { data: tourSettings } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!password.trim()) {\n      toast({\n        title: \"Fehler\",\n        description: \"Bitte geben Sie das Passwort ein\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const result = await login(password);\n    \n    if (!result.success) {\n      toast({\n        title: \"Login fehlgeschlagen\",\n        description: result.error || \"Ungültiges Passwort\",\n        variant: \"destructive\",\n      });\n      setPassword(\"\"); // Clear password on failed attempt\n    } else {\n      toast({\n        title: \"Erfolgreich angemeldet\",\n        description: `Willkommen zur ${tourSettings?.tourName || 'Kanada Tour 2025'}!`,\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-amber-50 via-white to-green-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md space-y-6\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <div className=\"flex justify-center\">\n            <div className=\"bg-amber-100 dark:bg-amber-900 p-3 rounded-full\">\n              <Wine className=\"w-8 h-8 text-amber-600 dark:text-amber-400\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {tourSettings?.tourName || 'Kanada Tour 2025'}\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-300 text-sm\">\n            Bitte geben Sie das Passwort ein, um die Tour-Details zu sehen\n          </p>\n        </div>\n\n        {/* Login Form */}\n        <Card className=\"shadow-lg border-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm\">\n          <CardHeader className=\"space-y-1 pb-4\">\n            <CardTitle className=\"text-center text-lg font-medium flex items-center justify-center gap-2\">\n              <Lock className=\"w-4 h-4\" />\n              Passwort erforderlich\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Passwort</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    placeholder=\"Geben Sie das Tour-Passwort ein\"\n                    className=\"pr-10\"\n                    required\n                    disabled={isLoading}\n                    data-testid=\"input-privacy-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    disabled={isLoading}\n                    data-testid=\"button-toggle-password\"\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                    ) : (\n                      <Eye className=\"h-4 w-4 text-gray-400\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n              \n              <Button\n                type=\"submit\"\n                className=\"w-full bg-amber-600 hover:bg-amber-700 dark:bg-amber-700 dark:hover:bg-amber-600\"\n                disabled={isLoading}\n                data-testid=\"button-privacy-login\"\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    Anmelden...\n                  </div>\n                ) : (\n                  \"Anmelden\"\n                )}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Footer */}\n        <div className=\"text-center text-xs text-gray-500 dark:text-gray-400\">\n          <p>Diese Seite ist passwortgeschützt</p>\n          <p className=\"mt-1\">\n            Sie bleiben angemeldet, bis Sie sich abmelden\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5318},"client/src/components/PrivacyWrapper.tsx":{"content":"import { useState, useEffect, ReactNode } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Wine } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport PrivacyLoginPage from \"@/components/PrivacyLoginPage\";\n\ninterface PrivacyWrapperProps {\n  children: ReactNode;\n}\n\ninterface PrivacyStatusResponse {\n  privacyEnabled: boolean;\n}\n\nexport default function PrivacyWrapper({ children }: PrivacyWrapperProps) {\n  const { isAuthenticated, isLoading: authLoading } = useAuth();\n  const [shouldShowLogin, setShouldShowLogin] = useState(false);\n\n  // Query privacy status from server\n  const {\n    data: privacyStatus,\n    isLoading: statusLoading,\n    error: statusError\n  } = useQuery<PrivacyStatusResponse>({\n    queryKey: [\"/api/privacy-status\"],\n    staleTime: 2 * 60 * 1000, // Cache for 2 minutes\n    retry: 2,\n  });\n\n  // Determine what to show based on privacy settings and auth status\n  useEffect(() => {\n    if (statusLoading || authLoading) return;\n\n    // If there's an error fetching privacy status, default to showing the app\n    if (statusError) {\n      console.warn(\"Failed to fetch privacy status, defaulting to public access:\", statusError);\n      setShouldShowLogin(false);\n      return;\n    }\n\n    // If privacy is disabled, show the app directly\n    if (!privacyStatus?.privacyEnabled) {\n      setShouldShowLogin(false);\n      return;\n    }\n\n    // If privacy is enabled, show login if not authenticated\n    setShouldShowLogin(!isAuthenticated);\n  }, [privacyStatus, isAuthenticated, statusLoading, authLoading, statusError]);\n\n  // Show loading state while checking privacy status or auth\n  if (statusLoading || authLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-amber-50 via-white to-green-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"bg-amber-100 dark:bg-amber-900 p-3 rounded-full\">\n              <Wine className=\"w-8 h-8 text-amber-600 dark:text-amber-400 animate-pulse\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            Kanada Tour 2025\n          </h1>\n          <div className=\"flex items-center justify-center gap-2 text-gray-600 dark:text-gray-300\">\n            <div className=\"w-4 h-4 border-2 border-amber-600 border-t-transparent rounded-full animate-spin\" />\n            <span>Wird geladen...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show login page if privacy is enabled and user is not authenticated\n  if (shouldShowLogin) {\n    return <PrivacyLoginPage />;\n  }\n\n  // Show the main app\n  return <>{children}</>;\n}","size_bytes":2793},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface AuthContextType {\n  isAuthenticated: boolean;\n  login: (password: string) => Promise<{ success: boolean; error?: string }>;\n  logout: () => void;\n  isLoading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nconst STORAGE_KEY = \"tour-logged-in\";\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check localStorage on mount\n  useEffect(() => {\n    const loggedIn = localStorage.getItem(STORAGE_KEY) === \"true\";\n    setIsAuthenticated(loggedIn);\n    setIsLoading(false);\n  }, []);\n\n  const login = async (password: string): Promise<{ success: boolean; error?: string }> => {\n    try {\n      setIsLoading(true);\n      \n      const response: any = await apiRequest(\"POST\", \"/api/simple-login\", { \n        password\n      });\n\n      if (response.success) {\n        // Set localStorage and update state\n        localStorage.setItem(STORAGE_KEY, \"true\");\n        setIsAuthenticated(true);\n        \n        return { success: true };\n      } else {\n        return { success: false, error: response.message || \"Login fehlgeschlagen\" };\n      }\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      \n      // Extract error message from API response\n      const errorMessage = error.message || \"Unbekannter Fehler beim Login\";\n      \n      return { \n        success: false, \n        error: errorMessage\n      };\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem(STORAGE_KEY);\n    setIsAuthenticated(false);\n  };\n\n  const value: AuthContextType = {\n    isAuthenticated,\n    login,\n    logout,\n    isLoading,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth(): AuthContextType {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}","size_bytes":2249},"client/src/lib/geolocationService.ts":{"content":"import { apiRequest } from \"@/lib/queryClient\";\nimport type { InsertLocationPing } from \"@shared/schema\";\n\ninterface GeolocationState {\n  isEnabled: boolean;\n  hasPermission: boolean;\n  lastPosition: GeolocationPosition | null;\n  intervalId: number | null;\n  isTracking: boolean;\n}\n\nclass GeolocationService {\n  private state: GeolocationState = {\n    isEnabled: false,\n    hasPermission: false,\n    lastPosition: null,\n    intervalId: null,\n    isTracking: false,\n  };\n\n  private readonly TRACKING_INTERVAL = 30 * 60 * 1000; // 30 minutes in milliseconds\n  private readonly POSITION_OPTIONS: PositionOptions = {\n    enableHighAccuracy: false, // Use less battery for tours\n    timeout: 10000, // 10 seconds timeout\n    maximumAge: 5 * 60 * 1000, // Accept 5-minute old position\n  };\n\n  /**\n   * Check if geolocation is available in the browser\n   */\n  isGeolocationAvailable(): boolean {\n    return \"geolocation\" in navigator;\n  }\n\n  /**\n   * Request permission and start location tracking\n   * Returns a friendly message about the result\n   */\n  async requestLocationTracking(): Promise<{\n    success: boolean;\n    message: string;\n    canTrack: boolean;\n  }> {\n    if (!this.isGeolocationAvailable()) {\n      return {\n        success: false,\n        message: \"GPS ist in diesem Browser nicht verfügbar. Die App funktioniert trotzdem!\",\n        canTrack: false,\n      };\n    }\n\n    try {\n      // Request permission by trying to get current position\n      const position = await this.getCurrentPosition();\n      \n      this.state.hasPermission = true;\n      this.state.lastPosition = position;\n      \n      // Send initial location ping\n      await this.sendLocationPing(position);\n      \n      // Start periodic tracking\n      this.startPeriodicTracking();\n      \n      return {\n        success: true,\n        message: \"🚗 Super! Euer Auto wird jetzt auf der Timeline angezeigt und zeigt euren Reisefortschritt.\",\n        canTrack: true,\n      };\n    } catch (error) {\n      console.log(\"Geolocation permission denied or failed:\", error);\n      \n      let message = \"Kein Problem! Das Live-Auto ist optional. Ihr könnt die Tour-App trotzdem vollständig nutzen.\";\n      \n      if (error instanceof GeolocationPositionError) {\n        switch (error.code) {\n          case GeolocationPositionError.PERMISSION_DENIED:\n            message = \"GPS-Berechtigung wurde verweigert. Die App funktioniert trotzdem perfekt!\";\n            break;\n          case GeolocationPositionError.POSITION_UNAVAILABLE:\n            message = \"GPS-Position ist momentan nicht verfügbar. Versucht es später nochmal!\";\n            break;\n          case GeolocationPositionError.TIMEOUT:\n            message = \"GPS-Abfrage dauert zu lange. Das Live-Auto ist aber optional!\";\n            break;\n        }\n      }\n      \n      return {\n        success: false,\n        message,\n        canTrack: false,\n      };\n    }\n  }\n\n  /**\n   * Get current position as a Promise\n   */\n  private getCurrentPosition(): Promise<GeolocationPosition> {\n    return new Promise((resolve, reject) => {\n      navigator.geolocation.getCurrentPosition(\n        resolve,\n        reject,\n        this.POSITION_OPTIONS\n      );\n    });\n  }\n\n  /**\n   * Send location ping to backend\n   */\n  private async sendLocationPing(position: GeolocationPosition): Promise<void> {\n    try {\n      const locationPing: InsertLocationPing = {\n        latitude: position.coords.latitude.toString(),\n        longitude: position.coords.longitude.toString(),\n        accuracy: Math.round(position.coords.accuracy),\n        deviceId: this.getDeviceId(),\n        timestamp: new Date(position.timestamp),\n      };\n\n      await apiRequest(\"POST\", \"/api/location-ping\", locationPing);\n\n      console.log(\"📍 Location ping sent successfully\");\n    } catch (error) {\n      console.error(\"Failed to send location ping:\", error);\n      // Store failed pings for later retry (offline support)\n      this.storePendingPing(position);\n    }\n  }\n\n  /**\n   * Start periodic location tracking every 30 minutes\n   */\n  private startPeriodicTracking(): void {\n    if (this.state.intervalId) {\n      clearInterval(this.state.intervalId);\n    }\n\n    this.state.isTracking = true;\n    \n    this.state.intervalId = window.setInterval(async () => {\n      try {\n        const position = await this.getCurrentPosition();\n        this.state.lastPosition = position;\n        await this.sendLocationPing(position);\n        \n        // Try to send any pending pings when online\n        await this.retryPendingPings();\n      } catch (error) {\n        console.log(\"Periodic location update failed:\", error);\n        // Don't spam the user with errors - this is background tracking\n      }\n    }, this.TRACKING_INTERVAL);\n\n    console.log(\"🚗 Location tracking started - updating every 30 minutes\");\n  }\n\n  /**\n   * Stop location tracking\n   */\n  stopLocationTracking(): void {\n    if (this.state.intervalId) {\n      clearInterval(this.state.intervalId);\n      this.state.intervalId = null;\n    }\n    this.state.isTracking = false;\n    console.log(\"🚗 Location tracking stopped\");\n  }\n\n  /**\n   * Get a simple device/session identifier\n   */\n  private getDeviceId(): string {\n    let deviceId = localStorage.getItem(\"tour-device-id\");\n    if (!deviceId) {\n      deviceId = `device-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n      localStorage.setItem(\"tour-device-id\", deviceId);\n    }\n    return deviceId;\n  }\n\n  /**\n   * Store failed pings for offline support\n   */\n  private storePendingPing(position: GeolocationPosition): void {\n    try {\n      const pendingPings = JSON.parse(\n        localStorage.getItem(\"tour-pending-pings\") || \"[]\"\n      );\n      \n      pendingPings.push({\n        latitude: position.coords.latitude.toString(),\n        longitude: position.coords.longitude.toString(),\n        accuracy: Math.round(position.coords.accuracy),\n        deviceId: this.getDeviceId(),\n        timestamp: new Date(position.timestamp).toISOString(),\n      });\n\n      // Keep only last 10 pending pings to avoid storage bloat\n      if (pendingPings.length > 10) {\n        pendingPings.splice(0, pendingPings.length - 10);\n      }\n\n      localStorage.setItem(\"tour-pending-pings\", JSON.stringify(pendingPings));\n    } catch (error) {\n      console.error(\"Failed to store pending ping:\", error);\n    }\n  }\n\n  /**\n   * Retry sending pending pings when back online\n   */\n  private async retryPendingPings(): Promise<void> {\n    try {\n      const pendingPings = JSON.parse(\n        localStorage.getItem(\"tour-pending-pings\") || \"[]\"\n      );\n\n      if (pendingPings.length === 0) return;\n\n      // Try to send all pending pings\n      for (const ping of pendingPings) {\n        try {\n          await apiRequest(\"POST\", \"/api/location-ping\", ping);\n        } catch (error) {\n          // If one fails, stop trying to avoid spam\n          console.log(\"Still offline, will retry later\");\n          return;\n        }\n      }\n\n      // Clear pending pings if all succeeded\n      localStorage.removeItem(\"tour-pending-pings\");\n      console.log(`📍 Successfully sent ${pendingPings.length} pending location pings`);\n    } catch (error) {\n      console.error(\"Failed to retry pending pings:\", error);\n    }\n  }\n\n  /**\n   * Get current tracking state\n   */\n  getState(): GeolocationState {\n    return { ...this.state };\n  }\n\n  /**\n   * Get last known position\n   */\n  getLastPosition(): GeolocationPosition | null {\n    return this.state.lastPosition;\n  }\n\n  /**\n   * Check if currently tracking\n   */\n  isTracking(): boolean {\n    return this.state.isTracking;\n  }\n}\n\n// Export singleton instance\nexport const geolocationService = new GeolocationService();\nexport default geolocationService;","size_bytes":7705},"client/src/lib/positionCalculator.ts":{"content":"import type { Location, LocationPing } from \"@shared/schema\";\n\ninterface CarPosition {\n  isVisible: boolean;\n  locationIndex: number; // Which location the car is closest to\n  progress: number; // 0-1 value showing progress between locations\n  isMoving: boolean;\n  lastUpdated: Date;\n}\n\ninterface LocationWithDistance extends Location {\n  distanceKm: number;\n}\n\n/**\n * Calculate the distance between two GPS coordinates using the Haversine formula\n */\nfunction calculateDistance(\n  lat1: number,\n  lng1: number,\n  lat2: number,\n  lng2: number\n): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\n  const dLng = ((lng2 - lng1) * Math.PI) / 180;\n  \n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos((lat1 * Math.PI) / 180) *\n      Math.cos((lat2 * Math.PI) / 180) *\n      Math.sin(dLng / 2) *\n      Math.sin(dLng / 2);\n  \n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/**\n * Calculate which location the car is closest to and the progress between locations\n */\nexport function calculateCarPosition(\n  currentPing: LocationPing | null,\n  locations: Location[],\n  previousPosition?: CarPosition\n): CarPosition {\n  if (!currentPing || locations.length === 0) {\n    return {\n      isVisible: false,\n      locationIndex: 0,\n      progress: 0,\n      isMoving: false,\n      lastUpdated: new Date(),\n    };\n  }\n\n  const currentLat = parseFloat(currentPing.latitude);\n  const currentLng = parseFloat(currentPing.longitude);\n\n  // Calculate distances to all locations\n  const locationsWithDistance: LocationWithDistance[] = locations\n    .map((location, index) => {\n      if (!location.coordinates) {\n        return { ...location, distanceKm: Infinity };\n      }\n      \n      const distance = calculateDistance(\n        currentLat,\n        currentLng,\n        location.coordinates.lat,\n        location.coordinates.lng\n      );\n      \n      return { ...location, distanceKm: distance };\n    })\n    .sort((a, b) => a.distanceKm - b.distanceKm);\n\n  const nearestLocation = locationsWithDistance[0];\n  const nearestIndex = locations.findIndex(loc => loc.id === nearestLocation.id);\n\n  // Check if we're moving (compare with previous position)\n  let isMoving = false;\n  if (previousPosition && currentPing.timestamp) {\n    const timeDiff = new Date(currentPing.timestamp).getTime() - previousPosition.lastUpdated.getTime();\n    const positionChanged = Math.abs(previousPosition.locationIndex - nearestIndex) > 0.1 ||\n                           Math.abs(previousPosition.progress - 0.5) > 0.1;\n    \n    // Consider moving if position changed in the last hour\n    isMoving = positionChanged && timeDiff < 60 * 60 * 1000;\n  }\n\n  // Calculate progress between locations\n  let progress = 0.5; // Default to middle if we can't calculate\n\n  // If we're very close to a location (within 50km), show at that location\n  if (nearestLocation.distanceKm <= 50) {\n    progress = 0.5; // Show car centered on the location\n  } else {\n    // Calculate progress between current and next location\n    const nextLocationIndex = nearestIndex + 1;\n    if (nextLocationIndex < locations.length) {\n      const nextLocation = locations[nextLocationIndex];\n      if (nextLocation.coordinates) {\n        const distanceToNext = calculateDistance(\n          currentLat,\n          currentLng,\n          nextLocation.coordinates.lat,\n          nextLocation.coordinates.lng\n        );\n\n        const totalDistance = nearestLocation.distanceKm + distanceToNext;\n        if (totalDistance > 0) {\n          // Progress from current location towards next (0 = at current, 1 = at next)\n          progress = nearestLocation.distanceKm / totalDistance;\n          progress = Math.max(0, Math.min(1, progress));\n        }\n      }\n    }\n  }\n\n  // Determine if car should be visible\n  // Show if we're within reasonable distance of the tour route (500km buffer)\n  const isVisible = nearestLocation.distanceKm <= 500;\n\n  return {\n    isVisible,\n    locationIndex: nearestIndex,\n    progress,\n    isMoving,\n    lastUpdated: new Date(currentPing.timestamp || new Date()),\n  };\n}\n\n/**\n * Get a user-friendly message about the current car position\n */\nexport function getPositionMessage(\n  carPosition: CarPosition,\n  locations: Location[]\n): string {\n  if (!carPosition.isVisible) {\n    return \"Das Auto ist zu weit von der Route entfernt 🗺️\";\n  }\n\n  const currentLocation = locations[carPosition.locationIndex];\n  if (!currentLocation) {\n    return \"Position wird berechnet... 🚗\";\n  }\n\n  const nextLocation = locations[carPosition.locationIndex + 1];\n\n  if (carPosition.progress <= 0.3) {\n    return `Das Auto ist in ${currentLocation.name} 📍`;\n  } else if (carPosition.progress >= 0.7 && nextLocation) {\n    return `Das Auto nähert sich ${nextLocation.name} 🚗💨`;\n  } else if (nextLocation) {\n    return `Das Auto ist auf dem Weg von ${currentLocation.name} nach ${nextLocation.name} 🛣️`;\n  } else {\n    return `Das Auto hat ${currentLocation.name} erreicht! 🎉`;\n  }\n}\n\n/**\n * Calculate the visual position of the car on the timeline\n * Returns CSS properties for positioning\n */\nexport function calculateTimelinePosition(\n  carPosition: CarPosition,\n  timelineRef?: HTMLElement\n): {\n  top: number;\n  isVisible: boolean;\n  shouldShowBetween: boolean;\n  betweenIndex?: number;\n} {\n  if (!carPosition.isVisible || !timelineRef) {\n    return {\n      top: 0,\n      isVisible: false,\n      shouldShowBetween: false,\n    };\n  }\n\n  // Find timeline items (location cards)\n  const timelineItems = timelineRef.querySelectorAll('[data-testid^=\"timeline-item-\"]');\n  \n  if (timelineItems.length === 0) {\n    return {\n      top: 0,\n      isVisible: false,\n      shouldShowBetween: false,\n    };\n  }\n\n  const currentItemIndex = Math.min(carPosition.locationIndex, timelineItems.length - 1);\n  const currentItem = timelineItems[currentItemIndex] as HTMLElement;\n  const nextItem = timelineItems[currentItemIndex + 1] as HTMLElement;\n\n  const currentItemRect = currentItem.getBoundingClientRect();\n  const timelineRect = timelineRef.getBoundingClientRect();\n\n  // Base position at current location\n  let top = currentItemRect.top - timelineRect.top + (currentItemRect.height / 2);\n\n  // If we have significant progress and a next item, interpolate position\n  if (carPosition.progress > 0.3 && nextItem) {\n    const nextItemRect = nextItem.getBoundingClientRect();\n    const nextTop = nextItemRect.top - timelineRect.top + (nextItemRect.height / 2);\n    \n    // Interpolate between current and next position\n    const progressAdjusted = (carPosition.progress - 0.3) / 0.7; // Normalize to 0-1\n    top = top + (nextTop - top) * progressAdjusted;\n\n    return {\n      top,\n      isVisible: true,\n      shouldShowBetween: true,\n      betweenIndex: currentItemIndex,\n    };\n  }\n\n  return {\n    top,\n    isVisible: true,\n    shouldShowBetween: false,\n  };\n}\n\n/**\n * Cache for storing last calculated position to detect movement\n */\nlet lastCarPosition: CarPosition | undefined;\n\n/**\n * Get the current car position with movement detection\n */\nexport function getCurrentCarPosition(\n  currentPing: LocationPing | null,\n  locations: Location[]\n): CarPosition {\n  const newPosition = calculateCarPosition(currentPing, locations, lastCarPosition);\n  lastCarPosition = newPosition;\n  return newPosition;\n}","size_bytes":7353},"client/src/components/Header.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Home, Camera, Settings, Menu, X, Map, Globe, MapPin, Clock } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { TourSettings, LocationPing } from \"@shared/schema\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { getLocationStatus } from \"@/lib/locationUtils\";\n\nexport default function Header() {\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const { language, setLanguage, t } = useLanguage();\n\n  // Update time every minute\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 60000); // Update every minute\n    return () => clearInterval(interval);\n  }, []);\n\n  // Fetch tour settings to get the current tour name\n  const { data: tourSettings } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  // Fetch latest location ping for GPS status (always enabled if data exists)\n  const { data: latestPing } = useQuery<LocationPing>({\n    queryKey: [\"/api/location-ping/latest\"],\n    refetchInterval: 2 * 60 * 1000, // Refresh every 2 minutes\n  });\n\n  // Helper function to extract initials from tour name\n  const getInitialsFromTourName = (tourName: string | undefined): string => {\n    if (!tourName) return \"WT\"; // Default fallback\n    \n    // Split by spaces and get first two words\n    const words = tourName.trim().split(/\\s+/);\n    \n    if (words.length === 0) return \"WT\";\n    \n    if (words.length === 1) {\n      // If only one word, take first two characters\n      const word = words[0].toUpperCase();\n      return word.length >= 2 ? word.substring(0, 2) : word + \"T\";\n    }\n    \n    // Take first letter of first two words\n    const firstInitial = words[0].charAt(0).toUpperCase();\n    const secondInitial = words[1].charAt(0).toUpperCase();\n    \n    return firstInitial + secondInitial;\n  };\n\n  const isActive = (path: string) => {\n    if (path === \"/\" && location === \"/\") return true;\n    if (path !== \"/\" && location.startsWith(path)) return true;\n    return false;\n  };\n\n  const scrollToSection = (sectionId: string) => {\n    const element = document.getElementById(sectionId);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth' });\n    }\n    setMobileMenuOpen(false);\n  };\n\n  // Create navigation links with context-aware Reiseverlauf on home page\n  const baseNavLinks = [\n    { href: \"/\", label: t('homepage'), icon: Home, type: \"link\" },\n  ];\n\n  const homePageScrollLinks = location === \"/\" ? [\n    { href: \"#timeline\", label: t('navItinerary'), icon: Map, type: \"scroll\", scrollTarget: \"timeline\" },\n  ] : [];\n\n  const otherNavLinks = [\n    { href: \"/live-feed\", label: t('liveFeed'), icon: Camera, type: \"link\" },\n    { href: \"/admin\", label: t('navEdit'), icon: Settings, type: \"link\" },\n  ];\n\n  const navLinks = [...baseNavLinks, ...homePageScrollLinks, ...otherNavLinks];\n\n  return (\n    <header className=\"sticky top-0 z-50 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800\" data-testid=\"main-header\">\n      <nav className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex justify-between items-center h-16\">\n          {/* Logo/Brand - tablet optimized */}\n          <Link href=\"/\" className=\"flex items-center space-x-2 md:space-x-3 text-foreground\" data-testid=\"header-logo\">\n            <div className=\"w-7 h-7 md:w-8 md:h-8 bg-primary rounded-lg flex items-center justify-center\">\n              <span className=\"text-primary-foreground font-bold text-xs md:text-sm\" data-testid=\"header-logo-initials\">\n                {getInitialsFromTourName(tourSettings?.tourName)}\n              </span>\n            </div>\n            <span className=\"font-semibold text-base md:text-lg hidden sm:block\" data-testid=\"header-tour-name\">\n              {tourSettings?.tourName || 'Kanada Tour 2025'}\n            </span>\n          </Link>\n\n          {/* Location Status - Desktop */}\n          {latestPing && (\n            <div className=\"hidden lg:flex items-center space-x-2 px-4 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\" data-testid=\"location-status-desktop\">\n              <MapPin className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n              <span className=\"text-sm text-green-700 dark:text-green-300\">\n                {getLocationStatus(\n                  parseFloat(latestPing.latitude), \n                  parseFloat(latestPing.longitude), \n                  language === 'en'\n                )}\n              </span>\n            </div>\n          )}\n\n          {/* Desktop Navigation - text labels on tablets and up */}\n          <div className=\"hidden md:flex items-center space-x-2 lg:space-x-4 xl:space-x-6\">\n            {navLinks.map((link) => {\n              const Icon = link.icon;\n              \n              if (link.type === \"scroll\") {\n                return (\n                  <button\n                    key={link.href}\n                    onClick={() => scrollToSection((link as any).scrollTarget || \"timeline\")}\n                    className=\"flex items-center space-x-2 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800\"\n                    data-testid={`nav-${link.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <Icon className=\"w-4 h-4\" />\n                    <span className=\"text-sm lg:text-base\">{link.label}</span>\n                  </button>\n                );\n              }\n              \n              return (\n                <Link \n                  key={link.href} \n                  href={link.href}\n                  className={`flex items-center space-x-2 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg transition-colors ${\n                    isActive(link.href)\n                      ? \"bg-primary/10 text-primary font-medium\"\n                      : \"text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800\"\n                  }`}\n                  data-testid={`nav-${link.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span className=\"text-sm lg:text-base\">{link.label}</span>\n                </Link>\n              );\n            })}\n            \n            {/* Language Toggle - compact on tablet */}\n            <button\n              onClick={() => setLanguage(language === 'de' ? 'en' : 'de')}\n              className=\"flex items-center space-x-2 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800\"\n              data-testid=\"language-toggle\"\n            >\n              <Globe className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">{language.toUpperCase()}</span>\n            </button>\n          </div>\n\n          {/* Mobile Actions */}\n          <div className=\"md:hidden flex items-center\">\n            {/* Mobile Menu Button */}\n            <button\n              className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              data-testid=\"mobile-menu-toggle\"\n              aria-label=\"Toggle mobile menu\"\n            >\n              {mobileMenuOpen ? (\n                <X className=\"w-6 h-6 text-foreground\" />\n              ) : (\n                <Menu className=\"w-6 h-6 text-foreground\" />\n              )}\n            </button>\n          </div>\n        </div>\n      </nav>\n\n      {/* Mobile Menu */}\n      {mobileMenuOpen && (\n        <div className=\"md:hidden border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900\" data-testid=\"mobile-menu\">\n          <div className=\"px-4 py-3 space-y-1\">\n            {/* Location Status - Mobile */}\n            {latestPing && (\n              <div className=\"flex items-center space-x-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 mb-2\" data-testid=\"location-status-mobile\">\n                <MapPin className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\n                <span className=\"text-sm text-green-700 dark:text-green-300\">\n                  {getLocationStatus(\n                    parseFloat(latestPing.latitude), \n                    parseFloat(latestPing.longitude), \n                    language === 'en'\n                  )}\n                </span>\n              </div>\n            )}\n            {navLinks.map((link) => {\n              const Icon = link.icon;\n              \n              if (link.type === \"scroll\") {\n                return (\n                  <button\n                    key={link.href}\n                    onClick={() => scrollToSection((link as any).scrollTarget || \"timeline\")}\n                    className=\"flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800 w-full text-left\"\n                    data-testid={`mobile-nav-${link.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <Icon className=\"w-5 h-5\" />\n                    <span>{link.label}</span>\n                  </button>\n                );\n              }\n              \n              return (\n                <Link \n                  key={link.href} \n                  href={link.href}\n                  onClick={() => setMobileMenuOpen(false)}\n                  className={`flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n                    isActive(link.href)\n                      ? \"bg-primary/10 text-primary font-medium\"\n                      : \"text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800\"\n                  }`}\n                  data-testid={`mobile-nav-${link.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                >\n                  <Icon className=\"w-5 h-5\" />\n                  <span>{link.label}</span>\n                </Link>\n              );\n            })}\n            \n            {/* Mobile Language Toggle */}\n            <button\n              onClick={() => setLanguage(language === 'de' ? 'en' : 'de')}\n              className=\"flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-muted-foreground hover:text-foreground hover:bg-gray-100 dark:hover:bg-gray-800 w-full text-left\"\n              data-testid=\"mobile-language-toggle\"\n            >\n              <Globe className=\"w-5 h-5\" />\n              <span>Language: {language.toUpperCase()}</span>\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Absolutely Positioned Mobile Live Feed Button */}\n      <Link\n        href=\"/live-feed\"\n        className={`md:hidden fixed bottom-6 right-6 z-[100] flex items-center justify-center w-14 h-14 rounded-full shadow-lg transition-all duration-200 ${\n          isActive(\"/live-feed\")\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-white dark:bg-gray-800 text-muted-foreground hover:text-foreground shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700\"\n        }`}\n        data-testid=\"mobile-live-feed-fab\"\n        aria-label={t('liveFeed')}\n      >\n        <Camera className=\"w-6 h-6\" />\n      </Link>\n    </header>\n  );\n}","size_bytes":11495},"client/src/components/FloatingUploadButton.tsx":{"content":"import { useState } from \"react\";\nimport { Plus, Camera } from \"lucide-react\";\nimport UploadModal from \"./UploadModal\";\n\nexport default function FloatingUploadButton() {\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\n\n  const handleOpenUpload = () => {\n    setIsUploadModalOpen(true);\n  };\n\n  const handleCloseUpload = () => {\n    setIsUploadModalOpen(false);\n  };\n\n  return (\n    <>\n      {/* Floating Action Button */}\n      <button\n        onClick={handleOpenUpload}\n        className=\"\n          fixed z-50\n          w-16 h-16 \n          bg-primary hover:bg-primary/90 \n          text-primary-foreground \n          rounded-full \n          shadow-lg hover:shadow-xl \n          transition-all duration-200 ease-in-out\n          flex items-center justify-center\n          focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2\n          active:scale-95\n          md:w-14 md:h-14\n          bottom-6 right-6\n        \"\n        data-testid=\"floating-upload-button\"\n        aria-label=\"Foto hochladen\"\n      >\n        <div className=\"relative\">\n          {/* Plus icon for general upload */}\n          <Plus \n            className=\"w-6 h-6 md:w-5 md:h-5 transition-transform duration-200\" \n            strokeWidth={2.5}\n          />\n          {/* Small camera icon overlay */}\n          <Camera \n            className=\"absolute -bottom-1 -right-1 w-3 h-3 md:w-2.5 md:h-2.5 opacity-80\" \n            strokeWidth={2}\n          />\n        </div>\n      </button>\n\n      {/* Upload Modal */}\n      <UploadModal\n        isOpen={isUploadModalOpen}\n        onClose={handleCloseUpload}\n      />\n    </>\n  );\n}","size_bytes":1636},"client/src/components/UploadModal.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Camera, Upload, X, Video, Image } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Location, Creator } from \"@shared/schema\";\nimport * as exifr from \"exifr\";\n\ninterface UploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function UploadModal({ isOpen, onClose }: UploadModalProps) {\n  const [, setLocation] = useLocation();\n  const [caption, setCaption] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [selectedLocationId, setSelectedLocationId] = useState<string>(\"general\");\n  const [selectedCreatorId, setSelectedCreatorId] = useState<string>(\"\");\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [mediaType, setMediaType] = useState<'image' | 'video'>('image');\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0 });\n  const [uploadStatus, setUploadStatus] = useState<string>(\"\");\n  const [processedFiles, setProcessedFiles] = useState(0);\n  const [visualPercent, setVisualPercent] = useState(0);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n\n  // Fetch locations for the optional location selector\n  const { data: locations } = useQuery<Location[]>({\n    queryKey: [\"/api/locations\"],\n  });\n\n  // Fetch creators for the creator selector\n  const { data: creators = [] } = useQuery<Creator[]>({\n    queryKey: [\"/api/creators\"],\n  });\n\n  // Extract EXIF data from image files\n  const extractExifData = async (file: File): Promise<Date | null> => {\n    try {\n      if (!file.type.startsWith('image/')) {\n        return null; // Not an image file\n      }\n      \n      const exifData = await exifr.parse(file);\n      \n      // Try to get the DateTimeOriginal, DateTime, or CreateDate\n      const dateTime = exifData?.DateTimeOriginal || \n                       exifData?.DateTime || \n                       exifData?.CreateDate;\n      \n      if (dateTime && dateTime instanceof Date) {\n        return dateTime;\n      }\n      \n      return null;\n    } catch (error) {\n      console.warn('Failed to extract EXIF data from', file.name, error);\n      return null;\n    }\n  };\n\n  // Upload mutation for batch trip photos\n  const uploadMutation = useMutation({\n    mutationFn: async ({ files, caption, uploadedBy, locationId, creatorId }: { files: File[]; caption: string; uploadedBy: string; locationId?: string; creatorId?: string }) => {\n      const formData = new FormData();\n      \n      // Add all files to the form data\n      files.forEach((file) => {\n        formData.append('media', file);\n      });\n      \n      // Update progress: Processing EXIF data\n      setUploadStatus(\"Vorbereitung\");\n      setUploadProgress({ current: 0, total: files.length });\n      setProcessedFiles(0);\n      setVisualPercent(0);\n      \n      // Extract EXIF data for each file sequentially for realistic progress\n      const exifResults = [];\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const takenAt = await extractExifData(file);\n        \n        // Update progress per file (0-60% for EXIF processing)\n        const processed = i + 1;\n        setProcessedFiles(processed);\n        setVisualPercent(Math.round((processed / files.length) * 60));\n        \n        // Small delay for realistic progress display\n        await new Promise(resolve => setTimeout(resolve, 200));\n        \n        exifResults.push({ index: i, takenAt });\n      }\n      \n      // Update progress: Starting upload (60-80%)\n      setUploadStatus(\"Hochladen\");\n      setVisualPercent(65);\n      \n      // Gradual progress during upload preparation\n      await new Promise(resolve => setTimeout(resolve, 300));\n      setVisualPercent(75);\n      \n      // Add EXIF data to form data as JSON\n      const exifData = exifResults.reduce((acc, { index, takenAt }) => {\n        if (takenAt) {\n          acc[index] = takenAt.toISOString();\n        }\n        return acc;\n      }, {} as Record<number, string>);\n      \n      formData.append('exifData', JSON.stringify(exifData));\n      formData.append('caption', caption || '');\n      if (uploadedBy) formData.append('uploadedBy', uploadedBy);\n      if (locationId) formData.append('locationId', locationId);\n      if (creatorId) formData.append('creatorId', creatorId);\n\n      // Show uploading progress\n      setVisualPercent(85);\n      \n      const response = await fetch('/api/trip-photos/media-batch', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Upload fehlgeschlagen\");\n      }\n      \n      // Final progress steps\n      setVisualPercent(95);\n      await new Promise(resolve => setTimeout(resolve, 200));\n      \n      // Update progress: Upload complete (100%)\n      setUploadStatus(\"Fertig\");\n      setVisualPercent(100);\n      setUploadProgress({ current: files.length, total: files.length });\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate all trip photo queries to refresh feed\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos/paginated\"] });\n      // Auto-redirect to news feed after upload\n      setLocation('/live-feed');\n    },\n    onSettled: () => {\n      setUploading(false);\n      setUploadProgress({ current: 0, total: 0 });\n      setUploadStatus(\"\");\n      setProcessedFiles(0);\n      setVisualPercent(0);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Upload fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Reset form helper\n  const resetForm = () => {\n    setCaption(\"\");\n    setName(\"\");\n    setSelectedLocationId(\"general\");\n    setSelectedCreatorId(\"\");\n    setSelectedFiles([]);\n    setMediaType('image');\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\n  };\n\n  // File selection handler for multiple files\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (files.length === 0) return;\n\n    const validFiles: File[] = [];\n    let hasVideo = false;\n    let hasImage = false;\n\n    // Validate each file\n    for (const file of files) {\n      const isImage = file.type.startsWith('image/');\n      const isVideo = file.type.startsWith('video/');\n      \n      if (!isImage && !isVideo) {\n        toast({\n          title: \"Ungültiger Dateityp\",\n          description: `Datei \"${file.name}\" ist kein gültiges Bild oder Video.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n\n      const maxSize = isVideo ? 50 * 1024 * 1024 : 10 * 1024 * 1024; // 50MB for video, 10MB for image\n      if (file.size > maxSize) {\n        toast({\n          title: \"Datei zu groß\",\n          description: `\"${file.name}\" ist zu groß. ${isVideo ? 'Videos' : 'Bilder'} dürfen maximal ${isVideo ? '50' : '10'}MB groß sein.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n\n      validFiles.push(file);\n      if (isVideo) hasVideo = true;\n      if (isImage) hasImage = true;\n    }\n\n    if (validFiles.length === 0) {\n      return;\n    }\n\n    // Set media type based on content\n    if (hasVideo && hasImage) {\n      setMediaType('image'); // Mixed content, default to image\n    } else if (hasVideo) {\n      setMediaType('video');\n    } else {\n      setMediaType('image');\n    }\n\n    setSelectedFiles(validFiles);\n  };\n\n  // Handle modal close\n  const handleCloseModal = () => {\n    resetForm();\n    onClose();\n  };\n\n  // Upload handler for multiple files\n  const handleUpload = async () => {\n    if (selectedFiles.length === 0) {\n      toast({\n        title: \"Keine Dateien ausgewählt\",\n        description: \"Bitte wählen Sie mindestens ein Bild oder Video aus.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check if creator is selected\n    if (!selectedCreatorId) {\n      toast({\n        title: \"Person auswählen\",\n        description: \"Bitte wählen Sie aus, wer die Dateien hochlädt.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    setUploadStatus(\"Start\");\n    setUploadProgress({ current: 0, total: selectedFiles.length });\n    setProcessedFiles(0);\n    setVisualPercent(0);\n    \n    try {\n      await uploadMutation.mutateAsync({\n        files: selectedFiles,\n        caption: caption.trim(),\n        uploadedBy: name.trim(),\n        locationId: selectedLocationId === \"general\" ? undefined : selectedLocationId,\n        creatorId: selectedCreatorId,\n      });\n      \n      // Reset form on success\n      resetForm();\n      onClose();\n      \n      toast({\n        title: \"📤 Upload erfolgreich!\",\n        description: `${selectedFiles.length} Datei${selectedFiles.length !== 1 ? 'en' : ''} wurden erfolgreich hochgeladen.`,\n        variant: \"default\",\n      });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      toast({\n        title: \"Upload fehlgeschlagen\",\n        description: error instanceof Error ? error.message : \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle open change from dialog\n  const handleOpenChange = (open: boolean) => {\n    if (!open) {\n      handleCloseModal();\n    }\n  };\n\n  return (\n    <>\n      {/* Hidden file input */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        multiple\n        accept=\"image/jpeg,image/jpg,image/png,image/webp,image/gif,video/mp4,video/webm,video/quicktime\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* Upload Modal */}\n      <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"upload-modal\">\n          <DialogHeader>\n            <DialogTitle>Fotos oder Videos teilen</DialogTitle>\n            <DialogDescription>\n              Teilen Sie Ihre Fotos oder Videos mit der Gruppe und fügen Sie optional eine Beschreibung hinzu.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            {/* File selection section */}\n            {selectedFiles.length === 0 ? (\n              <div className=\"border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-6\">\n                <div className=\"text-center\">\n                  <Camera className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2\">\n                    Fotos oder Videos auswählen\n                  </h3>\n                  <p className=\"text-gray-500 text-sm mb-4\">\n                    Mehrere Dateien auswählen: Bilder (JPG, PNG, WebP, GIF) bis 10MB oder Videos (MP4, WebM, MOV) bis 50MB\n                  </p>\n                  <Button\n                    onClick={() => fileInputRef.current?.click()}\n                    variant=\"outline\"\n                    className=\"w-full\"\n                    data-testid=\"button-select-file\"\n                  >\n                    <Upload className=\"w-4 h-4 mr-2\" />\n                    Dateien auswählen\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <>\n                {/* Selected files preview */}\n                <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg p-3\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      {selectedFiles.length} Datei{selectedFiles.length !== 1 ? 'en' : ''} ausgewählt\n                    </span>\n                    <button\n                      onClick={() => setSelectedFiles([])}\n                      className=\"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\n                      data-testid=\"button-remove-all-files\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </button>\n                  </div>\n                  <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                    {selectedFiles.map((file, index) => (\n                      <div key={index} className=\"flex items-center space-x-2 text-xs\">\n                        {file.type.startsWith('video/') ? (\n                          <Video className=\"w-3 h-3 text-blue-600 flex-shrink-0\" />\n                        ) : (\n                          <Image className=\"w-3 h-3 text-green-600 flex-shrink-0\" />\n                        )}\n                        <span className=\"text-gray-600 dark:text-gray-400 truncate\">{file.name}</span>\n                        <button\n                          onClick={() => {\n                            const newFiles = [...selectedFiles];\n                            newFiles.splice(index, 1);\n                            setSelectedFiles(newFiles);\n                          }}\n                          className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 flex-shrink-0\"\n                          data-testid={`button-remove-file-${index}`}\n                        >\n                          <X className=\"w-3 h-3\" />\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Form fields */}\n                <div className=\"space-y-3\">\n                  {/* Creator Selection - Required */}\n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Wer lädt die Dateien hoch? *</label>\n                    <Select value={selectedCreatorId} onValueChange={setSelectedCreatorId}>\n                      <SelectTrigger className=\"border-gray-300 dark:border-gray-700\" data-testid=\"creator-dropdown\">\n                        <SelectValue placeholder=\"Bitte wählen Sie eine Person aus\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {creators.map((creator) => (\n                          <SelectItem key={creator.id} value={creator.id} data-testid={`creator-option-${creator.id}`}>\n                            {creator.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <Input\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    placeholder=\"Zusätzliche Notiz (optional)\"\n                    className=\"border-gray-300 dark:border-gray-700\"\n                    maxLength={100}\n                    data-testid=\"input-name\"\n                  />\n\n                  <Textarea\n                    value={caption}\n                    onChange={(e) => setCaption(e.target.value)}\n                    placeholder=\"Beschreibung hinzufügen...\"\n                    className=\"border-gray-300 dark:border-gray-700 resize-none\"\n                    maxLength={500}\n                    rows={3}\n                    data-testid=\"input-caption\"\n                  />\n\n                  <Select value={selectedLocationId} onValueChange={setSelectedLocationId}>\n                    <SelectTrigger className=\"border-gray-300 dark:border-gray-700\" data-testid=\"select-location\">\n                      <SelectValue placeholder=\"Ort auswählen (optional)\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"general\" data-testid=\"location-option-general\">Kein Ort</SelectItem>\n                      {locations?.filter(location => location.id && location.id.trim() !== '').map((location) => (\n                        <SelectItem key={location.id} value={location.id} data-testid={`location-option-${location.slug}`}>\n                          {location.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Upload Progress Indicator */}\n                {uploading && uploadProgress.total > 0 && (\n                  <div className=\"mb-4 p-4 bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\n                        📤 {uploadStatus}\n                      </span>\n                      <span className=\"text-sm text-blue-600 dark:text-blue-400\">\n                        {uploadStatus === \"Vorbereitung\" ? `Verarbeitet: ${processedFiles}/${uploadProgress.total}` : \n                         uploadStatus === \"Hochladen\" ? \"Upload läuft...\" : \n                         `${uploadProgress.current}/${uploadProgress.total} Dateien`}\n                      </span>\n                    </div>\n                    <div className=\"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2.5 mb-2\">\n                      <div \n                        className=\"bg-gradient-to-r from-blue-500 to-green-500 h-2.5 rounded-full transition-all duration-300 ease-out\"\n                        style={{ width: `${visualPercent}%` }}\n                        data-testid=\"upload-progress-bar\"\n                      ></div>\n                    </div>\n                    <div className=\"text-center\">\n                      <span className=\"text-xs text-blue-600 dark:text-blue-400 font-medium\" data-testid=\"upload-percentage\">\n                        {visualPercent}% abgeschlossen\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                {/* Upload button */}\n                <Button\n                  onClick={handleUpload}\n                  disabled={uploading}\n                  className=\"w-full\"\n                  data-testid=\"button-upload\"\n                >\n                  {uploading ? (\n                    <div className=\"flex items-center justify-center space-x-2\">\n                      <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                      <span>Wird hochgeladen...</span>\n                    </div>\n                  ) : (\n                    <span>{selectedFiles.length} Datei{selectedFiles.length !== 1 ? 'en' : ''} teilen</span>\n                  )}\n                </Button>\n              </>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","size_bytes":19309},"client/src/components/Lightbox.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { ChevronLeft, ChevronRight, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface LightboxImage {\n  id: string;\n  imageUrl: string;\n  caption?: string;\n}\n\ninterface LightboxProps {\n  images: LightboxImage[];\n  currentIndex: number;\n  isOpen: boolean;\n  onClose: () => void;\n  onNext: () => void;\n  onPrevious: () => void;\n}\n\nexport function Lightbox({ \n  images, \n  currentIndex, \n  isOpen, \n  onClose, \n  onNext, \n  onPrevious \n}: LightboxProps) {\n  const [imageLoading, setImageLoading] = useState(true);\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (!isOpen) return;\n\n      switch (e.key) {\n        case 'Escape':\n          onClose();\n          break;\n        case 'ArrowLeft':\n          e.preventDefault();\n          onPrevious();\n          break;\n        case 'ArrowRight':\n          e.preventDefault();\n          onNext();\n          break;\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyPress);\n      // Prevent body scrolling when lightbox is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyPress);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose, onNext, onPrevious]);\n\n  // Reset loading state when image changes\n  useEffect(() => {\n    setImageLoading(true);\n  }, [currentIndex]);\n\n  if (!isOpen || images.length === 0) return null;\n\n  const currentImage = images[currentIndex];\n  const hasMultipleImages = images.length > 1;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-50 bg-black/95 flex items-center justify-center\"\n      onClick={onClose}\n      data-testid=\"lightbox-overlay\"\n    >\n      {/* Close Button */}\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20 p-3\"\n        onClick={onClose}\n        data-testid=\"lightbox-close\"\n      >\n        <X className=\"w-6 h-6\" />\n      </Button>\n\n      {/* Image Counter */}\n      {hasMultipleImages && (\n        <div className=\"absolute top-4 left-1/2 transform -translate-x-1/2 z-10 bg-black/50 text-white px-4 py-2 rounded-full text-sm font-medium\">\n          <span data-testid=\"lightbox-counter\">\n            {currentIndex + 1} von {images.length}\n          </span>\n        </div>\n      )}\n\n      {/* Navigation Arrows */}\n      {hasMultipleImages && (\n        <>\n          {/* Previous Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 text-white hover:bg-white/20 p-4\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onPrevious();\n            }}\n            disabled={currentIndex === 0}\n            data-testid=\"lightbox-previous\"\n          >\n            <ChevronLeft className=\"w-8 h-8\" />\n          </Button>\n\n          {/* Next Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 text-white hover:bg-white/20 p-4\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onNext();\n            }}\n            disabled={currentIndex === images.length - 1}\n            data-testid=\"lightbox-next\"\n          >\n            <ChevronRight className=\"w-8 h-8\" />\n          </Button>\n        </>\n      )}\n\n      {/* Main Image Container */}\n      <div \n        className=\"relative max-w-[95vw] max-h-[95vh] flex items-center justify-center\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Loading State */}\n        {imageLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-2 border-white border-t-transparent\" />\n          </div>\n        )}\n\n        {/* Image */}\n        <img\n          src={currentImage.imageUrl}\n          alt={currentImage.caption || `Bild ${currentIndex + 1}`}\n          decoding=\"async\"\n          className={`max-w-full max-h-full object-contain transition-opacity duration-300 ${\n            imageLoading ? 'opacity-0' : 'opacity-100'\n          }`}\n          onLoad={() => setImageLoading(false)}\n          onError={() => setImageLoading(false)}\n          data-testid=\"lightbox-image\"\n        />\n\n        {/* Caption */}\n        {currentImage.caption && !imageLoading && (\n          <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6\">\n            <p className=\"text-white text-center font-medium text-lg\" data-testid=\"lightbox-caption\">\n              {currentImage.caption}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Touch/Swipe Areas for Mobile */}\n      {hasMultipleImages && (\n        <>\n          {/* Left touch area for previous */}\n          <div \n            className=\"absolute left-0 top-0 bottom-0 w-20 md:w-32 cursor-pointer\"\n            onClick={(e) => {\n              e.stopPropagation();\n              if (currentIndex > 0) onPrevious();\n            }}\n            data-testid=\"lightbox-touch-previous\"\n          />\n          \n          {/* Right touch area for next */}\n          <div \n            className=\"absolute right-0 top-0 bottom-0 w-20 md:w-32 cursor-pointer\"\n            onClick={(e) => {\n              e.stopPropagation();\n              if (currentIndex < images.length - 1) onNext();\n            }}\n            data-testid=\"lightbox-touch-next\"\n          />\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":5667},"server/sync-external-data.ts":{"content":"import type { IStorage } from './storage';\nimport type { Location, HeroImage, ScenicContent, ScenicGalleryItem, LocationImage } from '@shared/schema';\n\nconst EXTERNAL_API_BASE = 'https://kanadareise.replit.app/api';\n\n// Helper function for flexible date parsing\nfunction parseDateFlexible(dateString: string): Date {\n  if (!dateString) throw new Error('Date string is required');\n  \n  // Handle DD.MM.YYYY format\n  if (dateString.includes('.')) {\n    const [day, month, year] = dateString.split('.');\n    const date = new Date(Date.UTC(parseInt(year), parseInt(month) - 1, parseInt(day)));\n    if (isNaN(date.getTime())) throw new Error(`Invalid date format: ${dateString}`);\n    return date;\n  }\n  \n  // Handle ISO-like formats (YYYY-MM-DD, YYYY-MM-DDTHH:mm, etc.)\n  const date = new Date(dateString);\n  if (isNaN(date.getTime())) throw new Error(`Invalid date format: ${dateString}`);\n  return date;\n}\n\n// Convert Date to YYYY-MM-DD string format for storage\nfunction toDateOnlyString(date: Date): string {\n  return date.toISOString().split('T')[0];\n}\n\n// Calculate nights between two dates using UTC to avoid DST issues\nfunction calculateNightsUTC(startDate: string, endDate: string): number {\n  const start = parseDateFlexible(startDate);\n  const end = parseDateFlexible(endDate);\n  \n  const startUTC = Date.UTC(start.getFullYear(), start.getMonth(), start.getDate());\n  const endUTC = Date.UTC(end.getFullYear(), end.getMonth(), end.getDate());\n  \n  const nights = Math.max(1, Math.ceil((endUTC - startUTC) / (1000 * 60 * 60 * 24)));\n  return nights;\n}\n\n// Ensure URLs are absolute, resolve relative URLs against base\nfunction ensureAbsoluteUrl(url: string, base: string = 'https://kanadareise.replit.app'): string {\n  if (!url) return '';\n  \n  // Already absolute URL\n  if (url.startsWith('http://') || url.startsWith('https://')) {\n    return url;\n  }\n  \n  // Relative URL, resolve against base\n  if (url.startsWith('/')) {\n    return new URL(url, base).toString();\n  }\n  \n  // Handle other cases by treating as relative\n  return new URL(`/${url}`, base).toString();\n}\n\n// Fetch data from external API with error handling\nasync function fetchExternalData<T>(endpoint: string): Promise<T> {\n  try {\n    const response = await fetch(`${EXTERNAL_API_BASE}${endpoint}`);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch ${endpoint}: ${response.status} ${response.statusText}`);\n    }\n    return await response.json();\n  } catch (error) {\n    console.error(`Error fetching ${endpoint}:`, error);\n    throw error;\n  }\n}\n\n// Sync locations with proper date handling and nights calculation\nasync function syncLocations(storage: IStorage): Promise<void> {\n  console.log('🔄 Syncing locations...');\n  \n  const externalLocations = await fetchExternalData<any[]>('/locations');\n  \n  for (const extLocation of externalLocations) {\n    try {\n      // Calculate nights from actual dates\n      const nights = calculateNightsUTC(extLocation.startDate, extLocation.endDate);\n      \n      // Normalize dates to YYYY-MM-DD format for storage\n      const startDate = toDateOnlyString(parseDateFlexible(extLocation.startDate));\n      const endDate = toDateOnlyString(parseDateFlexible(extLocation.endDate));\n      \n      const locationData: Omit<Location, 'createdAt' | 'updatedAt'> = {\n        id: extLocation.id,\n        name: extLocation.name,\n        slug: extLocation.slug,\n        startDate,\n        endDate,\n        description: extLocation.description,\n        accommodation: extLocation.accommodation || '',\n        accommodationWebsite: extLocation.accommodationWebsite || '',\n        accommodationImageUrl: ensureAbsoluteUrl(extLocation.accommodationImageUrl),\n        accommodationPrice: extLocation.accommodationPrice || null,\n        accommodationCurrency: extLocation.accommodationCurrency || 'CAD',\n        accommodationInclusiveServices: extLocation.accommodationInclusiveServices || [],\n        accommodationAmenities: extLocation.accommodationAmenities || [],\n        accommodationCheckinTime: extLocation.accommodationCheckinTime || null,\n        accommodationCheckoutTime: extLocation.accommodationCheckoutTime || null,\n        distance: extLocation.distance || 0,\n        imageUrl: ensureAbsoluteUrl(extLocation.imageUrl),\n        mapImageUrl: ensureAbsoluteUrl(extLocation.mapImageUrl),\n        coordinates: extLocation.coordinates || null,\n        activities: extLocation.activities || [],\n        restaurants: extLocation.restaurants || [],\n        experiences: extLocation.experiences || [],\n        highlights: extLocation.highlights || [],\n        funFacts: extLocation.funFacts || [],\n        routeHighlights: extLocation.routeHighlights || [],\n      };\n\n      // Resolve location by slug (handle ID mismatches)\n      let resolvedLocationId: string;\n      try {\n        // Try to find existing location by slug first\n        const existingBySlug = await storage.getLocationBySlug(extLocation.slug);\n        if (existingBySlug) {\n          resolvedLocationId = existingBySlug.id;\n          // Exclude id from update payload to avoid primary key mutation\n          const { id, ...updateData } = locationData;\n          await storage.updateLocation(resolvedLocationId, updateData);\n          console.log(`  ✅ Updated location by slug: ${extLocation.name} (${nights} nights)`);\n        } else {\n          const createdLocation = await storage.createLocation(locationData);\n          resolvedLocationId = createdLocation.id; // Use actual created ID\n          console.log(`  🆕 Created location: ${extLocation.name} (${nights} nights)`);\n        }\n      } catch (createError: any) {\n        // If creation fails due to duplicate slug, find by slug and update\n        if (createError.code === '23505') {\n          try {\n            const existingBySlug = await storage.getLocationBySlug(extLocation.slug);\n            if (existingBySlug) {\n              resolvedLocationId = existingBySlug.id;\n              // Exclude id from update payload to avoid primary key mutation\n              const { id, ...updateData } = locationData;\n              await storage.updateLocation(resolvedLocationId, updateData);\n              console.log(`  ✅ Updated existing location by slug: ${extLocation.name} (${nights} nights)`);\n            } else {\n              console.error(`  ❌ Duplicate error but no location found by slug ${extLocation.slug}`);\n              continue;\n            }\n          } catch (updateError) {\n            console.error(`  ❌ Failed to update location ${extLocation.name}:`, updateError);\n            continue;\n          }\n        } else {\n          throw createError;\n        }\n      }\n\n      // Location imageUrl is already set in locationData - no gallery sync needed\n      // since external locations only have single imageUrl, not image galleries\n      console.log(`    ✅ Location imageUrl synced: ${extLocation.imageUrl || 'No image'}`);\n      \n      // Clear any existing location gallery images since external has none\n      try {\n        const existingImages = await storage.getLocationImages(resolvedLocationId);\n        for (const existingImage of existingImages) {\n          await storage.deleteLocationImage(existingImage.id);\n        }\n        if (existingImages.length > 0) {\n          console.log(`    🗑️ Cleared ${existingImages.length} existing gallery images (external has none)`);\n        }\n      } catch (error) {\n        console.error(`    ❌ Error clearing gallery images for ${extLocation.name}:`, error);\n      }\n    } catch (error) {\n      console.error(`  ❌ Error syncing location ${extLocation.name}:`, error);\n    }\n  }\n}\n\n// Sync hero images with absolute URLs from external source\nasync function syncHeroImages(storage: IStorage): Promise<void> {\n  console.log('🔄 Syncing hero images from external source...');\n  \n  const externalHeroImages = await fetchExternalData<any[]>('/hero-images');\n  \n  // Clear existing hero images for clean replacement\n  const existingHeroImages = await storage.getHeroImages();\n  for (const existing of existingHeroImages) {\n    await storage.deleteHeroImage(existing.id);\n  }\n  console.log('  🗑️ Cleared existing hero images');\n  \n  for (const extHeroImage of externalHeroImages) {\n    try {\n      const heroImageData: Omit<HeroImage, 'id' | 'createdAt' | 'updatedAt'> = {\n        imageUrl: ensureAbsoluteUrl(extHeroImage.imageUrl),\n        title: extHeroImage.title,\n        description: extHeroImage.description || '',\n        sortOrder: extHeroImage.sortOrder || 0,\n        objectPath: extHeroImage.objectPath || null,\n      };\n\n      await storage.createHeroImage(heroImageData);\n      console.log(`  ✅ Synced hero image: ${extHeroImage.title}`);\n    } catch (error) {\n      console.error(`  ❌ Error syncing hero image ${extHeroImage.title}:`, error);\n    }\n  }\n  \n  console.log(`  📸 Synced ${externalHeroImages.length} hero images from external source`);\n}\n\n// Sync scenic content with gallery images\nasync function syncScenicContent(storage: IStorage): Promise<void> {\n  console.log('🔄 Syncing scenic content...');\n  \n  const externalScenicContent = await fetchExternalData<any>('/scenic-content');\n  \n  try {\n    // Normalize gallery images with absolute URLs\n    const galleries: ScenicGalleryItem[] = (externalScenicContent.galleries || []).map((gallery: any) => ({\n      id: gallery.id,\n      title: gallery.title,\n      description: gallery.description,\n      imageUrl: ensureAbsoluteUrl(gallery.imageUrl),\n      linkUrl: gallery.linkUrl || null,\n      isLarge: gallery.isLarge || false,\n      order: gallery.order || 0,\n    }));\n\n    const scenicContentData = {\n      title: externalScenicContent.title,\n      subtitle: externalScenicContent.subtitle,\n      galleries,\n      isActive: externalScenicContent.isActive !== false,\n    };\n\n    await storage.updateScenicContent(scenicContentData);\n    console.log(`  ✅ Synced scenic content: ${externalScenicContent.title}`);\n    console.log(`  📸 Imported ${galleries.length} gallery images`);\n  } catch (error) {\n    console.error(`  ❌ Error syncing scenic content:`, error);\n  }\n}\n\n// Main sync function\nexport async function syncExternalData(storage: IStorage): Promise<void> {\n  try {\n    console.log('🚀 Starting data sync from https://kanadareise.replit.app...\\n');\n    \n    await syncLocations(storage);\n    console.log('');\n    \n    await syncHeroImages(storage);\n    console.log('');\n    \n    await syncScenicContent(storage);\n    console.log('');\n    \n    console.log('✅ Data sync completed successfully!');\n    console.log('📊 Summary:');\n    console.log('   - Updated location data with proper nights calculation');\n    console.log('   - Synced hero images for homepage');\n    console.log('   - Synced scenic gallery content');\n    console.log('   - Normalized all image URLs to absolute paths');\n    \n  } catch (error) {\n    console.error('❌ Data sync failed:', error);\n    throw error;\n  }\n}\n\n// Sync individual location by slug for precise control\nexport async function syncLocationBySlug(storage: IStorage, slug: string): Promise<void> {\n  console.log(`🔄 Syncing individual location: ${slug}`);\n  \n  const externalLocations = await fetchExternalData<any[]>('/locations');\n  const extLocation = externalLocations.find(loc => loc.slug === slug);\n  \n  if (!extLocation) {\n    throw new Error(`Location with slug \"${slug}\" not found in external data`);\n  }\n  \n  try {\n    // Calculate nights from actual dates\n    const nights = calculateNightsUTC(extLocation.startDate, extLocation.endDate);\n    \n    // Normalize dates to YYYY-MM-DD format for storage\n    const startDate = toDateOnlyString(parseDateFlexible(extLocation.startDate));\n    const endDate = toDateOnlyString(parseDateFlexible(extLocation.endDate));\n    \n    const locationData: Omit<Location, 'createdAt' | 'updatedAt'> = {\n      id: extLocation.id,\n      name: extLocation.name,\n      slug: extLocation.slug,\n      startDate,\n      endDate,\n      description: extLocation.description,\n      accommodation: extLocation.accommodation || '',\n      accommodationWebsite: extLocation.accommodationWebsite || '',\n      accommodationImageUrl: ensureAbsoluteUrl(extLocation.accommodationImageUrl),\n      accommodationPrice: extLocation.accommodationPrice || null,\n      accommodationCurrency: extLocation.accommodationCurrency || 'CAD',\n      accommodationInclusiveServices: extLocation.accommodationInclusiveServices || [],\n      accommodationAmenities: extLocation.accommodationAmenities || [],\n      accommodationCheckinTime: extLocation.accommodationCheckinTime || null,\n      accommodationCheckoutTime: extLocation.accommodationCheckoutTime || null,\n      distance: extLocation.distance || 0,\n      imageUrl: ensureAbsoluteUrl(extLocation.imageUrl),\n      mapImageUrl: ensureAbsoluteUrl(extLocation.mapImageUrl),\n      coordinates: extLocation.coordinates || null,\n      activities: extLocation.activities || [],\n      restaurants: extLocation.restaurants || [],\n      experiences: extLocation.experiences || [],\n      highlights: extLocation.highlights || [],\n      funFacts: extLocation.funFacts || [],\n      routeHighlights: extLocation.routeHighlights || [],\n    };\n\n    // Resolve location by slug (handle ID mismatches)\n    let resolvedLocationId: string;\n    try {\n      // Try to find existing location by slug first\n      const existingBySlug = await storage.getLocationBySlug(extLocation.slug);\n      if (existingBySlug) {\n        resolvedLocationId = existingBySlug.id;\n        // Exclude id from update payload to avoid primary key mutation\n        const { id, ...updateData } = locationData;\n        await storage.updateLocation(resolvedLocationId, updateData);\n        console.log(`  ✅ Updated location by slug: ${extLocation.name} (${nights} nights)`);\n      } else {\n        const createdLocation = await storage.createLocation(locationData);\n        resolvedLocationId = createdLocation.id; // Use actual created ID\n        console.log(`  🆕 Created location: ${extLocation.name} (${nights} nights)`);\n      }\n    } catch (createError: any) {\n      // If creation fails due to duplicate slug, find by slug and update\n      if (createError.code === '23505') {\n        try {\n          const existingBySlug = await storage.getLocationBySlug(extLocation.slug);\n          if (existingBySlug) {\n            resolvedLocationId = existingBySlug.id;\n            // Exclude id from update payload to avoid primary key mutation\n            const { id, ...updateData } = locationData;\n            await storage.updateLocation(resolvedLocationId, updateData);\n            console.log(`  ✅ Updated existing location by slug: ${extLocation.name} (${nights} nights)`);\n          } else {\n            console.error(`  ❌ Duplicate error but no location found by slug ${extLocation.slug}`);\n            throw new Error(`Location sync failed for slug ${slug}`);\n          }\n        } catch (updateError) {\n          console.error(`  ❌ Failed to update location ${extLocation.name}:`, updateError);\n          throw updateError;\n        }\n      } else {\n        throw createError;\n      }\n    }\n\n    // EXACT MATCHING: Always clear and sync images (treat missing as empty)\n    try {\n      // Clear existing location images for exact matching (using resolved location ID)\n      const existingImages = await storage.getLocationImages(resolvedLocationId);\n      for (const existingImage of existingImages) {\n        await storage.deleteLocationImage(existingImage.id);\n      }\n      if (existingImages.length > 0) {\n        console.log(`    🗑️ Cleared ${existingImages.length} existing images for exact sync`);\n      }\n\n      // Add all external images (or none if missing - exact matching)\n      const externalImages = extLocation.images || [];\n      let mainImageUrl = '';\n      \n      for (const extImage of externalImages) {\n        try {\n          const imageData: Omit<LocationImage, 'id' | 'createdAt'> = {\n            locationId: resolvedLocationId,\n            imageUrl: ensureAbsoluteUrl(extImage.imageUrl),\n            caption: extImage.caption || '',\n            isMain: extImage.isMain || false,\n            objectPath: extImage.objectPath || null,\n          };\n\n          await storage.addLocationImage(imageData);\n          \n          // Track main image for location.imageUrl update\n          if (extImage.isMain) {\n            mainImageUrl = ensureAbsoluteUrl(extImage.imageUrl);\n          }\n          \n          console.log(`    📸 Synced image: ${extImage.caption || 'Untitled'} ${extImage.isMain ? '(MAIN)' : ''}`);\n        } catch (error) {\n          console.error(`    ❌ Error syncing image for ${extLocation.name}:`, error);\n        }\n      }\n      \n      // If no main image was specified, use the first image\n      if (!mainImageUrl && externalImages.length > 0) {\n        mainImageUrl = ensureAbsoluteUrl(externalImages[0].imageUrl);\n        console.log(`    📌 Using first image as main for ${extLocation.name}`);\n      }\n      \n      // Update location.imageUrl to match the main gallery image\n      if (mainImageUrl) {\n        await storage.updateLocation(resolvedLocationId, { imageUrl: mainImageUrl });\n        console.log(`    ✅ Updated location.imageUrl to main gallery image`);\n      }\n      \n      if (externalImages.length === 0) {\n        console.log(`    ✅ No images to sync for ${extLocation.name} (exact match with external)`);\n      }\n    } catch (error) {\n      console.error(`    ❌ Error clearing/syncing images for ${extLocation.name}:`, error);\n      throw error;\n    }\n    \n    console.log(`✅ Successfully synced location: ${slug}`);\n  } catch (error) {\n    console.error(`❌ Error syncing location ${slug}:`, error);\n    throw error;\n  }\n}\n\n// Helper function to calculate nights from dates (for use in UI)\nexport function calculateNights(startDate: string, endDate: string): number {\n  try {\n    return calculateNightsUTC(startDate, endDate);\n  } catch (error) {\n    console.error('Error calculating nights:', error);\n    return 1; // Default fallback\n  }\n}","size_bytes":18015},"client/src/components/GlobalTripFeed.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport React from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useInfiniteQuery, useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Clock, User, Camera, Send, Image, Upload, Heart, Trash2, Video, Play, MoreVertical, X, Maximize2, Edit, ChevronLeft, ChevronRight, PlayCircle, Filter, SortAsc } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { TripPhoto, Creator, Location } from \"@shared/schema\";\n\ninterface GlobalTripFeedProps {\n  selectedLocationFilter?: string;\n  sortOption?: string;\n}\n\nexport default function GlobalTripFeed({ selectedLocationFilter: propLocationFilter, sortOption: propSortOption }: GlobalTripFeedProps = {}) {\n  const [, setLocation] = useLocation();\n  \n  // Get URL parameters for deep linking\n  const urlParams = new URLSearchParams(window.location.search);\n  const filterLocationId = urlParams.get('locationId');\n  const shouldFocus = urlParams.get('focus') === 'first';\n  \n  // Filter and sort state\n  const [selectedLocationFilter, setSelectedLocationFilter] = useState<string>(propLocationFilter || filterLocationId || 'all');\n  const [sortOption, setSortOption] = useState<string>(propSortOption || urlParams.get('sortBy') || 'newest');\n  \n  // Update state when props change\n  useEffect(() => {\n    if (propLocationFilter !== undefined) {\n      setSelectedLocationFilter(propLocationFilter);\n    }\n    if (propSortOption !== undefined) {\n      setSortOption(propSortOption);\n    }\n  }, [propLocationFilter, propSortOption]);\n  // Upload state\n  const [caption, setCaption] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [selectedCreatorId, setSelectedCreatorId] = useState<string>(\"\");\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [selectedLocationId, setSelectedLocationId] = useState<string>(\"\");\n  const [mediaType, setMediaType] = useState<'image' | 'video'>('image');\n  \n  // User and interaction state\n  const [userKey] = useState(() => localStorage.getItem('userKey') || `user_${Date.now()}_${Math.random()}`);\n  const [likedPhotos, setLikedPhotos] = useState(() => {\n    // Load liked photos from localStorage on mount\n    try {\n      const currentUserKey = localStorage.getItem('userKey') || `user_${Date.now()}_${Math.random()}`;\n      const saved = localStorage.getItem(`likedPhotos_${currentUserKey}`);\n      return saved ? new Set<string>(JSON.parse(saved)) : new Set<string>();\n    } catch {\n      return new Set<string>();\n    }\n  });\n  const [deleteTokens, setDeleteTokens] = useState<Record<string, string>>(() => {\n    // Load delete tokens from localStorage on mount\n    try {\n      const saved = localStorage.getItem(`deleteTokens_${userKey}`);\n      return saved ? JSON.parse(saved) : {};\n    } catch {\n      return {};\n    }\n  });\n  \n  // Modal state\n  const [fullViewMedia, setFullViewMedia] = useState<TripPhoto | null>(null);\n  const [fullViewCarousel, setFullViewCarousel] = useState<TripPhoto[] | null>(null);\n  const [fullViewIndex, setFullViewIndex] = useState(0);\n  const [showUploadModal, setShowUploadModal] = useState(false);\n  \n  // Touch state for full view modal\n  const [modalTouchStart, setModalTouchStart] = useState<number | null>(null);\n  const [modalTouchEnd, setModalTouchEnd] = useState<number | null>(null);\n  \n  // Zoom state for full view modal\n  const [zoomScale, setZoomScale] = useState(1);\n  const [zoomPan, setZoomPan] = useState({ x: 0, y: 0 });\n  const [initialZoomDistance, setInitialZoomDistance] = useState<number | null>(null);\n  const [initialZoomScale, setInitialZoomScale] = useState(1);\n  const [initialPanPosition, setInitialPanPosition] = useState({ x: 0, y: 0 });\n  const [isPinching, setIsPinching] = useState(false);\n  const [isPanning, setIsPanning] = useState(false);\n  \n  // Edit state\n  const [editingPost, setEditingPost] = useState<string | null>(null);\n  const [editCaption, setEditCaption] = useState(\"\");\n  const [editLocationId, setEditLocationId] = useState(\"\");\n  \n  // Image loading state for full view modal\n  const [imageLoadingStates, setImageLoadingStates] = useState<Record<string, boolean>>({});\n  const [preloadedImages, setPreloadedImages] = useState<Set<string>>(new Set());\n  const [imageTransitioning, setImageTransitioning] = useState(false);\n  \n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const loadMoreRef = useRef<HTMLDivElement>(null);\n  const imagePreloadRef = useRef<Map<string, HTMLImageElement>>(new Map());\n  const { toast } = useToast();\n\n  // Save user key to localStorage\n  useEffect(() => {\n    localStorage.setItem('userKey', userKey);\n  }, [userKey]);\n\n\n  // Save liked photos to localStorage whenever they change\n  useEffect(() => {\n    try {\n      localStorage.setItem(`likedPhotos_${userKey}`, JSON.stringify(Array.from(likedPhotos)));\n    } catch {\n      // Ignore localStorage errors\n    }\n  }, [likedPhotos, userKey]);\n\n  // Save delete tokens to localStorage whenever they change\n  useEffect(() => {\n    try {\n      localStorage.setItem(`deleteTokens_${userKey}`, JSON.stringify(deleteTokens));\n    } catch {\n      // Ignore localStorage errors\n    }\n  }, [deleteTokens, userKey]);\n\n  // Query to fetch creators\n  const { data: creators = [] } = useQuery<Creator[]>({\n    queryKey: [\"/api/creators\"],\n  });\n\n  // Query to fetch locations\n  const { data: locations = [] } = useQuery<Location[]>({\n    queryKey: [\"/api/locations\"],\n  });\n\n  // Infinite query for paginated trip photos (global feed - no locationId filter)\n  const {\n    data,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage,\n    isLoading,\n    refetch,\n  } = useInfiniteQuery({\n    queryKey: [\"/api/trip-photos/paginated\", \"global\", selectedLocationFilter === 'all' ? null : selectedLocationFilter],\n    queryFn: async ({ pageParam }) => {\n      const params = new URLSearchParams({\n        limit: '15', // Larger pages for better performance\n        ...(pageParam && { cursor: pageParam }),\n        ...(selectedLocationFilter !== 'all' && { locationId: selectedLocationFilter }),\n      });\n      \n      const response = await fetch(`/api/trip-photos/paginated?${params}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch photos');\n      }\n      return response.json();\n    },\n    getNextPageParam: (lastPage) => lastPage.nextCursor,\n    initialPageParam: undefined as string | undefined,\n    staleTime: 15 * 60 * 1000, // 15 minutes for better performance\n    gcTime: 45 * 60 * 1000, // 45 minutes cache retention\n    refetchInterval: 5 * 60 * 1000, // Reduced to 5 minutes for performance\n  });\n\n  // Flatten the paginated data\n  const tripPhotos = data?.pages.flatMap(page => page.items) || [];\n  \n  // Handle deep linking focus behavior\n  useEffect(() => {\n    if (shouldFocus && data?.pages?.[0]?.items?.length) {\n      const firstItem = data.pages[0].items[0];\n      // Scroll to the first item\n      setTimeout(() => {\n        const element = document.querySelector(`[data-testid=\"post-image-${firstItem.id}\"]`) || \n                       document.querySelector(`[data-testid=\"post-video-${firstItem.id}\"]`);\n        if (element) {\n          element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n          // Optional: Open full view\n          openFullView(firstItem);\n        }\n      }, 500); // Wait for rendering\n    }\n  }, [shouldFocus, data]);\n  \n  // Helper function to safely get time from Date or string\n  const getTimeSafe = (date: Date | string | null): number => {\n    if (!date) return 0;\n    if (typeof date === 'string') {\n      return new Date(date).getTime();\n    }\n    return date.getTime();\n  };\n\n  // Group photos by groupId for carousel display\n  const groupedPhotos = React.useMemo(() => {\n    const groups = new Map<string, TripPhoto[]>();\n    const singles: TripPhoto[] = [];\n    \n    tripPhotos.forEach(photo => {\n      if (photo.groupId) {\n        if (!groups.has(photo.groupId)) {\n          groups.set(photo.groupId, []);\n        }\n        groups.get(photo.groupId)!.push(photo);\n      } else {\n        singles.push(photo);\n      }\n    });\n    \n    // Convert grouped photos to display items\n    type CarouselItem = { type: 'carousel', groupId: string, photos: TripPhoto[], id: string, uploadedAt: Date | null, locationId: string | null };\n    const groupedItems: (TripPhoto | CarouselItem)[] = [];\n    \n    // Add carousel groups\n    groups.forEach((photos, groupId) => {\n      if (photos.length > 1) {\n        // Sort photos by time (oldest to newest for carousel display)\n        const sortedPhotos = photos.sort((a, b) => getTimeSafe(a.uploadedAt) - getTimeSafe(b.uploadedAt));\n        // Use the newest photo's timestamp for feed ordering\n        const newestPhoto = sortedPhotos[sortedPhotos.length - 1];\n        groupedItems.push({\n          type: 'carousel',\n          groupId,\n          photos: sortedPhotos,\n          id: `carousel-${groupId}`,\n          uploadedAt: newestPhoto?.uploadedAt || null,\n          locationId: newestPhoto?.locationId || null\n        });\n      } else {\n        // Single photo in group, treat as individual\n        groupedItems.push(photos[0]);\n      }\n    });\n    \n    // Add individual photos\n    groupedItems.push(...singles);\n    \n    // Sort based on selected option\n    return groupedItems.sort((a, b) => {\n      switch (sortOption) {\n        case 'oldest':\n          const timeA = getTimeSafe(a.uploadedAt);\n          const timeB = getTimeSafe(b.uploadedAt);\n          return timeA - timeB; // Oldest first\n        case 'photo-date':\n          const takenA = getTimeSafe('type' in a ? a.photos[0]?.takenAt : a.takenAt) || getTimeSafe(a.uploadedAt);\n          const takenB = getTimeSafe('type' in b ? b.photos[0]?.takenAt : b.takenAt) || getTimeSafe(b.uploadedAt);\n          return takenB - takenA; // Most recent photo date first\n        case 'most-liked':\n          const likesA = 'type' in a ? Math.max(...a.photos.map(p => p.likesCount || 0)) : (a.likesCount || 0);\n          const likesB = 'type' in b ? Math.max(...b.photos.map(p => p.likesCount || 0)) : (b.likesCount || 0);\n          return likesB - likesA; // Most liked first\n        case 'newest':\n        default:\n          const uploadA = getTimeSafe(a.uploadedAt);\n          const uploadB = getTimeSafe(b.uploadedAt);\n          return uploadB - uploadA; // Newest first (default)\n      }\n    });\n  }, [tripPhotos, sortOption]);\n\n\n\n  // Generate video thumbnail function\n  const generateVideoThumbnail = (videoFile: File): Promise<File> => {\n    return new Promise((resolve, reject) => {\n      const video = document.createElement('video');\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      \n      if (!ctx) {\n        reject(new Error('Canvas context not available'));\n        return;\n      }\n\n      let objectUrl: string | null = null;\n\n      const cleanup = () => {\n        if (objectUrl) {\n          URL.revokeObjectURL(objectUrl);\n          objectUrl = null;\n        }\n      };\n\n      video.crossOrigin = 'anonymous';\n      video.preload = 'metadata';\n      video.muted = true;\n      \n      video.oncanplay = () => {\n        // Ensure video has loaded dimensions\n        if (video.videoWidth === 0 || video.videoHeight === 0) {\n          cleanup();\n          reject(new Error('Video dimensions not ready'));\n          return;\n        }\n        \n        // Seek to 1 second or 10% of video duration for better thumbnail\n        video.currentTime = Math.min(1, video.duration * 0.1);\n      };\n      \n      video.onseeked = () => {\n        try {\n          // Set canvas size to video dimensions (max 400px width to keep thumbnail small)\n          const maxWidth = 400;\n          const aspectRatio = video.videoHeight / video.videoWidth;\n          canvas.width = Math.min(video.videoWidth, maxWidth);\n          canvas.height = canvas.width * aspectRatio;\n          \n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n          canvas.toBlob((blob) => {\n            cleanup();\n            if (blob) {\n              const thumbnailFile = new File([blob], `${videoFile.name}_thumb.jpg`, {\n                type: 'image/jpeg'\n              });\n              resolve(thumbnailFile);\n            } else {\n              reject(new Error('Failed to generate thumbnail blob'));\n            }\n          }, 'image/jpeg', 0.8);\n        } catch (error) {\n          cleanup();\n          reject(new Error(`Canvas operation failed: ${error}`));\n        }\n      };\n      \n      video.onerror = () => {\n        cleanup();\n        reject(new Error('Failed to load video for thumbnail generation'));\n      };\n      \n      objectUrl = URL.createObjectURL(videoFile);\n      video.src = objectUrl;\n    });\n  };\n\n  // Upload mutation with batch support and EXIF data\n  const uploadMutation = useMutation({\n    mutationFn: async ({ files, caption, uploadedBy, creatorId, locationId }: { \n      files: File[]; \n      caption: string; \n      uploadedBy: string; \n      creatorId: string;\n      locationId: string;\n    }) => {\n      // Handle single video differently to support thumbnails\n      if (files.length === 1 && files[0].type.startsWith('video/')) {\n        const videoFile = files[0];\n        \n        const formData = new FormData();\n        formData.append('media', videoFile);\n        formData.append('caption', caption || '');\n        formData.append('uploadedBy', uploadedBy || '');\n        formData.append('creatorId', creatorId || '');\n        formData.append('locationId', locationId || '');\n        formData.append('mediaType', 'video');\n        \n        // Generate and add thumbnail for video\n        try {\n          const thumbnail = await generateVideoThumbnail(videoFile);\n          formData.append('thumbnail', thumbnail);\n        } catch (error) {\n          console.warn('Failed to generate video thumbnail:', error);\n          // Continue without thumbnail\n        }\n\n        const response = await fetch('/api/trip-photos/media', {\n          method: 'POST',\n          body: formData,\n        });\n        \n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error || \"Upload fehlgeschlagen\");\n        }\n        return response.json();\n      } else {\n        // Handle multiple files - use batch upload endpoint\n        const formData = new FormData();\n        \n        // Append all files\n        files.forEach(file => {\n          formData.append('media', file);\n        });\n        \n        // Extract EXIF data for all image files\n        const exifDataMap: Record<number, string> = {};\n        \n        for (let i = 0; i < files.length; i++) {\n          const file = files[i];\n          if (file.type.startsWith('image/')) {\n            try {\n              const exifr = await import('exifr');\n              const parsed = await exifr.parse(file);\n              const dateTime = parsed?.DateTimeOriginal || parsed?.DateTime || parsed?.CreateDate;\n              if (dateTime && dateTime instanceof Date) {\n                exifDataMap[i] = dateTime.toISOString();\n              }\n            } catch (error) {\n              console.warn(`Failed to extract EXIF data for ${file.name}:`, error);\n            }\n          }\n        }\n        \n        // Append form data\n        if (caption.trim()) formData.append('caption', caption.trim());\n        if (uploadedBy.trim()) formData.append('uploadedBy', uploadedBy.trim());\n        if (creatorId) formData.append('creatorId', creatorId);\n        if (locationId) formData.append('locationId', locationId);\n        if (Object.keys(exifDataMap).length > 0) {\n          formData.append('exifData', JSON.stringify(exifDataMap));\n        }\n\n        const response = await fetch('/api/trip-photos/media-batch', {\n          method: 'POST',\n          body: formData,\n        });\n        \n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error || \"Upload fehlgeschlagen\");\n        }\n        \n        const results = await response.json();\n        \n        // Return batch upload results in expected format\n        return {\n          files: results.files || [],\n          groupId: results.groupId || null\n        };\n      }\n    },\n    onSuccess: (result) => {\n      // Store delete tokens locally for batch uploads\n      if (result.files) {\n        const newTokens: Record<string, string> = {};\n        result.files.forEach((file: any) => {\n          if (file.deleteToken) {\n            newTokens[file.id] = file.deleteToken;\n          }\n        });\n        setDeleteTokens(prev => ({ ...prev, ...newTokens }));\n      }\n      \n      // Invalidate all feed queries to refresh all views\n      queryClient.invalidateQueries({ \n        predicate: (query) => Array.isArray(query.queryKey) && \n                              query.queryKey[0] === '/api/trip-photos/paginated'\n      });\n      \n      // Reset form and close modal\n      setCaption(\"\");\n      setName(\"\");\n      setSelectedCreatorId(\"\");\n      setSelectedLocationId(\"\");\n      setSelectedFiles([]);\n      setMediaType('image');\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n      setShowUploadModal(false);\n      \n      const fileCount = result.files?.length || 1;\n      toast({\n        title: \"Gepostet!\",\n        description: `${fileCount === 1 ? 'Ihr Beitrag' : `${fileCount} Dateien`} wurde(n) erfolgreich geteilt.`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Upload fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n\n  // Like mutation\n  const likeMutation = useMutation({\n    mutationFn: async ({ photoId }: { photoId: string }) => {\n      const response = await apiRequest(\"POST\", `/api/trip-photos/${photoId}/like`, {\n        userKey,\n      });\n      return response.json();\n    },\n    onMutate: ({ photoId }) => {\n      // Capture current state before update\n      const wasLiked = likedPhotos.has(photoId);\n      \n      // Optimistic update\n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (wasLiked) {\n          newSet.delete(photoId);\n        } else {\n          newSet.add(photoId);\n        }\n        return newSet;\n      });\n      \n      // Update cache optimistically using captured state\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated\", \"global\", selectedLocationFilter === 'all' ? null : selectedLocationFilter],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((photo: any) => {\n                if (photo.id === photoId) {\n                  return {\n                    ...photo,\n                    likesCount: Math.max(0, (photo.likesCount || 0) + (wasLiked ? -1 : 1))\n                  };\n                }\n                return photo;\n              })\n            }))\n          };\n        }\n      );\n      \n      return { wasLiked }; // Return for use in onError\n    },\n    onSuccess: (result, { photoId }) => {\n      // Update with server response\n      const { liked, likesCount } = result;\n      \n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (liked) {\n          newSet.add(photoId);\n        } else {\n          newSet.delete(photoId);\n        }\n        return newSet;\n      });\n      \n      // Update cache with actual server data\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated\", \"global\", selectedLocationFilter === 'all' ? null : selectedLocationFilter],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((photo: any) => \n                photo.id === photoId ? { ...photo, likesCount } : photo\n              )\n            }))\n          };\n        }\n      );\n    },\n    onError: (error, { photoId }, context) => {\n      // Revert optimistic update using original state\n      const wasLiked = context?.wasLiked ?? false;\n      setLikedPhotos(prev => {\n        const newSet = new Set(prev);\n        if (wasLiked) {\n          newSet.add(photoId);\n        } else {\n          newSet.delete(photoId);\n        }\n        return newSet;\n      });\n      \n      // Invalidate and refetch to get correct state\n      queryClient.invalidateQueries({ queryKey: [\"/api/trip-photos/paginated\", \"global\", selectedLocationFilter === 'all' ? null : selectedLocationFilter] });\n      \n      toast({\n        title: \"Fehler\",\n        description: \"Like konnte nicht gespeichert werden.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async ({ photoId }: { photoId: string }) => {\n      const response = await fetch(`/api/trip-photos/${photoId}`, {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to delete photo');\n      }\n    },\n    onSuccess: (_, { photoId }) => {\n      // Remove from delete tokens\n      setDeleteTokens(prev => {\n        const newTokens = { ...prev };\n        delete newTokens[photoId];\n        return newTokens;\n      });\n      \n      // Invalidate all trip-photos related caches\n      queryClient.invalidateQueries({ \n        predicate: (query) => Array.isArray(query.queryKey) && \n                              String(query.queryKey[0]).startsWith('/api/trip-photos') \n      });\n      \n      // Optimistically update the ungrouped cache\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated\", \"global\", selectedLocationFilter === 'all' ? null : selectedLocationFilter],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.filter((photo: any) => photo.id !== photoId)\n            }))\n          };\n        }\n      );\n      \n      // Optimistically update grouped caches for all locations\n      queryClient.getQueryCache().getAll().forEach(query => {\n        if (Array.isArray(query.queryKey) && \n            query.queryKey[0] === '/api/trip-photos/paginated-grouped') {\n          queryClient.setQueryData(query.queryKey, (oldData: any) => {\n            if (!oldData) return oldData;\n            \n            return {\n              ...oldData,\n              pages: oldData.pages.map((page: any) => ({\n                ...page,\n                items: page.items.map((group: any) => ({\n                  ...group,\n                  media: group.media.filter((media: any) => media.id !== photoId)\n                })).filter((group: any) => group.media.length > 0) // Remove empty groups\n              }))\n            };\n          });\n        }\n      });\n      \n      toast({\n        title: \"Gelöscht\",\n        description: \"Ihr Beitrag wurde erfolgreich gelöscht.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Löschen fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Edit mutation\n  const editMutation = useMutation({\n    mutationFn: async ({ photoId, caption, locationId }: { photoId: string; caption: string; locationId: string }) => {\n      const response = await fetch(`/api/trip-photos/${photoId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ caption, locationId }),\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update post');\n      }\n      return response.json();\n    },\n    onSuccess: (_, { photoId, caption, locationId }) => {\n      // Update cache with new caption and location\n      queryClient.setQueryData(\n        [\"/api/trip-photos/paginated\", \"global\"],\n        (oldData: any) => {\n          if (!oldData) return oldData;\n          \n          return {\n            ...oldData,\n            pages: oldData.pages.map((page: any) => ({\n              ...page,\n              items: page.items.map((photo: any) => \n                photo.id === photoId ? { ...photo, caption, locationId } : photo\n              )\n            }))\n          };\n        }\n      );\n      \n      setEditingPost(null);\n      setEditCaption(\"\");\n      setEditLocationId(\"none\");\n      \n      toast({\n        title: \"Aktualisiert\",\n        description: \"Beitrag wurde erfolgreich geändert.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Aktualisierung fehlgeschlagen\",\n        description: error.message || \"Bitte versuchen Sie es erneut.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Optimized infinite scroll with aggressive preloading for smooth performance  \n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasNextPage && !isFetchingNextPage) {\n          fetchNextPage();\n        }\n      },\n      { threshold: 0, rootMargin: '500px 0px' } // Optimized for smooth preloading\n    );\n\n    if (loadMoreRef.current) {\n      observer.observe(loadMoreRef.current);\n    }\n\n    return () => {\n      if (loadMoreRef.current) {\n        observer.unobserve(loadMoreRef.current);\n      }\n      observer.disconnect();\n    };\n  }, [fetchNextPage, hasNextPage, isFetchingNextPage]);\n\n  const handleLike = (photoId: string) => {\n    likeMutation.mutate({ photoId });\n  };\n\n  const handleDelete = (photoId: string) => {\n    deleteMutation.mutate({ photoId });\n  };\n\n  // File handling functions\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (files.length === 0) return;\n\n    const validFiles: File[] = [];\n    let hasVideo = false;\n    let hasImage = false;\n\n    // Validate each file\n    for (const file of files) {\n      // File type validation\n      const allowedImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];\n      const allowedVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];\n      const isImage = allowedImageTypes.includes(file.type);\n      const isVideo = allowedVideoTypes.includes(file.type);\n      \n      if (!isImage && !isVideo) {\n        toast({\n          title: \"Ungültiger Dateityp\",\n          description: `Datei ${file.name}: Nur Bilder (JPG, PNG, WebP, GIF) und Videos (MP4, WebM, MOV) sind erlaubt.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n\n      // File size validation\n      const maxSize = isVideo ? 52428800 : 10485760; // 50MB for videos, 10MB for images\n      if (file.size > maxSize) {\n        toast({\n          title: \"Datei zu groß\",\n          description: `${file.name}: ${isVideo ? 'Videos unter 50MB' : 'Bilder unter 10MB'} erlaubt.`,\n          variant: \"destructive\",\n        });\n        continue;\n      }\n\n      if (isVideo) hasVideo = true;\n      if (isImage) hasImage = true;\n      validFiles.push(file);\n    }\n\n    if (validFiles.length === 0) return;\n\n    // Don't allow mixing videos and images\n    if (hasVideo && hasImage) {\n      toast({\n        title: \"Medientyp mischen nicht erlaubt\",\n        description: \"Bitte laden Sie entweder nur Bilder oder nur Videos gleichzeitig hoch.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSelectedFiles(validFiles);\n    setMediaType(hasVideo ? 'video' : 'image');\n    \n    toast({\n      title: `${validFiles.length} ${hasVideo ? 'Video(s)' : 'Foto(s)'} ausgewählt`,\n      description: `${validFiles.length === 1 ? 'Datei' : 'Dateien'} bereit zum Hochladen.`,\n    });\n  };\n\n  const handleUpload = async () => {\n    if (selectedFiles.length === 0) {\n      toast({\n        title: `Bitte ${mediaType === 'video' ? 'Video(s)' : 'Foto(s)'} wählen`,\n        description: `Wählen Sie ${mediaType === 'video' ? 'Video(s)' : 'Foto(s)'} zum Hochladen aus.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!selectedLocationId) {\n      toast({\n        title: \"Location wählen\",\n        description: \"Bitte wählen Sie eine Location für Ihren Beitrag aus.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    uploadMutation.mutate({\n      files: selectedFiles,\n      caption: caption.trim(),\n      uploadedBy: name.trim(),\n      creatorId: selectedCreatorId,\n      locationId: selectedLocationId,\n    });\n  };\n\n  // Full view handlers\n  const openFullView = (photo: TripPhoto, carousel?: TripPhoto[]) => {\n    setFullViewMedia(photo);\n    if (carousel && carousel.length > 1) {\n      setFullViewCarousel(carousel);\n      const index = carousel.findIndex(p => p.id === photo.id);\n      setFullViewIndex(index >= 0 ? index : 0);\n    } else {\n      setFullViewCarousel(null);\n      setFullViewIndex(0);\n    }\n  };\n\n  const closeFullView = () => {\n    setFullViewMedia(null);\n    setFullViewCarousel(null);\n    setFullViewIndex(0);\n    resetZoom();\n  };\n\n  // Keyboard navigation for full view modal\n  useEffect(() => {\n    const handleKeyPress = (e: KeyboardEvent) => {\n      if (!fullViewMedia) return;\n\n      switch (e.key) {\n        case 'Escape':\n          closeFullView();\n          break;\n        case 'ArrowLeft':\n          e.preventDefault();\n          if (fullViewCarousel && fullViewCarousel.length > 1) {\n            goToFullViewPrev();\n          }\n          break;\n        case 'ArrowRight':\n          e.preventDefault();\n          if (fullViewCarousel && fullViewCarousel.length > 1) {\n            goToFullViewNext();\n          }\n          break;\n      }\n    };\n\n    if (fullViewMedia) {\n      document.addEventListener('keydown', handleKeyPress);\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyPress);\n      document.body.style.overflow = 'unset';\n    };\n  }, [fullViewMedia, fullViewCarousel]);\n\n  // Auto-open upload modal when files are selected via floating button\n  useEffect(() => {\n    if (selectedFiles.length > 0 && !showUploadModal) {\n      setShowUploadModal(true);\n    }\n  }, [selectedFiles, showUploadModal]);\n\n  // Trigger preloading when fullViewMedia changes\n  useEffect(() => {\n    if (fullViewMedia && fullViewMedia.imageUrl && fullViewMedia.mediaType !== 'video') {\n      // Mark current image as loading initially\n      handleImageLoadStart(fullViewMedia.id);\n      \n      // Start preloading surrounding images and cleanup after short delays\n      setTimeout(() => {\n        preloadCarouselImages();\n      }, 100);\n      \n      setTimeout(() => {\n        cleanupPreloadedImages();\n      }, 500);\n    }\n  }, [fullViewMedia]);\n\n  const goToFullViewNext = () => {\n    if (!fullViewCarousel || imageTransitioning) return;\n    setImageTransitioning(true);\n    resetZoom();\n    const nextIndex = (fullViewIndex + 1) % fullViewCarousel.length;\n    setFullViewIndex(nextIndex);\n    setFullViewMedia(fullViewCarousel[nextIndex]);\n    setTimeout(() => setImageTransitioning(false), 300);\n  };\n\n  const goToFullViewPrev = () => {\n    if (!fullViewCarousel || imageTransitioning) return;\n    setImageTransitioning(true);\n    resetZoom();\n    const prevIndex = (fullViewIndex - 1 + fullViewCarousel.length) % fullViewCarousel.length;\n    setFullViewIndex(prevIndex);\n    setFullViewMedia(fullViewCarousel[prevIndex]);\n    setTimeout(() => setImageTransitioning(false), 300);\n  };\n\n  const goToFullViewIndex = (index: number) => {\n    if (!fullViewCarousel || index < 0 || index >= fullViewCarousel.length || imageTransitioning) return;\n    setImageTransitioning(true);\n    resetZoom();\n    setFullViewIndex(index);\n    setFullViewMedia(fullViewCarousel[index]);\n    setTimeout(() => setImageTransitioning(false), 300);\n  };\n\n  // Zoom utility functions\n  const getDistance = (touch1: React.Touch, touch2: React.Touch) => {\n    return Math.sqrt(\n      Math.pow(touch2.clientX - touch1.clientX, 2) +\n      Math.pow(touch2.clientY - touch1.clientY, 2)\n    );\n  };\n\n  const resetZoom = () => {\n    setZoomScale(1);\n    setZoomPan({ x: 0, y: 0 });\n    setIsPinching(false);\n    setIsPanning(false);\n  };\n\n  const handleZoomIn = () => {\n    setZoomScale(prev => Math.min(prev * 1.5, 5));\n  };\n\n  const handleZoomOut = () => {\n    setZoomScale(prev => Math.max(prev / 1.5, 1));\n    if (zoomScale <= 1.5) {\n      setZoomPan({ x: 0, y: 0 });\n    }\n  };\n\n  // Image preloading and loading state management\n  const preloadImage = (imageUrl: string, photoId: string) => {\n    if (!imageUrl || preloadedImages.has(photoId)) return;\n    \n    const img = document.createElement('img') as HTMLImageElement;\n    img.onload = () => {\n      setPreloadedImages(prev => new Set(Array.from(prev).concat(photoId)));\n      setImageLoadingStates(prev => ({ ...prev, [photoId]: false }));\n      imagePreloadRef.current.set(photoId, img);\n    };\n    img.onerror = () => {\n      setImageLoadingStates(prev => ({ ...prev, [photoId]: false }));\n    };\n    \n    setImageLoadingStates(prev => ({ ...prev, [photoId]: true }));\n    img.src = imageUrl;\n  };\n\n  const preloadCarouselImages = () => {\n    if (!fullViewCarousel || !fullViewMedia) return;\n    \n    const currentIndex = fullViewCarousel.findIndex(photo => photo.id === fullViewMedia.id);\n    if (currentIndex === -1) return;\n    \n    // Preload next 2 and previous 1 images with priority\n    const indicesToPreload = [\n      currentIndex + 1, // Next image (highest priority)\n      currentIndex - 1, // Previous image\n      currentIndex + 2, // Second next image\n    ];\n    \n    indicesToPreload.forEach((index, priority) => {\n      if (index >= 0 && index < fullViewCarousel.length) {\n        const photo = fullViewCarousel[index];\n        if (photo.imageUrl && photo.mediaType !== 'video') {\n          // Add small delay based on priority to not overwhelm the network\n          setTimeout(() => preloadImage(photo.imageUrl!, photo.id), priority * 100);\n        }\n      }\n    });\n  };\n\n  const handleImageLoadStart = (photoId: string) => {\n    setImageLoadingStates(prev => ({ ...prev, [photoId]: true }));\n  };\n\n  const handleImageLoadComplete = (photoId: string) => {\n    setImageLoadingStates(prev => ({ ...prev, [photoId]: false }));\n    setPreloadedImages(prev => new Set(Array.from(prev).concat(photoId)));\n  };\n\n  const handleImageError = (photoId: string) => {\n    setImageLoadingStates(prev => ({ ...prev, [photoId]: false }));\n  };\n\n  // Cleanup preloaded images to prevent memory leaks\n  const cleanupPreloadedImages = () => {\n    if (!fullViewCarousel || !fullViewMedia) return;\n    \n    const currentIndex = fullViewCarousel.findIndex(photo => photo.id === fullViewMedia.id);\n    if (currentIndex === -1) return;\n    \n    // Keep only nearby images (current, next 2, previous 1)\n    const keepIndexes = [\n      currentIndex - 1,\n      currentIndex,\n      currentIndex + 1,\n      currentIndex + 2\n    ];\n    \n    const photosToKeep = keepIndexes\n      .filter(index => index >= 0 && index < fullViewCarousel.length)\n      .map(index => fullViewCarousel[index].id);\n    \n    // Remove images not in the keep list\n    Array.from(imagePreloadRef.current.keys()).forEach(photoId => {\n      if (!photosToKeep.includes(photoId)) {\n        imagePreloadRef.current.delete(photoId);\n      }\n    });\n    \n    // Update preloaded images set\n    setPreloadedImages(prev => new Set(\n      Array.from(prev).filter(photoId => photosToKeep.includes(photoId))\n    ));\n  };\n\n  // Progressive image loading with blur effect\n  const getProgressiveImageStyle = (photoId: string) => {\n    const isLoading = imageLoadingStates[photoId];\n    const isPreloaded = preloadedImages.has(photoId);\n    \n    return {\n      filter: isLoading && !isPreloaded ? 'blur(2px)' : 'none',\n      transition: 'filter 0.3s ease-out, opacity 0.3s ease-out'\n    };\n  };\n\n  // Touch event handlers for full view modal swipe and zoom\n  const handleModalTouchStart = (e: React.TouchEvent) => {\n    if (e.touches.length === 1) {\n      // Single touch - prepare for swipe or pan\n      setModalTouchEnd(null);\n      setModalTouchStart(e.targetTouches[0].clientX);\n      if (zoomScale > 1) {\n        setIsPanning(true);\n        setInitialPanPosition({\n          x: e.touches[0].clientX - zoomPan.x,\n          y: e.touches[0].clientY - zoomPan.y\n        });\n      }\n    } else if (e.touches.length === 2) {\n      // Two fingers - pinch zoom\n      setIsPinching(true);\n      const distance = getDistance(e.touches[0], e.touches[1]);\n      setInitialZoomDistance(distance);\n      setInitialZoomScale(zoomScale);\n    }\n  };\n\n  const handleModalTouchMove = (e: React.TouchEvent) => {\n    e.preventDefault();\n    \n    if (e.touches.length === 1) {\n      if (isPanning && zoomScale > 1) {\n        // Pan the zoomed image\n        const newX = e.touches[0].clientX - initialPanPosition.x;\n        const newY = e.touches[0].clientY - initialPanPosition.y;\n        setZoomPan({ x: newX, y: newY });\n      } else if (!isPinching) {\n        // Single touch swipe detection\n        setModalTouchEnd(e.targetTouches[0].clientX);\n      }\n    } else if (e.touches.length === 2 && isPinching && initialZoomDistance) {\n      // Pinch zoom\n      const currentDistance = getDistance(e.touches[0], e.touches[1]);\n      const scale = (currentDistance / initialZoomDistance) * initialZoomScale;\n      setZoomScale(Math.min(Math.max(scale, 1), 5));\n      \n      if (scale <= 1) {\n        setZoomPan({ x: 0, y: 0 });\n      }\n    }\n  };\n\n  const handleModalTouchEnd = () => {\n    if (isPinching) {\n      setIsPinching(false);\n      setInitialZoomDistance(null);\n      return;\n    }\n    \n    if (isPanning) {\n      setIsPanning(false);\n      return;\n    }\n    \n    // Swipe navigation (only if not zoomed)\n    if (zoomScale > 1 || !modalTouchStart || !modalTouchEnd || !fullViewCarousel || fullViewCarousel.length <= 1) return;\n    \n    const distance = modalTouchStart - modalTouchEnd;\n    const isLeftSwipe = distance > 50;\n    const isRightSwipe = distance < -50;\n\n    if (isLeftSwipe) {\n      goToFullViewNext();\n    }\n    if (isRightSwipe) {\n      goToFullViewPrev();\n    }\n  };\n\n  // Upload modal handlers\n  const openUploadModal = () => {\n    setShowUploadModal(true);\n  };\n\n  const closeUploadModal = () => {\n    setShowUploadModal(false);\n    // Reset form\n    setCaption(\"\");\n    setName(\"\");\n    setSelectedCreatorId(\"\");\n    setSelectedLocationId(\"\");\n    setSelectedFiles([]);\n    setMediaType('image');\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\n  };\n\n  // Get location name by ID\n  const getLocationName = (locationId: string | null) => {\n    if (!locationId || !locations) return null;\n    const location = locations.find(l => l.id === locationId);\n    return location?.name || null;\n  };\n\n  // Format timestamp with date only\n  const formatTime = (date: Date | string | null) => {\n    if (!date) return '';\n    const timestamp = typeof date === 'string' ? new Date(date) : date;\n    return timestamp.toLocaleString('de-DE', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\" data-testid=\"global-trip-feed\">\n\n\n      {/* Feed Title */}\n      <div className=\"flex items-center space-x-2 px-1\" data-testid=\"feed-stats\">\n        <Camera className=\"w-5 h-5 text-primary\" />\n        <div className=\"text-xs text-muted-foreground\">\n          {tripPhotos.length} {tripPhotos.length === 1 ? 'Beitrag' : 'Beiträge'}\n        </div>\n      </div>\n\n\n      {/* Feed Content */}\n      {isLoading ? (\n        <div className=\"space-y-3\" data-testid=\"loading-posts\">\n          {/* Render 3 skeleton cards */}\n          {Array.from({ length: 3 }).map((_, index) => (\n            <Card key={`skeleton-${index}`} className=\"overflow-hidden\">\n              {/* Skeleton Post Header */}\n              <div className=\"p-3 pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"flex items-center space-x-2\">\n                      <Skeleton className=\"w-4 h-4 rounded-full\" />\n                      <Skeleton className=\"h-4 w-20\" />\n                    </div>\n                    <Skeleton className=\"h-5 w-16 rounded-full\" />\n                  </div>\n                  <Skeleton className=\"w-6 h-6 rounded\" />\n                </div>\n                <div className=\"mt-2\">\n                  <Skeleton className=\"h-3 w-24\" />\n                </div>\n              </div>\n\n              {/* Skeleton Media Area */}\n              <Skeleton className=\"w-full h-96\" />\n\n              {/* Skeleton Caption */}\n              <div className=\"p-3\">\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-3/4\" />\n                </div>\n\n                {/* Skeleton Footer */}\n                <div className=\"flex items-center justify-between mt-3\">\n                  <Skeleton className=\"h-4 w-20\" />\n                  <div className=\"flex items-center space-x-2\">\n                    <Skeleton className=\"w-8 h-8 rounded-full\" />\n                    <Skeleton className=\"h-4 w-6\" />\n                  </div>\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      ) : tripPhotos.length === 0 ? (\n        <Card className=\"p-8 text-center\" data-testid=\"no-posts\">\n          <Camera className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground/50\" />\n          <p className=\"font-medium text-muted-foreground\">Noch keine Beiträge</p>\n          <p className=\"text-sm text-muted-foreground/70\">Sei der Erste, der etwas teilt!</p>\n        </Card>\n      ) : (\n        <div className=\"space-y-3\">\n          {groupedPhotos.map((item) => {\n            const isCarousel = 'type' in item && item.type === 'carousel';\n            \n            if (isCarousel) {\n              return <CarouselPost key={item.id} carousel={item} creators={creators} getLocationName={getLocationName} formatTime={formatTime} likedPhotos={likedPhotos} handleLike={handleLike} handleDelete={handleDelete} openFullView={openFullView} />;\n            }\n            \n            const photo = item as TripPhoto;\n            return (\n            <Card key={photo.id} className=\"overflow-hidden\" data-testid={`post-${photo.id}`}>\n              {/* Post Header */}\n              <div className=\"p-3 pb-2\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"flex items-center space-x-1\" data-testid={`post-author-${photo.id}`}>\n                      <User className=\"w-4 h-4 text-muted-foreground\" />\n                      <span className=\"font-medium text-sm\">\n                        {photo.creatorId ? \n                          creators.find(c => c.id === photo.creatorId)?.name || photo.uploadedBy || 'Unbekannt' : \n                          photo.uploadedBy || 'Unbekannt'\n                        }\n                      </span>\n                    </div>\n                    {getLocationName(photo.locationId) && (\n                      <div className=\"text-xs text-muted-foreground bg-muted px-2 py-1 rounded-full\">\n                        📍 {getLocationName(photo.locationId)}\n                      </div>\n                    )}\n                    {photo.mediaType === 'video' && (\n                      <div className=\"flex items-center space-x-1 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full\">\n                        <Video className=\"w-3 h-3\" />\n                        <span>Video</span>\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"flex items-center space-x-1 text-xs text-muted-foreground\" data-testid={`post-time-${photo.id}`}>\n                      <Clock className=\"w-3 h-3\" />\n                      <span>{formatTime(photo.uploadedAt)}</span>\n                    </div>\n                    {/* Three-dot delete menu - Always show for testing */}\n                    <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 z-50 relative\"\n                            data-testid={`post-menu-${photo.id}`}\n                          >\n                            <MoreVertical className=\"w-4 h-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\" className=\"z-50\">\n                          <DropdownMenuItem\n                            onClick={() => {\n                              setEditingPost(photo.id);\n                              setEditCaption(photo.caption || \"\");\n                              setEditLocationId(photo.locationId || \"none\");\n                            }}\n                            className=\"text-blue-600 hover:text-blue-700 cursor-pointer\"\n                            data-testid={`edit-menu-item-${photo.id}`}\n                          >\n                            <Edit className=\"w-4 h-4 mr-2\" />\n                            Bearbeiten\n                          </DropdownMenuItem>\n                          <DropdownMenuItem\n                            onClick={() => handleDelete(photo.id)}\n                            className=\"text-red-600 hover:text-red-700 cursor-pointer\"\n                            data-testid={`delete-menu-item-${photo.id}`}\n                          >\n                            <Trash2 className=\"w-4 h-4 mr-2\" />\n                            Löschen\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                  </div>\n                </div>\n              </div>\n\n\n              {/* Post Media - Image or Video */}\n              {photo.mediaType === 'video' && photo.videoUrl ? (\n                <VideoPreview photo={photo} openFullView={openFullView} />\n              ) : photo.imageUrl && (\n                <div className=\"relative group cursor-pointer\" onClick={() => openFullView(photo)}>\n                  <img\n                    src={photo.imageUrl}\n                    alt={photo.caption || \"Reisefoto\"}\n                    className=\"w-full object-cover max-h-96 bg-gray-50 dark:bg-gray-800\"\n                    loading=\"lazy\"\n                    decoding=\"async\"\n                    data-testid={`post-image-${photo.id}`}\n                  />\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <div className=\"bg-white/90 dark:bg-black/90 rounded-full p-3\">\n                      <Maximize2 className=\"w-6 h-6 text-black dark:text-white\" />\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Post Caption - Now Below Media */}\n              {photo.caption && (\n                <div className=\"px-3 py-1.5\">\n                  <p className=\"text-sm\" data-testid={`post-caption-${photo.id}`}>{photo.caption}</p>\n                </div>\n              )}\n\n              {/* Post Actions - Like */}\n              <div className=\"p-3 pt-2 border-t border-border/50\">\n                <div className=\"flex items-center\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleLike(photo.id)}\n                    className={`flex items-center space-x-2 ${\n                      likedPhotos.has(photo.id) ? 'text-red-500' : 'text-muted-foreground'\n                    }`}\n                    data-testid={`like-button-${photo.id}`}\n                  >\n                    <Heart \n                      className={`w-4 h-4 ${likedPhotos.has(photo.id) ? 'fill-current' : ''}`} \n                    />\n                    <span>{photo.likesCount || 0}</span>\n                  </Button>\n                </div>\n              </div>\n            </Card>\n            );\n          })}\n          \n          {/* Infinite Scroll Trigger */}\n          <div ref={loadMoreRef} className=\"flex justify-center p-4\">\n            {isFetchingNextPage ? (\n              <div className=\"flex items-center space-x-2 text-muted-foreground\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary\"></div>\n                <span className=\"text-sm\">Lade weitere Beiträge...</span>\n              </div>\n            ) : hasNextPage ? (\n              <Button\n                variant=\"outline\"\n                onClick={() => fetchNextPage()}\n                className=\"text-sm\"\n                data-testid=\"load-more-button\"\n              >\n                Weitere Beiträge laden\n              </Button>\n            ) : groupedPhotos.length > 0 ? (\n              <p className=\"text-sm text-muted-foreground\">Alle Beiträge geladen</p>\n            ) : null}\n          </div>\n        </div>\n      )}\n      \n      {/* Hidden File Input - Outside modal so it's always available */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        multiple\n        accept=\"image/*,video/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n        data-testid=\"file-input\"\n      />\n\n      {/* Floating Upload Button */}\n      <Button\n        onClick={() => fileInputRef.current?.click()}\n        className=\"fixed bottom-6 right-6 z-40 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-shadow\"\n        data-testid=\"floating-upload-button\"\n      >\n        <Plus className=\"w-6 h-6\" />\n      </Button>\n      \n      {/* Upload Modal */}\n      {showUploadModal && (\n        <Dialog open={showUploadModal} onOpenChange={uploadMutation.isPending ? undefined : closeUploadModal}>\n          <DialogContent className=\"max-w-md\" data-testid=\"upload-modal\">\n            <DialogHeader>\n              <DialogTitle>Neuen Beitrag teilen</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              {/* File Upload */}\n              <div className=\"space-y-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"w-full h-24 border-dashed border-2 hover:bg-gray-50 dark:hover:bg-gray-800\"\n                  data-testid=\"file-upload-button\"\n                >\n                  <div className=\"flex flex-col items-center space-y-2\">\n                    {mediaType === 'video' ? <Video className=\"w-8 h-8\" /> : <Image className=\"w-8 h-8\" />}\n                    <span className=\"text-sm\">\n                      {selectedFiles.length > 0 ? \n                        (selectedFiles.length === 1 ? selectedFiles[0].name : `${selectedFiles.length} Dateien`) : \n                        `${mediaType === 'video' ? 'Video' : 'Foto'} auswählen`}\n                    </span>\n                  </div>\n                </Button>\n                \n                {/* iOS Google Photos Help Text */}\n                <div className=\"text-xs text-muted-foreground bg-blue-50 dark:bg-blue-950 p-3 rounded-lg border border-blue-200 dark:border-blue-800\">\n                  <div className=\"flex items-start space-x-2\">\n                    <div className=\"text-blue-600 dark:text-blue-400 mt-0.5\">ℹ️</div>\n                    <div>\n                      <p className=\"font-medium text-blue-800 dark:text-blue-200 mb-1\">\n                        iOS/iPad Tipp: Google Photos Zugriff\n                      </p>\n                      <p className=\"text-blue-700 dark:text-blue-300\">\n                        Wenn Sie Fotos aus Google Photos hochladen möchten, speichern Sie diese zuerst in der iOS Fotos-App: \n                        Google Photos öffnen → Foto auswählen → Teilen → \"Zu Fotos hinzufügen\"\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              {selectedFiles.length > 0 && (\n                <div className=\"space-y-3\">\n                  {/* Location Selection */}\n                  <Select value={selectedLocationId} onValueChange={setSelectedLocationId}>\n                    <SelectTrigger data-testid=\"location-select\">\n                      <SelectValue placeholder=\"Location auswählen...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {locations.map((location) => (\n                        <SelectItem key={location.id} value={location.id}>\n                          {location.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  \n                  {/* Creator Selection */}\n                  <Select value={selectedCreatorId} onValueChange={setSelectedCreatorId}>\n                    <SelectTrigger data-testid=\"creator-select\">\n                      <SelectValue placeholder=\"Autor auswählen (optional)...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {creators.map((creator) => (\n                        <SelectItem key={creator.id} value={creator.id}>\n                          {creator.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  \n                  {/* Name Input (if no creator selected) */}\n                  {!selectedCreatorId && (\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Ihr Name...\"\n                      value={name}\n                      onChange={(e) => setName(e.target.value)}\n                      maxLength={100}\n                      data-testid=\"name-input\"\n                    />\n                  )}\n                  \n                  {/* Caption Input */}\n                  <Textarea\n                    placeholder=\"Beschreibung hinzufügen...\"\n                    value={caption}\n                    onChange={(e) => setCaption(e.target.value)}\n                    maxLength={500}\n                    rows={3}\n                    data-testid=\"caption-input\"\n                  />\n                  \n                  {/* Upload Button */}\n                  <div className=\"flex space-x-2\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={closeUploadModal}\n                      className=\"flex-1\"\n                      data-testid=\"cancel-upload-button\"\n                    >\n                      Abbrechen\n                    </Button>\n                    <Button\n                      onClick={handleUpload}\n                      disabled={uploadMutation.isPending || !selectedLocationId}\n                      className=\"flex-1\"\n                      data-testid=\"upload-button\"\n                    >\n                      {uploadMutation.isPending ? (\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-foreground\"></div>\n                          <span>Uploading...</span>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center space-x-2\">\n                          <Send className=\"w-4 h-4\" />\n                          <span>Teilen</span>\n                        </div>\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n      \n      {/* Full View Modal */}\n      {fullViewMedia && (\n        <Dialog open={!!fullViewMedia} onOpenChange={closeFullView}>\n          <DialogContent className=\"w-screen h-screen max-w-none max-h-none p-0 m-0 overflow-hidden flex flex-col bg-black border-0 rounded-none\" data-testid=\"full-view-modal\">\n            {/* Header - Minimized for mobile */}\n            <DialogHeader className=\"bg-black text-white p-2 md:p-4 flex-shrink-0\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-2 md:space-x-4\">\n                  <DialogTitle className=\"text-sm md:text-lg font-medium truncate\">\n                    {fullViewMedia.caption || 'Reisefoto'}\n                  </DialogTitle>\n                  {/* Image Counter - In header */}\n                  {fullViewCarousel && fullViewCarousel.length > 1 && (\n                    <div className=\"bg-gray-800 text-white px-2 py-1 md:px-3 rounded-full text-xs md:text-sm font-medium flex-shrink-0\">\n                      <span data-testid=\"full-view-counter\">\n                        {fullViewIndex + 1} von {fullViewCarousel.length}\n                      </span>\n                    </div>\n                  )}\n                  {/* Desktop Zoom Controls */}\n                  {fullViewMedia?.mediaType === 'image' && (\n                    <div className=\"hidden md:flex items-center space-x-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={handleZoomOut}\n                        disabled={zoomScale <= 1}\n                        className=\"text-white hover:bg-white/20 h-8 w-8 p-0\"\n                        data-testid=\"zoom-out-button\"\n                      >\n                        <span className=\"text-lg\">−</span>\n                      </Button>\n                      <span className=\"text-sm px-2\">{Math.round(zoomScale * 100)}%</span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={handleZoomIn}\n                        disabled={zoomScale >= 5}\n                        className=\"text-white hover:bg-white/20 h-8 w-8 p-0\"\n                        data-testid=\"zoom-in-button\"\n                      >\n                        <span className=\"text-lg\">+</span>\n                      </Button>\n                      {zoomScale > 1 && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={resetZoom}\n                          className=\"text-white hover:bg-white/20 h-8 px-2 text-xs\"\n                          data-testid=\"zoom-reset-button\"\n                        >\n                          Reset\n                        </Button>\n                      )}\n                    </div>\n                  )}\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={closeFullView}\n                  className=\"text-white hover:bg-white/20 h-8 w-8 md:h-8 md:w-8 p-0 touch-manipulation\"\n                  data-testid=\"close-full-view\"\n                >\n                  <X className=\"w-5 h-5 md:w-4 md:h-4\" />\n                </Button>\n              </div>\n              <div className=\"text-xs md:text-sm opacity-80 mt-1 md:mt-2 truncate\">\n                {fullViewMedia.creatorId ? \n                  creators.find(c => c.id === fullViewMedia.creatorId)?.name || fullViewMedia.uploadedBy || 'Unbekannt' : \n                  fullViewMedia.uploadedBy || 'Unbekannt'\n                } • {formatTime(fullViewMedia.uploadedAt)}\n                {getLocationName(fullViewMedia.locationId) && (\n                  <span> • 📍 {getLocationName(fullViewMedia.locationId)}</span>\n                )}\n              </div>\n            </DialogHeader>\n            \n            {/* Main content area with navigation */}\n            <div className=\"flex flex-1 items-center bg-black min-h-0\">\n              {/* Left Navigation - Hidden on mobile, visible on desktop only */}\n              {fullViewCarousel && fullViewCarousel.length > 1 && (\n                <div className=\"hidden md:flex flex-shrink-0 px-4\">\n                  <button\n                    onClick={goToFullViewPrev}\n                    className=\"bg-gray-800/80 text-white p-3 rounded-full hover:bg-gray-700 transition-colors backdrop-blur-sm\"\n                    data-testid=\"full-view-prev\"\n                  >\n                    <ChevronLeft className=\"w-6 h-6\" />\n                  </button>\n                </div>\n              )}\n\n              {/* Full-width image area with touch support */}\n              <div \n                className=\"flex-1 flex items-center justify-center bg-black min-h-0 overflow-hidden relative\"\n                onTouchStart={handleModalTouchStart}\n                onTouchMove={handleModalTouchMove}\n                onTouchEnd={handleModalTouchEnd}\n                style={{ \n                  touchAction: zoomScale > 1 ? 'none' : 'pan-y',\n                  cursor: zoomScale > 1 ? (isPanning ? 'grabbing' : 'grab') : 'default'\n                }}\n              >\n                {/* Mobile Touch Areas for Navigation - Full Height */}\n                {fullViewCarousel && fullViewCarousel.length > 1 && (\n                  <>\n                    {/* Left touch area */}\n                    <div \n                      className=\"md:hidden absolute left-0 top-0 bottom-0 w-1/3 z-10 flex items-center justify-start pl-4\"\n                      onClick={goToFullViewPrev}\n                      style={{ touchAction: 'manipulation' }}\n                    >\n                      <div className=\"opacity-0 bg-white text-black p-2 rounded-full\">\n                        <ChevronLeft className=\"w-4 h-4\" />\n                      </div>\n                    </div>\n                    \n                    {/* Right touch area */}\n                    <div \n                      className=\"md:hidden absolute right-0 top-0 bottom-0 w-1/3 z-10 flex items-center justify-end pr-4\"\n                      onClick={goToFullViewNext}\n                      style={{ touchAction: 'manipulation' }}\n                    >\n                      <div className=\"opacity-0 bg-white text-black p-2 rounded-full\">\n                        <ChevronRight className=\"w-4 h-4\" />\n                      </div>\n                    </div>\n                  </>\n                )}\n                {fullViewMedia.mediaType === 'video' && fullViewMedia.videoUrl ? (\n                  <video\n                    src={fullViewMedia.videoUrl}\n                    poster={fullViewMedia.thumbnailUrl || undefined}\n                    controls\n                    autoPlay\n                    className=\"w-full h-full object-contain\"\n                    data-testid=\"full-view-video\"\n                  >\n                    <source src={fullViewMedia.videoUrl} type=\"video/mp4\" />\n                    Ihr Browser unterstützt das Video-Element nicht.\n                  </video>\n                ) : fullViewMedia.imageUrl && (\n                  <div className=\"relative w-full h-full flex items-center justify-center\">\n                    {/* Loading Indicator */}\n                    {imageLoadingStates[fullViewMedia.id] && (\n                      <div className=\"absolute inset-0 flex items-center justify-center bg-black/50 z-20\">\n                        <div className=\"flex flex-col items-center gap-3\">\n                          <div className=\"animate-spin rounded-full h-8 w-8 md:h-12 md:w-12 border-2 border-white border-t-transparent\"></div>\n                          <div className=\"text-white text-sm opacity-80\">Bild wird geladen...</div>\n                        </div>\n                      </div>\n                    )}\n                    \n                    {/* Transition Overlay */}\n                    {imageTransitioning && (\n                      <div className=\"absolute inset-0 bg-black/30 z-10 transition-opacity duration-300\"></div>\n                    )}\n                    \n                    <img\n                      src={fullViewMedia.imageUrl}\n                      alt={fullViewMedia.caption || \"Reisefoto\"}\n                      className={`transition-all duration-300 ease-out ${\n                        imageTransitioning ? 'opacity-70' : 'opacity-100'\n                      }`}\n                      loading=\"eager\"\n                      fetchPriority=\"high\"\n                      decoding=\"async\"\n                      style={{\n                        maxWidth: zoomScale === 1 ? '100%' : 'none',\n                        maxHeight: zoomScale === 1 ? '100%' : 'none',\n                        width: zoomScale === 1 ? 'auto' : '100vw',\n                        height: zoomScale === 1 ? 'auto' : '100vh',\n                        objectFit: 'contain',\n                        transform: `scale(${zoomScale}) translate(${zoomPan.x / zoomScale}px, ${zoomPan.y / zoomScale}px)`,\n                        cursor: zoomScale > 1 ? (isPanning ? 'grabbing' : 'grab') : 'default',\n                        willChange: zoomScale > 1 ? 'transform' : 'auto',\n                        contain: 'layout style paint',\n                        ...getProgressiveImageStyle(fullViewMedia.id)\n                      }}\n                      data-testid=\"full-view-image\"\n                      onLoad={() => handleImageLoadComplete(fullViewMedia.id)}\n                      onError={() => handleImageError(fullViewMedia.id)}\n                      onLoadStart={() => handleImageLoadStart(fullViewMedia.id)}\n                      onWheel={(e) => {\n                        e.preventDefault();\n                        if (e.deltaY < 0) {\n                          handleZoomIn();\n                        } else {\n                          handleZoomOut();\n                        }\n                      }}\n                    />\n                  </div>\n                )}\n              </div>\n\n              {/* Right Navigation - Hidden on mobile, visible on desktop only */}\n              {fullViewCarousel && fullViewCarousel.length > 1 && (\n                <div className=\"hidden md:flex flex-shrink-0 px-4\">\n                  <button\n                    onClick={goToFullViewNext}\n                    className=\"bg-gray-800/80 text-white p-3 rounded-full hover:bg-gray-700 transition-colors backdrop-blur-sm\"\n                    data-testid=\"full-view-next\"\n                  >\n                    <ChevronRight className=\"w-6 h-6\" />\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Thumbnail Navigation - Clean, borderless design */}\n            {fullViewCarousel && fullViewCarousel.length > 1 && (\n              <div className=\"bg-black p-2 md:p-4 flex-shrink-0\">\n                <div className=\"flex justify-center gap-1 md:gap-2 overflow-x-auto px-2\">\n                  {fullViewCarousel.map((photo, index) => (\n                    <button\n                      key={photo.id}\n                      onClick={() => goToFullViewIndex(index)}\n                      className={`flex-shrink-0 w-12 h-12 md:w-16 md:h-16 rounded-lg transition-all overflow-hidden ${\n                        index === fullViewIndex \n                          ? 'ring-2 ring-white shadow-lg scale-110' \n                          : 'opacity-60 hover:opacity-80'\n                      }`}\n                      data-testid={`full-view-thumbnail-${index}`}\n                    >\n                      {photo.mediaType === 'video' && photo.thumbnailUrl ? (\n                        <div className=\"relative w-full h-full\">\n                          <img\n                            src={photo.thumbnailUrl}\n                            alt=\"Video thumbnail\"\n                            className=\"w-full h-full object-cover\"\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                          />\n                          <div className=\"absolute inset-0 flex items-center justify-center\">\n                            <Play className=\"w-4 h-4 text-white\" />\n                          </div>\n                        </div>\n                      ) : photo.imageUrl ? (\n                        <img\n                          src={photo.imageUrl}\n                          alt={photo.caption || \"Thumbnail\"}\n                          className=\"w-full h-full object-cover\"\n                          loading=\"lazy\"\n                          decoding=\"async\"\n                        />\n                      ) : (\n                        <div className=\"w-full h-full bg-gray-600 flex items-center justify-center\">\n                          <Camera className=\"w-6 h-6 text-white/50\" />\n                        </div>\n                      )}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Edit Dialog */}\n      {editingPost && (\n        <Dialog open={!!editingPost} onOpenChange={(open) => {\n          if (!open) {\n            setEditingPost(null);\n            setEditCaption(\"\");\n            setEditLocationId(\"none\");\n          }\n        }}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Beitrag bearbeiten</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Beschreibung</label>\n                <Textarea\n                  placeholder=\"Beschreibung bearbeiten...\"\n                  value={editCaption}\n                  onChange={(e) => setEditCaption(e.target.value)}\n                  className=\"text-base\"\n                  rows={4}\n                  maxLength={500}\n                  data-testid=\"edit-caption-input\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Ort</label>\n                <Select value={editLocationId} onValueChange={setEditLocationId}>\n                  <SelectTrigger data-testid=\"edit-location-select\">\n                    <SelectValue placeholder=\"Ort auswählen (optional)...\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"none\">Kein Ort</SelectItem>\n                    {locations && locations.length > 0 ? locations.map((location) => (\n                      <SelectItem key={location.id} value={location.id}>\n                        {location.name}\n                      </SelectItem>\n                    )) : (\n                      <SelectItem value=\"loading\" disabled>Lade Orte...</SelectItem>\n                    )}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center justify-end space-x-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setEditingPost(null);\n                    setEditCaption(\"\");\n                    setEditLocationId(\"none\");\n                  }}\n                  data-testid=\"edit-cancel-button\"\n                >\n                  Abbrechen\n                </Button>\n                <Button\n                  onClick={() => {\n                    if (editingPost) {\n                      editMutation.mutate({\n                        photoId: editingPost,\n                        caption: editCaption,\n                        locationId: editLocationId === \"none\" ? \"\" : editLocationId || \"\"\n                      });\n                    }\n                  }}\n                  disabled={editMutation.isPending}\n                  data-testid=\"edit-save-button\"\n                >\n                  {editMutation.isPending ? \"Speichern...\" : \"Speichern\"}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n}\n\n// Carousel Post Component\ninterface CarouselPostProps {\n  carousel: { type: 'carousel', groupId: string, photos: TripPhoto[], id: string, uploadedAt: Date | null, locationId: string | null };\n  creators: Creator[];\n  getLocationName: (locationId: string | null) => string | null;\n  formatTime: (date: Date | null) => string;\n  likedPhotos: Set<string>;\n  handleLike: (photoId: string) => void;\n  handleDelete: (photoId: string) => void;\n  openFullView: (photo: TripPhoto, carousel?: TripPhoto[]) => void;\n}\n\nfunction CarouselPost({ carousel, creators, getLocationName, formatTime, likedPhotos, handleLike, handleDelete, openFullView }: CarouselPostProps) {\n  const [currentIndex, setCurrentIndex] = React.useState(0);\n  const [isTransitioning, setIsTransitioning] = React.useState(false);\n  const [touchStart, setTouchStart] = React.useState<number | null>(null);\n  const [touchEnd, setTouchEnd] = React.useState<number | null>(null);\n  const currentPhoto = carousel.photos[currentIndex];\n\n  const nextPhoto = () => {\n    if (isTransitioning) return;\n    setIsTransitioning(true);\n    setCurrentIndex((prev) => (prev + 1) % carousel.photos.length);\n    setTimeout(() => setIsTransitioning(false), 300);\n  };\n\n  const prevPhoto = () => {\n    if (isTransitioning) return;\n    setIsTransitioning(true);\n    setCurrentIndex((prev) => (prev - 1 + carousel.photos.length) % carousel.photos.length);\n    setTimeout(() => setIsTransitioning(false), 300);\n  };\n\n  const goToSlide = (index: number) => {\n    if (isTransitioning || index === currentIndex) return;\n    setIsTransitioning(true);\n    setCurrentIndex(index);\n    setTimeout(() => setIsTransitioning(false), 300);\n  };\n\n  // Touch event handlers for mobile swipe\n  const handleTouchStart = (e: React.TouchEvent) => {\n    setTouchEnd(null);\n    setTouchStart(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    setTouchEnd(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchEnd = () => {\n    if (!touchStart || !touchEnd) return;\n    \n    const distance = touchStart - touchEnd;\n    const isLeftSwipe = distance > 50;\n    const isRightSwipe = distance < -50;\n\n    if (isLeftSwipe && carousel.photos.length > 1) {\n      nextPhoto();\n    }\n    if (isRightSwipe && carousel.photos.length > 1) {\n      prevPhoto();\n    }\n  };\n\n\n  return (\n    <Card className=\"overflow-hidden\" data-testid={`post-${carousel.id}`}>\n      {/* Post Header */}\n      <div className=\"p-3 pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"flex items-center space-x-1\" data-testid={`post-author-${carousel.id}`}>\n              <User className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"font-medium text-sm\">\n                {currentPhoto.creatorId ? \n                  creators.find(c => c.id === currentPhoto.creatorId)?.name || currentPhoto.uploadedBy || 'Unbekannt' : \n                  currentPhoto.uploadedBy || 'Unbekannt'\n                }\n              </span>\n            </div>\n            <div className=\"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full flex items-center space-x-1\">\n              <Image className=\"w-3 h-3\" />\n              <span>{carousel.photos.length} Fotos</span>\n            </div>\n            {getLocationName(currentPhoto.locationId) && (\n              <div className=\"text-xs text-muted-foreground bg-muted px-2 py-1 rounded-full\">\n                📍 {getLocationName(currentPhoto.locationId)}\n              </div>\n            )}\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"flex items-center space-x-1 text-xs text-muted-foreground\" data-testid={`post-time-${carousel.id}`}>\n              <Clock className=\"w-3 h-3\" />\n              <span>{formatTime(currentPhoto.uploadedAt)}</span>\n            </div>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 p-0 z-50 relative\"\n                  data-testid={`post-menu-${carousel.id}`}\n                >\n                  <MoreVertical className=\"w-4 h-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"z-50\">\n                <DropdownMenuItem\n                  onClick={() => handleDelete(currentPhoto.id)}\n                  className=\"text-red-600 focus:text-red-600\"\n                  data-testid={`delete-post-${carousel.id}`}\n                >\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                  Löschen\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </div>\n\n      {/* Carousel Content */}\n      <div \n        className=\"relative group overflow-hidden\"\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Sliding Container */}\n        <div \n          className=\"flex transition-transform duration-300 ease-in-out\"\n          style={{ transform: `translateX(-${currentIndex * 100}%)` }}\n        >\n          {carousel.photos.map((photo, index) => (\n            <div key={photo.id} className=\"w-full flex-shrink-0 relative\">\n              {photo.mediaType === 'video' && photo.videoUrl ? (\n                <VideoPreview photo={photo} openFullView={(p) => openFullView(p, carousel.photos)} />\n              ) : photo.imageUrl && (\n                <div className=\"relative cursor-pointer\" onClick={() => openFullView(photo, carousel.photos)}>\n                  <img\n                    src={photo.imageUrl}\n                    alt={photo.caption || \"Reisefoto\"}\n                    className=\"w-full object-cover max-h-96 bg-gray-50 dark:bg-gray-800\"\n                    loading=\"lazy\"\n                    decoding=\"async\"\n                    data-testid={`post-image-${photo.id}`}\n                  />\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity\">\n                    <div className=\"bg-white/90 dark:bg-black/90 rounded-full p-3\">\n                      <Maximize2 className=\"w-6 h-6 text-black dark:text-white\" />\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Navigation Arrows - Only show if more than 1 photo */}\n        {carousel.photos.length > 1 && (\n          <>\n            <button\n              onClick={prevPhoto}\n              className=\"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full opacity-60 hover:opacity-100 transition-opacity hover:bg-black/70\"\n              data-testid={`carousel-prev-${carousel.id}`}\n            >\n              <ChevronLeft className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={nextPhoto}\n              className=\"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 text-white p-2 rounded-full opacity-60 hover:opacity-100 transition-opacity hover:bg-black/70\"\n              data-testid={`carousel-next-${carousel.id}`}\n            >\n              <ChevronRight className=\"w-4 h-4\" />\n            </button>\n          </>\n        )}\n\n        {/* Carousel Indicators */}\n        {carousel.photos.length > 1 && (\n          <div className=\"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-black/30 px-2 py-1 rounded-full\">\n            {carousel.photos.map((_, index) => (\n              <button\n                key={index}\n                onClick={() => goToSlide(index)}\n                className={`w-2.5 h-2.5 rounded-full transition-colors ${\n                  index === currentIndex ? 'bg-white' : 'bg-white/50'\n                }`}\n                data-testid={`carousel-indicator-${carousel.id}-${index}`}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Post Caption */}\n      {currentPhoto.caption && (\n        <div className=\"px-3 py-1.5\">\n          <p className=\"text-sm\" data-testid={`post-caption-${currentPhoto.id}`}>{currentPhoto.caption}</p>\n        </div>\n      )}\n\n      {/* Post Actions - Like */}\n      <div className=\"p-3 pt-2 border-t border-border/50\">\n        <div className=\"flex items-center\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => handleLike(currentPhoto.id)}\n            className={`flex items-center space-x-2 ${\n              likedPhotos.has(currentPhoto.id) ? 'text-red-500' : 'text-muted-foreground'\n            }`}\n            data-testid={`like-button-${currentPhoto.id}`}\n          >\n            <Heart \n              className={`w-4 h-4 ${likedPhotos.has(currentPhoto.id) ? 'fill-current' : ''}`} \n            />\n            <span>{currentPhoto.likesCount || 0}</span>\n          </Button>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\n// Video Preview Component with fallback handling\ninterface VideoPreviewProps {\n  photo: TripPhoto;\n  openFullView: (photo: TripPhoto, carousel?: TripPhoto[]) => void;\n}\n\nfunction VideoPreview({ photo, openFullView }: VideoPreviewProps) {\n  const [showVideo, setShowVideo] = React.useState(false);\n  const [thumbnailError, setThumbnailError] = React.useState(false);\n  const [isVideoLoaded, setIsVideoLoaded] = React.useState(false);\n  const [generatedThumbnail, setGeneratedThumbnail] = React.useState<string | null>(null);\n  const videoRef = React.useRef<HTMLVideoElement>(null);\n  const hiddenVideoRef = React.useRef<HTMLVideoElement>(null);\n\n  // Generate a thumbnail from the video if no thumbnailUrl is available\n  const generateThumbnailFromVideo = React.useCallback(() => {\n    const video = hiddenVideoRef.current;\n    if (!video || photo.thumbnailUrl || generatedThumbnail) return;\n\n    // Ensure video has loaded dimensions\n    if (video.videoWidth === 0 || video.videoHeight === 0) {\n      console.warn('Video dimensions not ready for thumbnail generation');\n      return;\n    }\n\n    try {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      // Set canvas size to video dimensions\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n\n      // Draw the current frame\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n      // Convert to data URL\n      const dataURL = canvas.toDataURL('image/jpeg', 0.8);\n      setGeneratedThumbnail(dataURL);\n    } catch (error) {\n      console.warn('Failed to generate video thumbnail:', error);\n      setThumbnailError(true);\n    }\n  }, [photo.thumbnailUrl, generatedThumbnail]);\n\n  const handleHiddenVideoLoadedMetadata = () => {\n    const video = hiddenVideoRef.current;\n    if (video && !photo.thumbnailUrl) {\n      // Seek to 1 second or 10% of video duration for better thumbnail\n      video.currentTime = Math.min(1, video.duration * 0.1);\n    }\n  };\n\n  const handleHiddenVideoSeeked = () => {\n    generateThumbnailFromVideo();\n  };\n\n  const handleVideoLoadedMetadata = () => {\n    setIsVideoLoaded(true);\n  };\n\n  const handlePlayClick = () => {\n    setShowVideo(true);\n    // Small delay to ensure video element is rendered\n    setTimeout(() => {\n      if (videoRef.current) {\n        videoRef.current.play();\n      }\n    }, 100);\n  };\n\n  const hasThumbnail = photo.thumbnailUrl && !thumbnailError;\n  const hasGeneratedThumbnail = generatedThumbnail && !hasThumbnail;\n\n  return (\n    <div className=\"relative group\" data-testid={`post-video-${photo.id}`}>\n      {/* Hidden video for thumbnail generation - only load if no thumbnailUrl */}\n      {!photo.thumbnailUrl && (\n        <video\n          ref={hiddenVideoRef}\n          src={photo.videoUrl || \"\"}\n          crossOrigin=\"anonymous\"\n          preload=\"metadata\"\n          muted\n          playsInline\n          className=\"absolute opacity-0 pointer-events-none\"\n          style={{ width: '1px', height: '1px' }}\n          onLoadedMetadata={handleHiddenVideoLoadedMetadata}\n          onSeeked={handleHiddenVideoSeeked}\n          onCanPlay={generateThumbnailFromVideo}\n          onError={() => setThumbnailError(true)}\n        />\n      )}\n      \n      {!showVideo ? (\n        // Preview mode - show thumbnail, generated thumbnail, or placeholder\n        <div className=\"relative w-full h-96 bg-gray-900 rounded cursor-pointer\" onClick={handlePlayClick}>\n          {hasThumbnail ? (\n            <img\n              src={photo.thumbnailUrl || \"\"}\n              alt={photo.caption || \"Video Vorschau\"}\n              className=\"w-full h-full object-cover rounded\"\n              onError={() => setThumbnailError(true)}\n              data-testid={`post-video-thumbnail-${photo.id}`}\n            />\n          ) : hasGeneratedThumbnail ? (\n            <img\n              src={generatedThumbnail}\n              alt={photo.caption || \"Video Vorschau\"}\n              className=\"w-full h-full object-cover rounded\"\n              data-testid={`post-video-generated-thumbnail-${photo.id}`}\n            />\n          ) : (\n            // Fallback placeholder with gradient background\n            <div className=\"w-full h-full bg-gradient-to-br from-gray-800 to-gray-900 rounded flex items-center justify-center\">\n              <div className=\"text-center text-white\">\n                <Video className=\"w-16 h-16 mx-auto mb-2 opacity-60\" />\n                <p className=\"text-sm opacity-80\">Video wird geladen...</p>\n              </div>\n            </div>\n          )}\n          \n          {/* Play button overlay */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"bg-black/60 rounded-full p-4 hover:bg-black/80 transition-colors\" data-testid={`button-play-${photo.id}`}>\n              <PlayCircle className=\"w-12 h-12 text-white\" />\n            </div>\n          </div>\n          \n          {/* Video badge */}\n          <div className=\"absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-md text-xs flex items-center space-x-1\">\n            <Video className=\"w-3 h-3\" />\n            <span>Video</span>\n          </div>\n        </div>\n      ) : (\n        // Video mode - show actual video player\n        <div className=\"relative\">\n          <video\n            ref={videoRef}\n            src={photo.videoUrl || \"\"}\n            crossOrigin=\"anonymous\"\n            poster={hasGeneratedThumbnail ? generatedThumbnail : (photo.thumbnailUrl || undefined)}\n            controls\n            preload=\"metadata\"\n            playsInline\n            className=\"w-full max-h-96 object-cover rounded\"\n            data-testid={`post-video-player-${photo.id}`}\n            onLoadedMetadata={handleVideoLoadedMetadata}\n            onError={(e) => {\n              console.error('Video error:', e);\n              console.log('Video URL:', photo.videoUrl);\n            }}\n          >\n            <source src={photo.videoUrl || \"\"} type=\"video/mp4\" />\n            Ihr Browser unterstützt das Video-Element nicht.\n          </video>\n          \n          {/* Video badge */}\n          <div className=\"absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-md text-xs flex items-center space-x-1\">\n            <Video className=\"w-3 h-3\" />\n            <span>Video</span>\n          </div>\n          \n          {/* Fullscreen button */}\n          <button \n            onClick={() => openFullView(photo)}\n            className=\"absolute top-2 right-2 bg-black/50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70\"\n            title=\"Vollbild anzeigen\"\n            data-testid={`button-fullview-${photo.id}`}\n          >\n            <Maximize2 className=\"w-4 h-4\" />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":88835},"client/src/contexts/LanguageContext.tsx":{"content":"import { createContext, useContext, useState, ReactNode } from 'react';\n\ntype Language = 'de' | 'en';\n\ninterface Translations {\n  [key: string]: {\n    de: string;\n    en: string;\n  };\n}\n\nconst translations: Translations = {\n  // Header and Navigation\n  'liveFeed': { de: 'Live Fotoalbum', en: 'Live Feed' },\n  'homepage': { de: 'Startseite', en: 'Home' },\n  'navItinerary': { de: 'Reiseverlauf', en: 'Itinerary' },\n  'navEdit': { de: 'Editieren', en: 'Edit' },\n  'language': { de: 'Sprache', en: 'Language' },\n  \n  // Home Page Stats\n  'travelDays': { de: 'Reisetage', en: 'Travel Days' },\n  'destinations': { de: 'Reiseziele', en: 'Destinations' },\n  'kilometers': { de: 'Kilometer', en: 'Kilometers' },\n  'memories': { de: 'Erinnerungen', en: 'Memories' },\n  \n  // Home Page Sections\n  'ourItinerary': { de: 'Unser Reiseverlauf', en: 'Our Itinerary' },\n  'itineraryDescription': { \n    de: 'Eine sorgfältig geplante Reise durch die schönsten Regionen Westkanadas', \n    en: 'A carefully planned journey through the most beautiful regions of Western Canada' \n  },\n  'spectacularLandscapes': { de: 'Spektakuläre Landschaften erwarten uns', en: 'Spectacular Landscapes Await Us' },\n  'landscapeDescription': { \n    de: 'Von den türkisfarbenen Seen des Okanagan-Tals bis zu den majestätischen Gipfeln der Rocky Mountains - jeder Ort ist ein Fotomotiv', \n    en: 'From the turquoise lakes of the Okanagan Valley to the majestic peaks of the Rocky Mountains - every place is a photo opportunity' \n  },\n  'unforgettableJourney': { de: 'Eine unvergessliche Reise durch Westkanada', en: 'An unforgettable journey through Western Canada' },\n  \n  // Admin Forms\n  'name': { de: 'Name', en: 'Name' },\n  'slug': { de: 'URL-Slug', en: 'URL Slug' },\n  'startDate': { de: 'Start-Datum', en: 'Start Date' },\n  'endDate': { de: 'End-Datum', en: 'End Date' },\n  'description': { de: 'Beschreibung', en: 'Description' },\n  'distance': { de: 'Entfernung', en: 'Distance' },\n  'save': { de: 'Speichern', en: 'Save' },\n  'cancel': { de: 'Abbrechen', en: 'Cancel' },\n  'edit': { de: 'Bearbeiten', en: 'Edit' },\n  'delete': { de: 'Löschen', en: 'Delete' },\n  \n  // Location Details\n  'about': { de: 'Über', en: 'About' },\n  'activities': { de: 'Aktivitäten', en: 'Activities' },\n  'restaurants': { de: 'Restaurants', en: 'Restaurants' },\n  'culinary': { de: 'Kulinarik', en: 'Culinary' },\n  'accommodation': { de: 'Unterkunft', en: 'Accommodation' },\n  'amenities': { de: 'Ausstattung & Annehmlichkeiten', en: 'Amenities & Services' },\n  'checkInTime': { de: 'Check-in Zeit', en: 'Check-in Time' },\n  'checkOutTime': { de: 'Check-out Zeit', en: 'Check-out Time' },\n  'includedServices': { de: 'Inklusive Leistungen', en: 'Included Services' },\n  'highlights': { de: 'Highlights', en: 'Highlights' },\n  'experiences': { de: 'Erlebnisse', en: 'Experiences' },\n  'funFacts': { de: 'Wissenswertes & Fun Facts', en: 'Fun Facts & Trivia' },\n  'didYouKnow': { de: 'Wussten Sie schon?', en: 'Did You Know?' },\n  \n  // Restaurant Management\n  'addRestaurant': { de: 'Restaurant hinzufügen', en: 'Add Restaurant' },\n  'noRestaurantsAdded': { de: 'Noch keine Restaurants hinzugefügt', en: 'No restaurants added yet' },\n  'clickToAddRestaurant': { de: 'Klicken Sie auf \"Restaurant hinzufügen\" um zu starten', en: 'Click \"Add Restaurant\" to get started' },\n  'restaurantName': { de: 'Restaurant Name', en: 'Restaurant Name' },\n  'cuisine': { de: 'Küchenstil', en: 'Cuisine Style' },\n  'websiteUrl': { de: 'Website URL', en: 'Website URL' },\n  'accommodationWebsite': { de: 'Unterkunft Website', en: 'Accommodation Website' },\n  'accommodationImage': { de: 'Unterkunft Bild', en: 'Accommodation Image' },\n  'websiteLinkAdded': { de: 'Website-Link hinzugefügt', en: 'Website link added' },\n  \n  // Form Placeholders\n  'experienceDescription': { de: 'Erlebnis beschreiben...', en: 'Describe experience...' },\n  'highlight': { de: 'Highlight...', en: 'Highlight...' },\n  'interestingFact': { de: 'Interessante Tatsache oder Fun Fact...', en: 'Interesting fact or fun fact...' },\n  \n  // Live Feed\n  'shareNewPost': { de: 'Neuen Beitrag teilen', en: 'Share New Post' },\n  'photo': { de: 'Foto', en: 'Photo' },\n  'video': { de: 'Video', en: 'Video' },\n  'imageUrl': { de: 'Bild-URL', en: 'Image URL' },\n  'caption': { de: 'Bildunterschrift', en: 'Caption' },\n  'upload': { de: 'Hochladen', en: 'Upload' },\n  'selectFile': { de: 'Datei auswählen', en: 'Select File' },\n  'liveTracking': { de: 'Live-Tracking', en: 'Live Tracking' },\n  \n  // Admin Panel\n  'managePersons': { de: 'Personen verwalten', en: 'Manage People' },\n  'manageLocation': { de: 'Ort verwalten', en: 'Manage Location' },\n  'title': { de: 'Titel', en: 'Title' },\n  'passwordRequired': { de: 'Passwort erforderlich', en: 'Password Required' },\n  'password': { de: 'Passwort', en: 'Password' },\n  'login': { de: 'Anmelden', en: 'Login' },\n  \n  // Navigation\n  'next': { de: 'Nächste', en: 'Next' },\n  'backButton': { de: 'Zurück', en: 'Back' },\n  'morePages': { de: 'Mehr Seiten', en: 'More Pages' },\n  \n  // Date and Time\n  'day': { de: 'Tag', en: 'Day' },\n  'date': { de: 'Datum', en: 'Date' },\n  'itinerary': { de: 'Reiseverlauf', en: 'Itinerary' },\n  \n  // 404 Page\n  'pageNotFound': { de: '404 Seite nicht gefunden', en: '404 Page Not Found' },\n  'pageNotFoundDescription': { de: 'Haben Sie vergessen, die Seite zum Router hinzuzufügen?', en: 'Did you forget to add the page to the router?' },\n  \n  // Media Upload\n  'galleryImages': { de: 'Bilder-Galerie', en: 'Image Gallery' },\n  'nights': { de: 'Nächte', en: 'Nights' },\n  \n  // Error Messages (keeping some original German for multer)\n  'onlyImageFilesAllowed': { de: 'Nur Bilddateien sind erlaubt (JPG, PNG, WebP, GIF)', en: 'Only image files are allowed (JPG, PNG, WebP, GIF)' },\n  \n  // Location Detail Page  \n  'locationNotFound': { de: 'Ort nicht gefunden', en: 'Location Not Found' },\n  'locationNotFoundDescription': { de: 'Der angeforderte Ort konnte nicht gefunden werden.', en: 'The requested location could not be found.' },\n  'backToHomepage': { de: 'Zurück zur Startseite', en: 'Back to Homepage' },\n  'editLocation': { de: 'Ort bearbeiten', en: 'Edit Location' },\n  'viewDetails': { de: 'Details ansehen', en: 'View Details' },\n  'locationMap': { de: 'Lage & Karte', en: 'Location & Map' },\n  'aboutLocation': { de: 'Über', en: 'About' },\n  \n  // Image Gallery\n  'addImage': { de: 'Bild hinzufügen', en: 'Add Image' },\n  'imageAdded': { de: 'Bild hinzugefügt', en: 'Image Added' },\n  'imageAddedSuccess': { de: 'Das Bild wurde erfolgreich zur Galerie hinzugefügt.', en: 'The image was successfully added to the gallery.' },\n  'imageDeleted': { de: 'Bild gelöscht', en: 'Image Deleted' },\n  'imageDeletedSuccess': { de: 'Das Bild wurde erfolgreich aus der Galerie entfernt.', en: 'The image was successfully removed from the gallery.' },\n  'error': { de: 'Fehler', en: 'Error' },\n  'imageCouldNotBeAdded': { de: 'Bild konnte nicht hinzugefügt werden', en: 'Image could not be added' },\n  'imageCouldNotBeDeleted': { de: 'Bild konnte nicht gelöscht werden', en: 'Image could not be deleted' },\n  \n  // Timeline\n  'liveTrackingActivated': { de: 'Live-Tracking aktiviert!', en: 'Live Tracking Activated!' },\n  'gpsOptional': { de: 'GPS optional', en: 'GPS Optional' },\n  'gpsError': { de: 'GPS-Fehler', en: 'GPS Error' },\n  'liveCarOptional': { de: 'Das Live-Auto ist optional. Die App funktioniert trotzdem!', en: 'Live car tracking is optional. The app works anyway!' },\n  \n  // Categories (used in LocationCard)\n  'wineCountry': { de: 'Wine Country', en: 'Wine Country' },\n  'alpineAdventure': { de: 'Alpine Adventure', en: 'Alpine Adventure' },\n  'wilderness': { de: 'Wilderness', en: 'Wilderness' },\n  \n  // Additional Location Detail Sections\n  'restaurantsAndCulinary': { de: 'Restaurants & Kulinarik', en: 'Restaurants & Culinary' },\n  'specialExperiences': { de: 'Besondere Erlebnisse', en: 'Special Experiences' },\n  'yourAccommodation': { de: 'Ihre Unterkunft', en: 'Your Accommodation' },\n  'accommodationDescription': { de: 'Zentral gelegene Unterkunft mit modernen Annehmlichkeiten', en: 'Centrally located accommodation with modern amenities' },\n  \n  // Image Gallery\n  'noImagesYet': { de: 'Noch keine Bilder vorhanden', en: 'No Images Yet' },\n  'noImagesAdmin': { de: 'Fügen Sie die ersten Bilder zu diesem Ort hinzu, um eine schöne Galerie zu erstellen', en: 'Add the first images to this location to create a beautiful gallery' },\n  'imagesComingSoon': { de: 'Bilder werden bald hinzugefügt', en: 'Images will be added soon' },\n  'dragFilesOrSelect': { de: 'Ziehen Sie Dateien hierher oder wählen Sie sie aus', en: 'Drag files here or select them' },\n  'selectFiles': { de: 'Dateien auswählen', en: 'Select Files' },\n  'mainImage': { de: 'Hauptbild', en: 'Main Image' },\n  'addMoreImages': { de: 'Weitere hinzufügen', en: 'Add More' },\n  'moreImages': { de: 'Weitere Bilder', en: 'More Images' },\n  'images': { de: 'Bilder', en: 'Images' },\n  'setAsMain': { de: 'Als Hauptbild festlegen', en: 'Set as Main' },\n  'addUrlImage': { de: 'URL hinzufügen', en: 'Add URL' },\n  'uploadFiles': { de: 'Dateien hochladen', en: 'Upload Files' },\n  'uploadDescription': { de: 'Wählen Sie bis zu 5 Bilder aus (max. 10MB pro Datei)', en: 'Select up to 5 images (max. 10MB per file)' },\n  'imagePreview': { de: 'Bild-Vorschau', en: 'Image Preview' },\n  'saving': { de: 'Speichern...', en: 'Saving...' },\n  'preview': { de: 'Vorschau', en: 'Preview' },\n  'mainImageSet': { de: 'Hauptbild festgelegt', en: 'Main Image Set' },\n  'mainImageSetDescription': { de: 'Das Bild wurde als Hauptbild festgelegt.', en: 'The image has been set as the main image.' },\n  'mainImageSetError': { de: 'Hauptbild konnte nicht festgelegt werden', en: 'Could not set main image' },\n};\n\ninterface LanguageContextType {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  t: (key: string) => string;\n  getLocationText: (germanText: string | null | undefined, englishText: string | null | undefined) => string;\n  getLocationArray: (germanArray: string[] | null | undefined, englishArray: string[] | null | undefined) => string[];\n}\n\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\n\nexport function LanguageProvider({ children }: { children: ReactNode }) {\n  const [language, setLanguage] = useState<Language>('de'); // German as default\n\n  const t = (key: string): string => {\n    const translation = translations[key];\n    if (!translation) {\n      console.warn(`Translation missing for key: ${key}`);\n      return key;\n    }\n    return translation[language];\n  };\n\n  const getLocationText = (germanText: string | null | undefined, englishText: string | null | undefined): string => {\n    if (language === 'en' && englishText) {\n      return englishText;\n    }\n    return germanText || '';\n  };\n\n  const getLocationArray = (germanArray: string[] | null | undefined, englishArray: string[] | null | undefined): string[] => {\n    if (language === 'en' && englishArray && englishArray.length > 0) {\n      return englishArray;\n    }\n    return germanArray || [];\n  };\n\n  return (\n    <LanguageContext.Provider value={{ language, setLanguage, t, getLocationText, getLocationArray }}>\n      {children}\n    </LanguageContext.Provider>\n  );\n}\n\nexport function useLanguage() {\n  const context = useContext(LanguageContext);\n  if (context === undefined) {\n    throw new Error('useLanguage must be used within a LanguageProvider');\n  }\n  return context;\n}","size_bytes":11500},"client/src/lib/locationUtils.ts":{"content":"// Simple hardcoded city lookup for Canadian tour locations\n// Approximate coordinate boundaries for each city in the tour\n\ninterface CityBounds {\n  name: string;\n  nameEn: string;\n  province: string;\n  northLat: number;\n  southLat: number;\n  eastLng: number;\n  westLng: number;\n}\n\n// Hardcoded Canadian tour cities with approximate coordinate boundaries\nconst CANADIAN_CITIES: CityBounds[] = [\n  {\n    name: \"Penticton\",\n    nameEn: \"Penticton\", \n    province: \"BC\",\n    northLat: 49.57,\n    southLat: 49.43,\n    eastLng: -119.45,\n    westLng: -119.67\n  },\n  {\n    name: \"Vernon\",\n    nameEn: \"Vernon\",\n    province: \"BC\", \n    northLat: 50.30,\n    southLat: 50.20,\n    eastLng: -119.20,\n    westLng: -119.40\n  },\n  {\n    name: \"Golden\",\n    nameEn: \"Golden\",\n    province: \"BC\",\n    northLat: 51.35,\n    southLat: 51.25,\n    eastLng: -116.90,\n    westLng: -117.10\n  },\n  {\n    name: \"Jasper\",\n    nameEn: \"Jasper\", \n    province: \"AB\",\n    northLat: 52.95,\n    southLat: 52.85,\n    eastLng: -117.95,\n    westLng: -118.15\n  },\n  {\n    name: \"Clearwater\",\n    nameEn: \"Clearwater\",\n    province: \"BC\",\n    northLat: 51.70,\n    southLat: 51.60,\n    eastLng: -120.00,\n    westLng: -120.20\n  },\n  {\n    name: \"Lillooet\",\n    nameEn: \"Lillooet\",\n    province: \"BC\", \n    northLat: 50.70,\n    southLat: 50.60,\n    eastLng: -121.90,\n    westLng: -122.10\n  },\n  {\n    name: \"Sunshine Coast\",\n    nameEn: \"Sunshine Coast\",\n    province: \"BC\",\n    northLat: 49.75,\n    southLat: 49.35,\n    eastLng: -123.50,\n    westLng: -124.10\n  }\n];\n\n/**\n * Simple city lookup based on GPS coordinates\n * Returns the nearest Canadian tour city name or a generic location\n */\nexport function getCityFromCoordinates(lat: number, lng: number, useEnglish: boolean = false): string {\n  // Check if coordinates are within any city bounds\n  for (const city of CANADIAN_CITIES) {\n    if (lat >= city.southLat && lat <= city.northLat && \n        lng >= city.westLng && lng <= city.eastLng) {\n      const cityName = useEnglish ? city.nameEn : city.name;\n      return `${cityName}, ${city.province}`;\n    }\n  }\n  \n  // Calculate distances to find nearest city if not within bounds\n  let nearestCity = CANADIAN_CITIES[0];\n  let shortestDistance = Number.MAX_VALUE;\n  \n  for (const city of CANADIAN_CITIES) {\n    // Use center point of city bounds\n    const cityLat = (city.northLat + city.southLat) / 2;\n    const cityLng = (city.eastLng + city.westLng) / 2;\n    \n    // Simple distance calculation (Haversine formula)\n    const distance = calculateDistance(lat, lng, cityLat, cityLng);\n    \n    if (distance < shortestDistance) {\n      shortestDistance = distance;\n      nearestCity = city;\n    }\n  }\n  \n  // If within 150km of a tour city, show \"Near [City]\"\n  if (shortestDistance <= 150) {\n    const cityName = useEnglish ? nearestCity.nameEn : nearestCity.name;\n    const nearText = useEnglish ? \"Near\" : \"Nähe\";\n    return `${nearText} ${cityName}, ${nearestCity.province}`;\n  }\n  \n  // Otherwise show generic Canadian region based on coordinates\n  return getGenericRegion(lat, lng, useEnglish);\n}\n\n/**\n * Calculate distance between two points using Haversine formula\n */\nfunction calculateDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\n  const dLng = ((lng2 - lng1) * Math.PI) / 180;\n  \n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos((lat1 * Math.PI) / 180) *\n      Math.cos((lat2 * Math.PI) / 180) *\n      Math.sin(dLng / 2) *\n      Math.sin(dLng / 2);\n  \n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/**\n * Get generic Canadian region based on coordinates\n */\nfunction getGenericRegion(lat: number, lng: number, useEnglish: boolean): string {\n  // British Columbia (roughly)\n  if (lng >= -140 && lng <= -114 && lat >= 48 && lat <= 60) {\n    return useEnglish ? \"British Columbia, Canada\" : \"British Columbia, Kanada\";\n  }\n  \n  // Alberta (roughly)  \n  if (lng >= -120 && lng <= -110 && lat >= 49 && lat <= 60) {\n    return useEnglish ? \"Alberta, Canada\" : \"Alberta, Kanada\";\n  }\n  \n  // Generic Canada\n  return useEnglish ? \"Canada\" : \"Kanada\";\n}\n\n/**\n * Format current time in German or English format\n */\nexport function getCurrentTimeFormatted(useEnglish: boolean = false): string {\n  const now = new Date();\n  \n  if (useEnglish) {\n    return now.toLocaleTimeString('en-CA', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: true\n    });\n  } else {\n    return now.toLocaleTimeString('de-DE', {\n      hour: '2-digit', \n      minute: '2-digit',\n      hour12: false\n    });\n  }\n}\n\n/**\n * Get location status text with city and time\n */\nexport function getLocationStatus(lat: number, lng: number, useEnglish: boolean = false): string {\n  const cityText = getCityFromCoordinates(lat, lng, useEnglish);\n  const timeText = getCurrentTimeFormatted(useEnglish);\n  const currentlyText = useEnglish ? \"Currently\" : \"Aktuell\";\n  \n  return `${currentlyText}: ${cityText} • ${timeText}`;\n}","size_bytes":5053},"client/src/components/DocumentTitle.tsx":{"content":"import { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { TourSettings } from \"@shared/schema\";\n\nexport default function DocumentTitle() {\n  // Fetch tour settings to get the current tour name\n  const { data: tourSettings } = useQuery<TourSettings>({\n    queryKey: [\"/api/tour-settings\"],\n  });\n\n  // Update document title when tour settings change\n  useEffect(() => {\n    if (tourSettings?.tourName) {\n      document.title = `${tourSettings.tourName} - Ihr persönlicher Reiseführer`;\n    } else {\n      document.title = `Kanada Tour - Ihr persönlicher Reiseführer`;\n    }\n  }, [tourSettings?.tourName]);\n\n  // This component doesn't render anything\n  return null;\n}","size_bytes":711},"scripts/push-to-github.sh":{"content":"\n#!/bin/bash\n\n# Automated GitHub push script\necho \"🚀 Starting automated GitHub push...\"\n\n# Check if we're in a git repository\nif [ ! -d \".git\" ]; then\n    echo \"❌ Not a git repository. Initializing...\"\n    git init\n    echo \"✅ Git repository initialized\"\nfi\n\n# Check if remote origin exists\nif ! git remote get-url origin > /dev/null 2>&1; then\n    echo \"❌ No GitHub remote found. Please set up your GitHub repository first.\"\n    echo \"Run: git remote add origin https://github.com/yourusername/yourrepo.git\"\n    exit 1\nfi\n\n# Add all changes\necho \"📁 Adding all changes...\"\ngit add .\n\n# Check if there are changes to commit\nif git diff --staged --quiet; then\n    echo \"✅ No changes to commit. Repository is up to date.\"\n    exit 0\nfi\n\n# Get commit message from user or use default\nif [ -z \"$1\" ]; then\n    COMMIT_MSG=\"Auto-commit: $(date '+%Y-%m-%d %H:%M:%S')\"\nelse\n    COMMIT_MSG=\"$1\"\nfi\n\n# Commit changes\necho \"💾 Committing changes with message: '$COMMIT_MSG'\"\ngit commit -m \"$COMMIT_MSG\"\n\n# Push to GitHub\necho \"⬆️ Pushing to GitHub...\"\nif git push origin main 2>/dev/null || git push origin master 2>/dev/null; then\n    echo \"✅ Successfully pushed to GitHub!\"\nelse\n    echo \"❌ Push failed. Trying to pull and merge first...\"\n    \n    # Try to pull and merge\n    git pull origin main --rebase 2>/dev/null || git pull origin master --rebase 2>/dev/null\n    \n    # Try pushing again\n    if git push origin main 2>/dev/null || git push origin master 2>/dev/null; then\n        echo \"✅ Successfully pushed to GitHub after rebase!\"\n    else\n        echo \"❌ Push failed. Please check your GitHub credentials and repository access.\"\n        exit 1\n    fi\nfi\n\necho \"🎉 Automation complete!\"\n","size_bytes":1715}},"version":1}